const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/login.bundle.js","assets/login.css","js/activities.bundle.js","assets/activities.css","js/choice.bundle.js","assets/choice.css","js/skills.bundle.js","js/filterbox.bundle.js","assets/filterbox.css","assets/skills.css","js/equip.bundle.js","assets/equip.css","js/crafting.bundle.js","js/inventory.bundle.js","assets/inventory.css","js/potions.bundle.js","assets/potions.css","js/home.bundle.js","js/slotpick.bundle.js","assets/home.css","js/player.bundle.js","assets/player.css","js/bestiary.bundle.js","assets/bestiary.css","js/travelogue.bundle.js","assets/travelogue.css","js/spells.bundle.js","js/spellschool.bundle.js","assets/spellschool.css","assets/spells.css","js/adventure.bundle.js","assets/adventure.css","js/enchanting.bundle.js","assets/enchanting.css","js/minions.bundle.js","assets/minions.css","js/scraft.bundle.js","assets/scraft.css","js/glossary.bundle.js","assets/glossary.css","js/confirm.bundle.js","assets/confirm.css"])))=>i.map(i=>d[i]);
var Xu=Object.defineProperty;var Yu=(e,t,s)=>t in e?Xu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var _s=(e,t,s)=>Yu(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();/**
* @vue/shared v3.4.30
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Ol(e,t){const s=new Set(e.split(","));return t?i=>s.has(i.toLowerCase()):i=>s.has(i)}const dt={},Vs=[],ie=()=>{},$u=()=>!1,Gn=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Ml=e=>e.startsWith("onUpdate:"),jt=Object.assign,Cl=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},Qu=Object.prototype.hasOwnProperty,et=(e,t)=>Qu.call(e,t),G=Array.isArray,qs=e=>ji(e)==="[object Map]",si=e=>ji(e)==="[object Set]",pa=e=>ji(e)==="[object Date]",X=e=>typeof e=="function",Ot=e=>typeof e=="string",Oe=e=>typeof e=="symbol",ut=e=>e!==null&&typeof e=="object",Co=e=>(ut(e)||X(e))&&X(e.then)&&X(e.catch),Eo=Object.prototype.toString,ji=e=>Eo.call(e),Zu=e=>ji(e).slice(8,-1),Io=e=>ji(e)==="[object Object]",El=e=>Ot(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,yi=Ol(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Wn=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},tc=/-(\w)/g,Me=Wn(e=>e.replace(tc,(t,s)=>s?s.toUpperCase():"")),ec=/\B([A-Z])/g,ii=Wn(e=>e.replace(ec,"-$1").toLowerCase()),Jn=Wn(e=>e.charAt(0).toUpperCase()+e.slice(1)),br=Wn(e=>e?`on${Jn(e)}`:""),hs=(e,t)=>!Object.is(e,t),_n=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},Do=(e,t,s,i=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:i,value:s})},En=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let ga;const Lo=()=>ga||(ga=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ui(e){if(G(e)){const t={};for(let s=0;s<e.length;s++){const i=e[s],n=Ot(i)?rc(i):Ui(i);if(n)for(const r in n)t[r]=n[r]}return t}else if(Ot(e)||ut(e))return e}const sc=/;(?![^(]*\))/g,ic=/:([^]+)/,nc=/\/\*[^]*?\*\//g;function rc(e){const t={};return e.replace(nc,"").split(sc).forEach(s=>{if(s){const i=s.split(ic);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function Pt(e){let t="";if(Ot(e))t=e;else if(G(e))for(let s=0;s<e.length;s++){const i=Pt(e[s]);i&&(t+=i+" ")}else if(ut(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const lc="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ac=Ol(lc);function No(e){return!!e||e===""}function oc(e,t){if(e.length!==t.length)return!1;let s=!0;for(let i=0;s&&i<e.length;i++)s=Fi(e[i],t[i]);return s}function Fi(e,t){if(e===t)return!0;let s=pa(e),i=pa(t);if(s||i)return s&&i?e.getTime()===t.getTime():!1;if(s=Oe(e),i=Oe(t),s||i)return e===t;if(s=G(e),i=G(t),s||i)return s&&i?oc(e,t):!1;if(s=ut(e),i=ut(t),s||i){if(!s||!i)return!1;const n=Object.keys(e).length,r=Object.keys(t).length;if(n!==r)return!1;for(const l in e){const a=e.hasOwnProperty(l),o=t.hasOwnProperty(l);if(a&&!o||!a&&o||!Fi(e[l],t[l]))return!1}}return String(e)===String(t)}function Il(e,t){return e.findIndex(s=>Fi(s,t))}const b=e=>Ot(e)?e:e==null?"":G(e)||ut(e)&&(e.toString===Eo||!X(e.toString))?JSON.stringify(e,Ro,2):String(e),Ro=(e,t)=>t&&t.__v_isRef?Ro(e,t.value):qs(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[i,n],r)=>(s[kr(i,r)+" =>"]=n,s),{})}:si(t)?{[`Set(${t.size})`]:[...t.values()].map(s=>kr(s))}:Oe(t)?kr(t):ut(t)&&!G(t)&&!Io(t)?String(t):t,kr=(e,t="")=>{var s;return Oe(e)?`Symbol(${(s=e.description)!=null?s:t})`:e};/**
* @vue/reactivity v3.4.30
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let oe;class hc{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=oe,!t&&oe&&(this.index=(oe.scopes||(oe.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const s=oe;try{return oe=this,t()}finally{oe=s}}}on(){oe=this}off(){oe=this.parent}stop(t){if(this._active){let s,i;for(s=0,i=this.effects.length;s<i;s++)this.effects[s].stop();for(s=0,i=this.cleanups.length;s<i;s++)this.cleanups[s]();if(this.scopes)for(s=0,i=this.scopes.length;s<i;s++)this.scopes[s].stop(!0);if(!this.detached&&this.parent&&!t){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0,this._active=!1}}}function uc(e,t=oe){t&&t.active&&t.effects.push(e)}function cc(){return oe}let As;class Dl{constructor(t,s,i,n){this.fn=t,this.trigger=s,this.scheduler=i,this.active=!0,this.deps=[],this._dirtyLevel=5,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,uc(this,n)}get dirty(){if(this._dirtyLevel===2)return!1;if(this._dirtyLevel===3||this._dirtyLevel===4){this._dirtyLevel=1,ms();for(let t=0;t<this._depsLength;t++){const s=this.deps[t];if(s.computed){if(s.computed.effect._dirtyLevel===2)return Ge(),!0;if(fc(s.computed),this._dirtyLevel>=5)break}}this._dirtyLevel===1&&(this._dirtyLevel=0),Ge()}return this._dirtyLevel>=5}set dirty(t){this._dirtyLevel=t?5:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let t=rs,s=As;try{return rs=!0,As=this,this._runnings++,_a(this),this.fn()}finally{ya(this),this._runnings--,As=s,rs=t}}stop(){this.active&&(_a(this),ya(this),this.onStop&&this.onStop(),this.active=!1)}}function fc(e){return e.value}function _a(e){e._trackId++,e._depsLength=0}function ya(e){if(e.deps.length>e._depsLength){for(let t=e._depsLength;t<e.deps.length;t++)Po(e.deps[t],e);e.deps.length=e._depsLength}}function Po(e,t){const s=e.get(t);s!==void 0&&t._trackId!==s&&(e.delete(t),e.size===0&&e.cleanup())}let rs=!0,Wr=0;const jo=[];function ms(){jo.push(rs),rs=!1}function Ge(){const e=jo.pop();rs=e===void 0?!0:e}function Ll(){Wr++}function Nl(){for(Wr--;!Wr&&Jr.length;)Jr.shift()()}function Uo(e,t,s){if(t.get(e)!==e._trackId){t.set(e,e._trackId);const i=e.deps[e._depsLength];i!==t?(i&&Po(i,e),e.deps[e._depsLength++]=t):e._depsLength++}}const Jr=[];function Fo(e,t,s){Ll();for(const i of e.keys()){let n;if(!e.computed&&i.computed&&i._runnings>0&&(n??(n=e.get(i)===i._trackId))){i._dirtyLevel=2;continue}i._dirtyLevel<t&&(n??(n=e.get(i)===i._trackId))&&(i._shouldSchedule||(i._shouldSchedule=i._dirtyLevel===0),i.computed&&i._dirtyLevel===2&&(i._shouldSchedule=!0),i._dirtyLevel=t),i._shouldSchedule&&(n??(n=e.get(i)===i._trackId))&&(i.trigger(),(!i._runnings||i.allowRecurse)&&i._dirtyLevel!==3&&(i._shouldSchedule=!1,i.scheduler&&Jr.push(i.scheduler)))}Nl()}const Ho=(e,t)=>{const s=new Map;return s.cleanup=e,s.computed=t,s},Kr=new WeakMap,Os=Symbol(""),zr=Symbol("");function zt(e,t,s){if(rs&&As){let i=Kr.get(e);i||Kr.set(e,i=new Map);let n=i.get(s);n||i.set(s,n=Ho(()=>i.delete(s))),Uo(As,n)}}function Ve(e,t,s,i,n,r){const l=Kr.get(e);if(!l)return;let a=[];if(t==="clear")a=[...l.values()];else if(s==="length"&&G(e)){const o=Number(i);l.forEach((h,f)=>{(f==="length"||!Oe(f)&&f>=o)&&a.push(h)})}else switch(s!==void 0&&a.push(l.get(s)),t){case"add":G(e)?El(s)&&a.push(l.get("length")):(a.push(l.get(Os)),qs(e)&&a.push(l.get(zr)));break;case"delete":G(e)||(a.push(l.get(Os)),qs(e)&&a.push(l.get(zr)));break;case"set":qs(e)&&a.push(l.get(Os));break}Ll();for(const o of a)o&&Fo(o,5);Nl()}const dc=Ol("__proto__,__v_isRef,__isVue"),Vo=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Oe)),va=mc();function mc(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...s){const i=st(this);for(let r=0,l=this.length;r<l;r++)zt(i,"get",r+"");const n=i[t](...s);return n===-1||n===!1?i[t](...s.map(st)):n}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...s){ms(),Ll();const i=st(this)[t].apply(this,s);return Nl(),Ge(),i}}),e}function pc(e){Oe(e)||(e=String(e));const t=st(this);return zt(t,"has",e),t.hasOwnProperty(e)}class qo{constructor(t=!1,s=!1){this._isReadonly=t,this._isShallow=s}get(t,s,i){const n=this._isReadonly,r=this._isShallow;if(s==="__v_isReactive")return!n;if(s==="__v_isReadonly")return n;if(s==="__v_isShallow")return r;if(s==="__v_raw")return i===(n?r?Mc:Jo:r?Wo:Go).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const l=G(t);if(!n){if(l&&et(va,s))return Reflect.get(va,s,i);if(s==="hasOwnProperty")return pc}const a=Reflect.get(t,s,i);return(Oe(s)?Vo.has(s):dc(s))||(n||zt(t,"get",s),r)?a:Xt(a)?l&&El(s)?a:a.value:ut(a)?n?Ko(a):Is(a):a}}class Bo extends qo{constructor(t=!1){super(!1,t)}set(t,s,i,n){let r=t[s];if(!this._isShallow){const o=Ci(r);if(!In(i)&&!Ci(i)&&(r=st(r),i=st(i)),!G(t)&&Xt(r)&&!Xt(i))return o?!1:(r.value=i,!0)}const l=G(t)&&El(s)?Number(s)<t.length:et(t,s),a=Reflect.set(t,s,i,n);return t===st(n)&&(l?hs(i,r)&&Ve(t,"set",s,i):Ve(t,"add",s,i)),a}deleteProperty(t,s){const i=et(t,s);t[s];const n=Reflect.deleteProperty(t,s);return n&&i&&Ve(t,"delete",s,void 0),n}has(t,s){const i=Reflect.has(t,s);return(!Oe(s)||!Vo.has(s))&&zt(t,"has",s),i}ownKeys(t){return zt(t,"iterate",G(t)?"length":Os),Reflect.ownKeys(t)}}class gc extends qo{constructor(t=!1){super(!0,t)}set(t,s){return!0}deleteProperty(t,s){return!0}}const _c=new Bo,yc=new gc,vc=new Bo(!0);const Rl=e=>e,Kn=e=>Reflect.getPrototypeOf(e);function en(e,t,s=!1,i=!1){e=e.__v_raw;const n=st(e),r=st(t);s||(hs(t,r)&&zt(n,"get",t),zt(n,"get",r));const{has:l}=Kn(n),a=i?Rl:s?Ul:Ei;if(l.call(n,t))return a(e.get(t));if(l.call(n,r))return a(e.get(r));e!==n&&e.get(t)}function sn(e,t=!1){const s=this.__v_raw,i=st(s),n=st(e);return t||(hs(e,n)&&zt(i,"has",e),zt(i,"has",n)),e===n?s.has(e):s.has(e)||s.has(n)}function nn(e,t=!1){return e=e.__v_raw,!t&&zt(st(e),"iterate",Os),Reflect.get(e,"size",e)}function ba(e){e=st(e);const t=st(this);return Kn(t).has.call(t,e)||(t.add(e),Ve(t,"add",e,e)),this}function ka(e,t){t=st(t);const s=st(this),{has:i,get:n}=Kn(s);let r=i.call(s,e);r||(e=st(e),r=i.call(s,e));const l=n.call(s,e);return s.set(e,t),r?hs(t,l)&&Ve(s,"set",e,t):Ve(s,"add",e,t),this}function xa(e){const t=st(this),{has:s,get:i}=Kn(t);let n=s.call(t,e);n||(e=st(e),n=s.call(t,e)),i&&i.call(t,e);const r=t.delete(e);return n&&Ve(t,"delete",e,void 0),r}function wa(){const e=st(this),t=e.size!==0,s=e.clear();return t&&Ve(e,"clear",void 0,void 0),s}function rn(e,t){return function(i,n){const r=this,l=r.__v_raw,a=st(l),o=t?Rl:e?Ul:Ei;return!e&&zt(a,"iterate",Os),l.forEach((h,f)=>i.call(n,o(h),o(f),r))}}function ln(e,t,s){return function(...i){const n=this.__v_raw,r=st(n),l=qs(r),a=e==="entries"||e===Symbol.iterator&&l,o=e==="keys"&&l,h=n[e](...i),f=s?Rl:t?Ul:Ei;return!t&&zt(r,"iterate",o?zr:Os),{next(){const{value:_,done:x}=h.next();return x?{value:_,done:x}:{value:a?[f(_[0]),f(_[1])]:f(_),done:x}},[Symbol.iterator](){return this}}}}function Ye(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function bc(){const e={get(r){return en(this,r)},get size(){return nn(this)},has:sn,add:ba,set:ka,delete:xa,clear:wa,forEach:rn(!1,!1)},t={get(r){return en(this,r,!1,!0)},get size(){return nn(this)},has:sn,add:ba,set:ka,delete:xa,clear:wa,forEach:rn(!1,!0)},s={get(r){return en(this,r,!0)},get size(){return nn(this,!0)},has(r){return sn.call(this,r,!0)},add:Ye("add"),set:Ye("set"),delete:Ye("delete"),clear:Ye("clear"),forEach:rn(!0,!1)},i={get(r){return en(this,r,!0,!0)},get size(){return nn(this,!0)},has(r){return sn.call(this,r,!0)},add:Ye("add"),set:Ye("set"),delete:Ye("delete"),clear:Ye("clear"),forEach:rn(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=ln(r,!1,!1),s[r]=ln(r,!0,!1),t[r]=ln(r,!1,!0),i[r]=ln(r,!0,!0)}),[e,s,t,i]}const[kc,xc,wc,Tc]=bc();function Pl(e,t){const s=t?e?Tc:wc:e?xc:kc;return(i,n,r)=>n==="__v_isReactive"?!e:n==="__v_isReadonly"?e:n==="__v_raw"?i:Reflect.get(et(s,n)&&n in i?s:i,n,r)}const Sc={get:Pl(!1,!1)},Ac={get:Pl(!1,!0)},Oc={get:Pl(!0,!1)};const Go=new WeakMap,Wo=new WeakMap,Jo=new WeakMap,Mc=new WeakMap;function Cc(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ec(e){return e.__v_skip||!Object.isExtensible(e)?0:Cc(Zu(e))}function Is(e){return Ci(e)?e:jl(e,!1,_c,Sc,Go)}function Ic(e){return jl(e,!1,vc,Ac,Wo)}function Ko(e){return jl(e,!0,yc,Oc,Jo)}function jl(e,t,s,i,n){if(!ut(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=n.get(e);if(r)return r;const l=Ec(e);if(l===0)return e;const a=new Proxy(e,l===2?i:s);return n.set(e,a),a}function vi(e){return Ci(e)?vi(e.__v_raw):!!(e&&e.__v_isReactive)}function Ci(e){return!!(e&&e.__v_isReadonly)}function In(e){return!!(e&&e.__v_isShallow)}function zo(e){return e?!!e.__v_raw:!1}function st(e){const t=e&&e.__v_raw;return t?st(t):e}function Xr(e){return Object.isExtensible(e)&&Do(e,"__v_skip",!0),e}const Ei=e=>ut(e)?Is(e):e,Ul=e=>ut(e)?Ko(e):e;class Xo{constructor(t,s,i,n){this.getter=t,this._setter=s,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Dl(()=>t(this._value),()=>yn(this,this.effect._dirtyLevel===3?3:4)),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const t=st(this),s=t.effect._dirtyLevel;return(!t._cacheable||t.effect.dirty)&&hs(t._value,t._value=t.effect.run())&&s!==3&&yn(t,5),Yo(t),t.effect._dirtyLevel>=2&&yn(t,3),t._value}set value(t){this._setter(t)}get _dirty(){return this.effect.dirty}set _dirty(t){this.effect.dirty=t}}function Dc(e,t,s=!1){let i,n;const r=X(e);return r?(i=e,n=ie):(i=e.get,n=e.set),new Xo(i,n,r||!n,s)}function Yo(e){var t;rs&&As&&(e=st(e),Uo(As,(t=e.dep)!=null?t:e.dep=Ho(()=>e.dep=void 0,e instanceof Xo?e:void 0)))}function yn(e,t=5,s,i){e=st(e);const n=e.dep;n&&Fo(n,t)}function Xt(e){return!!(e&&e.__v_isRef===!0)}function bi(e){return Lc(e,!1)}function Lc(e,t){return Xt(e)?e:new Nc(e,t)}class Nc{constructor(t,s){this.__v_isShallow=s,this.dep=void 0,this.__v_isRef=!0,this._rawValue=s?t:st(t),this._value=s?t:Ei(t)}get value(){return Yo(this),this._value}set value(t){const s=this.__v_isShallow||In(t)||Ci(t);t=s?t:st(t),hs(t,this._rawValue)&&(this._rawValue,this._rawValue=t,this._value=s?t:Ei(t),yn(this,5))}}function Rc(e){return Xt(e)?e.value:e}const Pc={get:(e,t,s)=>Rc(Reflect.get(e,t,s)),set:(e,t,s,i)=>{const n=e[t];return Xt(n)&&!Xt(s)?(n.value=s,!0):Reflect.set(e,t,s,i)}};function $o(e){return vi(e)?e:new Proxy(e,Pc)}/**
* @vue/runtime-core v3.4.30
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ls(e,t,s,i){try{return i?e(...i):e()}catch(n){Hi(n,t,s)}}function de(e,t,s,i){if(X(e)){const n=ls(e,t,s,i);return n&&Co(n)&&n.catch(r=>{Hi(r,t,s)}),n}if(G(e)){const n=[];for(let r=0;r<e.length;r++)n.push(de(e[r],t,s,i));return n}}function Hi(e,t,s,i=!0){const n=t?t.vnode:null;if(t){let r=t.parent;const l=t.proxy,a=`https://vuejs.org/error-reference/#runtime-${s}`;for(;r;){const h=r.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](e,l,a)===!1)return}r=r.parent}const o=t.appContext.config.errorHandler;if(o){ms(),ls(o,null,10,[e,l,a]),Ge();return}}jc(e,s,n,i)}function jc(e,t,s,i=!0){console.error(e)}let Ii=!1,Yr=!1;const Nt=[];let Ae=0;const Bs=[];let ts=null,xs=0;const Qo=Promise.resolve();let Fl=null;function Zo(e){const t=Fl||Qo;return e?t.then(this?e.bind(this):e):t}function Uc(e){let t=Ae+1,s=Nt.length;for(;t<s;){const i=t+s>>>1,n=Nt[i],r=Di(n);r<e||r===e&&n.pre?t=i+1:s=i}return t}function zn(e){(!Nt.length||!Nt.includes(e,Ii&&e.allowRecurse?Ae+1:Ae))&&(e.id==null?Nt.push(e):Nt.splice(Uc(e.id),0,e),th())}function th(){!Ii&&!Yr&&(Yr=!0,Fl=Qo.then(sh))}function Fc(e){const t=Nt.indexOf(e);t>Ae&&Nt.splice(t,1)}function Hc(e){G(e)?Bs.push(...e):(!ts||!ts.includes(e,e.allowRecurse?xs+1:xs))&&Bs.push(e),th()}function Ta(e,t,s=Ii?Ae+1:0){for(;s<Nt.length;s++){const i=Nt[s];if(i&&i.pre){if(e&&i.id!==e.uid)continue;Nt.splice(s,1),s--,i()}}}function eh(e){if(Bs.length){const t=[...new Set(Bs)].sort((s,i)=>Di(s)-Di(i));if(Bs.length=0,ts){ts.push(...t);return}for(ts=t,xs=0;xs<ts.length;xs++){const s=ts[xs];s.active!==!1&&s()}ts=null,xs=0}}const Di=e=>e.id==null?1/0:e.id,Vc=(e,t)=>{const s=Di(e)-Di(t);if(s===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return s};function sh(e){Yr=!1,Ii=!0,Nt.sort(Vc);try{for(Ae=0;Ae<Nt.length;Ae++){const t=Nt[Ae];t&&t.active!==!1&&ls(t,null,14)}}finally{Ae=0,Nt.length=0,eh(),Ii=!1,Fl=null,(Nt.length||Bs.length)&&sh()}}function qc(e,t,...s){if(e.isUnmounted)return;const i=e.vnode.props||dt;let n=s;const r=t.startsWith("update:"),l=r&&t.slice(7);if(l&&l in i){const f=`${l==="modelValue"?"model":l}Modifiers`,{number:_,trim:x}=i[f]||dt;x&&(n=s.map(T=>Ot(T)?T.trim():T)),_&&(n=s.map(En))}let a,o=i[a=br(t)]||i[a=br(Me(t))];!o&&r&&(o=i[a=br(ii(t))]),o&&de(o,e,6,n);const h=i[a+"Once"];if(h){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,de(h,e,6,n)}}function ih(e,t,s=!1){const i=t.emitsCache,n=i.get(e);if(n!==void 0)return n;const r=e.emits;let l={},a=!1;if(!X(e)){const o=h=>{const f=ih(h,t,!0);f&&(a=!0,jt(l,f))};!s&&t.mixins.length&&t.mixins.forEach(o),e.extends&&o(e.extends),e.mixins&&e.mixins.forEach(o)}return!r&&!a?(ut(e)&&i.set(e,null),null):(G(r)?r.forEach(o=>l[o]=null):jt(l,r),ut(e)&&i.set(e,l),l)}function Xn(e,t){return!e||!Gn(t)?!1:(t=t.slice(2).replace(/Once$/,""),et(e,t[0].toLowerCase()+t.slice(1))||et(e,ii(t))||et(e,t))}let Lt=null,Yn=null;function Dn(e){const t=Lt;return Lt=e,Yn=e&&e.type.__scopeId||null,t}function Ke(e){Yn=e}function ze(){Yn=null}function xt(e,t=Lt,s){if(!t||e._n)return e;const i=(...n)=>{i._d&&ja(-1);const r=Dn(t);let l;try{l=e(...n)}finally{Dn(r),i._d&&ja(1)}return l};return i._n=!0,i._c=!0,i._d=!0,i}function Sa(e){const{type:t,vnode:s,proxy:i,withProxy:n,propsOptions:[r],slots:l,attrs:a,emit:o,render:h,renderCache:f,props:_,data:x,setupState:T,ctx:E,inheritAttrs:U}=e,P=Dn(e);let Y,K;try{if(s.shapeFlag&4){const kt=n||i,Tt=kt;Y=Se(h.call(Tt,kt,f,_,T,x,E)),K=a}else{const kt=t;Y=Se(kt.length>1?kt(_,{attrs:a,slots:l,emit:o}):kt(_,null)),K=t.props?a:Bc(a)}}catch(kt){Ti.length=0,Hi(kt,e,1),Y=O(us)}let J=Y;if(K&&U!==!1){const kt=Object.keys(K),{shapeFlag:Tt}=J;kt.length&&Tt&7&&(r&&kt.some(Ml)&&(K=Gc(K,r)),J=Xs(J,K,!1,!0))}return s.dirs&&(J=Xs(J,null,!1,!0),J.dirs=J.dirs?J.dirs.concat(s.dirs):s.dirs),s.transition&&(J.transition=s.transition),Y=J,Dn(P),Y}const Bc=e=>{let t;for(const s in e)(s==="class"||s==="style"||Gn(s))&&((t||(t={}))[s]=e[s]);return t},Gc=(e,t)=>{const s={};for(const i in e)(!Ml(i)||!(i.slice(9)in t))&&(s[i]=e[i]);return s};function Wc(e,t,s){const{props:i,children:n,component:r}=e,{props:l,children:a,patchFlag:o}=t,h=r.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&o>=0){if(o&1024)return!0;if(o&16)return i?Aa(i,l,h):!!l;if(o&8){const f=t.dynamicProps;for(let _=0;_<f.length;_++){const x=f[_];if(l[x]!==i[x]&&!Xn(h,x))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:i===l?!1:i?l?Aa(i,l,h):!0:!!l;return!1}function Aa(e,t,s){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let n=0;n<i.length;n++){const r=i[n];if(t[r]!==e[r]&&!Xn(s,r))return!0}return!1}function Jc({vnode:e,parent:t},s){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i===e)(e=t.vnode).el=s,t=t.parent;else break}}const Kc="components";function V(e,t){return Xc(Kc,e,!0,t)||e}const zc=Symbol.for("v-ndc");function Xc(e,t,s=!0,i=!1){const n=Lt||It;if(n){const r=n.type;{const a=Jf(r,!1);if(a&&(a===t||a===Me(t)||a===Jn(Me(t))))return r}const l=Oa(n[e]||r[e],t)||Oa(n.appContext[e],t);return!l&&i?r:l}}function Oa(e,t){return e&&(e[t]||e[Me(t)]||e[Jn(Me(t))])}const Yc=e=>e.__isSuspense;function $c(e,t){t&&t.pendingBranch?G(e)?t.effects.push(...e):t.effects.push(e):Hc(e)}function $n(e,t,s=It,i=!1){if(s){const n=s[e]||(s[e]=[]),r=t.__weh||(t.__weh=(...l)=>{ms();const a=Vi(s),o=de(t,s,e,l);return a(),Ge(),o});return i?n.unshift(r):n.push(r),r}}const Xe=e=>(t,s=It)=>{(!qi||e==="sp")&&$n(e,(...i)=>t(...i),s)},Qc=Xe("bm"),Zc=Xe("m"),tf=Xe("bu"),ef=Xe("u"),sf=Xe("bum"),nh=Xe("um"),nf=Xe("sp"),rf=Xe("rtg"),lf=Xe("rtc");function af(e,t=It){$n("ec",e,t)}function At(e,t){if(Lt===null)return e;const s=Zn(Lt),i=e.dirs||(e.dirs=[]);for(let n=0;n<t.length;n++){let[r,l,a,o=dt]=t[n];r&&(X(r)&&(r={mounted:r,updated:r}),r.deep&&ss(l),i.push({dir:r,instance:s,value:l,oldValue:void 0,arg:a,modifiers:o}))}return e}function ys(e,t,s,i){const n=e.dirs,r=t&&t.dirs;for(let l=0;l<n.length;l++){const a=n[l];r&&(a.oldValue=r[l].value);let o=a.dir[i];o&&(ms(),de(o,s,8,[e.el,a,e,t]),Ge())}}function bt(e,t,s,i){let n;const r=s;if(G(e)||Ot(e)){n=new Array(e.length);for(let l=0,a=e.length;l<a;l++)n[l]=t(e[l],l,void 0,r)}else if(typeof e=="number"){n=new Array(e);for(let l=0;l<e;l++)n[l]=t(l+1,l,void 0,r)}else if(ut(e))if(e[Symbol.iterator])n=Array.from(e,(l,a)=>t(l,a,void 0,r));else{const l=Object.keys(e);n=new Array(l.length);for(let a=0,o=l.length;a<o;a++){const h=l[a];n[a]=t(e[h],h,a,r)}}else n=[];return n}/*! #__NO_SIDE_EFFECTS__ */function of(e,t){return X(e)?jt({name:e.name},t,{setup:e}):e}const ki=e=>!!e.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function pt(e){X(e)&&(e={loader:e});const{loader:t,loadingComponent:s,errorComponent:i,delay:n=200,timeout:r,suspensible:l=!0,onError:a}=e;let o=null,h,f=0;const _=()=>(f++,o=null,x()),x=()=>{let T;return o||(T=o=t().catch(E=>{if(E=E instanceof Error?E:new Error(String(E)),a)return new Promise((U,P)=>{a(E,()=>U(_()),()=>P(E),f+1)});throw E}).then(E=>T!==o&&o?o:(E&&(E.__esModule||E[Symbol.toStringTag]==="Module")&&(E=E.default),h=E,E)))};return of({name:"AsyncComponentWrapper",__asyncLoader:x,get __asyncResolved(){return h},setup(){const T=It;if(h)return()=>xr(h,T);const E=K=>{o=null,Hi(K,T,13,!i)};if(l&&T.suspense||qi)return x().then(K=>()=>xr(K,T)).catch(K=>(E(K),()=>i?O(i,{error:K}):null));const U=bi(!1),P=bi(),Y=bi(!!n);return n&&setTimeout(()=>{Y.value=!1},n),r!=null&&setTimeout(()=>{if(!U.value&&!P.value){const K=new Error(`Async component timed out after ${r}ms.`);E(K),P.value=K}},r),x().then(()=>{U.value=!0,T.parent&&ql(T.parent.vnode)&&(T.parent.effect.dirty=!0,zn(T.parent.update))}).catch(K=>{E(K),P.value=K}),()=>{if(U.value&&h)return xr(h,T);if(P.value&&i)return O(i,{error:P.value});if(s&&!Y.value)return O(s)}}})}function xr(e,t){const{ref:s,props:i,children:n,ce:r}=t.vnode,l=O(e,i,n);return l.ref=s,l.ce=r,delete t.vnode.ce,l}function rh(e,t,s={},i,n){if(Lt.isCE||Lt.parent&&ki(Lt.parent)&&Lt.parent.isCE)return t!=="default"&&(s.name=t),O("slot",s,i&&i());let r=e[t];r&&r._c&&(r._d=!1),u();const l=r&&lh(r(s)),a=lt(tt,{key:s.key||l&&l.key||`_${t}`},l||(i?i():[]),l&&e._===1?64:-2);return r&&r._c&&(r._d=!0),a}function lh(e){return e.some(t=>Nn(t)?!(t.type===us||t.type===tt&&!lh(t.children)):!0)?e:null}const $r=e=>e?Sh(e)?Zn(e):$r(e.parent):null,xi=jt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>$r(e.parent),$root:e=>$r(e.root),$emit:e=>e.emit,$options:e=>oh(e),$forceUpdate:e=>e.f||(e.f=()=>{e.effect.dirty=!0,zn(e.update)}),$nextTick:e=>e.n||(e.n=Zo.bind(e.proxy)),$watch:e=>Ef.bind(e)}),wr=(e,t)=>e!==dt&&!e.__isScriptSetup&&et(e,t),hf={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:s,setupState:i,data:n,props:r,accessCache:l,type:a,appContext:o}=e;let h;if(t[0]!=="$"){const T=l[t];if(T!==void 0)switch(T){case 1:return i[t];case 2:return n[t];case 4:return s[t];case 3:return r[t]}else{if(wr(i,t))return l[t]=1,i[t];if(n!==dt&&et(n,t))return l[t]=2,n[t];if((h=e.propsOptions[0])&&et(h,t))return l[t]=3,r[t];if(s!==dt&&et(s,t))return l[t]=4,s[t];Qr&&(l[t]=0)}}const f=xi[t];let _,x;if(f)return t==="$attrs"&&zt(e.attrs,"get",""),f(e);if((_=a.__cssModules)&&(_=_[t]))return _;if(s!==dt&&et(s,t))return l[t]=4,s[t];if(x=o.config.globalProperties,et(x,t))return x[t]},set({_:e},t,s){const{data:i,setupState:n,ctx:r}=e;return wr(n,t)?(n[t]=s,!0):i!==dt&&et(i,t)?(i[t]=s,!0):et(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(r[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:i,appContext:n,propsOptions:r}},l){let a;return!!s[l]||e!==dt&&et(e,l)||wr(t,l)||(a=r[0])&&et(a,l)||et(i,l)||et(xi,l)||et(n.config.globalProperties,l)},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:et(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function Ma(e){return G(e)?e.reduce((t,s)=>(t[s]=null,t),{}):e}let Qr=!0;function uf(e){const t=oh(e),s=e.proxy,i=e.ctx;Qr=!1,t.beforeCreate&&Ca(t.beforeCreate,e,"bc");const{data:n,computed:r,methods:l,watch:a,provide:o,inject:h,created:f,beforeMount:_,mounted:x,beforeUpdate:T,updated:E,activated:U,deactivated:P,beforeDestroy:Y,beforeUnmount:K,destroyed:J,unmounted:kt,render:Tt,renderTracked:Z,renderTriggered:le,errorCaptured:te,serverPrefetch:ri,expose:De,inheritAttrs:gs,components:Ns,directives:Rs,filters:li}=t;if(h&&cf(h,i,null),l)for(const ct in l){const rt=l[ct];X(rt)&&(i[ct]=rt.bind(s))}if(n){const ct=n.call(s,s);ut(ct)&&(e.data=Is(ct))}if(Qr=!0,r)for(const ct in r){const rt=r[ct],Le=X(rt)?rt.bind(s,s):X(rt.get)?rt.get.bind(s,s):ie,Ps=!X(rt)&&X(rt.set)?rt.set.bind(s):ie,St=il({get:Le,set:Ps});Object.defineProperty(i,ct,{enumerable:!0,configurable:!0,get:()=>St.value,set:ye=>St.value=ye})}if(a)for(const ct in a)ah(a[ct],i,s,ct);if(o){const ct=X(o)?o.call(s):o;Reflect.ownKeys(ct).forEach(rt=>{_f(rt,ct[rt])})}f&&Ca(f,e,"c");function Ct(ct,rt){G(rt)?rt.forEach(Le=>ct(Le.bind(s))):rt&&ct(rt.bind(s))}if(Ct(Qc,_),Ct(Zc,x),Ct(tf,T),Ct(ef,E),Ct(If,U),Ct(Df,P),Ct(af,te),Ct(lf,Z),Ct(rf,le),Ct(sf,K),Ct(nh,kt),Ct(nf,ri),G(De))if(De.length){const ct=e.exposed||(e.exposed={});De.forEach(rt=>{Object.defineProperty(ct,rt,{get:()=>s[rt],set:Le=>s[rt]=Le})})}else e.exposed||(e.exposed={});Tt&&e.render===ie&&(e.render=Tt),gs!=null&&(e.inheritAttrs=gs),Ns&&(e.components=Ns),Rs&&(e.directives=Rs)}function cf(e,t,s=ie){G(e)&&(e=Zr(e));for(const i in e){const n=e[i];let r;ut(n)?"default"in n?r=vn(n.from||i,n.default,!0):r=vn(n.from||i):r=vn(n),Xt(r)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>r.value,set:l=>r.value=l}):t[i]=r}}function Ca(e,t,s){de(G(e)?e.map(i=>i.bind(t.proxy)):e.bind(t.proxy),t,s)}function ah(e,t,s,i){const n=i.includes(".")?bh(s,i):()=>s[i];if(Ot(e)){const r=t[e];X(r)&&Sr(n,r)}else if(X(e))Sr(n,e.bind(s));else if(ut(e))if(G(e))e.forEach(r=>ah(r,t,s,i));else{const r=X(e.handler)?e.handler.bind(s):t[e.handler];X(r)&&Sr(n,r,e)}}function oh(e){const t=e.type,{mixins:s,extends:i}=t,{mixins:n,optionsCache:r,config:{optionMergeStrategies:l}}=e.appContext,a=r.get(t);let o;return a?o=a:!n.length&&!s&&!i?o=t:(o={},n.length&&n.forEach(h=>Ln(o,h,l,!0)),Ln(o,t,l)),ut(t)&&r.set(t,o),o}function Ln(e,t,s,i=!1){const{mixins:n,extends:r}=t;r&&Ln(e,r,s,!0),n&&n.forEach(l=>Ln(e,l,s,!0));for(const l in t)if(!(i&&l==="expose")){const a=ff[l]||s&&s[l];e[l]=a?a(e[l],t[l]):t[l]}return e}const ff={data:Ea,props:Ia,emits:Ia,methods:pi,computed:pi,beforeCreate:Ft,created:Ft,beforeMount:Ft,mounted:Ft,beforeUpdate:Ft,updated:Ft,beforeDestroy:Ft,beforeUnmount:Ft,destroyed:Ft,unmounted:Ft,activated:Ft,deactivated:Ft,errorCaptured:Ft,serverPrefetch:Ft,components:pi,directives:pi,watch:mf,provide:Ea,inject:df};function Ea(e,t){return t?e?function(){return jt(X(e)?e.call(this,this):e,X(t)?t.call(this,this):t)}:t:e}function df(e,t){return pi(Zr(e),Zr(t))}function Zr(e){if(G(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function Ft(e,t){return e?[...new Set([].concat(e,t))]:t}function pi(e,t){return e?jt(Object.create(null),e,t):t}function Ia(e,t){return e?G(e)&&G(t)?[...new Set([...e,...t])]:jt(Object.create(null),Ma(e),Ma(t??{})):t}function mf(e,t){if(!e)return t;if(!t)return e;const s=jt(Object.create(null),e);for(const i in t)s[i]=Ft(e[i],t[i]);return s}function hh(){return{app:null,config:{isNativeTag:$u,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let pf=0;function gf(e,t){return function(i,n=null){X(i)||(i=jt({},i)),n!=null&&!ut(n)&&(n=null);const r=hh(),l=new WeakSet;let a=!1;const o=r.app={_uid:pf++,_component:i,_props:n,_container:null,_context:r,_instance:null,version:Xf,get config(){return r.config},set config(h){},use(h,...f){return l.has(h)||(h&&X(h.install)?(l.add(h),h.install(o,...f)):X(h)&&(l.add(h),h(o,...f))),o},mixin(h){return r.mixins.includes(h)||r.mixins.push(h),o},component(h,f){return f?(r.components[h]=f,o):r.components[h]},directive(h,f){return f?(r.directives[h]=f,o):r.directives[h]},mount(h,f,_){if(!a){const x=O(i,n);return x.appContext=r,_===!0?_="svg":_===!1&&(_=void 0),e(x,h,_),a=!0,o._container=h,h.__vue_app__=o,Zn(x.component)}},unmount(){a&&(e(null,o._container),delete o._container.__vue_app__)},provide(h,f){return r.provides[h]=f,o},runWithContext(h){const f=wi;wi=o;try{return h()}finally{wi=f}}};return o}}let wi=null;function _f(e,t){if(It){let s=It.provides;const i=It.parent&&It.parent.provides;i===s&&(s=It.provides=Object.create(i)),s[e]=t}}function vn(e,t,s=!1){const i=It||Lt;if(i||wi){const n=i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:wi._context.provides;if(n&&e in n)return n[e];if(arguments.length>1)return s&&X(t)?t.call(i&&i.proxy):t}}const uh={},ch=()=>Object.create(uh),fh=e=>Object.getPrototypeOf(e)===uh;function yf(e,t,s,i=!1){const n={},r=ch();e.propsDefaults=Object.create(null),dh(e,t,n,r);for(const l in e.propsOptions[0])l in n||(n[l]=void 0);s?e.props=i?n:Ic(n):e.type.props?e.props=n:e.props=r,e.attrs=r}function vf(e,t,s,i){const{props:n,attrs:r,vnode:{patchFlag:l}}=e,a=st(n),[o]=e.propsOptions;let h=!1;if((i||l>0)&&!(l&16)){if(l&8){const f=e.vnode.dynamicProps;for(let _=0;_<f.length;_++){let x=f[_];if(Xn(e.emitsOptions,x))continue;const T=t[x];if(o)if(et(r,x))T!==r[x]&&(r[x]=T,h=!0);else{const E=Me(x);n[E]=tl(o,a,E,T,e,!1)}else T!==r[x]&&(r[x]=T,h=!0)}}}else{dh(e,t,n,r)&&(h=!0);let f;for(const _ in a)(!t||!et(t,_)&&((f=ii(_))===_||!et(t,f)))&&(o?s&&(s[_]!==void 0||s[f]!==void 0)&&(n[_]=tl(o,a,_,void 0,e,!0)):delete n[_]);if(r!==a)for(const _ in r)(!t||!et(t,_))&&(delete r[_],h=!0)}h&&Ve(e.attrs,"set","")}function dh(e,t,s,i){const[n,r]=e.propsOptions;let l=!1,a;if(t)for(let o in t){if(yi(o))continue;const h=t[o];let f;n&&et(n,f=Me(o))?!r||!r.includes(f)?s[f]=h:(a||(a={}))[f]=h:Xn(e.emitsOptions,o)||(!(o in i)||h!==i[o])&&(i[o]=h,l=!0)}if(r){const o=st(s),h=a||dt;for(let f=0;f<r.length;f++){const _=r[f];s[_]=tl(n,o,_,h[_],e,!et(h,_))}}return l}function tl(e,t,s,i,n,r){const l=e[s];if(l!=null){const a=et(l,"default");if(a&&i===void 0){const o=l.default;if(l.type!==Function&&!l.skipFactory&&X(o)){const{propsDefaults:h}=n;if(s in h)i=h[s];else{const f=Vi(n);i=h[s]=o.call(null,t),f()}}else i=o}l[0]&&(r&&!a?i=!1:l[1]&&(i===""||i===ii(s))&&(i=!0))}return i}function mh(e,t,s=!1){const i=t.propsCache,n=i.get(e);if(n)return n;const r=e.props,l={},a=[];let o=!1;if(!X(e)){const f=_=>{o=!0;const[x,T]=mh(_,t,!0);jt(l,x),T&&a.push(...T)};!s&&t.mixins.length&&t.mixins.forEach(f),e.extends&&f(e.extends),e.mixins&&e.mixins.forEach(f)}if(!r&&!o)return ut(e)&&i.set(e,Vs),Vs;if(G(r))for(let f=0;f<r.length;f++){const _=Me(r[f]);Da(_)&&(l[_]=dt)}else if(r)for(const f in r){const _=Me(f);if(Da(_)){const x=r[f],T=l[_]=G(x)||X(x)?{type:x}:jt({},x);if(T){const E=Ra(Boolean,T.type),U=Ra(String,T.type);T[0]=E>-1,T[1]=U<0||E<U,(E>-1||et(T,"default"))&&a.push(_)}}}const h=[l,a];return ut(e)&&i.set(e,h),h}function Da(e){return e[0]!=="$"&&!yi(e)}function La(e){return e===null?"null":typeof e=="function"?e.name||"":typeof e=="object"&&e.constructor&&e.constructor.name||""}function Na(e,t){return La(e)===La(t)}function Ra(e,t){return G(t)?t.findIndex(s=>Na(s,e)):X(t)&&Na(t,e)?0:-1}const ph=e=>e[0]==="_"||e==="$stable",Hl=e=>G(e)?e.map(Se):[Se(e)],bf=(e,t,s)=>{if(t._n)return t;const i=xt((...n)=>Hl(t(...n)),s);return i._c=!1,i},gh=(e,t,s)=>{const i=e._ctx;for(const n in e){if(ph(n))continue;const r=e[n];if(X(r))t[n]=bf(n,r,i);else if(r!=null){const l=Hl(r);t[n]=()=>l}}},_h=(e,t)=>{const s=Hl(t);e.slots.default=()=>s},kf=(e,t)=>{const s=e.slots=ch();if(e.vnode.shapeFlag&32){const i=t._;i?(jt(s,t),Do(s,"_",i,!0)):gh(t,s)}else t&&_h(e,t)},xf=(e,t,s)=>{const{vnode:i,slots:n}=e;let r=!0,l=dt;if(i.shapeFlag&32){const a=t._;a?s&&a===1?r=!1:(jt(n,t),!s&&a===1&&delete n._):(r=!t.$stable,gh(t,n)),l=t}else t&&(_h(e,t),l={default:1});if(r)for(const a in n)!ph(a)&&l[a]==null&&delete n[a]};function el(e,t,s,i,n=!1){if(G(e)){e.forEach((x,T)=>el(x,t&&(G(t)?t[T]:t),s,i,n));return}if(ki(i)&&!n)return;const r=i.shapeFlag&4?Zn(i.component):i.el,l=n?null:r,{i:a,r:o}=e,h=t&&t.r,f=a.refs===dt?a.refs={}:a.refs,_=a.setupState;if(h!=null&&h!==o&&(Ot(h)?(f[h]=null,et(_,h)&&(_[h]=null)):Xt(h)&&(h.value=null)),X(o))ls(o,a,12,[l,f]);else{const x=Ot(o),T=Xt(o);if(x||T){const E=()=>{if(e.f){const U=x?et(_,o)?_[o]:f[o]:o.value;n?G(U)&&Cl(U,r):G(U)?U.includes(r)||U.push(r):x?(f[o]=[r],et(_,o)&&(_[o]=f[o])):(o.value=[r],e.k&&(f[e.k]=o.value))}else x?(f[o]=l,et(_,o)&&(_[o]=l)):T&&(o.value=l,e.k&&(f[e.k]=l))};l?(E.id=-1,qt(E,s)):E()}}}const qt=$c;function wf(e){return Tf(e)}function Tf(e,t){const s=Lo();s.__VUE__=!0;const{insert:i,remove:n,patchProp:r,createElement:l,createText:a,createComment:o,setText:h,setElementText:f,parentNode:_,nextSibling:x,setScopeId:T=ie,insertStaticContent:E}=e,U=(d,y,k,S=null,A=null,D=null,R=void 0,I=null,L=!!y.dynamicChildren)=>{if(d===y)return;d&&!hi(d,y)&&(S=tn(d),ye(d,A,D,!0),d=null),y.patchFlag===-2&&(L=!1,y.dynamicChildren=null);const{type:M,ref:j,shapeFlag:W}=y;switch(M){case Qn:P(d,y,k,S);break;case us:Y(d,y,k,S);break;case Ar:d==null&&K(y,k,S,R);break;case tt:Ns(d,y,k,S,A,D,R,I,L);break;default:W&1?Tt(d,y,k,S,A,D,R,I,L):W&6?Rs(d,y,k,S,A,D,R,I,L):(W&64||W&128)&&M.process(d,y,k,S,A,D,R,I,L,ai)}j!=null&&A&&el(j,d&&d.ref,D,y||d,!y)},P=(d,y,k,S)=>{if(d==null)i(y.el=a(y.children),k,S);else{const A=y.el=d.el;y.children!==d.children&&h(A,y.children)}},Y=(d,y,k,S)=>{d==null?i(y.el=o(y.children||""),k,S):y.el=d.el},K=(d,y,k,S)=>{[d.el,d.anchor]=E(d.children,y,k,S,d.el,d.anchor)},J=({el:d,anchor:y},k,S)=>{let A;for(;d&&d!==y;)A=x(d),i(d,k,S),d=A;i(y,k,S)},kt=({el:d,anchor:y})=>{let k;for(;d&&d!==y;)k=x(d),n(d),d=k;n(y)},Tt=(d,y,k,S,A,D,R,I,L)=>{y.type==="svg"?R="svg":y.type==="math"&&(R="mathml"),d==null?Z(y,k,S,A,D,R,I,L):ri(d,y,A,D,R,I,L)},Z=(d,y,k,S,A,D,R,I)=>{let L,M;const{props:j,shapeFlag:W,transition:q,dirs:z}=d;if(L=d.el=l(d.type,D,j&&j.is,j),W&8?f(L,d.children):W&16&&te(d.children,L,null,S,A,Tr(d,D),R,I),z&&ys(d,null,S,"created"),le(L,d,d.scopeId,R,S),j){for(const ft in j)ft!=="value"&&!yi(ft)&&r(L,ft,null,j[ft],D,d.children,S,A,Ne);"value"in j&&r(L,"value",null,j.value,D),(M=j.onVnodeBeforeMount)&&be(M,S,d)}z&&ys(d,null,S,"beforeMount");const $=Sf(A,q);$&&q.beforeEnter(L),i(L,y,k),((M=j&&j.onVnodeMounted)||$||z)&&qt(()=>{M&&be(M,S,d),$&&q.enter(L),z&&ys(d,null,S,"mounted")},A)},le=(d,y,k,S,A)=>{if(k&&T(d,k),S)for(let D=0;D<S.length;D++)T(d,S[D]);if(A){let D=A.subTree;if(y===D){const R=A.vnode;le(d,R,R.scopeId,R.slotScopeIds,A.parent)}}},te=(d,y,k,S,A,D,R,I,L=0)=>{for(let M=L;M<d.length;M++){const j=d[M]=I?es(d[M]):Se(d[M]);U(null,j,y,k,S,A,D,R,I)}},ri=(d,y,k,S,A,D,R)=>{const I=y.el=d.el;let{patchFlag:L,dynamicChildren:M,dirs:j}=y;L|=d.patchFlag&16;const W=d.props||dt,q=y.props||dt;let z;if(k&&vs(k,!1),(z=q.onVnodeBeforeUpdate)&&be(z,k,y,d),j&&ys(y,d,k,"beforeUpdate"),k&&vs(k,!0),M?De(d.dynamicChildren,M,I,k,S,Tr(y,A),D):R||rt(d,y,I,null,k,S,Tr(y,A),D,!1),L>0){if(L&16)gs(I,y,W,q,k,S,A);else if(L&2&&W.class!==q.class&&r(I,"class",null,q.class,A),L&4&&r(I,"style",W.style,q.style,A),L&8){const $=y.dynamicProps;for(let ft=0;ft<$.length;ft++){const nt=$[ft],Ut=W[nt],ae=q[nt];(ae!==Ut||nt==="value")&&r(I,nt,Ut,ae,A,d.children,k,S,Ne)}}L&1&&d.children!==y.children&&f(I,y.children)}else!R&&M==null&&gs(I,y,W,q,k,S,A);((z=q.onVnodeUpdated)||j)&&qt(()=>{z&&be(z,k,y,d),j&&ys(y,d,k,"updated")},S)},De=(d,y,k,S,A,D,R)=>{for(let I=0;I<y.length;I++){const L=d[I],M=y[I],j=L.el&&(L.type===tt||!hi(L,M)||L.shapeFlag&70)?_(L.el):k;U(L,M,j,null,S,A,D,R,!0)}},gs=(d,y,k,S,A,D,R)=>{if(k!==S){if(k!==dt)for(const I in k)!yi(I)&&!(I in S)&&r(d,I,k[I],null,R,y.children,A,D,Ne);for(const I in S){if(yi(I))continue;const L=S[I],M=k[I];L!==M&&I!=="value"&&r(d,I,M,L,R,y.children,A,D,Ne)}"value"in S&&r(d,"value",k.value,S.value,R)}},Ns=(d,y,k,S,A,D,R,I,L)=>{const M=y.el=d?d.el:a(""),j=y.anchor=d?d.anchor:a("");let{patchFlag:W,dynamicChildren:q,slotScopeIds:z}=y;z&&(I=I?I.concat(z):z),d==null?(i(M,k,S),i(j,k,S),te(y.children||[],k,j,A,D,R,I,L)):W>0&&W&64&&q&&d.dynamicChildren?(De(d.dynamicChildren,q,k,A,D,R,I),(y.key!=null||A&&y===A.subTree)&&yh(d,y,!0)):rt(d,y,k,j,A,D,R,I,L)},Rs=(d,y,k,S,A,D,R,I,L)=>{y.slotScopeIds=I,d==null?y.shapeFlag&512?A.ctx.activate(y,k,S,R,L):li(y,k,S,A,D,R,L):Zi(d,y,L)},li=(d,y,k,S,A,D,R)=>{const I=d.component=Vf(d,S,A);if(ql(d)&&(I.ctx.renderer=ai),qf(I),I.asyncDep){if(A&&A.registerDep(I,Ct,R),!d.el){const L=I.subTree=O(us);Y(null,L,y,k)}}else Ct(I,d,y,k,A,D,R)},Zi=(d,y,k)=>{const S=y.component=d.component;if(Wc(d,y,k))if(S.asyncDep&&!S.asyncResolved){ct(S,y,k);return}else S.next=y,Fc(S.update),S.effect.dirty=!0,S.update();else y.el=d.el,S.vnode=y},Ct=(d,y,k,S,A,D,R)=>{const I=()=>{if(d.isMounted){let{next:j,bu:W,u:q,parent:z,vnode:$}=d;{const js=vh(d);if(js){j&&(j.el=$.el,ct(d,j,R)),js.asyncDep.then(()=>{d.isUnmounted||I()});return}}let ft=j,nt;vs(d,!1),j?(j.el=$.el,ct(d,j,R)):j=$,W&&_n(W),(nt=j.props&&j.props.onVnodeBeforeUpdate)&&be(nt,z,j,$),vs(d,!0);const Ut=Sa(d),ae=d.subTree;d.subTree=Ut,U(ae,Ut,_(ae.el),tn(ae),d,A,D),j.el=Ut.el,ft===null&&Jc(d,Ut.el),q&&qt(q,A),(nt=j.props&&j.props.onVnodeUpdated)&&qt(()=>be(nt,z,j,$),A)}else{let j;const{el:W,props:q}=y,{bm:z,m:$,parent:ft}=d,nt=ki(y);vs(d,!1),z&&_n(z),!nt&&(j=q&&q.onVnodeBeforeMount)&&be(j,ft,y),vs(d,!0);{const Ut=d.subTree=Sa(d);U(null,Ut,k,S,d,A,D),y.el=Ut.el}if($&&qt($,A),!nt&&(j=q&&q.onVnodeMounted)){const Ut=y;qt(()=>be(j,ft,Ut),A)}(y.shapeFlag&256||ft&&ki(ft.vnode)&&ft.vnode.shapeFlag&256)&&d.a&&qt(d.a,A),d.isMounted=!0,y=k=S=null}},L=d.effect=new Dl(I,ie,()=>zn(M),d.scope),M=d.update=()=>{L.dirty&&L.run()};M.id=d.uid,vs(d,!0),M()},ct=(d,y,k)=>{y.component=d;const S=d.vnode.props;d.vnode=y,d.next=null,vf(d,y.props,S,k),xf(d,y.children,k),ms(),Ta(d),Ge()},rt=(d,y,k,S,A,D,R,I,L=!1)=>{const M=d&&d.children,j=d?d.shapeFlag:0,W=y.children,{patchFlag:q,shapeFlag:z}=y;if(q>0){if(q&128){Ps(M,W,k,S,A,D,R,I,L);return}else if(q&256){Le(M,W,k,S,A,D,R,I,L);return}}z&8?(j&16&&Ne(M,A,D),W!==M&&f(k,W)):j&16?z&16?Ps(M,W,k,S,A,D,R,I,L):Ne(M,A,D,!0):(j&8&&f(k,""),z&16&&te(W,k,S,A,D,R,I,L))},Le=(d,y,k,S,A,D,R,I,L)=>{d=d||Vs,y=y||Vs;const M=d.length,j=y.length,W=Math.min(M,j);let q;for(q=0;q<W;q++){const z=y[q]=L?es(y[q]):Se(y[q]);U(d[q],z,k,null,A,D,R,I,L)}M>j?Ne(d,A,D,!0,!1,W):te(y,k,S,A,D,R,I,L,W)},Ps=(d,y,k,S,A,D,R,I,L)=>{let M=0;const j=y.length;let W=d.length-1,q=j-1;for(;M<=W&&M<=q;){const z=d[M],$=y[M]=L?es(y[M]):Se(y[M]);if(hi(z,$))U(z,$,k,null,A,D,R,I,L);else break;M++}for(;M<=W&&M<=q;){const z=d[W],$=y[q]=L?es(y[q]):Se(y[q]);if(hi(z,$))U(z,$,k,null,A,D,R,I,L);else break;W--,q--}if(M>W){if(M<=q){const z=q+1,$=z<j?y[z].el:S;for(;M<=q;)U(null,y[M]=L?es(y[M]):Se(y[M]),k,$,A,D,R,I,L),M++}}else if(M>q)for(;M<=W;)ye(d[M],A,D,!0),M++;else{const z=M,$=M,ft=new Map;for(M=$;M<=q;M++){const Yt=y[M]=L?es(y[M]):Se(y[M]);Yt.key!=null&&ft.set(Yt.key,M)}let nt,Ut=0;const ae=q-$+1;let js=!1,fa=0;const oi=new Array(ae);for(M=0;M<ae;M++)oi[M]=0;for(M=z;M<=W;M++){const Yt=d[M];if(Ut>=ae){ye(Yt,A,D,!0);continue}let ve;if(Yt.key!=null)ve=ft.get(Yt.key);else for(nt=$;nt<=q;nt++)if(oi[nt-$]===0&&hi(Yt,y[nt])){ve=nt;break}ve===void 0?ye(Yt,A,D,!0):(oi[ve-$]=M+1,ve>=fa?fa=ve:js=!0,U(Yt,y[ve],k,null,A,D,R,I,L),Ut++)}const da=js?Af(oi):Vs;for(nt=da.length-1,M=ae-1;M>=0;M--){const Yt=$+M,ve=y[Yt],ma=Yt+1<j?y[Yt+1].el:S;oi[M]===0?U(null,ve,k,ma,A,D,R,I,L):js&&(nt<0||M!==da[nt]?St(ve,k,ma,2):nt--)}}},St=(d,y,k,S,A=null)=>{const{el:D,type:R,transition:I,children:L,shapeFlag:M}=d;if(M&6){St(d.component.subTree,y,k,S);return}if(M&128){d.suspense.move(y,k,S);return}if(M&64){R.move(d,y,k,ai);return}if(R===tt){i(D,y,k);for(let W=0;W<L.length;W++)St(L[W],y,k,S);i(d.anchor,y,k);return}if(R===Ar){J(d,y,k);return}if(S!==2&&M&1&&I)if(S===0)I.beforeEnter(D),i(D,y,k),qt(()=>I.enter(D),A);else{const{leave:W,delayLeave:q,afterLeave:z}=I,$=()=>i(D,y,k),ft=()=>{W(D,()=>{$(),z&&z()})};q?q(D,$,ft):ft()}else i(D,y,k)},ye=(d,y,k,S=!1,A=!1)=>{const{type:D,props:R,ref:I,children:L,dynamicChildren:M,shapeFlag:j,patchFlag:W,dirs:q,memoIndex:z}=d;if(W===-2&&(A=!1),I!=null&&el(I,null,k,d,!0),z!=null&&(y.renderCache[z]=void 0),j&256){y.ctx.deactivate(d);return}const $=j&1&&q,ft=!ki(d);let nt;if(ft&&(nt=R&&R.onVnodeBeforeUnmount)&&be(nt,y,d),j&6)zu(d.component,k,S);else{if(j&128){d.suspense.unmount(k,S);return}$&&ys(d,null,y,"beforeUnmount"),j&64?d.type.remove(d,y,k,ai,S):M&&(D!==tt||W>0&&W&64)?Ne(M,y,k,!1,!0):(D===tt&&W&384||!A&&j&16)&&Ne(L,y,k),S&&ua(d)}(ft&&(nt=R&&R.onVnodeUnmounted)||$)&&qt(()=>{nt&&be(nt,y,d),$&&ys(d,null,y,"unmounted")},k)},ua=d=>{const{type:y,el:k,anchor:S,transition:A}=d;if(y===tt){Ku(k,S);return}if(y===Ar){kt(d);return}const D=()=>{n(k),A&&!A.persisted&&A.afterLeave&&A.afterLeave()};if(d.shapeFlag&1&&A&&!A.persisted){const{leave:R,delayLeave:I}=A,L=()=>R(k,D);I?I(d.el,D,L):L()}else D()},Ku=(d,y)=>{let k;for(;d!==y;)k=x(d),n(d),d=k;n(y)},zu=(d,y,k)=>{const{bum:S,scope:A,update:D,subTree:R,um:I,m:L,a:M}=d;Pa(L),Pa(M),S&&_n(S),A.stop(),D&&(D.active=!1,ye(R,d,y,k)),I&&qt(I,y),qt(()=>{d.isUnmounted=!0},y),y&&y.pendingBranch&&!y.isUnmounted&&d.asyncDep&&!d.asyncResolved&&d.suspenseId===y.pendingId&&(y.deps--,y.deps===0&&y.resolve())},Ne=(d,y,k,S=!1,A=!1,D=0)=>{for(let R=D;R<d.length;R++)ye(d[R],y,k,S,A)},tn=d=>d.shapeFlag&6?tn(d.component.subTree):d.shapeFlag&128?d.suspense.next():x(d.anchor||d.el);let vr=!1;const ca=(d,y,k)=>{d==null?y._vnode&&ye(y._vnode,null,null,!0):U(y._vnode||null,d,y,null,null,null,k),vr||(vr=!0,Ta(),eh(),vr=!1),y._vnode=d},ai={p:U,um:ye,m:St,r:ua,mt:li,mc:te,pc:rt,pbc:De,n:tn,o:e};return{render:ca,hydrate:void 0,createApp:gf(ca)}}function Tr({type:e,props:t},s){return s==="svg"&&e==="foreignObject"||s==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:s}function vs({effect:e,update:t},s){e.allowRecurse=t.allowRecurse=s}function Sf(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function yh(e,t,s=!1){const i=e.children,n=t.children;if(G(i)&&G(n))for(let r=0;r<i.length;r++){const l=i[r];let a=n[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[r]=es(n[r]),a.el=l.el),!s&&a.patchFlag!==-2&&yh(l,a)),a.type===Qn&&(a.el=l.el)}}function Af(e){const t=e.slice(),s=[0];let i,n,r,l,a;const o=e.length;for(i=0;i<o;i++){const h=e[i];if(h!==0){if(n=s[s.length-1],e[n]<h){t[i]=n,s.push(i);continue}for(r=0,l=s.length-1;r<l;)a=r+l>>1,e[s[a]]<h?r=a+1:l=a;h<e[s[r]]&&(r>0&&(t[i]=s[r-1]),s[r]=i)}}for(r=s.length,l=s[r-1];r-- >0;)s[r]=l,l=t[l];return s}function vh(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:vh(t)}function Pa(e){if(e)for(let t=0;t<e.length;t++)e[t].active=!1}const Of=Symbol.for("v-scx"),Mf=()=>vn(Of);function Cf(e,t){return Vl(e,null,t)}const an={};function Sr(e,t,s){return Vl(e,t,s)}function Vl(e,t,{immediate:s,deep:i,flush:n,once:r,onTrack:l,onTrigger:a}=dt){if(t&&r){const Z=t;t=(...le)=>{Z(...le),Tt()}}const o=It,h=Z=>i===!0?Z:ss(Z,i===!1?1:void 0);let f,_=!1,x=!1;if(Xt(e)?(f=()=>e.value,_=In(e)):vi(e)?(f=()=>h(e),_=!0):G(e)?(x=!0,_=e.some(Z=>vi(Z)||In(Z)),f=()=>e.map(Z=>{if(Xt(Z))return Z.value;if(vi(Z))return h(Z);if(X(Z))return ls(Z,o,2)})):X(e)?t?f=()=>ls(e,o,2):f=()=>(T&&T(),de(e,o,3,[E])):f=ie,t&&i){const Z=f;f=()=>ss(Z())}let T,E=Z=>{T=J.onStop=()=>{ls(Z,o,4),T=J.onStop=void 0}},U;if(qi)if(E=ie,t?s&&de(t,o,3,[f(),x?[]:void 0,E]):f(),n==="sync"){const Z=Mf();U=Z.__watcherHandles||(Z.__watcherHandles=[])}else return ie;let P=x?new Array(e.length).fill(an):an;const Y=()=>{if(!(!J.active||!J.dirty))if(t){const Z=J.run();(i||_||(x?Z.some((le,te)=>hs(le,P[te])):hs(Z,P)))&&(T&&T(),de(t,o,3,[Z,P===an?void 0:x&&P[0]===an?[]:P,E]),P=Z)}else J.run()};Y.allowRecurse=!!t;let K;n==="sync"?K=Y:n==="post"?K=()=>qt(Y,o&&o.suspense):(Y.pre=!0,o&&(Y.id=o.uid),K=()=>zn(Y));const J=new Dl(f,ie,K),kt=cc(),Tt=()=>{J.stop(),kt&&Cl(kt.effects,J)};return t?s?Y():P=J.run():n==="post"?qt(J.run.bind(J),o&&o.suspense):J.run(),U&&U.push(Tt),Tt}function Ef(e,t,s){const i=this.proxy,n=Ot(e)?e.includes(".")?bh(i,e):()=>i[e]:e.bind(i,i);let r;X(t)?r=t:(r=t.handler,s=t);const l=Vi(this),a=Vl(n,r.bind(i),s);return l(),a}function bh(e,t){const s=t.split(".");return()=>{let i=e;for(let n=0;n<s.length&&i;n++)i=i[s[n]];return i}}function ss(e,t=1/0,s){if(t<=0||!ut(e)||e.__v_skip||(s=s||new Set,s.has(e)))return e;if(s.add(e),t--,Xt(e))ss(e.value,t,s);else if(G(e))for(let i=0;i<e.length;i++)ss(e[i],t,s);else if(si(e)||qs(e))e.forEach(i=>{ss(i,t,s)});else if(Io(e)){for(const i in e)ss(e[i],t,s);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&ss(e[i],t,s)}return e}const ql=e=>e.type.__isKeepAlive;function If(e,t){kh(e,"a",t)}function Df(e,t){kh(e,"da",t)}function kh(e,t,s=It){const i=e.__wdc||(e.__wdc=()=>{let n=s;for(;n;){if(n.isDeactivated)return;n=n.parent}return e()});if($n(t,i,s),s){let n=s.parent;for(;n&&n.parent;)ql(n.parent.vnode)&&Lf(i,t,s,n),n=n.parent}}function Lf(e,t,s,i){const n=$n(t,e,i,!0);nh(()=>{Cl(i[t],n)},s)}function xh(e,t){e.shapeFlag&6&&e.component?xh(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}const Nf=e=>e.__isTeleport,tt=Symbol.for("v-fgt"),Qn=Symbol.for("v-txt"),us=Symbol.for("v-cmt"),Ar=Symbol.for("v-stc"),Ti=[];let ce=null;function u(e=!1){Ti.push(ce=e?null:[])}function Rf(){Ti.pop(),ce=Ti[Ti.length-1]||null}let Li=1;function ja(e){Li+=e}function wh(e){return e.dynamicChildren=Li>0?ce||Vs:null,Rf(),Li>0&&ce&&ce.push(e),e}function c(e,t,s,i,n,r){return wh(m(e,t,s,i,n,r,!0))}function lt(e,t,s,i,n){return wh(O(e,t,s,i,n,!0))}function Nn(e){return e?e.__v_isVNode===!0:!1}function hi(e,t){return e.type===t.type&&e.key===t.key}const Th=({key:e})=>e??null,bn=({ref:e,ref_key:t,ref_for:s})=>(typeof e=="number"&&(e=""+e),e!=null?Ot(e)||Xt(e)||X(e)?{i:Lt,r:e,k:t,f:!!s}:e:null);function m(e,t=null,s=null,i=0,n=null,r=e===tt?0:1,l=!1,a=!1){const o={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Th(t),ref:t&&bn(t),scopeId:Yn,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Lt};return a?(Bl(o,s),r&128&&e.normalize(o)):s&&(o.shapeFlag|=Ot(s)?8:16),Li>0&&!l&&ce&&(o.patchFlag>0||r&6)&&o.patchFlag!==32&&ce.push(o),o}const O=Pf;function Pf(e,t=null,s=null,i=0,n=null,r=!1){if((!e||e===zc)&&(e=us),Nn(e)){const a=Xs(e,t,!0);return s&&Bl(a,s),Li>0&&!r&&ce&&(a.shapeFlag&6?ce[ce.indexOf(e)]=a:ce.push(a)),a.patchFlag=-2,a}if(Kf(e)&&(e=e.__vccOpts),t){t=jf(t);let{class:a,style:o}=t;a&&!Ot(a)&&(t.class=Pt(a)),ut(o)&&(zo(o)&&!G(o)&&(o=jt({},o)),t.style=Ui(o))}const l=Ot(e)?1:Yc(e)?128:Nf(e)?64:ut(e)?4:X(e)?2:0;return m(e,t,s,i,n,l,r,!0)}function jf(e){return e?zo(e)||fh(e)?jt({},e):e:null}function Xs(e,t,s=!1,i=!1){const{props:n,ref:r,patchFlag:l,children:a,transition:o}=e,h=t?Uf(n||{},t):n,f={__v_isVNode:!0,__v_skip:!0,type:e.type,props:h,key:h&&Th(h),ref:t&&t.ref?s&&r?G(r)?r.concat(bn(t)):[r,bn(t)]:bn(t):r,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==tt?l===-1?16:l|16:l,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:o,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Xs(e.ssContent),ssFallback:e.ssFallback&&Xs(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return o&&i&&xh(f,o.clone(f)),f}function Jt(e=" ",t=0){return O(Qn,null,e,t)}function g(e="",t=!1){return t?(u(),lt(us,null,e)):O(us,null,e)}function Se(e){return e==null||typeof e=="boolean"?O(us):G(e)?O(tt,null,e.slice()):typeof e=="object"?es(e):O(Qn,null,String(e))}function es(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Xs(e)}function Bl(e,t){let s=0;const{shapeFlag:i}=e;if(t==null)t=null;else if(G(t))s=16;else if(typeof t=="object")if(i&65){const n=t.default;n&&(n._c&&(n._d=!1),Bl(e,n()),n._c&&(n._d=!0));return}else{s=32;const n=t._;!n&&!fh(t)?t._ctx=Lt:n===3&&Lt&&(Lt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else X(t)?(t={default:t,_ctx:Lt},s=32):(t=String(t),i&64?(s=16,t=[Jt(t)]):s=8);e.children=t,e.shapeFlag|=s}function Uf(...e){const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const n in i)if(n==="class")t.class!==i.class&&(t.class=Pt([t.class,i.class]));else if(n==="style")t.style=Ui([t.style,i.style]);else if(Gn(n)){const r=t[n],l=i[n];l&&r!==l&&!(G(r)&&r.includes(l))&&(t[n]=r?[].concat(r,l):l)}else n!==""&&(t[n]=i[n])}return t}function be(e,t,s,i=null){de(e,t,7,[s,i])}const Ff=hh();let Hf=0;function Vf(e,t,s){const i=e.type,n=(t?t.appContext:e.appContext)||Ff,r={uid:Hf++,vnode:e,type:i,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new hc(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:mh(i,n),emitsOptions:ih(i,n),emit:null,emitted:null,propsDefaults:dt,inheritAttrs:i.inheritAttrs,ctx:dt,data:dt,props:dt,attrs:dt,slots:dt,refs:dt,setupState:dt,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=qc.bind(null,r),e.ce&&e.ce(r),r}let It=null,Rn,sl;{const e=Lo(),t=(s,i)=>{let n;return(n=e[s])||(n=e[s]=[]),n.push(i),r=>{n.length>1?n.forEach(l=>l(r)):n[0](r)}};Rn=t("__VUE_INSTANCE_SETTERS__",s=>It=s),sl=t("__VUE_SSR_SETTERS__",s=>qi=s)}const Vi=e=>{const t=It;return Rn(e),e.scope.on(),()=>{e.scope.off(),Rn(t)}},Ua=()=>{It&&It.scope.off(),Rn(null)};function Sh(e){return e.vnode.shapeFlag&4}let qi=!1;function qf(e,t=!1){t&&sl(t);const{props:s,children:i}=e.vnode,n=Sh(e);yf(e,s,n,t),kf(e,i);const r=n?Bf(e,t):void 0;return t&&sl(!1),r}function Bf(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,hf);const{setup:i}=s;if(i){const n=e.setupContext=i.length>1?Wf(e):null,r=Vi(e);ms();const l=ls(i,e,0,[e.props,n]);if(Ge(),r(),Co(l)){if(l.then(Ua,Ua),t)return l.then(a=>{Fa(e,a)}).catch(a=>{Hi(a,e,0)});e.asyncDep=l}else Fa(e,l)}else Ah(e)}function Fa(e,t,s){X(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:ut(t)&&(e.setupState=$o(t)),Ah(e)}function Ah(e,t,s){const i=e.type;e.render||(e.render=i.render||ie);{const n=Vi(e);ms();try{uf(e)}finally{Ge(),n()}}}const Gf={get(e,t){return zt(e,"get",""),e[t]}};function Wf(e){const t=s=>{e.exposed=s||{}};return{attrs:new Proxy(e.attrs,Gf),slots:e.slots,emit:e.emit,expose:t}}function Zn(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy($o(Xr(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in xi)return xi[s](e)},has(t,s){return s in t||s in xi}})):e.proxy}function Jf(e,t=!0){return X(e)?e.displayName||e.name:e.name||t&&e.__name}function Kf(e){return X(e)&&"__vccOpts"in e}const il=(e,t)=>Dc(e,t,qi);function zf(e,t,s){const i=arguments.length;return i===2?ut(t)&&!G(t)?Nn(t)?O(e,null,[t]):O(e,t):O(e,null,t):(i>3?s=Array.prototype.slice.call(arguments,2):i===3&&Nn(s)&&(s=[s]),O(e,t,s))}const Xf="3.4.30";/**
* @vue/runtime-dom v3.4.30
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Yf="http://www.w3.org/2000/svg",$f="http://www.w3.org/1998/Math/MathML",Pe=typeof document<"u"?document:null,Ha=Pe&&Pe.createElement("template"),Qf={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,i)=>{const n=t==="svg"?Pe.createElementNS(Yf,e):t==="mathml"?Pe.createElementNS($f,e):s?Pe.createElement(e,{is:s}):Pe.createElement(e);return e==="select"&&i&&i.multiple!=null&&n.setAttribute("multiple",i.multiple),n},createText:e=>Pe.createTextNode(e),createComment:e=>Pe.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Pe.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,i,n,r){const l=s?s.previousSibling:t.lastChild;if(n&&(n===r||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),s),!(n===r||!(n=n.nextSibling)););else{Ha.innerHTML=i==="svg"?`<svg>${e}</svg>`:i==="mathml"?`<math>${e}</math>`:e;const a=Ha.content;if(i==="svg"||i==="mathml"){const o=a.firstChild;for(;o.firstChild;)a.appendChild(o.firstChild);a.removeChild(o)}t.insertBefore(a,s)}return[l?l.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},Zf=Symbol("_vtc");function td(e,t,s){const i=e[Zf];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}const Pn=Symbol("_vod"),Oh=Symbol("_vsh"),ke={beforeMount(e,{value:t},{transition:s}){e[Pn]=e.style.display==="none"?"":e.style.display,s&&t?s.beforeEnter(e):ui(e,t)},mounted(e,{value:t},{transition:s}){s&&t&&s.enter(e)},updated(e,{value:t,oldValue:s},{transition:i}){!t!=!s&&(i?t?(i.beforeEnter(e),ui(e,!0),i.enter(e)):i.leave(e,()=>{ui(e,!1)}):ui(e,t))},beforeUnmount(e,{value:t}){ui(e,t)}};function ui(e,t){e.style.display=t?e[Pn]:"none",e[Oh]=!t}const ed=Symbol(""),sd=/(^|;)\s*display\s*:/;function id(e,t,s){const i=e.style,n=Ot(s);let r=!1;if(s&&!n){if(t)if(Ot(t))for(const l of t.split(";")){const a=l.slice(0,l.indexOf(":")).trim();s[a]==null&&kn(i,a,"")}else for(const l in t)s[l]==null&&kn(i,l,"");for(const l in s)l==="display"&&(r=!0),kn(i,l,s[l])}else if(n){if(t!==s){const l=i[ed];l&&(s+=";"+l),i.cssText=s,r=sd.test(s)}}else t&&e.removeAttribute("style");Pn in e&&(e[Pn]=r?i.display:"",e[Oh]&&(i.display="none"))}const Va=/\s*!important$/;function kn(e,t,s){if(G(s))s.forEach(i=>kn(e,t,i));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const i=nd(e,t);Va.test(s)?e.setProperty(ii(i),s.replace(Va,""),"important"):e[i]=s}}const qa=["Webkit","Moz","ms"],Or={};function nd(e,t){const s=Or[t];if(s)return s;let i=Me(t);if(i!=="filter"&&i in e)return Or[t]=i;i=Jn(i);for(let n=0;n<qa.length;n++){const r=qa[n]+i;if(r in e)return Or[t]=r}return t}const Ba="http://www.w3.org/1999/xlink";function Ga(e,t,s,i,n,r=ac(t)){i&&t.startsWith("xlink:")?s==null?e.removeAttributeNS(Ba,t.slice(6,t.length)):e.setAttributeNS(Ba,t,s):s==null||r&&!No(s)?e.removeAttribute(t):e.setAttribute(t,r?"":Oe(s)?String(s):s)}function rd(e,t,s,i,n,r,l){if(t==="innerHTML"||t==="textContent"){i&&l(i,n,r),e[t]=s??"";return}const a=e.tagName;if(t==="value"&&a!=="PROGRESS"&&!a.includes("-")){const h=a==="OPTION"?e.getAttribute("value")||"":e.value,f=s==null?"":String(s);(h!==f||!("_value"in e))&&(e.value=f),s==null&&e.removeAttribute(t),e._value=s;return}let o=!1;if(s===""||s==null){const h=typeof e[t];h==="boolean"?s=No(s):s==null&&h==="string"?(s="",o=!0):h==="number"&&(s=0,o=!0)}try{e[t]=s}catch{}o&&e.removeAttribute(t)}function is(e,t,s,i){e.addEventListener(t,s,i)}function ld(e,t,s,i){e.removeEventListener(t,s,i)}const Wa=Symbol("_vei");function ad(e,t,s,i,n=null){const r=e[Wa]||(e[Wa]={}),l=r[t];if(i&&l)l.value=i;else{const[a,o]=od(t);if(i){const h=r[t]=cd(i,n);is(e,a,h,o)}else l&&(ld(e,a,l,o),r[t]=void 0)}}const Ja=/(?:Once|Passive|Capture)$/;function od(e){let t;if(Ja.test(e)){t={};let i;for(;i=e.match(Ja);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):ii(e.slice(2)),t]}let Mr=0;const hd=Promise.resolve(),ud=()=>Mr||(hd.then(()=>Mr=0),Mr=Date.now());function cd(e,t){const s=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=s.attached)return;de(fd(i,s.value),t,5,[i])};return s.value=e,s.attached=ud(),s}function fd(e,t){if(G(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(i=>n=>!n._stopped&&i&&i(n))}else return t}const Ka=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,dd=(e,t,s,i,n,r,l,a,o)=>{const h=n==="svg";t==="class"?td(e,i,h):t==="style"?id(e,s,i):Gn(t)?Ml(t)||ad(e,t,s,i,l):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):md(e,t,i,h))?(rd(e,t,i,r,l,a,o),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Ga(e,t,i,h,l,t!=="value")):(t==="true-value"?e._trueValue=i:t==="false-value"&&(e._falseValue=i),Ga(e,t,i,h))};function md(e,t,s,i){if(i)return!!(t==="innerHTML"||t==="textContent"||t in e&&Ka(t)&&X(s));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const n=e.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return Ka(t)&&Ot(s)?!1:t in e}const Ys=e=>{const t=e.props["onUpdate:modelValue"]||!1;return G(t)?s=>_n(t,s):t};function pd(e){e.target.composing=!0}function za(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const qe=Symbol("_assign"),gd={created(e,{modifiers:{lazy:t,trim:s,number:i}},n){e[qe]=Ys(n);const r=i||n.props&&n.props.type==="number";is(e,t?"change":"input",l=>{if(l.target.composing)return;let a=e.value;s&&(a=a.trim()),r&&(a=En(a)),e[qe](a)}),s&&is(e,"change",()=>{e.value=e.value.trim()}),t||(is(e,"compositionstart",pd),is(e,"compositionend",za),is(e,"change",za))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:s,modifiers:{lazy:i,trim:n,number:r}},l){if(e[qe]=Ys(l),e.composing)return;const a=(r||e.type==="number")&&!/^0\d/.test(e.value)?En(e.value):e.value,o=t??"";a!==o&&(document.activeElement===e&&e.type!=="range"&&(i&&t===s||n&&e.value.trim()===o)||(e.value=o))}},$e={deep:!0,created(e,t,s){e[qe]=Ys(s),is(e,"change",()=>{const i=e._modelValue,n=Ni(e),r=e.checked,l=e[qe];if(G(i)){const a=Il(i,n),o=a!==-1;if(r&&!o)l(i.concat(n));else if(!r&&o){const h=[...i];h.splice(a,1),l(h)}}else if(si(i)){const a=new Set(i);r?a.add(n):a.delete(n),l(a)}else l(Mh(e,r))})},mounted:Xa,beforeUpdate(e,t,s){e[qe]=Ys(s),Xa(e,t,s)}};function Xa(e,{value:t,oldValue:s},i){e._modelValue=t,G(t)?e.checked=Il(t,i.props.value)>-1:si(t)?e.checked=t.has(i.props.value):t!==s&&(e.checked=Fi(t,Mh(e,!0)))}const lx={deep:!0,created(e,{value:t,modifiers:{number:s}},i){const n=si(t);is(e,"change",()=>{const r=Array.prototype.filter.call(e.options,l=>l.selected).map(l=>s?En(Ni(l)):Ni(l));e[qe](e.multiple?n?new Set(r):r:r[0]),e._assigning=!0,Zo(()=>{e._assigning=!1})}),e[qe]=Ys(i)},mounted(e,{value:t,modifiers:{number:s}}){Ya(e,t)},beforeUpdate(e,t,s){e[qe]=Ys(s)},updated(e,{value:t,modifiers:{number:s}}){e._assigning||Ya(e,t)}};function Ya(e,t,s){const i=e.multiple,n=G(t);if(!(i&&!n&&!si(t))){for(let r=0,l=e.options.length;r<l;r++){const a=e.options[r],o=Ni(a);if(i)if(n){const h=typeof o;h==="string"||h==="number"?a.selected=t.some(f=>String(f)===String(o)):a.selected=Il(t,o)>-1}else a.selected=t.has(o);else if(Fi(Ni(a),t)){e.selectedIndex!==r&&(e.selectedIndex=r);return}}!i&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function Ni(e){return"_value"in e?e._value:e.value}function Mh(e,t){const s=t?"_trueValue":"_falseValue";return s in e?e[s]:t}const _d=["ctrl","shift","alt","meta"],yd={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>_d.some(s=>e[`${s}Key`]&&!t.includes(s))},Zt=(e,t)=>{const s=e._withMods||(e._withMods={}),i=t.join(".");return s[i]||(s[i]=(n,...r)=>{for(let l=0;l<t.length;l++){const a=yd[t[l]];if(a&&a(n,t))return}return e(n,...r)})},vd=jt({patchProp:dd},Qf);let $a;function bd(){return $a||($a=wf(vd))}const kd=(...e)=>{const t=bd().createApp(...e),{mount:s}=t;return t.mount=i=>{const n=wd(i);if(!n)return;const r=t._component;!X(r)&&!r.render&&!r.template&&(r.template=n.innerHTML),n.innerHTML="";const l=s(n,!1,xd(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),l},t};function xd(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function wd(e){return Ot(e)?document.querySelector(e):e}const Ch=new Set;function nl(e,t){let s=null;for(const i in e){let n=e[i];const r=t[i];if(n!=r){if(n){if(typeof n=="object"&&typeof r=="object"&&r!==null&&(n=nl(n,r),n===null))continue}else if(!r)continue;s===null&&(s={}),s[i]=n}}return s}function $s(e,t,s=null){const i=Eh(e);if(s)for(const r of s)i.add(r);let n=t;for(;n!==Object.prototype;){for(const r in n){if(i.has(r))continue;const l=e[r],a=t[r];if(l===void 0){a!==null&&typeof a=="object"?e[r]=rl(a,Array.isArray(a)?[]:{}):e[r]=a;continue}else if(l===null)continue;a&&typeof l=="object"&&typeof a=="object"&&Array.isArray(l)===Array.isArray(a)&&$s(l,a)}n=Object.getPrototypeOf(n)}}function Ht(e,t=null){let s;if(t==null){if(e.clone&&typeof e.clone=="function")return e.clone.call(e);let i=Object.getPrototypeOf(e);t=Array.isArray(e)?[]:i?Object.create(i):{}}for(const i in e){s=e[i];const n=tr(t,i);n&&!n.writable&&n.set===void 0||(s==null?t[i]=s:typeof s=="object"?s.clone&&typeof s.clone=="function"?t[i]=s.clone.call(s):t[i]=Ht(s):t[i]=s)}return t}function rl(e,t={}){if(typeof e.clone=="function ")return e.clone();let s,i;for(let n in e)s=e[n],s==null?t[n]=s:Array.isArray(s)?t[n]=rl(s,[]):typeof s=="object"?(i=s.clone,i&&typeof i=="function"?t[n]=i.call(s):t[n]=rl(s)):t[n]=s;return t}function Eh(e,t=null){const s=new Set(t);let i=e;for(;i!==Object.prototype;){const n=Object.getOwnPropertyDescriptors(i);for(const r in n){const l=n[r];l.writable!==!0&&l.set===void 0&&s.add(r)}i=Object.getPrototypeOf(i)}return s}function Td(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const i=Object.getOwnPropertyDescriptors(s);for(const n in i)t.set(n,i[n]);s=Object.getPrototypeOf(s)}return t}function we(e,...t){for(let s=t.length-1;s>=0;s--)if(e.includes(t[s]))return!0;return!1}function Sd(e,t=null,s=null){if(!e)return;s||(s=Ch);let i=e;for(;i!==Object.prototype;){for(let n of Object.getOwnPropertyNames(i))s.has(n)||e[n]!==void 0||Object.getOwnPropertyDescriptor(i,n).set!==void 0&&(e[n]=t);i=Object.getPrototypeOf(i)}}function tr(e,t){for(;e!==Object.prototype;){const s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=Object.getPrototypeOf(e)}return null}function ge(e,t,s=null){let i=Eh(e,s);for(let n of Object.getOwnPropertyNames(t))i.has(n)!==!0&&(e[n]=t[n]);return e}function Qa(e,t=null,s=null,i=!0){const n={};let r,l;if(t==null&&(t=Ch),s)for(r of s)l=e[r],l!==void 0&&(typeof l=="object"&&l!==null&&l.toJSON?n[r]=l.toJSON():n[r]=l);let a=Object.getPrototypeOf(e);for(;a!=Object.prototype;){for(r of Object.getOwnPropertyNames(a)){if(t.has(r))continue;const o=Object.getOwnPropertyDescriptor(a,r);i&&o.set===void 0&&!o.writable||(l=e[r],!(l===void 0||typeof l=="function")&&(typeof l=="object"&&l!==null&&l.toJSON?n[r]=l.toJSON():n[r]=l))}a=Object.getPrototypeOf(a)}return n}const Ih=e=>e+Date.now().toString(36).slice(3)+(4096*Math.random()).toString(36),mt="%",Si="range",Ad="stat",Ri="mod",Gl="rval",Dh="func",Od="dot",Ms="runnable",Lh="state",Qs="enchantslots",Nh="title",Rh="log",Ph="potion",ll="item",er="npc",sr="resource",Wl="skill",me="encounter",ne="monster",Gt="wearable",Md="enchant",Ai="home",jh="companion",jn="event",Cd="equipslot",Jl="hobbies",Kl="goals",Be="armor",Kt="weapon",Cr="t_rest",ir="task",Ed="dungeon",Id="locale",Gs="explore",Dd="clash",Bt=Object.freeze({SUCCESS:1,FAIL:2,DEFEATED:4,USER:8,CANTRUN:16,COST:32,FULL:64,MAXED:128,MIDRUN_LOSS:52}),cs="untag_",xn=["cost","run","effect","result","convert","input","output"],je=1,al=0,Za=2;function fe(e){return .5+3.5*Math.exp(-e/20)}const C=Object.freeze({GDATA:"g",TARGET:"t",ACTOR:"a",ITEM:"i",CONTEXT:"c",STATE:"s",MOD:"mod"}),Un=(e,t)=>{if(Array.isArray(e)){for(let s=e.length-1;s>=0;s--){const i=e[s];if(i&&i==t.type||i===t.kind||i===t.slot||t.hasTag(i))return!0}return!1}return e===t.type||e===t.kind||e===t.slot||t.hasTag(e)},Ld=(e,t=null)=>t?e.filter(s=>Un(t,s)):Array.from(e),to=["","K","M","B","T"],Uh=(e,t=3,s=!0)=>{const i=typeof e=="number"?e:parseFloat(e);if(!i)return e;const n=Math.sign(i);let r=Math.floor(Math.abs(i));const l=Math.abs(i)-r;let a=l>0&&!s?l.toFixed(t).slice(1):"";for(;r>=1e3;)a=","+(r%1e3).toString().padStart(3,"0")+a,r=Math.floor(r/1e3);return a=(r%1e3).toString()+a,n>0?a:"-"+a},ax=e=>{let t=1;if(e<0&&(t=-1,e=-e),e<=1)return t;let s=Math.floor((Math.log10(e)-1)/3);return s<1?t*e:s>=to.length?(t*e).toExponential(2):t*Math.round(e/Math.pow(10,3*s))+to[s]},Q=(e,t=2,s=0)=>{const i=Number(e);if(Number.isNaN(i))return e;if(i===Math.floor(i))return i;let n=Math.pow(10,t),r=Math.pow(10,s),l=Math.abs(i),a=1;for(;l<n&&l!==Math.floor(l);)l*=10,a*=10;return l=Math.round(l)/a,l*r<1&&s>0?"~0":i>=0?l:-l},Fh=e=>{if(!e)return"";let t=e.name;if(!t)return e;let s=t.indexOf(" ");return s>=0&&s+1<t.length?t[0]+t[s+1]:t.slice(0,2)},ox=(e,t=2)=>{let s=Math.pow(10,t);return Math.floor(e*s)/s},Nd=e=>e===null||isNaN(e)?0:Math.floor(e),Pi=(e=void 0,t=e,s=new Set,i=!1)=>{s.add(e);for(const n in e){const r=e[n];if(r!=null)if(Array.isArray(r))for(let l=r.length-1;l>=0;l--){const a=r[l];typeof a=="object"&&!s.has(a)&&Pi(a,t,s,i)}else typeof r=="object"&&!s.has(r)&&(r instanceof Vt?!r.source||i?r.source=t:r.source!==t&&console.warn("Mismatching source while setting initiating RValues",t,r.source):Pi(r,t,s,i))}},Ue=(e,t)=>e+"."+t;let Vt=class Hh{toJSON(){return this._value}clone(){let t=new Hh(this._value,this._id);return t.source=this.source,t}get source(){return this._source instanceof WeakRef?this._source.deref():this._source}set source(t){this._source=t!=null&&t instanceof Object?new WeakRef(t):t}get isRVal(){return!0}get id(){return this._id}set id(t){this._id=t}get value(){return this._value}set value(t){this._value=t}get type(){return Gl}toString(){return Q(this.value)}valueOf(){return this._value}constructor(t=0,s=null){this.id=s,this._value=t||0}add(t){this.value+=t}set(t){this.value=Number(t)}apply(t,s=1){this.add(t.value*s)}addMod(t,s){console.warn("ATTEMPT TO MOD RVAL: "+this.id+" mod: "+t.id)}getApply(){return this.valueOf()}apply(t,s){}delValue(t=0){return this._value+t}removeMods(t){}instantiate(){return+this}};class N extends Vt{static getBase(t){return t instanceof N?t.base:t}toJSON(){return this._value}toString(){return Q(this.value)}set value(t){this._value=t}get value(){return this.valueOf()}valueOf(){let t=this._value+this._mBase,s=Math.max(1+this._mPct,0);return this._min!==null&&this._min!==void 0?Math.max(t*s,this._min):t*s}get base(){return this._value}set base(t){this._value=t}get mBase(){return this._mBase}set mBase(t){this._mBase=t}get mPct(){return this._mPct}get pctTot(){return this._mPct}get prev(){return this._prev||0}set prev(t){this._prev=t}get mod(){return this._mod}set mod(t){this._mod=t}get mods(){return this._mods}set mods(t){const s={};for(const i in t){const n=t[i];s[i]=n instanceof Mod?n:new Mod(t[i])}this._mods=s,this.recalc()}get min(){return this._min}set min(t){this._min=t}get type(){return Ad}constructor(t=null,s,i){super(0,s),t&&(typeof t=="object"?t.type===Gl?this.base=t.value??0:this.base=t.base:isNaN(t)||(this.base=Number(t))),i&&(this.min=i),this.base||(this.base=0),this._mBase=this._mPct=0,this.mod||(this.mod={}),this.mods||(this.mods={})}set(t){this.base=typeof t=="number"?t:t.base}add(t){super.value+=t}apply(t,s=1){if(t.type===Ri&&t.id)return this.addMod(t,s);if(t.type===Ri&&console.warn("MOD WITHOUT ID: "+t),isNaN(t)||(t=+t),typeof t=="number"){this.base+=s*t;return}else typeof t=="object"?(this.base+=s*(t.bonus||t.value||0),console.warn(this.id+" DEPRECATED APPLY: "+t+"  type: "+t.constructor.name)):console.dir(t,"unknown mod: "+typeof t)}perm(t){console.warn(this.id+" PERM MOD: "+t),t.countBonus?this.base+=t.countBonus:typeof t=="number"&&(this.base+=t)}addMod(t,s=1){if(!t.id){console.dir(t,"NO MOD ID"),this.apply(t,s);return}this.mods[t.id]=t,this.recalc()}removeMods(t){this.mods[t.id]!==void 0&&(this.mods[t.id]=void 0,this.recalc())}delValue(t=0,s=0){return(this._value+this._mBase+t)*(1+this._mPct+s)}update(){let t=+this,s=t!==this.prev;return s&&this.mod&&Object.values(this.mod).length&&v.applyMods(this.mod,t),this.prev=t,s}recalc(){let t=0,s=0;for(const i in this._mods){const n=this._mods[i];n!==void 0&&(s+=n.countPct||0,t+=n.countBonus||0)}return this._mPct=s,this._mBase=t,this.update()}canPay(t){let s=this.base-t+this._mBase;return this._min!==null&&this._min!==void 0?s*(1+this._mPct)>=this.min:!0}}const hx=(e,t)=>typeof e.name=="string"?e.name.localeCompare(t.name,"en",{sensitivity:"base"}):e.name<t.name?-1:1,ux=(e,t)=>{let s=(e.sortOrder??0)-(t.sortOrder??0);return s!==0||(s=e.level-t.level,s!==0)?s:e.name<t.name?-1:1},Rd=(e,t)=>{for(let s=t.length-1;s>=0;s--){const i=t[s];e.hasOwnProperty(i)||(e[i]=null)}},Vh=(e,t)=>{let s=tr(e,t);return!s||s.set||s.writable},zl=(e,t)=>{for(let s of Object.getOwnPropertyNames(t)){if(s[0]==="_")continue;const i=tr(e,s);if(i)if(i.set)typeof e[s]=="function"&&console.log("OVERWRITE: "+s);else if(i.writable){if(typeof e[s]=="function")continue}else continue;e[s]=t[s]}return e};function Pd(e,...t){let s={};for(;e!==Object.prototype&&t.length;){let i=Object.getOwnPropertyDescriptors(e);t=t.filter(n=>i[n]?(s[n]=i[n],!1):!0),e=Object.getPrototypeOf(e)}return s}function jd(e){let t={};for(;e!==Object.prototype;){for(let[s,i]of Object.entries(Object.getOwnPropertyDescriptors(e)))t[s]||(t[s]=i);e=Object.getPrototypeOf(e)}return t}const qh=(e,t)=>{let s=t;for(;s!==Object.prototype;){for(const i of Object.getOwnPropertyNames(s)){if(i[0]==="_")continue;const n=tr(e,i);if(n)if(n.set)typeof e[i]=="function"&&console.log("OVERWRITE func: "+i);else if(n.writable){if(typeof e[i]=="function")continue}else continue;e[i]=t[i]}s=Object.getPrototypeOf(s)}return e};function eo(e){return typeof e=="object"&&e.constructor.name==="Object"}function Bh(e,t,...s){if(!eo(e))return[];let i=[];for(let n in e){if(s.includes(n))continue;let r=e[n];eo(r)?i.push(...Bh(r,t,...s)):(t&&t instanceof Function&&(t(e,n,r),r=e[n]),i.push({obj:e,prop:n,sub:r}))}return i}const Bi=e=>{if(!(!e||typeof e!="object")){for(const t in e){const s=e[t];t.includes(".")&&Gh(e,t),s&&typeof s=="object"&&Object.getPrototypeOf(s)===Object.prototype&&Bi(s)}return e}},Gh=(e,t)=>{const s=e[t];delete e[t];const i=t.split("."),n=i.length-1;for(let r=0;r<n;r++){let l=e[i[r]];l==null?l={}:(typeof l!="object"||Object.getPrototypeOf(l)!==Object.prototype)&&(l={value:l}),e=e[i[r]]=l}e[i[n]]=s},Gi=e=>{let t;for(let s in e)t=e[s],typeof t=="object"?Gi(t):Object.freeze(t);return Object.freeze(e)},ol=e=>{if(Array.isArray(e))return`[ 
`+e.map(t=>ol(t)).join(", ")+`
 ]`;if(typeof e=="object"){let t="{ ";for(let s in e)t+=`
${s}: `+ol(e[s]);return t+=`
}`,t}else return""+e},Ud=(e,t="")=>{console.log((t?t+": ":"")+ol(e))},Er=e=>e?e.length>1?e[0].toUpperCase()+e.slice(1):e[0].toUpperCase():"";String.prototype.toTitleCase=function(){return this.trim().toLowerCase().replace(/\b\w\S*/g,e=>e==="i"||e=="ii"||e==="iii"||e==="iv"||e==="v"?e.toUpperCase():e[0].toUpperCase()+e.slice(1))};const Wh=(e,t)=>e*(100+t)/100,wn=(e,t,s)=>{if(!e[t])return 0;if(e[t]instanceof Function){const i={[FP.GDATA]:s};return e[t].getApply(i)}else return e[t].valueOf()},Wi=/^(\d+(?:\.\d+)?)\%$/i;class pe{toJSON(){return 100*this.pct+"%"}get value(){return Math.random()<this.pct?1:0}roll(t=0){return Math.random()<Wh(this.pct,t)}get type(){return mt}toString(){return Q(100*this.pct)+"%"}constructor(t){if(typeof t=="string"){let s=Wi.exec(t);s?this.pct=s[1]:this.pct=Number(t)}else isNaN(t)||(this.pct=t);this.pct=(this.pct||0)/100}clone(){return new pe(100*this.pct)}}const Jh=/^([\+\-]?\d*(?:\.\d+)?(?![.%0-9]))?(?:([\+\-]?\d*(?:\.\d+)?)\%)?$/,Fd=/^(?<source>.*)\.mod\.(?<target>.*)$/,Hd="all";let Dt=class Tn extends N{toJSON(){return this._basePct===0?this.base:(this.base||"")+((this._basePct>0?"+":"")+100*this.basePct+"%")}toString(){let t=this.bonus!==0?Q(this.bonus.toString()):"";return this.pctTot!==0&&(this.bonus!==0&&(t+=" & "),t+=Q(100*this.pctTot)+"%"),t||(t="0"),t}get count(){return this._count!==null&&this._count!==void 0?this._count:((this.source===null||this.source===void 0)&&console.warn(this.id+" No Source"),this.source)}set count(t){t&&typeof t=="object"?t.str?this.count=t.str:this._count=t:this._count=t}get basePct(){return this._basePct}set basePct(t){this._basePct=t}get bonus(){return(this.base+this.mBase)*(1+this.mPct)}get pctTot(){return this.basePct+this.mPct}get countPct(){return this.pctTot*this.count}get countBonus(){return this.bonus*this.count}get str(){return this.value}set str(t){if(typeof t=="string"){let s=Jh.exec(t);s?s.length===3?(this.base=Number(s[1])||0,this.basePct=Number(s[2])/100||0):s.length===2&&(this.base=s[1]||0,this.basePct=0):console.error(this.id+" no mod regex: "+t)}else t instanceof pe?this.basePct=t.pct:isNaN(t)?typeof t=="object"&&t&&typeof t=="object"&&t.str&&(this.str=t.str):this.base=t}get type(){return Ri}constructor(t=null,s=null,i=null){super(null,s),typeof i=="number"?this.count=i:this.source=i,typeof t=="number"?this.base=t:typeof t=="string"?this.str=t:t&&(t.value?this.str=t.value:ge(this,t)),this.base=this.base||0,this.basePct=this.basePct||0,this.id||(this.id=Hd)}clone(){return new Tn({base:this.base,basePct:this.basePct},this.id,this.source)}applyTo(t,s,i,n=!1,r=null){let l=t[s];if(s.startsWith(cs)){let a=s.slice(cs.length),o=[],h=null;const f=Array.isArray(t);for(const _ in t){let x=t[_],T=x;if(f||(T=v.state.getData(_)),T&&T.hasTag(a))if(r)x[r]&&(h=this.applyTo(x,r,i,!0,r));else if(f){console.warn("Arrayed object without childKey: ",t,_,x,l,s,this);continue}else h=this.applyTo(t,_,i,!0);o.shift(h)}return o}else{if((l==null?void 0:l.addMod)instanceof Function)return l.addMod(this,i)||l instanceof Tn?l:null;if(typeof l=="number"){if(!Vh(t,s))return console.log("NOT WRITABLE: "+s),null;(t[s]=new N(l||0,(t.id?t.id+".":"")+s)).addMod(this,i)}else if(l==null)console.error("DEPRECATED: MOD.applyTo() NEW MOD AT TARGET: "+s);else if(typeof l=="object")if(Array.isArray(l)){const a=[];for(let o=l.length-1,h;o>=0;o--)(h=this.applyTo(l[o],s,i))&&a.unshift(h);return a}else if(l.value){if(l=this.applyTo(l,"value",i),l)return l}else{const a=[];if(!l)return;if(xn.includes(s)||n){let o=null;for(let h in l){const f=l[h];if(typeof f.value=="boolean"){console.warn("Skipping boolean value: "+s+"."+h);continue}typeof f>"u"||(o=this.applyTo(l,h,i,!0),a.unshift(o))}}if(a)return a;console.warn(this.id+": "+l.id+" !!Mod Targ: "+l.constructor.name),l.value=i*this.bonus*(1+i*this.pctTot)}}return null}addMod(t,s=1){return super.addMod(t,s),this}removeMods(t){var n,r;super.removeMods(t);let s=(r=(n=Fd.exec(t.id))==null?void 0:n.groups)==null?void 0:r.target;if(!s){console.warn(`Failed to find targetPath in mod id ${t.id}}`,t);return}let i=Bi({[s]:this});v.applyMods(i)}instantiate(){return new Tn({base:this.bonus,basePct:this.pctTot,count:+this.source},this.id)}},Ir=new Set;var hl=new Set;const so=()=>{const e=hl;return Ir.clear(),hl=Ir,Ir=e,e},io=e=>{(e.delta==0||!_t.has(e))&&hl.add(e)};let Dr=new Set;var _t=new Set;const Vd=()=>{const e=_t;return Dr.clear(),_t=Dr,Dr=e,e},qd=(...e)=>`{${e.join(",")}}`,Bd=Object.values(C),Lr=C.MOD;class Rt extends Vt{constructor(s,i,n){super(0,n);_s(this,"_recordedParams",{});_s(this,"instantiate",this.clone);_s(this,"addMod",N.prototype.addMod);_s(this,"removeMods",N.prototype.removeMods);this._params=[...s??Bd],this._params.includes(Lr)||this._params.push(Lr),this._src=i,this._fn=new Function(qd(...this._params),"return "+i),this.mods={},this.mBase=this.mPct=0}toJSON(){return this._src}get fn(){return this._fn}set fn(s){this._fn=s}get type(){return Dh}get mod(){}set mod(s){console.warn("Attempting to set mod of an FValue",s,this)}get recordedParams(){let s={};for(const i in this._recordedParams){const n=this._recordedParams[i].deref();n!=null?s[i]=n:(console.warn("FValue parameter has been garbage collected",i,this),delete this._recordedParams[i])}return s}set recordedParams(s){for(const i in s)this.setParameter(i,s[i])}get value(){return+this}set value(s){console.warn("Attempting to set value of an FValue",s,this)}toString(s){return Q(this.applyDummy(s))+" (Function)"}valueOf(s){return this.getApply(s)}getApply(s){const i=this.recordedParams;if(s==null)if(Object.values(i).length)s={};else return this.applyDummy();return typeof s!="object"?(console.warn("Non-object params in FValue apply",s,this),0):(s={...i,...s},this.calculateValue(s))}applyDummy(s={}){return typeof s!="object"&&(console.warn("Non-object params in FValue applyDummy",s,this),s={}),s={[C.GDATA]:v.state.items,[C.ACTOR]:v.player,[C.TARGET]:v.player,[C.CONTEXT]:v.player.context,[C.STATE]:v.state,[C.ITEM]:this.source,...this.recordedParams,...s},this.calculateValue(s)}calculateValue(s){let i=this.mBase,n=!1,r=this.mPct,l=!1;s[Lr]={get flat(){return n=!0,i},get pct(){return l=!0,r}};let a=this._fn(s);return isNaN(a)?(console.warn("Cannot convert FValue into number",a,this),0):(l||(n||(a+=this.mBase),a*=1+this.mPct),a)}setParameter(s,i){this._recordedParams[s]=new WeakRef(i)}clone(){let s=new Rt(this._params,this._src,this._id);return s.source=this.source,s.recordedParams=this.recordedParams,s}canPay(){return!1}apply(s,i=1){if(s.type===Ri&&s.id)return this.addMod(s,i);console.warn("Cannot apply",s,"to FValue",this)}recalc(){let s=0,i=0;for(let r in this.mods){var n=this.mods[r];n!==void 0&&(i+=n.countPct||0,s+=n.countBonus||0)}return this.mPct=i,this.mBase=s,!1}}const ns=/^\-?\d+\.?\d*\~\-?\d+\.?\d*$/i,Nr="~";class Mt{toJSON(){return(typeof this.min=="number"?this.min:this.min.base)+Nr+(typeof this.max=="number"?this.max:this.max.base)}toString(){const t=Q(this.min),s=Q(this.max);return t==s?t:t+" "+Nr+" "+s}get id(){return this._id}set id(t){this._id=t}get type(){return Si}get min(){return this._min}set min(t){this._min=t}get max(){return this._max}set max(t){this._max=t}get value(){return this.min+Math.random()*(this.max-this.min)}set value(t){this.min=this.max=t}get avg(){return(this.min+this.max)/2}get isRVal(){return!0}valueOf(){return this.value}constructor(t,s){if(typeof t=="string"){let i=t.split(Nr);this.min=Number(i[0]),this.max=Number(i[1])}else typeof t=="object"?Object.assign(this,t):(this.min=Number(t),this.max=Number(s===void 0?t:s));typeof this.min!="number"&&console.log("min: "+this.min+" -> "+this.max)}contains(t){return t>=this.min&&t<=this.max}percent(t){return this.min+t*(this.max-this.min)}addMod(t,s){this.min instanceof N||(this.min=new N(this.min,Ue(this.id,"min"))),this.max instanceof N||(this.max=new N(this.max,Ue(this.id,"max"))),this.min.addMod(t,s),this.max.addMod(t,s)}removeMods(t){this.min instanceof N&&this.min.removeMods(t),this.max instanceof N&&this.max.removeMods(t)}add(t){typeof t=="number"?(this.min+=t,this.max+=t):t&&typeof t=="object"&&(t.type===Si?(this.min+=t.min,this.max+=t.max):t.value&&(this.min+=t.value,this.max+=t.value))}multiply(t){typeof t=="number"?(this.min*=t,this.max*=t):t&&typeof t=="object"&&(t.type===Si?(this.min*=t.min,this.max*=t.max):t.value&&(this.min*=t.value,this.max*=t.value))}getApply(){return this.valueOf()}instantiate(){return new Mt(+this.min,+this.max)}}function Gd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kh={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function n(o,h,f){this.fn=o,this.context=h,this.once=f||!1}function r(o,h,f,_,x){if(typeof f!="function")throw new TypeError("The listener must be a function");var T=new n(f,_||o,x),E=s?s+h:h;return o._events[E]?o._events[E].fn?o._events[E]=[o._events[E],T]:o._events[E].push(T):(o._events[E]=T,o._eventsCount++),o}function l(o,h){--o._eventsCount===0?o._events=new i:delete o._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],f,_;if(this._eventsCount===0)return h;for(_ in f=this._events)t.call(f,_)&&h.push(s?_.slice(1):_);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(f)):h},a.prototype.listeners=function(h){var f=s?s+h:h,_=this._events[f];if(!_)return[];if(_.fn)return[_.fn];for(var x=0,T=_.length,E=new Array(T);x<T;x++)E[x]=_[x].fn;return E},a.prototype.listenerCount=function(h){var f=s?s+h:h,_=this._events[f];return _?_.fn?1:_.length:0},a.prototype.emit=function(h,f,_,x,T,E){var U=s?s+h:h;if(!this._events[U])return!1;var P=this._events[U],Y=arguments.length,K,J;if(P.fn){switch(P.once&&this.removeListener(h,P.fn,void 0,!0),Y){case 1:return P.fn.call(P.context),!0;case 2:return P.fn.call(P.context,f),!0;case 3:return P.fn.call(P.context,f,_),!0;case 4:return P.fn.call(P.context,f,_,x),!0;case 5:return P.fn.call(P.context,f,_,x,T),!0;case 6:return P.fn.call(P.context,f,_,x,T,E),!0}for(J=1,K=new Array(Y-1);J<Y;J++)K[J-1]=arguments[J];P.fn.apply(P.context,K)}else{var kt=P.length,Tt;for(J=0;J<kt;J++)switch(P[J].once&&this.removeListener(h,P[J].fn,void 0,!0),Y){case 1:P[J].fn.call(P[J].context);break;case 2:P[J].fn.call(P[J].context,f);break;case 3:P[J].fn.call(P[J].context,f,_);break;case 4:P[J].fn.call(P[J].context,f,_,x);break;default:if(!K)for(Tt=1,K=new Array(Y-1);Tt<Y;Tt++)K[Tt-1]=arguments[Tt];P[J].fn.apply(P[J].context,K)}}return!0},a.prototype.on=function(h,f,_){return r(this,h,f,_,!1)},a.prototype.once=function(h,f,_){return r(this,h,f,_,!0)},a.prototype.removeListener=function(h,f,_,x){var T=s?s+h:h;if(!this._events[T])return this;if(!f)return l(this,T),this;var E=this._events[T];if(E.fn)E.fn===f&&(!x||E.once)&&(!_||E.context===_)&&l(this,T);else{for(var U=0,P=[],Y=E.length;U<Y;U++)(E[U].fn!==f||x&&!E[U].once||_&&E[U].context!==_)&&P.push(E[U]);P.length?this._events[T]=P.length===1?P[0]:P:l(this,T)}return this},a.prototype.removeAllListeners=function(h){var f;return h?(f=s?s+h:h,this._events[f]&&l(this,f)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,e.exports=a})(Kh);var Wd=Kh.exports;const zh=Gd(Wd),ot=new zh,on=new zh,Qt="combat",Xh="char_hit",Ds="event",Ji="unlock",Sn="loot",no="craftmsg",ul=1,Fs=2,cl=4,$t=8,Oi={event:ul,unlock:Fs,loot:cl,combat:$t},Jd="trigger",Kd="buy",zd="tryuse",Xd="use",Yd="set_slot",$d="clear_slot",nr="char_died",Yh="ally_died",ro="combat_won",$h="slain",fl="enemyreward",Qh="charstate",ue="stateblock",Zh="defeat",tu="dmg_miss",Xl="is_immune",eu="resists",su="taskrepeat",dl="taskimprove",iu="taskdowngrade",nu="stopall",rr="taskdone",ru="halttask",lu="taskblock",lr="charact",au="itemact",ou="dotact",se="triggeraction",Ki="delitem",hu="encstart",ml="overcrowded",uu="chartitle",cu="newtitle",fu="charname",Yl="levelup",du="charclass",Mi="stat",Qd="craftitem",w={log:null,init(e){this.log=e.log,this.game=e,this._triggers={},this.clearGameEvents(),ot.addListener(Sn,this.onLoot,this),ot.addListener(no,this.onCraftMessage,this),ot.addListener(Ji,this.onUnlock,this),ot.addListener(Ds,this.onEvent,this),ot.addListener(Yl,this.onLevel,this),ot.addListener(cu,this.onNewTitle,this),ot.addListener(Jd,this.doTrigger,this),ot.addListener(dl,this.actImproved,this),ot.addListener(iu,this.actDowngraded,this),ot.addListener(Qt,this.onCombat,this),ot.addListener(Xh,this.onHit,this),ot.addListener(Qh,this.onCharState,this),ot.addListener(ue,this.onStateBlock,this),ot.addListener($h,this.npcSlain,this),ot.addListener(Yh,this.npcSlain,this),ot.addListener(Zh,this.onDefeat,this),ot.addListener(tu,this.onMiss,this),ot.addListener(Xl,this.onImmune,this),ot.addListener(eu,this.onResist,this),ot.addListener(hu,this.onEnc,this),ot.addListener(Qd,this.onCraft,this),ot.addListener(ml,this.onOvercrowded,this)},clearGameEvents(){ot.removeAllListeners()},clearTriggers(e){let t=e.on;if(t)for(let s in t)this.clearTrigger(s,e)},clearTrigger(e,t){let s=this._triggers.get(e);s&&s.delete(t)},addTrigger(e,t,s){let i=this._triggers.get(e);i||(i={},this._triggers.set(e,i))},doTrigger(e){this._triggers[e]},onEvent(e){if(!e.hide&&!(e[mt]&&!e[mt].roll()))if(Array.isArray(e))for(const t of e)this.onEvent(t);else this.log.log(e.name,e.desc,ul)},onUnlock(e){e.hide||e.type===jn||(e.actname?this.log.log(Er(e.typeName)+" Unlocked: "+e.actname,null,Fs):this.log.log(Er(e.typeName)+" Unlocked: "+e.name,null,Fs))},onLoot(e){let t=this.getDisplay(e);!t||Number.isNaN(t)||this.log.log("LOOT",t,cl)},onCraftMessage(e){let t=this.getDisplay(e);!t||Number.isNaN(t)||this.log.log("CRAFTED",t,cl)},getDisplay(e){if(!e)return null;if(typeof e=="object")if(Array.isArray(e)){let t,s=[];for(let i=e.length-1;i>=0;i--)t=this.getDisplay(e[i]),t&&s.push(t);if(s.length>0)return s.join(", ")}else return e.name.toTitleCase();else if(typeof e=="string")return e.toTitleCase();return null},onNewTitle(e,t){this.log.log("Title Earned: "+Er(e),null,Fs),this.dispatch(Mi,"titles",t)},actImproved(e){this.log.log(e.name.toTitleCase()+" Improved",null,Fs)},actDowngraded(e){this.log.log(e.name.toTitleCase()+" Downgraded",null,Fs)},onLevel(e,t){this.log.log(e.name+" Level Up!",null,ul),this.dispatch(Mi,"level",t)},onDefeat(e){this.log.log("RETREAT","Leaving "+e.name.toTitleCase(),$t)},onImmune(e,t){this.log.log("IMMUNE",e.name.toTitleCase()+" Is Immune To "+t,$t)},onResist(e,t){this.log.log("RESISTS",e.name.toTitleCase()+" Resists "+t,$t)},onMiss(e){this.log.log("",e.toString().toTitleCase(),$t)},onEnc(e,t){this.log.log(e.toString().toTitleCase(),Array.isArray(t)?t.join(`
`):t,$t)},onCombat(e,t){if(Array.isArray(t))for(let s=0;s<t.length;s++){const i=t[s];if(i[mt]&&i[mt].roll()){this.onCombat(e,i);return}else this.onCombat(e,i)}else typeof t=="object"?this.log.log(t.name||e,t.desc,$t):this.log.log(e,t,$t)},onHit(e,t,s){let i=s.toString().toTitleCase();i+=" hits "+e.name.toString().toTitleCase(),i+=" for "+Q(t,1),i+=" damage",this.log.log("",i,$t)},onStateBlock(e,t){this.log.log(t.adj,e.name+" Is "+t.adj,$t)},onCharState(e,t){this.log.log(t.adj,e.name+" Is "+t.adj,$t)},onCraft(e,t){const s=game.itemGen.instance(t,e);s&&game.state.inventory.add(s),this.emit(no,s)},npcSlain(e,t){var s;this.log.log(e.name.toTitleCase()+" Slain",t&&((s=t==null?void 0:t.name)!=null&&s.toTitleCase())?" By "+t.name.toTitleCase():"",$t)},onOvercrowded(e,t){this.log.log("Overcrowding",e.toTitleCase()+" cannot join "+t+" due to overcrowding",$t)},emit(...e){ot.emit.apply(ot,e)},add(e,t,s){ot.addListener(e,t,s)},listen(e,t,s){on.addListener(e,t,s)},removeListener(e,t){on.removeListener(e,t)},dispatch(...e){on.emit.apply(on,e)}},mu=(e,t,s)=>{if(t<0||t>=e.length)return e;const i=s>0?Math.min(t+s,e.length-1):Math.max(t+s,0);return e.splice(i,0,...e.splice(t,1)),e},pl=(e,t,s)=>mu(e,e.indexOf(t),s),Zd=(e,t,s)=>{const i=e.concat();if(Array.isArray(t))for(let n=0;n<=t.length-1;n++)s(t[n])&&i.push(t[n]);else s(t)&&i.push(t);return i},tm=(e,t=0,s=e.length)=>e[Math.floor(t+Math.random()*(s-t))],ws=e=>tm(e),em=e=>{const t=[];for(let s=e.length-1;s>=0;s--)t.push(ws(e[s]));return t.length==0?null:ws(t)},sm=(e,t)=>{const s=e.concat();Array.isArray(t)||(t=[t]);for(let i=0;i<=t.length-1;i++){const n=t[i];n&&s.push(n)}return s},im=(e,t)=>{const s=Math.floor(Math.random()*e.length);let i=s;do{if(t(e[i]))return e[i];i=(i+1)%e.length}while(i!==s);return null},gl=(e,t)=>{e[t]=e[e.length-1],e.pop()},nm=(e,t)=>{if(Array.isArray(e)){const s=e.concat();return Array.isArray(t)?s.concat(t):(s.push(t),s)}else if(Array.isArray(t)){const s=t.concat();return s.unshift(e),s}else return[e,t]},rm=(e,t)=>{e.sort((s,i)=>{const n=s[t],r=i[t];return n===r?0:n===void 0?1:r===void 0?-1:n-r})},Ls=1,ar=2,zi=4,pu=8,gu=16,gi=32,_i=64,lm=128,_u=256,yu=512,$l=1024,Ql=2048,am=Ls+ar+zi,om=$l+Ql,vu=e=>{typeof e=="string"&&(e=e.split(","));let t=0;for(let s=e.length-1;s>=0;s--){const i=e[s];i==="noact"?t|=am:i==="noattack"?t|=Ls:i==="nodefend"?t|=ar:i==="nocast"?t|=zi:i==="confused"?t|=pu:i==="charmed"?t|=gu:i==="taunt"?t|=gi:i==="hiding"?t|=_i:i==="defensive"?t|=lm:i==="noonexpire"?t|=_u:i==="noondeath"?t|=yu:i==="noonhit"?t|=$l:i==="noonmiss"?t|=Ql:i==="nocounter"&&(t|=om)}return t};class lo{toJSON(){}get causes(){return this._causes}set causes(t){this._causes=t}get flags(){return this._flags}set flags(t){this._flags=t}get tags(){return this._tags}set tags(t){t&&(typeof t=="string"?this._tags=t.split(",").map(s=>s.trim()):Array.isArray(t)?this._tags=t:console.warn("Unknown tags in setter",t))}canCast(){return(this._flags&zi)===0}canAttack(){return(this._flags&Ls)===0}canDefend(){return(this._flags&ar)===0}has(t){const s=this._causes[t];return s&&s.length>0}constructor(){this._causes={},this._flags=0}retarget(t){if((this.flags&pu)>0){if(ao[t])return ao[t]}else if((this.flags&gu)>0&&oo[t])return oo[t];return t}getCause(t){let s=this._causes[t];return s&&s.length>0?s[0]:null}add(t){t||console.warn("no cause: "+t);let s=t.flags;if(s===0)return;let i=1;for(;i<=s;)(s&i)>0&&this._addCause(i,t),i*=2;this._flags|=s}remove(t){if(!t)return;let s=t.flags,i=1;for(;i<=s;)(s&i)>0&&this._rmCause(i,t),i*=2}_rmCause(t,s){let i=this._causes[t];if(!i)return;let n=i.indexOf(s);n>=0&&(gl(i,n),i.length===0&&(this.flags^=t))}_addCause(t,s){let i=this._causes[t];i?i.push(s):i=this._causes[t]=[s]}refresh(t){this._flags=0;for(const s in this._causes)this._causes[s]=null;for(let s=t.length-1;s>=0;s--){const i=t[s];i.flags&&this.add(i)}}}const An=100,bu=0,Ws=32,Qe=1,ee=2,Te=4,he=8,ku=16,xe=64,H={self:bu,ally:Qe+ee,allies:Qe+ee+xe,enemy:Te+he,enemies:Te+he+xe,leader:Qe,enemyleader:Te,randomleader:Qe+Te,bothleaders:Qe+Te+xe,minion:ee,minions:ee+xe,flunky:he,flunkies:he+xe,otherminion:ee+Ws,otherminions:ee+Ws+xe,nonleader:ee+he,nonleaders:ee+he+xe,fixed:ku,all:Qe+ee+Te+he+xe,epicenter:Qe+ee+Te+he+Ws+xe},ao={[H.ally]:H.all,[H.allies]:H.all,[H.enemy]:H.all,[H.enemies]:H.all,[H.leader]:H.randomleader,[H.enemyleader]:H.randomleader,[H.minion]:H.all,[H.minions]:H.all,[H.flunky]:H.all,[H.flunkies]:H.all,[H.otherminion]:H.epicenter,[H.otherminions]:H.epicenter},oo={[H.self]:H.enemy,[H.ally]:H.enemy,[H.allies]:H.enemies,[H.enemy]:H.ally,[H.enemies]:H.allies,[H.leader]:H.enemyleader,[H.enemyleader]:H.leader,[H.minion]:H.flunky,[H.minions]:H.flunkies,[H.flunky]:H.minion+Ws,[H.flunkies]:H.minions+Ws,[H.otherminion]:H.flunky,[H.otherminions]:H.flunkies};function hm(e){for(let t=e.length-1;t>=0;t--){const s=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[s],e[s]=i}}function um(e,t){const s=t.affectedby,i=t.notaffectedby,n=[],r=[],l=[];for(let a of e){const o=!s||(s.all?s.condition.every(f=>a.hasDot(f)):s.condition.some(f=>a.hasDot(f)));if(!o&&s.strict)continue;const h=!i||(i.all?i.condition.every(f=>!a.hasDot(f)):i.condition.some(f=>!a.hasDot(f)));!h&&i.strict||(o&&h?n.push(a):o||h?r.push(a):l.push(a))}return n.push.apply(n,r),n.push.apply(n,l),n}const cm=(e,t,s)=>{if(!s)return 0;const i=s.stat;if(!i)return 0;const n=s.usepercentage?e[i]/e[i].max:e[i],r=s.usepercentage?t[i]/t[i].max:t[i];return s.highest?r-n:n-r},_l=e=>H[e]??H.enemy,fm=e=>{if(typeof e!="number")return"";let s=Object.entries(H).find(i=>i[1]===e);return s?s[0]:""},Js=e=>new Rt([C.ACTOR,C.TARGET,C.CONTEXT,C.ITEM,C.GDATA],e),re=e=>e==null||e===""?null:typeof e=="string"&&!ns.test(e)&&isNaN(e)?Js(e):e instanceof Vt?e:new Mt(e),Ze=(e,t,s=null,i=null)=>{if(!((!e||!e.alive)&&e.id!=s.id))return e.isImmune(t.kind)?(w.emit(Xl,e,t.kind),!1):(t.damage&&yl(e,t,s),t.healing&&dm(e,t,s),t.cure&&e.cure(t.cure),t.state&&e.addDot(t.state,t,null,s),t.result&&e.context.applyVars(t.result),t.acquire&&i.context.applyVars(t.acquire,1,1,s,e),t.dot&&e.addDot(t.dot,t,null,s),t.summon&&(e||s).context.summon(t.summon,s,e),!0)},Zs=(e,t,s,i=null,n=!0)=>{if(e){if(e instanceof Rt?e=e.getApply({[C.ACTOR]:s,[C.TARGET]:i,[C.CONTEXT]:i.context,[C.ITEM]:t.source,[C.GDATA]:s.context.state.items}):e=e.value,n&&(t.bonus&&(e+=t.bonus),s&&(s.getBonus&&(e+=s.getBonus(t.kind)),s.context&&t.potencies)))for(let r of t.potencies){let l=s.context.state.getData(r,!1,!1);l&&(e=e*l.damage.getApply({[C.ACTOR]:s,[C.TARGET]:i,[C.CONTEXT]:i.context,[C.ITEM]:l}))}return e}},yl=(e,t,s)=>{var a;let i=Zs(t.damage,t,s,e,!t.showinstanced),n=e.getResistMultiplier(t.kind);i*=n;let r=t.nodefense?1:e.getDefenceMultiplier();i*=r;let l=i;if(t.noLogs||w.emit(Xh,e,i,t.name||(s?s.name:"")),e.barrier>i?(e.barrier-=i,i=0):(i-=e.barrier,e.barrier=0,e.hp-=i),t.leech&&s&&i>0){let o=Math.floor(100*t.leech*i)/100;s.hp+=o,w.emit(Qt,null,s.name.toTitleCase()+" Steals "+o+" Life")}if(e.hp<=0&&w.emit(nr,e,t),s&&!t.unreflectable&&(+e.stat_thorns>0&&e.getThornAttack(0)&&s.hp>0&&yl(s,e.getThornAttack(+e.stat_thorns),e),+e.stat_reflect>0&&e.getReflectAttack(0)&&s.hp>0&&yl(s,e.getReflectAttack(+e.stat_reflect/100*l),e),!e.getCause($l))){e.onHit&&w.emit(se,e.onHit,e.context,s);const o=e.dots;for(let h=o.length-1;h>=0;h--){const f=o[h];f.onHit&&w.emit(se,f.onHit,e.context,s),f.conditionaction&&w.emit(se,(a=f.conditionaction)==null?void 0:a.onHit,e.context,s)}}},dm=(e,t,s)=>{let i=Zs(t.healing,t,s,e,!t.showinstanced);e.hp+=i},hn=(e,t,s)=>(e.damage=Zs(e.damage,e,t,s),e.healing=Zs(e.healing,e,t,s),e.tohit+=t.getHit(),e.showinstanced=!0,e),We=e=>{var t,s;if((t=e.conditional)!=null&&t.onSuccess&&(e.conditional.onSuccess=We(e.conditional.onSuccess)),(s=e.conditional)!=null&&s.onFailure&&(e.conditional.onFailure=We(e.conditional.onFailure)),e.attack)if(Array.isArray(e.attack))for(let i=e.attack.length-1;i>=0;i--)e.attack[i]=Us(e.attack[i]);else e.attack=Us(e.attack);return e.onExpire&&(e.onExpire=Us(e.onExpire)),e.onDeath&&(e.onDeath=Us(e.onDeath)),e.onHit&&(e.onHit=Us(e.onHit)),e.onMiss&&(e.onMiss=Us(e.onMiss)),e},Us=e=>{if(e.targetstring=e.targets,e.hits)for(let t=e.hits.length-1;t>=0;t--)e.hits[t].targetstring=e.hits[t].targets,e.hits[t].dot&&(e.hits[t].dot=We(e.hits[t].dot));return e.dot&&(e.dot=We(e.dot)),e},mm="?",xu=/^([<>=]|[<>]=)?(-?\d+\.?\d*)?\?(-?\d+\.?\d*)?$/,Xi=1,or=2,hr=4,Fn=or+Xi,Zl=hr+Xi,un=Object.freeze(Object.entries({EQ:{op:"=",value:Xi},GT:{op:">",value:or},LT:{op:"<",value:hr},GTE:{op:">=",value:Fn},LTE:{op:"<=",value:Zl}}).reduce((e,[t,s])=>(e[t]=s,e[s.op]=s.value,e[s.value]=s.op,e),{})),pm=e=>e==="="?Xi:e==="<"?hr:e==="<="?Zl:e===">"?or:Fn,ta=e=>xu.test(e);class Yi extends Dt{toJSON(){return this.at+mm+this.value}get at(){return this._at}set at(t){this._at=t}get op(){return this._op}set op(t){this._op=t}get count(){if(!this.source)return 0;switch(this.op){case Fn:if(this.source.value>=this.at)return 1;break;case or:if(this.source.value>this.at)return 1;break;case Zl:if(this.source.value<=this.at)return 1;break;case hr:if(this.source.value<this.at)return 1;break;case Xi:if(this.source.value==this.at)return 1;break}return 0}toString(){return this.value+" (once)"}constructor(t,s,i){if(super(0,s,i),typeof t=="string"){let n=xu.exec(t);n&&(this.op=pm(n[1]),this.at=n[2]?Number(n[2]):1,this.value=Number(n[3])||0)}else this.op=Fn,this.value=Number(t)||0,console.log("bad AtMod: "+t);(this.at===null||this.at===void 0)&&(this.at=1)}getApply(){return this.count?this.value:0}instantiate(){let t=new Yi(null,this.id,this.source);return t.at=+this.at,t.value=+this.value,t.op=this.op,t}}const vl=/(?<modFlat>[\+\-]?\d*(?:\.\d+)?(?![.%0-9]))?(?:(?<modPct>[\+\-]?\d*(?:\.\d+)?)\%)?\|(?<max>\d+)\|(?<percent>\d+(?:\.\d+)?)/,ur=e=>vl.test(e);class as extends Dt{toJSON(){return this.str}toString(){let t=+this.percent,s=+this.max,i=+this.base||0,n=+this.basePct||0,r=`${i||""}${i&&n?" & ":""}${i<0&&n>0?"+":""}${n?n*100+"%":""}`,l=`${i/2||""}${i&&n?" & ":""}${i<0&&n>0?"+":""}${n?n/2*100+"%":""}`,a=Math.ceil(t*s/100),o="",h=`${Q(this.countBonus.toString())||""}${this.countBonus&&this.countPct?" & ":""}${this.countPct?this.countPct*100+"%":""}`;return o=l+" at "+a,t===50?o+=" linearly increasing to ":t<50?o+=" slowly increasing to ":o+=" sharply increasing to ",o+=r+" total at "+s,h&&(o+=" (cur: "+h+")"),o}get count(){let t=+(this._count instanceof Function?this._count():super.count);return this.calcMult(t)}set count(t){super.count=t}get range(){return this.max}get str(){return`${this.base||""}${this.basePct>0&&this.base&&this.basePct?"+":""}${this.basePct*100+"%"||""}|${this.max||""}|${this.percent}`}set str(t){this.parseMod(t)}constructor(t,s,i){if(super(0,s,i),t instanceof as){this.str=t.str,this.id=t.id,t._count?this._count=t._count:this.source=t.source,this.basePct=t.basePct;return}typeof t=="object"?this.setBase(t):typeof t=="string"?this.str=t:(console.warn("Non-string vars in CurvedMod constructor",t,this),this.setBase())}parseMod(t){var i;let s=(i=vl.exec(t))==null?void 0:i.groups;return s||console.warn("Invalid Curved Mod",t),this.setBase(s),vl.test(t)}setBase(t){t||(t={}),this.base=+(t.modFlat||0),this.basePct=+(t.modPct||0)/100,this.max=+t.max,this.percent=+t.percent,this.scaling=+this.calcScale(this.percent),console.warn("Calling CurvedMod setBase"),(this.max==null||this.percent==null||this.base==null&&this.basePct==null)&&console.warn("CurvedMod was declared improperly",this.max,this.percent,this),this.percent<=0&&(this.percent=1,console.warn("CurvedMod defined with 'percent' <= 0, resetting to 1",this)),this.percent>=100&&(this.percent=99,console.warn("CurvedMod defined with 'percent' >= 100, resetting to 99",this))}clone(){return new as(this)}instantiate(){let t={modFlat:this.bonus,modPct:this.pctTot*100,max:+this.max,percent:+this.percent,scaling:+this.scaling};return new as(t,this.id,+this.source)}maxed(){return+(this._count instanceof Function?this._count():super.count)>=this.max}calcMult(t){let s=0,i=+this.max,n=this.scaling;return t>=this.max?(t=+this.max,1):n?(s=(n+1)*t/(i+n*t),s):t/i}calcScale(t){return(100-2*t)/t}}const Rr=":",gm=/^(\d+\.?\d*)?\:(\d+\.?\d*)?$/,cr=e=>gm.test(e);class ni extends Dt{toJSON(){return this.value+Rr+this.per}get count(){return this.source?Math.floor(this.source.value/this.per):0}get per(){return this._per}set per(t){this._per=t}toString(){return this.value+Rr+this.per}constructor(t,s,i){if(super(0,s,i),typeof t=="number")this.per=t;else if(typeof t=="string"){let n=t.split(Rr);n.length===2?(this.value=n[0]?Number(n[0]):1,this.per=n[1]?Number(n[1]):1):console.warn("bad PerMod: "+t)}else console.log("bad PerMod: "+t),this.value=Number(t);this.value==null&&(this.value=1),this.per==null&&(this.per=1)}getApply(){return this.source&&this.source.value%this.per===0?this.count*this.value:0}instantiate(){return new ni(this.toString(),this.id,this.source)}}const bl=/^(?<modFlat>[\+\-]?\d*\.?\d+(?![.%0-9]))?(?:(?<modPct>[\+\-]?\d*\.?\d+)\%)?\/(?:(?<start>[\+\-]?\d*\.?\d+)?\/)?(?:(?<minOp>>=?)?(?<min>[\+\-]?\d*\.?\d+))?\/(?<max>[\+\-]?\d*\.?\d+)?\/(?:(?<mode>~)?(?<rounding>[\+\-])?(?<step>\d*\.?\d+))?$/,_m=e=>{switch(e){case"+":return Math.ceil;case"-":return Math.floor;default:return Math.round}},fr=e=>bl.test(e);class os extends Dt{toJSON(){return this.str}toString(){let t=this.strBonus(this.estimateStep());return t?(+this.step&&(t+=` per ${Q(this.estimateStep())} amount${this.roundingSym?` (rounded ${this.roundingSym==="+"?"up":"down"})`:""}`),+this.min&&(t+=` ${this.minOp?"active":"starting"} ${this.minOp===un.GT.value?"past":"at"} ${Q(this.min)} (resulting in ${this.strBonus(this.start)})`),+this.max&&(t+=` up to ${Q(this.max)} (resulting in ${this.adjustedbonus(this.max)})`),t):"0"}get count(){let t=+(this._count instanceof Function?this._count():super.count);return this.adjustCount(t)}set count(t){super.count=t}get range(){return this.max-this.min}get str(){let t=N.getBase(this.base),s=N.getBase(this.basePct);return`${t||""}${s>0&&t?"+":""}${s?s*100+"%":""}/${this._start!=null?N.getBase(this._start)+"/":""}${un[this.minOp]||""}${N.getBase(this.min)||""}/${N.getBase(this.max)||""}/${this.section?"~":""}${this.roundingSym||""}${N.getBase(this.step)}`}set str(t){this.parseMod(t)}get start(){return+(this._start??this.min)}set start(t){this._start=t}constructor(t,s,i){if(super(0,s,i),t instanceof os){this.str=t.str,this.id||(this.id=t.id),t._count&&(this._count=t._count),!this.source&&t.source&&(this.source=t.source);return}typeof t=="object"?this.setBase(t):typeof t=="string"?this.str=t:(console.warn("Non-string vars in RangedMod constructor",t,this),this.setBase())}estimateStep(){return+this.step?this.section?this.range/this.step:+this.step:1}parseMod(t){var i;let s=(i=bl.exec(t))==null?void 0:i.groups;return s||console.warn("Invalid Ranged Mod",t),this.setBase(s),bl.test(t)}setBase(t){t||(t={}),this.base=+(t.modFlat||0),this.basePct=+(t.modPct||0)/100,this.min=t.min==null||t.min===""?null:+t.min,this.max=t.max==null||t.max===""?null:+t.max,t.start&&(this.start=t.start),this.minOp=t.minOp?typeof t.minOp=="number"?t.minOp:un[t.minOp]:null,this.section=!!t.mode,this.roundingSym=t.rounding,this.step=+(t.step||0),this.max==null&&(this.section&&this.step&&console.warn("RangedMod section mode was declared with non-zero step, but missing max",this.max,this),this.section=!1),this.max!=null&&this.min!=null&&this.max<this.min&&(console.warn("RangedMod maximum less than minimum",this.min,this.max,this),this.max=this.min)}clone(){return new os(this)}instantiate(){let t={modFlat:this.bonus,modPct:this.pctTot*100,minOp:this.minOp,start:this._start,min:+this.min,max:+this.max,mode:this.section,rounding:this.roundingSym,step:+this.step};return new os(t,this.id,+this.source)}maxed(){return this.max!=null&&this.count>=this.max}adjustedbonus(t=1){let s=this.adjustCount(t);return this.strBonus(s)}strBonus(t){let s=this.bonus?Q(this.bonus*t):"";return this.pctTot&&(this.bonus&&(s+=" & "),s+=Q(100*this.pctTot*t)+"%"),s}adjustCount(t){if(this.max!=null&&t>=this.max)t=this.range;else if(this.min!=null&&t<=this.min){if(t<this.min||this.minOp===un.GT.value&&+this.min===t)return 0;t=0}else if(this.step){let s=_m(this.roundingSym),i=this.min||0,{range:n,step:r}=this;this.section?t=s((t-i)*r/n)*n/r:t=s((t-i)/r)*r}return t+this.start}}const ym=/^[A-Za-z_]+\w*$/,Ce=(e,t,s)=>e?(!t&&s&&typeof s=="object"&&(t=s.id,t||(t="",Ud(e,"No Mod Id: "+s+": "+t))),e=wu(e,t,s),e||console.warn("mods is null: "+t),Bi(e),e):null,vm=(e,t,s)=>Jh.test(e)||!isNaN(e)?new Dt(e,t,s):cr(e)?new ni(e,t,s):ta(e)?new Yi(e,t,s):fr(e)?new os(e,t,s):ur(e)?new as(e,t,s):e,wu=(e,t,s)=>{if(e==null)return null;if(typeof e=="string")return Xr(vm(e,t,s));if(typeof e=="number")return Xr(new Dt(e,t,s));if(typeof e!="object")return e;if(e.id||e.base||e.str)return new Dt(e,t,s);for(const i in e){const n=e[i];if(n===0){delete e[i];continue}if(n){if(n instanceof Dt){t&&(n.id=Ue(t,i)),n.source=s;continue}e[i]=wu(n,Ue(t,i),s)}}return e},fs=(e,t="")=>{if(Array.isArray(e))for(let s=e.length-1;s>=0;s--)e[s]=fs(e[s],t);else if(typeof e=="object")for(const s in e){if(s==="mod"||s==="runmod"||s==="alter"){e[s]=Ce(e[s],Ue(t,s));continue}else if(s==="effect"||s==="result"||s==="use"||s==="acquire"||s==="loot")e[s]=Fe(e[s],Ks);else if(s==="cost"||s==="buy"||s==="sell")e[s]=Fe(e[s],km);else if(s==="require"||s==="need"){e[s]=Su(e[s]);continue}else s==="convert"?(e[s].input=Fe(e[s].input,Ks),e[s].output.effect=Fe(e[s].output.effect,Ks),e[s].output.mod=Ce(e[s].output.mod,Ue(t,"mod"))):(s==="dotcondition"||s==="restrate"||s==="summoncondition")&&(e[s]=Js(e[s]));s.includes(".")&&Gh(e,s);const i=e[s],n=typeof i;if(n==="string")if(Wi.test(i))e[s]=new pe(i);else if(ns.test(i))e[s]=new Mt(i);else if(cr(i))e[s]=new ni(i,Ue(t,s));else{if(fr(i))return new os(i,Ue(t,s));if(ur(i))return new as(i,Ue(t,s));isNaN(i)?(s==="damage"||s==="dmg"||s==="healing"||s==="heal")&&(e[s]=Js(i)):(i!==""&&console.warn("string used as Number: "+s+" -> "+i),e[s]=Number(i))}else n==="object"&&fs(i,t)}else if(typeof e=="string")return Tu(e);return e},Tu=e=>ns.test(e)?new Mt(e):Wi.test(e)?new pe(e):cr(e)?new ni(e):ta(e)?new Yi(e):fr(e)?new os(e):ur(e)?new as(e):e,Fe=(e,t)=>{var s,i;if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)e[n]=Fe(e[n],t);else{if(typeof e=="string")return ns.test(e)?new Mt(e):Wi.test(e)?new pe(e):cr(e)?new ni(e):ta(e)?new Yi(e):fr(e)?new os(e):ur(e)?new as(e):e.includes(".")?t(e):e;if(typeof e=="object")for(const n in e)((s=e[n])==null?void 0:s.type)==Dh||((i=e[n])==null?void 0:i.type)==Gl||n!=="dot"&&n!=="attack"&&(e[n]=Fe(e[n],t));else if(typeof e=="number")return new N(e)}return e},Su=e=>{if(!(e==null||e===!1||e==="")){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)e[t]=Su(e[t]);else if(typeof e=="string"&&!ym.test(e))return bm(e);return e}};function bm(e){return new Function(C.GDATA,C.ITEM,C.STATE,"return "+e)}function km(e){return new Rt([C.GDATA,C.ACTOR],e)}function Ks(e){return new Rt([C.GDATA,C.TARGET,C.ACTOR],e)}function xm(e,t,s){s||(e.template?s=e.template:(console.warn("No template found. Using target as template.",e),s=e)),t instanceof Function&&(t=t(e,s));let i=fs(Ht(t),e.id);const n={};for(const r in i)e[r]==null&&(n[r]=e[r]=i[r]);return[Gi(t),n]}const dr=(e,t)=>{if(e instanceof Dt)e.count=t;else if(typeof e=="object")for(let s in e)dr(e[s],t)},_e=(e,t)=>{let s=e.prototype||e,i=Object.getOwnPropertyDescriptors(t),n=Td(s);for(let r in i)n.has(r)||Object.defineProperty(s,r,i[r]);return e},wm=["runmod","mod"],Tm=new Set(["template","id","type","defaults","module","sname","sym","warn","effect","length","runmod","name","desc","running","current","warnMsg","once","context","enemies","encs","boss","spawns","targets","only","locked","locks","value","exp","delta","tags","mod","alter","progress","need","require","action","repeat"]),Ee={toJSON(){if(this.save&&(this.value>0||this.owned))return this.forceSave();let e=JSON.parse(JSON.stringify(Qa(this,Tm)||{}));if(this.template&&(e=nl(e,st(this.template)),this.cost&&this.template.cost!=null)){if(this.template.cost instanceof String)delete e.cost;else if(typeof this.template.cost=="number"&&e.cost.gold===this.template.cost)delete e.cost;else if(e!=null&&e.cost){let s=Ht(this.template.cost);Bi(s),nl(e.cost,s)||delete e.cost}}let t=this.Defaults||this.constructor.Defaults;if(t)for(let s in t)e[s]!==void 0&&(t[s]instanceof Object||e[s]===t[s]&&delete e[s]);return this.locked===!1&&this.template&&this.template.locked!==!1&&(e=e||{},e.locked=this.locked),e&&e.name&&(e.name=this.sname),e&&this.timer>0&&(e.timer=this.timer),e&&Object.keys(e).length?e:void 0},forceSave(){let e=Qa(this);return this.mod&&(e.mod=this.mod),this.slot&&(e.slot=this.slot),this.effect&&(e.effect=this.effect),this.use&&(e.use=this.use),e.template&&typeof e.template=="object"&&(e.template=e.template.id),e.val&&(e.value=void 0),e.name=this.sname,e},get id(){return this._id},set id(e){this._id=e},get template(){return this._template},set template(e){this._template=e},get type(){return this._type},set type(e){this._type=e},get typeName(){return this._type},toString(){return this.id},get sname(){return this._name||this.id},get name(){return this._actname&&this._value<1?this.actname:(this.sym||"")+(this._name||this.id)},set name(e){e&&this.sym?this._name=e.split(this.sym).join("").trim():this._name=e},get sym(){return this._sym},set sym(e){this._sym=e},get repeat(){return this._repeat},set repeat(e){this._repeat=e},get desc(){return this.actdesc&&this._value<1?this.actdesc:this._desc||null},set desc(e){this._desc=e},get current(){return this.value},get ex(){return this._exp},set ex(e){this._exp=e},get val(){return this._value},set val(e){this._value=e},get value(){return this._value},set value(e){this._value=e},valueOf(){return this._value},get delta(){return 0},get tags(){return this._tags},set tags(e){typeof e=="string"?this._tags=e.split(","):Array.isArray(e)?this._tags=e:this._tags=null},permVars(e,t=this){if(typeof t!="number"){if(typeof e=="object"){for(const s in e){const i=e[s];let n=t[s];n==null?n=t[s]=Ht(i):typeof n=="number"?t[s]=(n||0)+e[s].valueOf():typeof i=="object"?i.constructor!==Object?n.perm(i):this.permVars(i,n):console.log(this.id+" UNKNOWN PERM VAR: "+s+" typ: "+typeof n)}t===this&&e.mod&&Ce(this.mod,this.id,this)}}},applyVars(e,t=1){if(typeof e=="number")this.value.add(e*t);else if(e.isRVal){const s={[C.GDATA]:v.gdata,[C.ITEM]:this};this.amount(t*e.getApply(s))}else if(typeof e=="object"){e.mod&&this.changeMod(e.mod,t);for(let s in e){if(s==="skipLocked"||s==="value")continue;let i=this[s],n=e[s];i!=null&&i.applyVars?i.applyVars(n,t):i instanceof Vt?i.apply(n,t):typeof n=="object"?n.type===Ri?n.applyTo(this,s,t):typeof i=="number"||n.isRVal?this[s]+=Number(n)*t:this.subeffect(i,n,t):i!==void 0?this[s]+=Number(n)*t:this.newSub(this,s,n,t)}e.value&&(e.skipLocked&&(this.disabled===!0||this.locks>0||this.locked!==!1)||this.amount(e.value*t))}_t.add(this)},applyMods(e,t=1,s=this,i=this,n=this.id,r=null,l=!0){return _t.add(this),e instanceof Dt?e.applyTo(s,"value",t):(e.constructor===Object?this.applyObj(e,t,s,i,n,r,l):console.warn(typeof e=="number"?e+" RAW NUM MOD ON: "+this.id:this.id+" unknown mod type: "+e),null)},applyObj(e,t,s,i,n,r,l){for(let a in e){let o=e[a],h=s[a],f=r||(wm.includes(a)?a:null);l&&f&&(s instanceof vt||s instanceof N?io(s):io(this));let _=f||isNaN(+h)?i:h,x=(n?n+".":"")+a;if(typeof o=="boolean")typeof h=="object"?console.warn("applyObj boolean target is an obj. Skipping.",s,a,this.id):t>0?s[a]=o:t<0&&(s[a]=!o);else if(h==null){if(!Vh(s,a))continue;if(o.constructor===Object&&(f||!a.startsWith(cs)))this.applyObj(o,t,s[a]={},_,x,f,l);else if(a.startsWith(cs)&&!f)if(o!=null&&o.applyTo)o.applyTo(s,a,t);else{for(const T in o){const E=o[T];E!=null&&E.applyTo&&E.applyTo(s,a,t,!1,T)}continue}else{if(xn.includes(a)&&f===null)continue;{let T=!1;if(a==="value"){let U=i.id;for(let P in xn){let Y=xn[P],K=U+"."+Y+".value";if(x===K){T=!0,o.applyTo(i,Y,t);continue}}}if(T)continue;let E=[0,x,r!=="runmod"?_:1];(s[a]=f?new Dt(...E):new N(E[0],E[1])).addMod(o,t)}}}else h.applyMods?h.applyMods(o,t,h,_,x,f,l):o.constructor===Object?this.applyObj(o,t,h,_,x,f,l):o instanceof Dt?h.isRVal?h.addMod(o,t):o.applyTo(s,a,t):console.warn(typeof o=="number"?"RAW NUMBER MOD on: "+this.id+": "+a+": "+o:`UNKNOWN Mod to ${this.id}.${a}: ${o}  `+typeof o)}},removeMods(e,t=this){if(t===this)_t.add(this);else if(!t)return;if(e instanceof Dt)typeof t=="object"&&(t.isRVal?t.removeMods(e):this.removeMods(e,t.value));else if(e.constructor===Object)for(let s in e)this.removeMods(e[s],t[s]);else console.warn(typeof e=="number"?this.id+" REMOVED NUMBER MOD: "+e:this.id+" unknown mod type: "+e)},subeffect(e,t,s){if(typeof e=="object")for(let i in t){let n=e[i],r=t[i];r&&typeof r=="object"&&(r.isRVal?r=+r:r.constructor.name!=="Object"&&console.warn("Class instance source in subeffect",r)),typeof r=="object"?this.subeffect(n,r,s):n instanceof N?n.base+=r*s:typeof n=="object"?n.value=(n.value||0)+r*s:e[i]+=r*s}},newSub(e,t,s,i=1){console.warn("ADD SUB: "+this.id+" "+t+" stat: "+i*s.value);let n=e[t]=new N(typeof s=="number"?s*i:0,"key");s instanceof Dt&&n.apply(s,i)},changeMod(e,t,s=!0){v.applyMods(e,s?t*this.value:t)},addTag(e){Array.isArray(e)?e.forEach(t=>this.addTag(t),this):this._tags==null?this._tags=[e]:this._tags.includes(e)||this._tags.push(e)},hasTag(e){return this.tags&&this.tags.includes(e)},hasTags(e){if(!this._tags)return!1;for(let t=e.length-1;t>=0;t--)if(!this._tags.includes(e[t]))return!1;return!0},canUse(){return!0}},Sm=new Set(["require","rate","current","need","value","buy","on","cost","id","name","warn","effect","slot","exp","delta"]);class vt{get module(){return this._module}set module(t){this._module=t}get disabled(){return this._disabled}set disabled(t){this._disabled=t}get max(){return this._max}set max(t){t!=null&&(this._max?t instanceof N?this._max.base=t.base:isNaN(t)||(this._max.base=t):this._max=t instanceof N?t:new N(t,this.id+".max",0))}get rate(){return this._rate}set rate(t){t instanceof N?(t.id=this.id+".rate",this._rate=t):this._rate?typeof t=="object"?Object.assign(this._rate,t):this._rate.base=t:this._rate=new N(t,this.id+".rate")}get on(){return this._on}set on(t){this._on=t}get triggers(){return this._triggers}set triggers(t){this._triggers=t}get cost(){return this._cost}set cost(t){typeof t!="object"||t instanceof Vt?this._cost={gold:t}:this._cost=t}get require(){return this._require}set require(t){this._require=t}get warn(){return this._warn}set warn(t){this._warn=t}get warnMsg(){return this._warnMsg}set warnMsg(t){this._warnMsg=t}get mod(){return this.value.mod}set mod(t){this.value.mod=t}get effect(){return this._effect}set effect(t){this._effect=t}get locks(){return this._locks||0}set locks(t){this._locks=t}get locked(){return this._locked}set locked(t){this._locked=t}get owned(){return this._owned}set owned(t){this._owned=t}get delta(){return this._delta}set delta(t){this._delta=t}get value(){return this._value}set value(t){t instanceof N?this._value===null||this._value===void 0?this._value=t:t!==this._value&&(this._value.base=t.base,this._value.basePct=t.basePct):this._value!=null?this._value.base=typeof t=="object"?(t==null?void 0:t.value)??0:t:this._value=new N(t,this.id)}get val(){return this.value}set val(t){this.value=t??0}valueOf(){return this._value.valueOf()}constructor(t=null,s=null){t&&(typeof t=="object"?(t.id&&(this.id=t.id),this.val=t.val||0,zl(this,t)):isNaN(t)||(this.val=t)),s&&(this.defaults=xm(this,s)[0]),(this._locked===void 0||this._locked===null)&&(this.locked=!0),this.locks=0,(this._value===null||this._value===void 0)&&(this.val=0),this.delta=0,Sd(this,null,Sm),Pi(this),Pi(this.mod,this)}fillsRequire(){return this.locked===!1&&this.value>0}canRun(t,s=Bn){if(this.disabled||this.maxed()||this.locks>0||this.need&&!t.unlockTest(this.need,this)||this.buy&&!this.owned&&!t.canPay(this.buy)||this.cost&&this.exp==0&&!t.canPay(this.cost)&&!this.paid||this.fill&&t.filled(this.fill,this))return!1;if(this.exclude){let i=this.exclude,n=this.tags||[];for(const r of t.runner.actives){if(this==r)continue;let l=r.tags||[];if(i&&we(i,r.type,r.id,...l)||r.exclude&&we(r.exclude,this.type,this.id,...n))return!1}}return!this.run||t.canPay(this.run,s)}canContinue(t){return!0}canPay(t){return t>=0?this.value>=t:this.max?this.value-t<=this.max.value:!0}remove(t){this.value.base-=t}canUse(t=v){return this.perpetual>0||this.length>0?this.canRun(t,Bn):this.disabled||this.locks>0||this.maxed()||this.need&&!t.unlockTest(this.need,this)||this.buy&&!this.owned&&!t.canPay(this.buy)||this.slot&&t.state.getSlot(this.slot,this.type)===this||this.fill&&t.filled(this.fill,this)||this.mod&&!t.canMod(this.mod,this)?!1:!this.cost||t.canPay(this.cost)}canBuy(t){return this.disabled||this.locked||this.locks>0||this.maxed()?!1:!this.buy||t.canPay(this.buy)}add(t){let s=this.value.valueOf();if(t<=0){if(s<=0||t===0)return 0;if(s+t<=0)return this.value.base=0,-s}else{if(this.repeat!==!0&&!this.max&&this.value>1&&(!this.buy||this.owned===!0))return 0;this.max&&s+t>=this.max.value&&(t=this.max.value-s)}return this.value=this.value.base+t,this.value.valueOf()-s}amount(t=1){this.delta+=t,_t.add(this)}changed(t,s){if(this.delta=0,this.slot){let n=t.state.getSlot(this.slot);if(this!==n){t.setSlot(this);return}}if(s=this.add(s),s===0)return;let i;if(this.caststoppers){for(let n of this.caststoppers)if(i=t.self.getCause(n),i){w.emit(ue,t.self,i);return}}if(this.cd&&(s=Math.min(s,1),this.timer=Number(this.cd),t.addTimer(this),this.tags))for(let n of this.tags)t.state.getData(n).cdshare(t,this.timer);if(this.isRecipe)return t.create(this,!0,s);if(this.once&&this.valueOf()===1&&(t.applyVars(this.once),this.once.loot&&t.getLoot(this.once.loot)),this.loot)for(let n=0;n<s;n++)t.getLoot(this.loot);if(this.title&&t.self.setTitle(this.title),this.result&&t.applyVars(this.result,s),this.create&&t.create(this.create),this.summon)for(let n=0;n<s;n++)t.summon(this.summon,t.self);if(this.resurrect){const n=t.getData("minions"),r=n.filter(a=>this.canRez(a)&&!a.alive);let l=(this.resurrect.count||1)*s;for(let a of r)if(a.hp=a.hp.max/2,a.barrier=a.barrier.max/2,n.setActive(a,!0),l--,l==0)break}if(this.mod&&t.applyMods(this.mod),this.lock&&t.lock(this.lock,s),this.dot&&t.self.addDot(this.dot,this,null,t.self),this.disable&&t.disable(this.disable),this.enable&&t.enable(this.enable),this.log&&w.emit(Ds,this.log),(this.attack||this.action)&&this.type!==Gt&&this.type!==Kt)for(let n=0;n<s;n++)w.emit(lr,this,t)}doLock(t){this.locks+=t,_t.add(this)}doUnlock(){this.disabled||this.locked===!1||this.locks>0||(this.locked=!1,this.start?w.emit(Ds,this.start):w.emit(Ji,this),_t.add(this))}onUse(t){this.slot?t.setSlot(this):this.amount(1)}filled(t=0){return this._max&&this.value>=this._max.value||this.rate&&this.rate+t.valueOf()<=0}maxed(t=0){if(this._max){let s=this.value+this.delta;return s+=t>0?t:1e-11,s>Math.floor(this._max.value)}return!(this.repeat||this.owned)&&this.value+this.delta>=1}blocked(){return this.locked||this.disabled||this.locks>0}addRequire(t){if(!this.require)this.require=t;else{if(this.require===t||Array.isArray(this.require)&&this.require.includes(t))return;this.require=nm(this.require,t)}}}_e(vt,Ee);function kl(e,...t){let s=Pd(e,...t);for(let i of t){let n=s[i],r=e[i];if(n&&!n.configurable){console.warn(`Cannot overwrite non-configurable property ${i} of ${e.id??e}. Skipping.`);continue}Object.defineProperty(e,i,{get(){return r},set(l){if(r instanceof vt){isNaN(l)?console.warn(`Non-numeric property set ${i} on ${e.id??e}: ${l}`):r.value=+l;return}else l instanceof vt||console.warn(`Non-Gdata property set ${i} on ${e.id??e}: ${l}`);r=l},configurable:!0,enumerable:!0})}}class Am{constructor(t="",s="",i=1,n=""){this.text=s,this.title=t,this.type=i,this.subtype=n,this.count=1}}class Om{constructor(t=null){t&&Object.assign(this,t),this.items=this.items||[],this.maxItems=this.maxItems||100,this.initCounts()}initCounts(){this.counts=this.counts||{};for(let t in Oi)this.counts[Oi[t]]=0}clear(t){t?this.cut(t,this.items.length):(this.items.splice(0,this.items.length),this.initCounts())}log(t="",s="",i=1,n=null){this.tryMatch(t,s,i)||(this.items.push(new Am(t,s,i,n)),++this.counts[i]>=this.maxItems+50&&this.cut(i))}cut(t,s=50){const i=this.items.length,n=[];let r=0,l=0;for(;l<i;){const a=this.items[l++];if(a.type===t){if(++r>=s)break}else n.push(a)}this.counts[t]-=r,this.items=l<i?n.concat(this.items.slice(l)):n}tryMatch(t,s,i){for(let n=this.items.length-1;n>=0;n--){const r=this.items[n];if(i&r.type)return r.title===t&&r.text===s?(r.count++,!0):!1}}logItem(t){this.tryMatch(t.title,t.text,t.type)||(this.items.push(t),++this.counts[type]>=this.maxItems+50&&this.cut(type))}}let F=class On{toJSON(){return{name:this.name,dmg:this.damage||void 0,heal:this.healing||void 0,tohit:this.tohit||void 0,bonus:this.bonus||void 0,kind:this.kind,hits:this.hits||void 0,cure:this.cure||void 0,state:this.state||void 0,targets:this.targets??void 0,targetstring:this.targetstring||void 0,result:this.result||void 0,acquire:this.acquire||void 0,id:this.id,dot:this.dot,repeathits:this.repeathits,targetspec:this.targetspec,showinstanced:this.showinstanced||void 0,potencies:this.potencies,only:this.only,nodefense:this.nodefense,harmless:this.harmless,noLogs:this.noLogs,unreflectable:this.unreflectable,summon:this.summon}}get dot(){return this._dot}set dot(t){this._dot=t}get id(){return this._id||this._name}set id(t){if(this._id=t,this._hits)for(let s=this._hits.length-1;s>=0;s--)this._hits[s].id||(this._hits[s].id=t)}get name(){return this._name}set name(t){if(this._name=t,this._hits)for(let s=this._hits.length-1;s>=0;s--)this._hits[s].name||(this._hits[s].name=t)}get kind(){return this._kind}set kind(t){if(this._kind=t,this.dot&&(this.dot.kind||(this.dot.kind=t)),this._hits){for(let s=this._hits.length-1;s>=0;s--)this._hits[s].kind||(this._hits[s].kind=t);if(this._hits.dot)for(let s=this._hits.length-1;s>=0;s--)this._hits[s].dot.kind||(this._hits[s].dot.kind=this._hits[s].kind)}}get state(){return this._state}set state(t){typeof t=="string"?this._state=t.split(","):this._state=t}get cure(){return this._cure}set cure(t){typeof t=="string"?this._cure=t.split(","):this._cure=t}get targetstring(){return this._targetstring}set targetstring(t){this._targetstring=t}get targets(){return this._targets}set targets(t){if(typeof t=="string"){if(this._targetstring=t,this._targets=_l(t),this._hits){for(let s=this._hits.length-1;s>=0;s--)this._hits[s].targets||(this._hits[s].targets=_l(t));for(let s=this._hits.length-1;s>=0;s--)this._hits[s].targetstring||(this._hits[s].targetstring=t)}}else if(this._targetstring=fm(t),this._targets=t,this._hits){for(let s=this._hits.length-1;s>=0;s--)this._hits[s].targets||(this._hits[s].targets=t);for(let s=this._hits.length-1;s>=0;s--)this._hits[s].targetstring||(this._hits[s].targetstring=t)}}get bonus(){return this._bonus}set bonus(t){this._bonus?this._bonus.set(t):this._bonus=new N(t)}get source(){return this._source}set source(t){this._source=t}get targetspec(){return this._targetspec}set targetspec(t){this._targetspec=t}get repeathits(){return this._repeathits}set repeathits(t){this._repeathits=t}get applyinstanced(){return this._applyinstanced}set applyinstanced(t){this._applyinstanced=t}get dmg(){return this.damage}set dmg(t){this.damage=t}get damage(){return this._damage}set damage(t){this._damage=re(t)}get heal(){return this.healing}set heal(t){this.healing=t}get healing(){return this._healing}set healing(t){this._healing=re(t)}get hits(){return this._hits}set hits(t){if(this._hits=t,!!t)for(let s=t.length-1;s>=0;s--){const i=t[s];i.id||(i.id=this.id),i.name||(i.name=this.name),i.kind||(i.kind=this.kind),i.potencies||(i.potencies=this.potencies),i.dot&&(i.dot.targetstring=i.dot.targets,i.dot.damage=re(i.dot.damage),i.dot.healing=re(i.dot.healing)),i.noLogs==null&&(i.noLogs=!1),i.unreflectable==null&&(i.unreflectable=!1),i instanceof On||(t[s]=new On(i,this))}}get level(){return this._level!=null?this._level:this.source?this.source.level:void 0}set level(t){this._level=t}get harmless(){return this._harmless}set harmless(t){this._harmless=t}get potencies(){return this._potencies}set potencies(t){this._potencies=t}get summon(){return this._summon}set summon(t){this._summon=t}get result(){return this._result}set result(t){this._result=Fe(t,Ks)}get acquire(){return this._acquire}set acquire(t){this._acquire=Fe(t,Ks)}get only(){return this._only}set only(t){this._only=typeof t=="string"?t.split(","):t}canAttack(){return!0}clone(){return Ht(this,new On)}constructor(t=null,s){if(t&&(this.id=t.id,this.name=t.name,this.kind=t.kind,this.potencies=t.potencies,qh(this,t)),s&&(this.source=s),this.potencies??(this.potencies=[]),this.dot)if(Array.isArray(this.dot))for(let i of this.dot)i.id||(i.name?i.id=i.name:i.id=i.name=this.name||this.id),(i.dmg||i.damage)&&(i.damage?i.dmg=i.damage:i.damage=i.dmg,this.potencies&&!i.potencies&&(i.potencies=this.potencies)),(i.heal||i.healing)&&(i.healing?i.heal=i.healing:i.healing=i.heal,this.potencies&&!i.potencies&&(i.potencies=this.potencies)),i=We(i);else this.dot.id||(this.dot.name?this.dot.id=this.dot.name:this.dot.id=this.dot.name=this.name||this.id),(this.dot.dmg||this.dot.damage)&&(this.dot.damage?this.dot.dmg=this.dot.damage:this.dot.damage=this.dot.dmg,this.potencies&&!this.dot.potencies&&(this.dot.potencies=this.potencies)),(this.dot.heal||this.dot.healing)&&(this.dot.healing?this.dot.heal=this.dot.healing:this.dot.healing=this.dot.heal,this.potencies&&!this.dot.potencies&&(this.dot.potencies=this.potencies)),this.dot=We(this.dot);(this._harmless===null||this._harmless===void 0)&&(this.harmless=this.targets!==null&&this.targets!==void 0&&!(this.targets&H.enemy+H.fixed)),this.bonus=this.bonus||0,this.tohit=this.tohit||0,this.noLogs==null&&(this.noLogs=!1),this.unreflectable==null&&(this.unreflectable=!1)}};const ea={get instanced(){return!0},get recipe(){return this.template?this.template.id:this._id},set recipe(e){this.template||(this.template=e)},get template(){return this._template},set template(e){this._template=e},get mod(){return this._mod},set mod(e){this._mod=e},get alters(){return this._alters},set alters(e){this._alters=e},initAlters(e,t=!1){let s=this.alters||[];typeof s=="string"&&(s=s.split(","));let i=s.length,n=[];for(let r=0;r<i;r++){let l=e.getData(s[r]);if(!(!l||typeof l!="object")&&(n.push(l),l.alter)){const a=l.alter.attack,o=l.alter.tags,h={...l.alter};if(delete h.attack,delete h.tags,a){let f=[];if(this.attack&&(f=this.attack instanceof Array?this.attack:[this.attack]),a instanceof Array)for(let _ of a)f.push(_);else f.push(a);this.attack=f}if(o){let f=typeof o=="string"?o.split(",").map(_=>_.trim()):f=o;for(let _ of f)this.addTag(_)}this.applyMods(h,...Array(5),t)}}this.alters=n},doAlter(e){if(!e){console.log("NO ALTER. NULL RETURN");return}if(!e.alter)return;const t=e.alter.attack,s=e.alter.tags,i={...e.alter};if(delete i.attack,delete i.tags,t){let n=this.attack instanceof Array?this.attack:[this.attack];if(t instanceof Array)for(let r of t)n.push(r);else n.push(t);this.attack=n}if(s){let n=typeof s=="string"?s.split(",").map(r=>r.trim()):n=s;for(let r of n)this.addTag(r)}if(this.applyMods(i,1,this),!Array.isArray(this.alters))this.alters=[];else if(this.alters.includes(e))return;this.addAdj(e.adj||e.name,e),this.alters.push(e)},addAdj(e,t,s=null){if(e){if(e.includes("%")){this.name=e.replace("%s",t.name).replace("%i",this.name);return}else if(!this.name.includes(e)){this.name=e+" "+this.name;return}}s&&this.addAdj(s,t)},is(e){return this.type===e||this.kind===e||this.hasTag(e)||this.name===e}},Mm={stack:!0,consume:!0},Cm=["alter","_cost"];class ds{toJSON(){let t=Ee.toJSON.call(this)||{};return!this.template&&!this.recipe&&(t.type=this.type),this.alters&&this.alters.length>0&&(this.alters=this.alters.filter(function(s){return s!=null}),t.alters=this.alters.map(s=>s.id)),t.cnt=this.count||void 0,t.id=this.id,t.recipe=this.recipe,t.attack&&delete t.attack,t&&Object.keys(t).length?t:void 0}get consume(){return this._consume}set consume(t){this._consume=t}get count(){return this._count}set count(t){(t instanceof Vt||!isNaN(t))&&(this._count=+t)}get stack(){return this._stack}set stack(t){this._stack=t}get defaults(){return this._defaults||Mm}set defaults(t){this._defaults=t}get sell(){return this._sell}set sell(t){this._sell=t}constructor(t=null,s=null){if(t&&Ht(t,this),this.sell==null){this.sell={};let i=this._cost;typeof i=="number"?this.sell={gold:i}:i instanceof Object&&(i.gold&&!isNaN(+i.gold)?this.sell={gold:+i.gold}:isNaN(+i)||(this.sell={gold:+i}))}Cm.forEach(i=>{this[i]&&delete this[i]}),s&&ge(this,s),this.count||(t&&(t.cnt?this.count=t.cnt:t.val&&(this.count=t.val)),this.count||(this.count=1)),this.value=0,this.use&&(this.use.attack!=null&&!(this.use.attack instanceof F)&&(this.use.attack=new F(this.use.attack)),this.use.action!=null&&this.use.action.targets&&(this.use.action.targetstring=this.use.action.targets,this.use.action.targets=ParseTarget(this.use.action.targets)),this.use.dot!=null&&(this.use.dot.id||(this.use.dot.name?this.use.dot.id=this.use.dot.name:this.use.dot.id=this.use.dot.name=this.name||this.id),(this.use.dot.dmg||this.use.dot.damage)&&(this.use.dot.damage?this.use.dot.dmg=this.use.dot.damage:this.use.dot.damage=this.use.dot.dmg,this.potencies&&!this.use.dot.potencies&&(this.use.dot.potencies=this.potencies)),(this.use.dot.heal||this.use.dot.healing)&&(this.use.dot.healing?this.use.dot.heal=this.use.dot.healing:this.use.dot.healing=this.use.dot.heal,this.potencies&&!this.use.dot.potencies&&(this.use.dot.potencies=this.potencies)),We(this.use.dot))),(this.consume===null||this.consume===void 0)&&(this.consume=this.defaults.consume),(this.stack===null||this.stack===void 0)&&(this.stack=this.defaults.stack),Pi(this,void 0,void 0,!0)}updated(){_t.add(this),this.template&&this.template instanceof Object&&_t.add(this.template)}canPay(t){return this.count>=t}canUse(t){let s=!1;if(this.tags){for(let i of this.tags)if(t.state.getData(i).sharecd){s=!0;break}}if((s||this.cd)&&this.template){let i=this.template;return this.template.id&&(i=this.template.id),!t.state.getData(i).timer&&(this.consume||this.use)}return!(this.timer>0)&&(this.consume||this.use)}canRun(t){return this.canUse(t)}onUse(t,s){if(this.cd){if(this.template){let i=this.template;this.template.id&&(i=this.template.id);let n=t.state.getData(i);if(n.timer=Number(n.cd),t.addTimer(n),this.tags)for(let r of this.tags)t.state.getData(r).cdshare(t,n.timer)}else if(this.timer=Number(this.cd),t.addTimer(this),this.tags)for(let i of this.tags)t.state.getData(i).cdshare(t,this.timer)}if(this.consume===!0&&(this.count--,this.count<=0&&(s||t.state.inventory).remove(this)),this.use)if(this.use instanceof Object){let{dot:i,attack:n,action:r,...l}=this.use;i&&t.state.player.addDot(i,this,null,this),(n||r)&&w.emit(au,this,t),t.applyVars(l)}else t.applyVars(this.use)}amount(t=0){for(let s=t;s>0;s--){const i=v.itemGen.instance(this);i&&v.state.inventory.add(i)}}maxed(){return this.stack===!1&&this.count>0||this.max&&this.count>=this.max}revive(t){typeof this.template=="object"?(!this.template.id||!t.getData(this.template.id))&&(this.template=null):typeof this.template=="string"&&(this.template=t.getData(this.template)),this.mod&&(this.mod=Ce(this.mod,this.id,this))}begin(t){this.template&&this.template.alter&&this.applyMods(this.template.alter,...Array(5),!this.equippable||this.value>0),this.initAlters(t,!this.equippable||this.value>0)}tick(t){return this.timer-=t,this.timer<0?(this.timer=0,!0):!1}}_e(ds,Ee);_e(ds,ea);let cn=class{toJSON(){if(!this.id){console.warn("NO DOT ID: "+this);return}let t=this.source&&v.getData(this.source.id);if(!t||t.template!==this.source.template){let s=jd(this),i={};for(let[n,r]of Object.entries(s))n[0]!=="_"&&this[n]!=null&&!(this[n]instanceof Function)&&(r.writable||r.set&&(r.set.name==="reactiveSetter"||this[n]===this["_"+n]))&&(i[n]=this[n]);return i.source&&delete i.source,i.applier&&(i.applier=i.applier.id),this.level!=null&&(i.level=this.level),i.flags||delete i.flags,i.tags=i.tags.join(",")||void 0,i}return{id:this._id,kind:this.kind||this.school||void 0,school:this.school||void 0,name:this._name||void 0,sym:this._sym||void 0,tags:this.tags.join(",")||void 0,dmg:this.damage||void 0,heal:this.healing||void 0,effect:this.effect||void 0,level:this._level||void 0,mod:this._mod||void 0,acc:this.acc||void 0,state:this.state||void 0,adj:this._adj||void 0,flags:this._flags!==0?this._flags:void 0,duration:this.duration,source:this.source?typeof this.source=="string"?this.source:this.source.id:void 0,applier:this.applier?typeof this.applier=="string"?this.applier:this.applier.id:void 0,attack:this.attack||void 0,onExpire:this.onExpire||void 0,onDeath:this.onDeath||void 0,onHit:this.onHit||void 0,onMiss:this.onMiss||void 0,noLogs:this.noLogs||void 0,dotcondition:this.dotcondition||void 0,conditiontext:this.conditiontext||void 0,conditional:this.conditional||void 0,applyinstanced:this.applyinstanced||void 0,showinstanced:this.showinstanced||void 0,summon:this.summon||void 0}}get name(){return(this.sym||"")+(this._name||this._id)}set name(t){t&&this.sym?this._name=t.split(this.sym).join("").trim():this._name=t}get sym(){return this._sym}set sym(t){this._sym=t}get id(){return this._id}set id(t){this._id=t}get mod(){return this._mod}set mod(t){this._mod=t}get adj(){return this._adj||this._name||this._id}set adj(t){this._adj=t}get dmg(){return this.damage}set dmg(t){this.damage=t}get heal(){return this.healing}set heal(t){this.healing=t}get attack(){return this._attack}set attack(t){if(Array.isArray(t)){let s=[];for(let i=t.length-1;i>=0;i--)s.push(t[i]instanceof F?t[i]:new F(t[i]));this._attack=s}else this._attack=t instanceof F?t:new F(t)}get onExpire(){return this._onExpire}set onExpire(t){this._onExpire=t instanceof F?t:new F(t)}get onDeath(){return this._onDeath}set onDeath(t){this._onDeath=t instanceof F?t:new F(t)}get onHit(){return this._onHit}set onHit(t){this._onHit=t instanceof F?t:new F(t)}get onMiss(){return this._onMiss}set onMiss(t){this._onMiss=t instanceof F?t:new F(t)}get potencies(){return this._potencies}set potencies(t){this._potencies=t}get damage(){return this._damage}set damage(t){this._damage=re(t)}get healing(){return this._healing}set healing(t){this._healing=re(t)}get flags(){return this._flags}set flags(t){this._flags=0,typeof t!="number"?this._flags=vu(t):this._flags=t}get source(){return this._source}set source(t){this._source=t}get applier(){return this._applier}set applier(t){this._applier=t}get applyinstanced(){return this._applyinstanced}set applyinstanced(t){this._applyinstanced=t}get level(){return this._level||this.source&&this.source.level||0}set level(t){this._level=t}get perm(){return this._perm}set perm(t){this._perm=t}get tags(){return this._tags}set tags(t){t&&(typeof t=="string"?this._tags=t.split(",").map(s=>s.trim()):Array.isArray(t)?this._tags=t:console.warn("Unknown tags in setter",t))}get type(){return Od}get summon(){return this._summon}set summon(t){this._summon=t}valueOf(){return this.perm||this.duration>0?1:0}canCast(){return(this._flags&zi)===0}canAttack(){return(this._flags&Ls)===0}canDefend(){return(this._flags&ar)===0}hasTag(t){return this.tags&&this.tags.includes(t)}constructor(t,s,i){var n,r;t&&ge(this,t),this.source=this.source||s||null,this.applier=this.applier||this.source||null,this.name=i||this._name||(s?s.name:null),this.id||console.warn("BAD DOT ID: "+this.name),this.duration||(this.duration=0,this.perm=!0),this.mod&&(this.mod=Ce(this.mod,this.id,this)),this.flags||(this.flags=0),this._attack&&(this.attack=this._attack,this._attack.name||(this._attack.name=this.name)),this._onExpire&&(this.onExpire=this._onExpire,this._onExpire.name||(this._onExpire.name=this.onExpire.name)),this._onDeath&&(this.onDeath=this._onDeath,this._onDeath.name||(this._onDeath.name=this.onDeath.name)),this._onHit&&(this.onHit=this._onHit,this._onHit.name||(this._onHit.name=this.onHit.name)),this._onMiss&&(this.onMiss=this._onMiss,this._onMiss.name||(this._onMiss.name=this.onMiss.name)),this.acc=this.acc||0,(n=this.conditional)!=null&&n.onSuccess&&this.reviveProperties(this.conditional.onSuccess),(r=this.conditional)!=null&&r.onFailure&&this.reviveProperties(this.conditional.onFailure),this.tags||(this.tags=[]),this.potencies||(this.potencies=[]),this.noLogs==null&&(this.noLogs=!0),this.unreflectable==null&&(this.unreflectable=!0)}extend(t){t===0||this.perm?(this.perm=!0,this.duration=0):t>this.duration&&(this.duration=t)}reviveAttack(t){if(Array.isArray(t)){let s=[];for(let i=t.length-1;i>=0;i--)t.push(t[i]instanceof F?t[i]:new F(t[i]));this.attack=s}else t=t instanceof F?t:new F(t);return t}revive(t){var s,i;this.applier&&typeof this.applier=="string"&&(this.applier=t.getMonster(this.applier)),this.source&&typeof this.source=="string"&&(this.source=t.getData(this.source)),this.dotcondition&&(this.dotcondition=Js(this.dotcondition)),this.reviveProperties(this),(s=this.conditional)!=null&&s.onSuccess&&this.reviveProperties(this.conditional.onSuccess),(i=this.conditional)!=null&&i.onFailure&&this.reviveProperties(this.conditional.onFailure)}reviveProperties(t){t.name=this._name||(this.source?this.source.name:null),t.effect&&(t.effect=Fe(t.effect,Ks)),t.summon&&t.summon.summoncondition&&(t.summon.summoncondition=Js(t.summon.summoncondition)),t.noLogs==null&&(t.noLogs=!0),t.unreflectable==null&&(t.unreflectable=!0),t.damage&&(t.damage=re(t.damage)),t.healing&&(t.healing=re(t.healing)),t.attack&&(t.attack=this.reviveAttack(t.attack)),t.onExpire&&(t.onExpire=this.reviveAttack(t.onExpire)),t.onDeath&&(t.onDeath=this.reviveAttack(t.onDeath)),t.onHit&&(t.onHit=this.reviveAttack(t.onHit)),t.onMiss&&(t.onMiss=this.reviveAttack(t.onMiss))}tick(t){return this.acc+=t,this.acc>=1?(this.acc--,this.perm||this.duration--,1):0}getAttack(){return Array.isArray(this.attack)?this.attack[Math.floor(Math.random()*this.attack.length)]:this.attack||this}};const Em=(e,t)=>{let s=[];for(let i of e)s.push(t(i));return s},Im=(e,t)=>{let s=[];for(let i of e)s.push(t(i));return new Set(s)},Dm=e=>{for(const t in e){const s=e[t];e[t]=s instanceof N?s:new N(s,t)}return e},fn=(e,t,s)=>{const i=e[t];i===void 0?e[t]=new Vt(s.valueOf()):typeof i=="object"?i.value=(i.value||0)+s:e[t]=new Vt(i+s)},Au=(e,t)=>{if((typeof e!="object"||e.constructor!==Object)&&(e={value:e}),typeof t=="string")fn(e,t,1);else if(typeof t=="object")for(let s in t){let i=e[s],n=t[s];typeof n=="object"?n.constructor!==Object?fn(e,s,n):e[s]=Au(i||{},n):typeof i=="object"?fn(i,"value",n):fn(e,s,n)}return e};class wt{get resist(){return this._resist}set resist(t){this._resist=t}get negate(){return this._negate}set negate(t){this._negate=t}get team(){return this._team}set team(t){this._team=t}set immune(t){this.immunities=t}get immunities(){return this._immunities}set immunities(t){if(typeof t=="string"){this._immunities={};const s=t.split(",");for(const i in s)this.addImmune(s[i]);return}for(const s in t){const i=t[s];i instanceof N||(t[s]=new N(i))}this._immunities=t}get bonuses(){return this._bonuses}set bonuses(t){this._bonuses=Dm(t)}get attack(){return this._attack}set attack(t){if(Array.isArray(t)){let s=[];for(let i=t.length-1;i>=0;i--)s.push(t[i]instanceof F?t[i]:new F(t[i]));this._attack=s}else this._attack=t instanceof F?t:new F(t)}get onHit(){return this._onHit}set onHit(t){t!=null&&(this._onHit=t instanceof F?t:new F(t))}get onMiss(){return this._onMiss}set onMiss(t){t!=null&&(this._onMiss=t instanceof F?t:new F(t))}get dots(){return this._dots}set dots(t){const s=[];if(t)for(let i=t.length-1;i>=0;i--)s.push(t[i]instanceof cn?t[i]:new cn(t[i]));this._dots=s}getCause(t){return this._states.getCause(t)}hasState(t){return this._states.has(t)}hasDot(t){for(let s=this.dots.length-1;s>=0;s--)if(this.dots[s].id===t||this.dots[s].kind===t||this.dots[s].hasTag(t))return this.dots[s];return!1}canAttack(){return this._states.canAttack()}canDefend(){return this._states.canDefend()}canCast(){return this._states.canCast()}get states(){return this._states}set states(t){this._states=new lo}get instanced(){return!0}get regen(){return this._regen}set regen(t){this._regen=t instanceof N?t:new N(t)}get recharge(){return this._recharge}set recharge(t){this._recharge=t instanceof N?t:new N(t)}get alive(){return this.hp.value>0}get context(){return this._context}set context(t){this._context=t}get delay(){return fe(this.speed)}constructor(t){t&&(this.id=t.id,qh(this,t)),this.type=er,this._states=new lo,this.immunities=this.immunities||{},this._resist=this._resist||{},this._negate=this._negate||{},this.restitems=[],this.bonuses||(this.bonuses={}),this.dots||(this._dots=[]),this.timer=this.timer||0}revive(t){}reviveDots(t){for(let s=this.dots.length-1;s>=0;s--)this.dots[s].revive(t),this._states.add(this._dots[s])}retarget(t){return this._states.retarget(t)}cure(t){if(Array.isArray(t)){for(let s=t.length-1;s>=0;s--)this.cure(t[s]);return}for(let s=this.dots.length-1;s>=0;s--)if(this.dots[s].id===t||this.dots[s].kind===t||this.dots[s].hasTag(t)){this.rmDot(s);return}}tryCast(){return this.spells?this.spells.nextUsable(this.context):null}begin(){}addDot(t,s,i=0,n=null){var x,T,E;if(Array.isArray(t))return t.forEach(U=>this.addDot(U,s,i,n));let r=t,l=t,a,o;if(typeof t=="string"&&(t=this.context.state.getData(t),!t))return;if((t.dmg||t.damage)&&(a=t.dmg!=null?t.dmg:t.damage),(t.heal||t.healing)&&(o=t.heal!=null?t.heal:t.healing),!i&&!isNaN(t.duration)&&(i=+t.duration),t=Ht(t),n&&(t.applier=n),l instanceof Object){r=l.id;let U=this.context.state.getData(r);U&&U.type===Lh&&this.mergeDot(t,U),!i&&!isNaN(t.duration)&&(i=+t.duration)}if(t[mt]&&!t[mt].roll())return;if(!t.id&&typeof r=="string"&&(t.id=r),r||(r=t.id=s?"dot_"+(s.recipe||s.id||s.name.replace(" ","_")):null),!r||!t.id){console.warn("No DoT ID",this.id,t);return}if(t.flags&&this.rollNegate(t.kind||r)){w.emit(eu,this,t.kind||t.name);return}if(t.flags&&this.isImmune(t.kind||r)){w.emit(Xl,this,t.kind||t.name);return}let h=Array.isArray(t.tags)?t.tags:((x=t.tags)==null?void 0:x.split(","))||[],f=t.level||s&&s.level||0;t._tags&&(Array.isArray(t._tags)&&t.tags!==t._tags&&h.push(...t._tags),delete t._tags),h=h.filter(U=>U!=="state"),t.tags=h;let _=this.dots.find(U=>U.id===r||U.tags.find(P=>h.includes(P)));if(_!=null){if(_.id===r){_.extend(i);return}if(_.level<=f)this.removeDot(_);else return}a&&a.instantiate instanceof Function&&(t.damage=t.dmg=a.instantiate()),o&&o.instantiate instanceof Function&&(t.healing=t.heal=o.instantiate()),(T=t.conditional)!=null&&T.onSuccess&&this.handleSubDot(t.conditional.onSuccess),(E=t.conditional)!=null&&E.onFailure&&this.handleSubDot(t.conditional.onFailure),t instanceof cn||(t=new cn(t,s),t.duration!=i&&(t.duration=i)),t.applyinstanced&&(t=this.instanceDot(t,t.applier)),this.applyDot(t)}handleSubDot(t){let s,i;(t.dmg||t.damage)&&(s=t.dmg!=null?t.dmg:t.damage),(t.heal||t.healing)&&(i=t.heal!=null?t.heal:t.healing),s&&s.instantiate instanceof Function&&(t.damage=t.dmg=s.instantiate()),i&&i.instantiate instanceof Function&&(t.healing=t.heal=i.instantiate())}mergeDot(t,s){$s(t,s),t.name=t.name,t.flags=t.flags|s.flags,t.adj=t.adj||s.adj}applyDot(t){this._states.add(t),this.dots.push(t),t.mod&&this.context.applyMods(t.mod),t.flags&&w.emit(Qh,this,t)}removeDot(t){let s=t.id;this.rmDot(this.dots.findIndex(i=>i.id===s))}rmDot(t){if(t<0)return;let s=this.dots[t];this.dots.splice(t,1),s.mod&&this.context.removeMods(s.mod),s.flags&&this._states.remove(s)}update(t){if(this.regen&&(this.hp+=this.regen*t),this.recharge&&(this.barrier+=this.recharge*t),!v.state.explore.running&&this.id==="player")for(let i of this.restitems)i.amount(i.restrate.getApply({[C.CONTEXT]:this.context,[C.GDATA]:this.context.gdata,[C.ITEM]:i,[C.ACTOR]:this,[C.TARGET]:this})*t);const s=this.dots;for(let i=s.length-1;i>=0;i--){const n=s[i];n.dotcondition&&(n.conditionstatus=n.dotcondition.getApply({[C.CONTEXT]:this.context,[C.GDATA]:this.context.gdata,[C.ITEM]:n,[C.ACTOR]:n.applier,[C.TARGET]:this}),n.conditionaction=n.conditionstatus?n.conditional.onSuccess:n.conditional.onFailure);let r=n.tick(t),l=!1;n.conditionaction&&(l||(l=this.doDot(n.conditionaction,t,r))),l||(l=this.doDot(n,t,r)),(n.duration<=t&&!n.perm&&r||l)&&this.rmDot(i)}}doDot(t,s,i){if(t.effect&&this.context.applyVars(t.effect,s,1,t.applier,this),!!i)return t.summon&&this.context.summon(t.summon,this),(t.damage||t.cure||t.healing)&&Ze(this,t,t.applier),t.attack&&w.emit(ou,t,this.context),t.duration<=s&&!t.perm&&t.onExpire&&!this.getCause(_u)&&w.emit(se,t.onExpire,this.context),!!t.removedot}combat(t){if(this.alive&&(this.timer-=t,this.timer<=0)){this.timer+=fe(this.speed);for(let n=this.spells?this.castAmt(this.chaincast):0;n>0;n--){const r=this.tryCast();if(!r)break;if(r.caststoppers){let a;for(const o of r.caststoppers)if(a=this.getCause(o),a)break;if(a){w.emit(ue,this,a);continue}}let l=!1;(r.attack||r.action)&&(w.emit(lr,r,this.context),l=!0),r.mod&&(this.context.applyMods(this.mod),l||(w.emit(Qt,this.name+" uses "+r.name),l=!0)),r.create&&this.context.create(r.create),r.summon&&this.context.summon(r.summon,this),r.result&&(l||(w.emit(Qt,this.name+" uses "+r.name),l=!0),this.context.applyVars(r.result,1)),r.dot&&(l||(w.emit(Qt,this.name+" uses "+r.name),l=!0),this.context.self.addDot(r.dot,r,null,this))}let s=this.getCause(Ls);if(s)return s;let i=[];for(let n=this.castAmt(this.chainhit);n>0;n--)i.push(this.getAttack());return i}}getBonus(t){return this.bonuses[t]||0}getAttack(){return Array.isArray(this.attack)?this.attack[Math.floor(Math.random()*this.attack.length)]:this.attack||this}hasStatus(t){return this.states[t]>0}isImmune(t){return this.immunities[t]>0}getHit(){return this.tohit.valueOf()}rollNegate(t){return(this.negate[t]||0)>100*Math.random()}getResistMultiplier(t){let s=this._resist[t]||0;return s>0?50/(50+s):2-50/(50-s)}getDefenceMultiplier(){let t=this.defense||0;return t>0?100/(100+t):2-100/(100-t)}getDodgeChance(t=0){t=Math.max(t,-50);let s=this.dodge||0;return s>0?s/(100+s+t):0}addStatus(t){this.states[t]=this.states[t]?this.states[t]+1:1}removeStatus(t){this.states[t]=this.states[t]?this.states[t]-1:0}addImmune(t){this.immunities[t]=this.immunities[t]?this.immunities[t]+1:1}removeImmune(t){this.immunities[t]=this.immunities[t]?this.immunities[t]-1:0}castAmt(t){return Math.floor(t)+(Math.random()<t-Math.floor(t))}instanceDot(t,s){var i,n;return t.damage=Zs(t.damage,t,s,this),t.heal=Zs(t.healing,t,s,this),t.showinstanced=!0,(i=t.conditional)!=null&&i.onSuccess&&this.instanceDot(t.conditional.onSuccess),(n=t.conditional)!=null&&n.onFailure&&this.instanceDot(t.conditional.onFailure),t.attack&&(t.attack=this.instanceDotAttack(t.attack,s)),t.onExpire&&(t.onExpire=this.instanceDotAttack(t.onExpire,s)),t.onDeath&&(t.onDeath=this.instanceDotAttack(t.onDeath,s)),t.onHit&&(t.onHit=this.instanceDotAttack(t.onHit,s)),t.onMiss&&(t.onMiss=this.instanceDotAttack(t.onMiss,s)),t}instanceDotAttack(t,s){if(Array.isArray(t)){for(let i=t.length-1;i>=0;i--)if(t[i]=hn(t[i],s,this),t[i].dot&&(t[i].dot=this.instanceDot(t[i].dot,s)),t[i].hits)for(let n=t[i].hits.length-1;n>=0;n--)t[i].hits[n]=hn(t[i].hits[n],s,this),t[i].hits[n].dot&&(t[i].hits[n].dot=this.instanceDot(t[i].hits[n].dot,s))}else if(t=hn(t,s,this),t.dot&&(t.dot=this.instanceDot(t.dot,s)),t.hits)for(let i=t.hits.length-1;i>=0;i--)t.hits[i]=hn(t.hits[i],s,this),t.hits[i].dot&&(t.hits[i].dot=this.instanceDot(t.hits[i].dot,s));return t}deathThroes(){var t;if(!this.getCause(yu)){this.onDeath&&w.emit(se,this.onDeath,this.context);const s=this.dots;for(let i=s.length-1;i>=0;i--){const n=s[i];n.onDeath&&w.emit(se,n.onDeath,this.context),n.conditionaction&&w.emit(se,(t=n.conditionaction)==null?void 0:t.onDeath,this.context)}}}openingAction(){this.onSummon&&w.emit(se,this.onSummon,this.context)}getThornAttack(t){return this.thornAttack==null&&(this.thornAttack=new F({name:"thorns",kind:"thorns",harmless:!0,unreflectable:!0,targets:"fixed",potencies:[]})),this.thornAttack.dmg=t,this.thornAttack}getReflectAttack(t){return this.reflectAttack==null&&(this.reflectAttack=new F({name:"reflect",kind:"thorns",harmless:!0,unreflectable:!0,targets:"fixed",potencies:[]})),this.reflectAttack.dmg=t,this.reflectAttack}}_e(wt,Ee);class Lm{toJSON(){let t={};return this.npcItems.forEach((s,i)=>{if(i==="spelllist")return;let n=s.toJSON();n!=null&&(typeof n!="object"||Object.keys(n).length)&&(t[i]=n)}),t}constructor(t,s,i){this.state=t,this.self=s,this.npcItems=new Map;for(let n in i){let r=this.state.getData(n,!1);if(!r)console.warn(`Cannot find id ${n}. Skipping.`);else{let l=i[n];r.template||console.warn(`!!! NO TEMPLATE FOR ${n}!`);let a=r.template||{},o=st(l.template)||{};delete l.template,n==="level"&&(a=Ht(a),delete a.mod,delete a.result),$s(l,a),l=fs(l,n);let h=new r.constructor(l);r.isRecipe?(h.subInstance=!0,h.template=a,h.instTemplate=o):($s(o,a),h.template=o),Gi(h.template),this.npcItems.set(n,h),this.state.playerStats.includes(r)&&(kl(s,n),s[n]=h)}}}nextId(t){return this.state.nextId(t)}getSlot(t,s){return null}setSlot(t,s){}findInstance(t){return null}getUnique(t){return this.state.getUnique(t)}findData(t,s=!1){return this.getData(p)}hasUnique(t){return!1}getData(t,s=!0,i=!0){if(t==="self")return this.self;if(this.state[t])return this.state[t];let n=this.npcItems.get(t);return n!==void 0?n:i&&(n=this.state.getData(t,!1,i),n)?n.isRecipe||!s?n:this.makeNpcItem(t,n):null}makeNpcItem(t,s){let i;return s.template?(i=Ht(s.template),i=fs(i,s.id)):(console.warn(`No template for ${s.id}. Directly copying data.`),i=Ht(s,{})),s.constructor&&(i=new s.constructor(i)),i==null?(console.log("NPC: Cant create: "+t),i=s):i.template=s.template,this.npcItems.set(t,i),this.state.playerStats.find(n=>n.id===t)&&(kl(this.self,t),this.self[t]=i),i}revive(){this.npcItems.forEach(t=>{t.revive instanceof Function&&t.revive(this)})}}class Wt{toJSON(){}get id(){return this._id}set id(t){this._id=t}get items(){return this._items}set items(t){this._items=t}[Symbol.iterator](){return this._items[Symbol.iterator]()}get type(){return this._type}set type(t){this._type=t}get name(){return this._name}set name(t){this._name=t}get locked(){for(let t of this.items)if(t.locked===!1)return!1;return!0}set locked(t){for(let s of this.items)s.locked=t}get owned(){for(let t of this.items)if(t.owned===!0)return!0;return!1}get delta(){return 0}valueOf(){let t=0;for(let s of this.items)t+=s.valueOf();return t}constructor(t){if(this.items=new Set,t instanceof Object?zl(this,t):this.id=t,this.id||console.warn("TAGSET NO ID!!!!!"),!this.name){let s=t.toString().indexOf("t_");s<0?this.name=t.toString():this.name=t.toString().slice(s+2)}}canUse(t){return t.canPay(this.cost)}fillsRequire(){for(let t of this.items)if(t.fillsRequire())return!0;return!1}filled(t){for(let s of this.items)if(!s.filled(t))return!1;return!0}maxed(t=0){for(let s of this.items)if(!s.maxed(t))return!1;return!0}canPay(t){for(let s of this.items)if(!s.canPay(t))return!1;return!0}remove(t){for(let s of this.items)s.remove(t)}onUse(t){console.warn("TagSet onUse() not implemented")}add(t){this.items.add(t)}random(){let t=this.items.size;if(t<=0)return null;let s=Math.floor(Math.random()*t);const i=this.items.values();for(;s-- >0;)i.next();return i.next().value}amount(t){for(let s of this.items)s.amount(t)}disable(t){for(let s of this.items)t.disable(s)}enable(t){for(let s of this.items)t.enable(s)}applyVars(t,s=1){for(let i of this.items)i.applyVars(t,s)}applyMods(t,s,i,n,r,l,a){for(let o of this.items)o.applyMods(t,s,o,n,r,l,a)}removeMods(t){for(let s of this.items)s.removeMods(t,s)}hasTag(t){return t==="tagset"}toArray(){return Array.from(this.items)}filter(t){let s=[];for(let i of this.items)t(i)&&s.push(i);return s}forEach(t){return this.items.forEach(t)}cdshare(t,s){if(this.sharecd)for(let i of this.items)(!i.timer||i.timer<s)&&(i.timer=s,t.addTimer(i))}}class Nm{get runner(){return this._runner}set runner(t){this._runner=t}get state(){return this._state}set state(t){this._state=t}get self(){return this._state.self}set self(t){this._state.self=t}constructor(t,s,i){this.state=new Lm(t,s,i)}getData(t,s=!0,i=!0){return this.state.getData(t,s,i)}tryItem(t){}tryUseOn(t,s){}tryBuy(t){return!0}unlockTest(t){return!1}craft(t){return!0}summon(t,s=null,i=null){if(Array.isArray(t)){for(let o of t)this.summon(o,s,i);return}if(t[mt]&&!t[mt].roll()||t.summoncondition&&!t.summoncondition.getApply({[C.CONTEXT]:s.context,[C.GDATA]:s.context.gdata,[C.ITEM]:null,[C.ACTOR]:s,[C.TARGET]:i}))return;let n=t.id,r=t.keep||!1,l=t.count||1,a=t.max||0;this.create(n,r,l,a)}create(t,s,i=1,n=0){if(Array.isArray(t)){for(let r=t.length-1;r>=0;r--)this.create(t[r],s,i,n);return}if(typeof t=="string"&&(t=this.state.getData(t)),!!t)for(let r=i;r>0;r--)t.type===ne&&t.onCreate&&t.onCreate(this,this.self.team,s,n)}filled(){return!1}removeMods(t,s){this.applyMods(t,-s)}remove(t,s){}disable(t){}enable(t){}useOn(t,s){}addTimer(t){}getLoot(){}canPay(t,s=1){return!0}canPayObj(t,s,i=1){if(!t)return!1;if(s instanceof RValue||!isNaN(s))return t.value>=s;for(const n in s){const r=s[n];if(!isNaN(r)||r instanceof RValue){if(t.value<r*i)return!1}else if(typeof r=="object"&&!this.canPayObj(t[n],r,i))return!1}return!0}canEquip(t){return!0}equip(t){}unequip(t,s){}onUnequip(t){}setSlot(t){}payCost(t){}canMod(t){return!0}payInst(t,s){}setTask(t){}canRun(t){return!0}canUse(t){return!0}applyMods(t,s=1){if(t){if(Array.isArray(t))for(const i of t)this.applyMods(i,s);else if(typeof t=="object")for(const i in t){const n=this.getData(i);n!=null&&(n.applyMods?n.applyMods(t[i],s):console.warn("no applyMods(): "+n))}else if(typeof t=="string"){let i=this.getData(t);i&&(console.warn("!!!!!!!!!!ADDED NUMBER MOD: "+t),i.amount(this,1))}}}applyVars(t,s=1,i=1,n=null,r=null){if(Array.isArray(t))for(let l of t)this.applyVars(l,s,i);else if(typeof t=="object"){let l,a=t[mt];if(a&&!a.roll())return;for(let o in t)if(l=this.getData(o),a=t[o],l==null)o===Nh?this.self.addTitle(a):o===Rh?w.emit(Ds,a):console.warn(o+" no effect target: "+a);else if(typeof a=="number")l.amount(a*s*i);else if(a.isRVal){const h={[C.GDATA]:this.state.state.gdata,[C.ITEM]:l,[C.ACTOR]:n,[C.TARGET]:r};l.amount(i*s*a.getApply(h))}else a===!0?(l.doUnlock(this),l.onUse(this)):a.type===mt?a.roll()&&l.amount(1):l.applyVars(a,s,i)}else if(typeof t=="string"){let l=this.getData(t);l!==void 0&&(l.amount.length===1?l.amount(s):l.amount.length===2&&l.amount(this,s))}}restoreMods(){this.state.npcItems.forEach(t=>{t instanceof Wt||t.instanced||t.isRecipe||t.value!=0&&(t.applyImproves&&t.applyImproves(),t.mod&&+t.value&&this.applyMods(t.mod,t.value,t.id),t.lock&&this.lock(t.lock,t.value))})}revive(t){this.state.revive(t)}}const Pr={team:al,active:!1},Rm=["mod","runmod","alter","attack","damage","cost","run","result","effect","loot","statedata","template"];class Cs extends wt{toJSON(){let t=super.toJSON()||{};t.id=this.id,t.cost=void 0,t.context=void 0,t.team=this.team||void 0,t.timer=this.timer,t.cdtimers=this.cdtimers,t.attack&&delete t.attack,t.onDeath&&delete t.onDeath,t.onHit&&delete t.onHit,t.onMiss&&delete t.onMiss,this.template?(t.template=this.template.id,this._name!=this.template.name&&(t.name=this._name)):t.name=this._name,t.statedata=this.context.state.toJSON(),delete t.hp;for(let s in t){let i=t[s];typeof i=="object"&&!Object.keys(i).length&&delete t[s]}return t}get keep(){return this._keep}set keep(t){this._keep=t}get loot(){return this._loot}set loot(t){if(typeof t!="object"){this._loot=t;return}for(const s in t){const i=t[s];typeof i=="string"&&(Wi.test(i)?t[s]=new pe(i):ns.test(i)?t[s]=new Mt(i):isNaN(i)||(t[s]=Number(i)))}this._loot=t}get damage(){return this._damage}set damage(t){this._damage=re(t)}get active(){return this._active}set active(t){this._active=t}get spells(){return this._spells}set spells(t){this._spells=cp(t)}constructor(t,s=null){super(t),delete this.defaults,delete this.instTemplate;let i=Ht(this.statedata)||{},n=this.stateTemplate;for(let l of v.state.playerStats){let a=l.id,o=t.statedata[a],h=i[a],{max:f,val:_}=o;!l.stat&&f!=null&&(typeof f=="string"&&ns.exec(f)&&(f=new Mt(f)),isNaN(f)?console.warn(`Non-numeric statedata property max: ${f}`):h.max=f=+f,_==null&&(h.val=_=f)),_!=null&&(typeof _=="string"&&ns.exec(_)&&(_=new Mt(_)),isNaN(_)?console.warn(`Non-numeric statedata property val: ${_}`):h.val=_=+_,!l.stat&&f==null&&(h.max=f=_)),Bh(i[a],(x,T,E)=>{E!=null&&(typeof E=="string"&&ns.exec(E)&&(E=new Mt(E)),isNaN(E)||(x[T]=+E))},...Rm)}for(let l in i){let a=i[l];a.template=Ht(n[l])}if(s){let l=s.statedata;l&&($s(l,i),i=l);let a=fs(Ht(s),s.id);zl(this,a)}this.context=new Nm(v.state,this,i),delete this.statedata,delete this.stateTemplate,typeof this.hp=="string"?this.hp=new Mt(this.hp).value:this.hp instanceof Mt&&(this.hp=this.hp.value),this.dmg&&this.damage==null&&(this.damage=this.dmg),this.attack||(this.attack=new F(this.damage),this.damage=0),this.cdtimers||(this.cdtimers={}),+this.hp.max||(this.hp.max.set(1),+this.hp||(this.hp=+this.hp.max));for(let l in Pr)this[l]==null&&(this[l]=Pr[l]);let r=this.context.state.npcItems;for(let l of r.keys())r.get(l).restrate&&this.restitems.push(r.get(l))}revive(t){typeof this.template=="string"&&(this.template=t.getData(this.template),this.template&&this.template.attack&&(this.attack=this.template.attack)),this.context.revive(t),this._spells&&(this.spells.revive(this._context.state),this.spells.name=this.spells.id="spelllist",this.context.state.npcItems.set("spelllist",this.spells)),super.revive(t)}begin(){if(this.dots)for(let t=this.dots.length-1;t>=0;t--)this.dots[t].mod&&this.context.applyMods(this.dots[t].mod,1);this.context.restoreMods()}onUse(t){}res(){this.hp=1}rest(t){const s=.01*this.hp.max+(this.regen||0),i=this.recharge||0;this.hp.amount(s*t),this.barrier.amount(i*t);for(let n of this.restitems)n.amount(n.restrate.getApply({[C.CONTEXT]:this.context,[C.GDATA]:Object.fromEntries(this.context.state.npcItems),[C.ITEM]:n,[C.ACTOR]:this,[C.TARGET]:this})*t)}combat(t){if(this.alive){this.timer-=t;for(let s of Object.keys(this.cdtimers))this.cdtimers[s]-=t,this.cdtimers[s]<=0&&delete this.cdtimers[s];if(this.timer<=0){this.timer+=fe(this.speed);for(let n=this.spells?this.castAmt(this.chaincast):0;n>0;n--){let r=null;for(let a=0;a<this.spells.items.length&&(r=this.tryCast(),!(!r||!this.cdtimers[r.id]));a++)r=null;if(!r)break;if(r.caststoppers){let a;for(const o of r.caststoppers)if(a=this.getCause(o),a)break;if(a){w.emit(ue,this,a);continue}}let l=!1;r.cd&&(this.cdtimers[r.id]=r.cd),(r.attack||r.action)&&(w.emit(lr,r,this.context),l=!0),r.mod&&(this.context.applyMods(this.mod),l||(w.emit(Qt,this.name+" uses "+r.name),l=!0)),r.create&&this.context.create(r.create),r.summon&&this.context.summon(r.summon,this),r.result&&(l||(w.emit(Qt,this.name+" uses "+r.name),l=!0),this.context.applyVars(r.result,1)),r.dot&&(l||(w.emit(Qt,this.name+" uses "+r.name),l=!0),this.context.self.addDot(r.dot,r,null,this))}let s=this.getCause(Ls);if(s)return s;let i=[];for(let n=this.castAmt(this.chainhit);n>0;n--){let r=this.getAttack();r&&i.push(r)}return i.length>0?i:null}}}}_s(Cs,"Defaults",Pr);_e(Cs,ea);class ho{toJSON(){let t=this._value.toJSON(),s=this.max.toJSON();return t===s?t:{v:this._value,max:this.max}}get base(){return this._value.base}set base(t){t&&typeof t=="object"?this._value.base=t.base||t.value:this._value.base=t}get value(){return this._value.value}set value(t){t>this._max.value&&(t=this._max.value),this._value?this._value.set(t):this.v=t}set v(t){this._value=new N(t??0,this.path+".value")}get max(){return this._max}set max(t){this._max=t instanceof N?t:new N(t,this.path+".max",0)}valueOf(){return this._value.value}set(t){t>this.max.value&&(t=this.max.value),this._value.set(t)}amount(t){this._value.base+=t,this._value.value>this.max.value&&(this._value.base=this.max.value)}maxed(){return this._value>=this.max}constructor(t=null,s=!1){t&&typeof t=="object"?t.isRVal?(this.max=t.value,this.v=s?0:this.max.value):(t.max?this.max=t.max:t.v?this.max=t.v:this.max=0,t.v?this.v=t.v:this.v=s||!t.max?0:t.max):typeof t=="number"?(this.max=t,this.v=s?0:t):(this.max=0,this.v=0)}}class mr extends ds{toJSON(){let t=super.toJSON()||{};return this.save||(t.material=t.kind=void 0),t.id=this.id,this.template?typeof this.template=="string"?t.template=this.template:t.template=this.template.id:t.type=this.type,t.sell=this.sell,t.name=this.sname,t.enchants=this.enchants,this.mod&&(t.mod=this.mod),this.material&&(t||(t={}),t.material=this.material.id),t&&Object.keys(t).length?t:void 0}get enchants(){return this._enchants}set enchants(t){this._enchants===void 0||this._enchants===null||typeof t=="object"?this._enchants=t instanceof ho?t:new ho(t,!0):this._enchants.set(t)}get dmg(){return this.damage}set dmg(t){this.damage=t}get damage(){return this._damage?this._damage:0}set damage(t){this._damage=re(t)}get heal(){return this.healing}set heal(t){this.healing=t}get healing(){return this._healing}set healing(t){this._healing=re(t)}get equippable(){return!0}get material(){return this._material}set material(t){this._material=t}get armor(){return this._armor}set armor(t){this._armor?(typeof this._armor=="number"&&(this._armor=new N(this._armor)),this._armor.base=t):this._armor=new N(t)}get evasion(){return this._evasion}set evasion(t){this._evasion?(typeof this._evasion=="number"&&(this._evasion=new N(this._evasion)),this._evasion.base=t):this._evasion=new N(t)}get shield(){return this._shield}set shield(t){this._shield?(typeof this._shield=="number"&&(this._shield=new N(this._shield)),this._shield.base=t):this._shield=new N(t)}get attack(){return this._attack}set attack(t){if(t)if(Array.isArray(t)){let s=[];for(let i of t)s.push(i instanceof F?i:new F(i,this));this._attack=s}else t!==this._attack?t instanceof F?this._attack=t.clone():this._attack=new F(t,this):t instanceof F||(this._attack=new F(t,this));else this._attack=null}get worn(){return this.value>0}get slot(){return this._slot}set slot(t){this._slot=t}get kind(){return this._kind}set kind(t){this._kind=t}constructor(t=null,s=null){super(t,s),this.stack=!1,this.consume=!1,(this.armor===null||this.armor===void 0)&&(this.armor=0),(this.evasion===null||this.evasion===void 0)&&(this.evasion=0),(this.shield===null||this.shield===void 0)&&(this.shield=0),this.enchants||(this.enchants=0),this.alters||(this.alters=[]),this.value=this.val=0,this.type||(console.warn(this.id+" unknown wear type: "+this.type),this.attack?this.type=Kt:this.armor||this.slot!=null?this.type=Be:this.type=Gt),this._attack&&(this.attack=this._attack,this._attack.name||(this._attack.name=this.name))}maxed(){return!1}revive(t){this.sell instanceof Object||(this.sell={gold:this.sell}),typeof this.material=="string"&&(this.material=t.getData(this.material)),typeof this.recipe=="string"?this.template=t.getData(this.recipe):typeof this.template=="string"&&(this.template=t.getData(this.template)),this.template?((this.armor===null||this.armor===void 0)&&(this.armor=this.template.armor),(this.evasion===null||this.evasion===void 0)&&(this.evasion=this.template.evasion),(this.shield===null||this.shield===void 0)&&(this.shield=this.template.shield),(this.tohit===null||this.tohit===void 0)&&(this.tohit=this.template.tohit||0),(this.attack===null||this.attack===void 0)&&(this.attack=this.template.attack),this.type=this.template.type||this.type):console.log("bad template: "+this.template),(!this.level||this.template&&this.level<=this.template.level)&&(this.template&&this.template.level?this.level=this.template.level.valueOf()||1:this.level=1,this.material&&this.material.level&&(this.level+=this.material.level.valueOf()||0)),typeof this.alters.includes=="function"&&this.material&&!this.alters.includes(this.material.id)&&this.alters.push(this.material.id),this.mod&&(this.mod=Ce(this.mod,this.id,this)),this.enchants.max||this.calcMaxEnchants()}hasEnchant(t){return this.alters&&this.alters.find(s=>s.id===t)}applyMaterial(t){t&&(this.material=t,this.doAlter(t))}doAlter(t){if(t.sell)for(let s in t.sell)Object.hasOwn(this.sell,s)?this.sell[s]+=t.sell[s]:this.sell[s]=t.sell[s];t.priceMod&&(this.sell instanceof Object?this.sell.gold=(this.sell.gold||0)+t.priceMod:typeof this.sell=="number"&&(this.sell+=t.priceMod),this.cost instanceof Object?this.cost.gold=(this.cost.gold||0)+t.priceMod:typeof this.cost=="number"&&(this.cost+=t.priceMod),this.sell==null&&this.cost==null&&(this.sell=t.priceMod)),t.type===Md?this.enchants+=t.level||0:t.level&&(this.level+=t.level),ea.doAlter.call(this,t)}calcMaxEnchants(){let t=0;this.template&&(t=this.template.enchants||0),console.log(this.id+" RECALC ENCHANT max: "+t),this.enchants.max=t}getEquipMod(){const t={};return this.armor&&(t.defense=+this.armor),this.evasion&&(t.dodge=+this.evasion),this.shield&&(t.barrier={max:+this.shield}),Ce({self:t},this.id,this)}equip(t){this.remod(t);let s=t.state.player;(this.type===Kt||this.attack)&&s.addWeapon(this)}remod(t){this.value=1,(this.armor||this.evasion||this.shield)&&t.applyMods(this.getEquipMod(),1),this.mod&&t.applyMods(this.mod,1);let s=t.state.player;s.defense.value.base=0}unequip(t){this.value=0,(this.armor||this.evasion||this.shield)&&t.removeMods(this.getEquipMod()),this.mod&&t.removeMods(this.mod);let s=t.state.player;(this.type===Kt||this.attack)&&s.removeWeapon(this)}convertMods(t){let s=typeof t;if(t instanceof Dt)return t;if(s==="object"){if(t.id)return new Dt(t,t.id,this);for(let i in t)t[i]=this.convertMods(t[i])}else if(s==="string"||s==="number")return new Dt(t,this.id,this);return t}}const ci="none";class Pm{constructor(t){this.items=t.filter(s=>!s.unique&&!s.noproc),this.filterBy={}}subgroup(){}randBelow(t=1,s){let i=this.filterBy.level,n=1+Math.floor(Math.random()*t),r=n;do{let l=i[r],a;if(l&&(a=s?im(l,s):ws(l),a))return a;--r<0&&(r=t)}while(r!==n);return null}randAt(t,s=!0){let n=this.filterBy.level[t];return(n==null?void 0:n.length)>0?ws(n):s?this.randCloseTo(t-3,s):null}randCloseTo(t,s=!0){let i=this.filterBy.level,n=[];for(let r=-2;r<3;r++){let l=i[t+r];(l==null?void 0:l.length)>0&&n.push(ws(l))}return(n==null?void 0:n.length)>0?ws(n):s?this.randCloseTo(t-5,t>5):null}rand(){return this.items.length===0?null:this.items[Math.floor(Math.random()*this.items.length)]}allBelow(t=1,s){const i=this.filterBy.level,n=[];let r=t;for(;r-->=0;){let l=i[r];if(!l)continue;let a=s?l.filter(s):l;a&&n.push(...a)}return n}filtered(t,s,i=!1){let n=this.filterBy[t],r=n[s]||[];return i&&n.hasOwnProperty(ci)?r.concat(n[ci]):r}getCategories(t,s,i){const n=this.filterBy[t],r=[];if(n===void 0)return r;if(i&&n.hasOwnProperty(ci)&&r.push(n[ci]),typeof s=="string")n.hasOwnProperty(s)&&r.push(n[s]);else if(Array.isArray(s))for(let l=s.length-1;l>=0;l--){const a=n[s[l]];a&&r.push(a)}return r}randBy(t,s,i=!1){return this.filterBy[t]===void 0?null:Array.isArray(s)?em(this.getCategories(t,s,i)):ws(this.filtered(t,s,i))}makeFilter(t,s,i="level"){const n=this.filterBy[t]={};s=s||t;for(let r=this.items.length-1;r>=0;r--){const l=this.items[r],a=l[s]||ci,o=n[a];o===void 0?n[a]=[l]:o.push(l)}if(i&&i!==s)for(const r in n)rm(n[r],i)}}const jm={beast:["animals","naturelore","summoning"],magicbeast:["magicbeasts","naturelore","summoning"],demon:["demonology","bloodlore","summoning","languages"],humanoid:["charms","languages","history"],undead:["necromancy","reanimation"],kell:["naturelore","runelore"],celestial:["lightlore","astrallore","divination"],construct:"crafting",elemental:["waterlore","firelore","earthlore","airlore","summoning"],giant:["charms","summoning","trickery"],ghost:["spiritlore","conjuration"],spirit:["spiritlore","divination","summoning"],deity:["spiritlore","divination"]},Um=(e,t,s)=>{let i=e[t];if(i===void 0)return 0;if(typeof i=="string"){let n=s.getData(i);return n?n.value:0}else{let n=0;for(let r=i.length-1;r>=0;r--){let l=s.getData(i[r]);l&&(n+=l.value)}return n}},Fm=(e,t)=>Um(jm,e,t),Hm=[{id:"iron",level:7},{id:"quicksteel",level:25},{id:"adamant",level:40},{id:"leather",level:7},{id:"serpentskin",level:25},{id:"aetherhide",level:40},{id:"cotton",level:7},{id:"spidersilk",level:25},{id:"amberroot",level:40},{id:"rubies",level:35},{id:"diamonds",level:50}],Hn=(e,t)=>{let s=new Cs(e);return s.value=1,s.name=e.name,s.id=t.state.nextId(e.id),s.revive(t.state),s.begin(),s},uo=e=>{let t=1;e.level!=null&&(isNaN(e.level)?console.warn(`Target ${e.id} level is NaN (${e.level})`):t=+e.level);let s=Math.max(1,t),i=4+Math.floor(Math.log10(s*2)*2500/(1+Math.pow(1.1,78-s))),n=2+Math.floor(Math.log10(s*50)*200/(1+Math.pow(1.12,76-s))),r={gold:{[mt]:new pe(50).toJSON(),value:new Mt(i+2,i*2-2).toJSON()}};return t>10&&(r.gems={[mt]:new pe(25).toJSON(),value:new Mt(t/50,t/10).toJSON()}),{level:t,hp:i,damage:n,speed:t,tohit:0,dodge:0,defense:0,chainhit:1,chaincast:.8,loot:r}};function Vm(e,t){const s=e.defaults??{};t==null&&(t=e.template??{});let i=t.statedata?Ht(t.statedata):{};for(let n of v.state.playerStats){let r=n.id,l=t[r]??s[r],a=i[r];a||(a=i[r]={}),!n.stat&&a.max==null&&(a.max=l),n.stat&&a.val==null&&(a.val=l)}return i}var Gr;let Ou=(Gr=class extends vt{get isRecipe(){return!0}toJSON(){return this.require?{value:this.value,locked:this.locked}:this.value>0?{value:this.value}:void 0}get attack(){return this._attack}set attack(t){if(t!=null)if(Array.isArray(t)){let s=[];for(let i=t.length-1;i>=0;i--)s.push(t[i]instanceof F?t[i]:new F(t[i]));this._attack=s}else this._attack=t instanceof F?t:new F(t)}get onDeath(){return this._onDeath}set onDeath(t){t!=null&&(this._onDeath=t instanceof F?t:new F(t))}get onHit(){return this._onHit}set onHit(t){t!=null&&(this._onHit=t instanceof F?t:new F(t))}get onMiss(){return this._onMiss}set onMiss(t){t!=null&&(this._onMiss=t instanceof F?t:new F(t))}get onSummon(){return this._onSummon}set onSummon(t){t!=null&&(this._onSummon=t instanceof F?t:new F(t))}constructor(t=null){t instanceof Object&&t.constructor.name==="Object"||console.log(`Non-object vars for ${t.id}`),super(t,uo),this.statedata&&Bi(this.statedata),this.type=ne,this.locked!=!1&&(this.locked=!!this.require),delete this.subInstance,delete this.instTemplate}canUse(t){return this.value<10||Fm(this.kind,t)<this.level?!1:super.canUse(t)}amount(t,s){s||(s=1),t.create(this,!1,s)}onCreate(t,s=je,i=!1,n=0){let r=t.getData("combat");if(!i&&n>0&&r.getMonsters(this.id,s).length>=n)return;let l=Hn(this,t);if(l.team=s,l.active=!i,i){let a=t.getData("minions",!1,!1);a?a.add(l):console.warn("Context does not have minions!",t.self.id)}else r.addNpc(l)}revive(t){let s=Vm(this,this.instTemplate);this.statedata=s,this.stateTemplate=this.subInstance?v.state.getData(this.id).stateTemplate:Gi(Ht(s));for(let i of v.state.playerStats){let n=i.id,r=i.template,l=this.statedata[n],{val:a,max:o}=l,h=i.stat||o==null?"val":"max";l[h]==null&&(a==null&&r.val!=null&&(l.val=a=r.val),!i.stat&&o==null&&r.max!=null&&(l.max=o=r.max),h=i.stat||o==null?"val":"max",l[h]==null&&(console.warn(`${this.id}'s ${n}'s ${h} is null during revival.`,l),l[h]=0)),a!=null&&(l.val=new Mt(a),l.val.id=`${this.id}.${n}.val`),!i.stat&&o!=null&&(l.max=new Mt(o),l.max.id=`${this.id}.${n}.max`),Object.defineProperty(this,n,{get(){return this.statedata[n][h]},set(f){this.statedata[n][h]=f},configurable:!0,enumerable:!0})}}maxed(){return!1}},_s(Gr,"GenDefaults",uo),Gr);class jr extends vt{toJSON(){if(!this.locked)return{id:this.id,locked:this.locked}}get hide(){return!1}get isRecipe(){return!0}get material(){return this._material}set material(t){this._material=t}get properties(){return this._properties}set properties(t){this._properties=Tu(t)}get locked(){return this._locked}set locked(t){this._locked=t}get armor(){return this._armor}set armor(t){this._armor=t}get attack(){return this._attack}set attack(t){this._attack=t}get kind(){return this._kind}set kind(t){this._kind=t}get slot(){return this._slot}set slot(t){this._slot=t}get craftcostmult(){return this._craftcostmult}set craftcostmult(t){this._craftcostmult=t}constructor(t=null){super(t),this.level=this.level||1,this.value=1,this.enchants==null&&(this.enchants=0),!this.require&&!this.need&&(this.locked=!1),this.attack&&(this.attack.damage||(this.attack.damage=this.attack.dmg)),this._craftcostmult||(this.craftcostmult=1)}instantiate(){return _t.add(this),this.type===Be||this.type===Kt||this.type===Gt?new mr(this.template):new ds(this.template)}hasUnique(){return v.state.hasUnique(this)}maxed(){return this.hasUnique()}isEquipped(){return(this.type===Be||this.type===Kt||this.type===Gt)&&v.state.equip.find(this.id,!0)!=null}blocked(){return this.locked||this.disabled}doUnlock(){this.disabled||this.locked===!1||(this.locked=!1,w.emit(Ji,this))}}class Vn{get isRecipe(){return!0}get exclude(){return this._exclude}set exclude(t){this._exclude=typeof t=="string"?t.split(","):t}get only(){return this._only}set only(t){this._only=typeof t=="string"?t.split(","):t}get alter(){return this._alter}set alter(t){this._alter=t}get locked(){return this._locked}set locked(t){this._locked=t}get disabled(){return this._disabled}set disabled(t){this._disabled=t}get require(){return this._require}set require(t){this._require=t}get craftcostmult(){return this._craftcostmult}set craftcostmult(t){this._craftcostmult=t}get attack(){return this._attack}set attack(t){if(t)if(Array.isArray(t)){let s=[];for(let i=t.length-1;i>=0;i--)s.push(t[i]instanceof F?t[i]:new F(t[i]));this._attack=s}else this._attack=[t instanceof F?t:new F(t)]}toJSON(){if(!this.locked)return{id:this.id,locked:this.locked}}constructor(t=null){t&&ge(this,t),this.alter&&(this.alter=Ce(this.alter,this.id,1)),(this._locked===void 0||this._locked===null)&&(this.locked=!0),this._craftcostmult||(this.craftcostmult=1)}blocked(){return this.locked||this.disabled}doUnlock(){this.disabled||this.locked===!1||this.locks>0||(this.locked=!1,w.emit(Ji,this))}}_e(Vn,Ee);const qm=(e,t)=>{let s=[],i=(void 0).length;for(let n=0;n<i;n++){let r=(void 0)[n];if(Array.isArray(r)){r=r.flatMap(e,t);for(let l=0;l<r.length;l++)s.push(r[l])}else s.push(e.call(t,r))}return s};function ti(e,t){if(!t)return console.warn("Missing gen item: "+t),null;let s=t.template||t.recipe;typeof s=="string"&&(s=e.getData(s));let i=s!==void 0&&s.type||t.type;if(!i){if(!t.id)return null;console.warn(t.id+" unknown type: "+i+" -> "+t.template+" -> "+t.recipe),i="item"}return i===Be||i===Kt||i===Gt?t=new mr(s,t):i===ne||i===er?t=new Cs(s,t):t=new ds(s,t),t.owned=!0,t.revive(e),t}class Bm{constructor(t){this.game=t,this.state=t.state,this.groups={},this.luck=this.state.getData("luck"),this.initGroup(Gt,this.state.weapons.concat(this.state.armors)),this.initGroup("materials",this.state.materials),this.initGroup("properties",this.state.properties),this.initGroup("craftingmaterials",Hm)}randEncounter(t,s,i=1){let n=t.level||1;return typeof n=="object"&&(n.type===Si?n=n.percent(i):n=n.value*i),t.range&&(n+=t.range*(-1+2*Math.random())),n=Math.ceil(n),this.groups.hasOwnProperty(me)||this.initGroup(me,this.state.encounters),this.groups[me].randAt(n)}randEnemy(t,s,i=1){if(this.groups.hasOwnProperty(ne)||this.initGroup(ne,this.state.monsters,["biome","kind"]),s)return randByBiome(t,s,i);let n=t.level||1,r=t.quantity||2;const l=t.quantitypenalty||.05;typeof n=="object"&&(n.type===Si?n=n.percent(i):n=n.value*i),r=Math.round(r),n*=Math.max(1-(r-1)*l,.1),n=Math.ceil(n);const a=[];for(let o=0;o<r;o++){const h=t.range?Math.max(1,n+t.range*(2*Math.random()-1)):n,f=this.groups[ne].randAt(Math.floor(h));a.push(Hn(f,this.game))}return a.length>0?a:null}randByBiome(t,s,i){}instance(t,s=null,i=1){let n;if(t.disabled||t.locked||this.state.hasUnique(t))return null;if(t.type===Be||t.type===Kt||t.type===Gt)return n=this.fromProto(t,s),n.owned=!0,n.updated(),n;if(t.type===Ph)n=new ds(t);else if(t.type===ll)n=new ds(t);else if(t.type===ne||t.type===er)return Hn(t,this.game);return n===void 0?null:(n.id=this.state.nextId(n.id),n.count=i||1,n.value=1,n.owned=!0,n.updated(),n)}getLoot(t,s=1){if(s instanceof pe){if(!s.roll(this.luck.value))return null;s=1}if(Array.isArray(t))return t.flatMap?t.flatMap(this.getLoot,this):qm.call(t,this.getLoot,this);if(typeof t=="string"&&(t=this.state.getData(t)),!t)return null;if(s[mt]){if(s[mt]instanceof pe){if(!s[mt].roll(+this.luck))return null}else if(100*Math.random()>s[mt])return null}if(t instanceof vt||t instanceof Wt)return this.getGData(t,s,t.maxlevel||null);if(t.id){let i=this.state.getData(t.id);return i instanceof vt||i instanceof Wt?this.getGData(i,s,t.material||t.level||t.maxlevel||s):this.instance(t)}else if(t.material||t.level||t.maxlevel)return this.randLoot(t,s);return this.objLoot(t)}objLoot(t){let s=[];for(const i in t){let n;if(i=="craftingmaterial"){let r=this.state.getData(this.groups.craftingmaterials.randBelow(t[i].level).id);n=this.getGData(r,1)}else n=this.getLoot(i,t[i]);if(n)Array.isArray(n)?s=sm(s,n):s.push(n);else continue}return s}getGData(t,s=1,i=null){if(!t||(t instanceof Wt&&(t=t.random()),this.state.hasUnique(t)))return null;if(t.instanced||t.isRecipe)return s=+(s==null?void 0:s.value)||+s||0,this.instance(t,i,s);if(typeof s=="object"&&s.skipLocked&&(t.disabled===!0||t.locks>0||t.locked!==!1))return null;if(s=+(s==null?void 0:s.value)||+s||0,typeof s=="number"||typeof s=="boolean"){if(t.type==="upgrade"||t.type===ir||t.type==="furniture"||t.type===jn)t.doUnlock(this.game);else if(t.amount(s),s>0)return t.name}else console.warn("bad amount: "+t+" -> "+s);return null}randLoot(t){let s=t.material,i=t.type,n=t.maxlevel||t.level||0;return n=+(n==null?void 0:n.value)||+n||0,s&&(typeof s=="string"?s=this.state.getData(s):s&&s.constructor===Object&&(s=this.randItemBelow(this.groups.materials,s,n)),s instanceof Wt&&(s=s.random())),i&&(typeof i=="string"?i=this.state.getData(i):i&&i.constructor===Object&&(i=this.randItemBelow(this.groups[Gt],i,n)),i instanceof Wt&&(i=i.random())),!i&&!s&&(i=this.groups[Gt].randBelow(n)),s&&!i?i=this.getCompatible(this.groups[Gt],s,n):i&&!s&&(s=this.getCompatible(this.groups.materials,i,n)),this.fromProto(i,s)}randItemBelow(t,s,i=0){let{only:n,exclude:r}=s;return i=s.maxlevel??s.level??i,typeof n=="string"&&(n=n.split(",")),typeof r=="string"&&(r=r.split(",")),t.randBelow(i,l=>{let a=[l.type,l.kind,l.id,...l.tags??[]];return!(n&&n.find(o=>a.includes(o))==null||r&&r.find(o=>a.includes(o))!=null)})}randAt(t=0,s=null,i=null){s=s||Gt;let n=this.groups[s];if(n){let r=n.randBy("level",t);if(r)return this.fromProto(r,i||t)}else console.warn("No group: "+s);return null}randBelow(t=1,s=null,i=null){s=s||Gt;let n=this.groups[s];t=Math.floor(1+Math.random()*t);let r=n.randBelow(t);return r?this.fromProto(r,i||t):null}getCompatible(t,s,i=null){let n=s.only,r=s.exclude,l=s.material?s.material.id:null,a=s.tags||[],o=i||s.level+1||1;return t.randBelow(o,h=>{let f=h.tags||[];return!(n&&!we(n,h.type,h.kind,h.id,...f)||r&&we(r,h.type,h.kind,h.id,...f)||h.only&&!we(h.only,s.type,s.kind,s.id,l,...a)||h.exclude&&we(h.exclude,s.type,s.kind,s.id,l,...a))})}getAllCompatible(t,s,i=null){let n=s.only,r=s.exclude,l=s.material?s.material.id:null,a=s.tags||[],o=i||s.level+1||1;return t.allBelow(o,h=>{if(h.blocked())return!1;let f=h.tags||[];return!(n&&!we(n,h.type,h.kind,h.id,...f)||r&&we(r,h.type,h.kind,h.id,...f)||h.only&&!we(h.only,s.type,s.kind,s.id,l,...a)||h.exclude&&we(h.exclude,s.type,s.kind,s.id,l,...a))})}fromProto(t,s=null){if(t==null)return null;let i=t.material||s;return typeof i=="string"?i=this.state.getData(i):!i instanceof Vn&&(i=+(i==null?void 0:i.value)||+i||0,i&&(i=this.getCompatible(this.groups.materials,t,i))),this.makeWearable(t,i)}genProperties(t,s){if(this.groups.properties,typeof s=="object"&&(s=Math.round(s.value)),!(s<=0))for(console.log(t.name+" props lvl: "+t.level+"  kind: "+t.kind),s;s>0;s--);}makeWearable(t,s){const i=new mr(t);return i.id=this.state.nextId(i.id),i.template=t,i.begin(this.game),s?i.applyMaterial(s):i.name=t.name||t.id,t.properties&&this.genProperties(i,t.properties),i}initGroup(t,s,i=null){if(!s){console.warn("group undefined: "+t);return}let n=this.groups[t]=new Pm(s);if(n.makeFilter("level"),i)for(let r of i)n.makeFilter(r);return n}}const Gm=e=>e.instanced?e:e.id,co="full",$i="ids";class Je{get count(){return this.items.length}valueOf(){return this.items.length}toJSON(){return{items:this.saveMode===co?this.items:this.saveMode===$i||!this.saveMap?this.items.map(t=>t.id):this.items.map(this.saveMap,this),max:this.max,countProp:this._cProp}}get saveMode(){return this._saveMode}set saveMode(t){this._saveMode=t}get saveMap(){return this._saveMap}set saveMap(t){this._saveMap=t}get spaceProp(){return this._spaceProp}set spaceProp(t){this._spaceProp=t}get countProp(){return this._cProp}set countProp(t){this._cProp=t}get used(){return this._used}set used(t){this._used=t}get name(){return this._name||this.id}set name(t){this._name=t}get max(){return this._max}set max(t){this._max=t instanceof N?t:new N(t,"max",0)}get removeDupes(){return this._removeDupes}set removeDupes(t){this._removeDupes=t}get items(){return this._items}set items(t){if(t)for(let s=t.length-1;s>=0;s--)(t[s]===null||t[s]===void 0)&&t.splice(s,1);this._items=t}get saveIds(){return this._saveIds}set saveIds(t){this._saveIds=t}[Symbol.iterator](){return this.items[Symbol.iterator]()}reverse(){return this._items.reverse()}toArray(){return this._items.slice(0)}constructor(t=null){t&&(typeof t=="string"?this.items=t.split(","):Array.isArray(t)?this.items=t:Object.assign(this,t)),this.items||(this.items=[]),this._cProp||(this._cProp="value"),this.saveMode||(this.saveMode=co),this.type="inventory",this.id||(this.id=this.type),this.max||(this.max=0)}begin(t){for(let s=this.items.length-1;s>=0;s--)typeof this.items[s].begin=="function"&&this.items[s].begin(t)}revive(t,s){const i=this.items.length,n=this.items.splice(0,i);for(let r=0;r<i;r++){let l=n[r];s?l=s(t,l):typeof l=="object"?l=ti(t,l):typeof l=="string"&&(l=t.getData(l)),this.add(l)}this.calcUsed()}add(t){if(t==null||typeof t!="object")return!1;if(Array.isArray(t))for(let s=t.length-1;s>=0;s--)this.add(t[s]);else{if(!t.id)return!1;if(t.stack&&this.addStack(t))return;if(this.full())return!1;if(this.removeDupes&&this.find(t.id))return console.log("removing: "+t.id),!1;this._items.push(t),this.used+=this.spaceCost(t)}_t.add(this)}cycleAdd(t){const s=this.spaceCost(t);if(this.max&&s>this.max)return!1;for(;this.items.length>0&&this.used+s>this.max;)this.removeAt(0);return this.add(t)}spaceCost(t){return this.spaceProp?t[this.spaceProp]||0:1}canAdd(t){return!this.max||this.max.value===0?!0:this.used+this.spaceCost(t)<=this.max.value}includes(t){return this.items.includes(t)}freeSpace(){return this.max?this.max-this.used:Number.MAX_SAFE_INTEGER}full(){return this.max>0&&this.used>=Math.floor(this.max.value)}randItem(){return this.items.length<=0?null:this.items[Math.floor(Math.random()*this.items.length)]}removeAll(){return this.used=0,this.items.splice(0,this.items.length)}remove(t){let s=this.items.indexOf(t);s<0||this.removeAt(s)}removeAt(t){let s=this.items[t];this.used-=this.spaceCost(s),this.items.splice(t,1)}move(t,s){let i=pl(this.items,t,s);return this.items=i,!0}moveInd(t,s){let i=mu(this.items,t,s);return this.items=i,!0}removeCount(t,s){t[this._cProp]-=s,t[this._cProp]<=0&&this.remove(t)}filter(t){return this.items.filter(t)}hasCount(t,s){return t=this.findMatch(t),t?s===1||t.stack&&t[this._cProp]>=s:!1}addStack(t,s){let i=this.findMatch(t);return i?(s==null&&(s=t.count??1),i.count.value<1&&console.warn("item in inv with >1 count",i),i.count+=s,i):null}findMatch(t){let s=t.id,i=t.recipe||t.id;return this.items.find(n=>n.id===s||i&&n.recipe===i)}find(t,s=!1){return s===!0?this.items.find(i=>i.id===t||i.recipe===t):this.items.find(i=>i.id===t)}calcUsed(){const t=this.spaceProp;let s=0;for(let i=this.items.length-1;i>=0;i--){const n=this.items[i];n?s+=t?n[t]||0:1:console.warn(this.id+" null Item in Inv: "+n)}this.used=s}}_e(Je,Ee);class qn{toJSON(){return{id:this.id,item:this.item,savedMax:this.oldMax,max:this.max}}get item(){return this._item}set item(t){this._item=t}get max(){return this._max}set max(t){if(this._max=t instanceof N?t:new N(t,"max",0),this._max.update!==N.prototype.update)return;this.oldMax=this._max.valueOf();let s=this._max.update.bind(this._max);this._max.update=()=>{let i=s();return i&&this.slotSizeChange(this._max.valueOf()),i}}constructor(t=null){t&&Object.assign(this,t),this.max||(this.max=this.max||0),this.item=this.item||(this.max>1?[]:null),this.multi=Array.isArray(this.item)}*[Symbol.iterator](){if(Array.isArray(this.item))for(let t=0;t<this.item.length;t++)yield this.item[t];else yield this.item}getItemIds(){if(this.item==null)return[];if(Array.isArray(this.item)){const t=[];for(let s=0;s<this.item.length;s++)t.push(this.item[s].id);return t}else return[this.item.id]}freeSpace(t){let s=t||this.max;if(this.item){if(s.valueOf()===1)return 0}else return s;if(!Array.isArray(this.item))return-1;for(let i=this.item.length-1;i>=0;i--)s-=this.item[i].numslots||1;return s}equip(t){const s=t.numslots||1;if(s>this.max)return!1;if(this.multi===!0)return this.addMult(t,s);if(this.item){const i=this.item;return this.item=t,t.updated(),i.updated(),i}else return t.updated(),this.item=t,!0}addMult(t,s){var i;if((i=this==null?void 0:this.item)!=null&&i.find(n=>n.id===t.id))return!1;t.updated(),this.item.push(t);for(let n=this.item.length-2;n>=0;n--)if(s+=this.item[n].numslots||1,s>this.max){const r=this.item.splice(0,n+1);return r.forEach(l=>l.updated()),r}return!0}find(t,s=!1){return this.item===null||this.item===void 0?null:s?this.multi?this.item.find(i=>i.id===t||i.recipe===t):this.item.id===t||this.item.recipe===t?this.item:null:this.multi?this.item.find(i=>i.id===t):this.item.id===t?this.item:null}match(t){return this.item===null?null:this.multi?this.item.find(t):t(this.item)?this.item:null}has(t){return this.multi===!1?this.item===t:this.item.includes(t)}remove(t=void 0){if(this.item===t)return t.updated(),this.item=null,t;if(t==null)return t=this.item,this.item=null,t&&t.updated(),t;if(this.multi||Array.isArray(this.item)){const s=this.item.indexOf(t);return s<0?!1:(t.updated(),this.item.splice(s,1)[0])}return!1}begin(t){if(!(this.item===null||this.item===void 0))if(Array.isArray(this.item))for(let s=this.item.length-1;s>=0;s--)this.item[s].begin(t);else this.item.begin(t)}revive(t){if(!(this.item===null||this.item===void 0))if(Array.isArray(this.item)){const s={},i=this.item;for(let n=i.length-1;n>=0;n--){const r=ti(t,i[n]);!r||s[r.id]===!0?i.splice(n,1):(i[n]=r,s[r.id]=!0)}}else this.item=ti(t,this.item)}hands(){return this.item!=null&&this.item.hands||0}empty(){return this.item===null||Array.isArray(this.item)&&this.item.length===0}hasTag(t){if(!this.item)return!1;if(Array.isArray(this.item)){const s=this.item;for(let i=s.length-1;i>=0;i--)if(s[i]&&s[i].tags&&s[i].tags.includes(t))return s[i]}else return this.item.tags&&this.item.tags.includes(t)}slotSizeChange(t){for(this.savedMax=this.savedMax||0;this.freeSpace()<0&&this.savedMax<=t&&this.item;)Array.isArray(this.item)?v.unequip(this,this.item[this.item.length-1]):v.unequip(this,this.item);if(this.savedMax==t&&(this.savedMax=null),this.oldMax=t,this.multi=Math.max(t,this.savedMax)>1,this.multi&&!Array.isArray(this.item)&&(this.item?this.item=[this.item]:this.item=[]),!this.multi&&Array.isArray(this.item)){for(;this.item.length>1;)v.unequip(this,this.item[this.item.length-1]);this.item=this.item[0]||null}}}_e(qn,Ee);class Wm{get slots(){return this._slots}set slots(t){for(const s in t)t[s]instanceof qn||(t[s]=new qn(t[s]));this._slots=t}constructor(t=null){t&&Object.assign(this,t)}find(t,s=!1){for(const i in this.slots){const n=this.slots[i].find(t,s);if(n)return n}return null}findAll(t){const s=[];for(const i in this.slots){const n=this.slots[i].match(t);n&&s.push(n)}return s}get(t){if(t=this.slots[t],t!==void 0)return t.item}freeSpace(t){return t=this.slots[t],t===void 0?0:t.freeSpace()}remove(t,s=null){return s=s||t.slot,typeof s=="string"&&(s=this.slots[s]),s?s.remove(t):!1}begin(t){for(let s in this.slots)this.slots[s].begin(t)}revive(t){for(let s in this.slots)this.slots[s].revive(t)}setSlot(t,s=null){return s=s||t.slot,s===null||!this.slots.hasOwnProperty(s)?!1:this.slots[s].equip(t)}*slotNames(){for(let t in this.slots)yield t}*[Symbol.iterator](){for(const t in this.slots){const s=this.slots[t].item;if(Array.isArray(s))for(let i=s.length-1;i>=0;i--)s[i]&&(yield s[i]);else s&&(yield s)}}}class Jm extends Wm{toJSON(){}constructor(t=null){super(t),this.slots={};for(let s of t)s.slotgroup=="equip"&&(this.slots[s.id]=s)}remove(t,s=null){return super.remove(t,s)}replaceCount(t){const s=this.freeSpace(t.slot);return Math.max((t.numslots||1)-s,0)}equip(t,s=null){return s=s||t.slot,s===null||!this.slots.hasOwnProperty(s)?(console.log(t.id+" bad equip slot: "+t.slot),!1):this.slots[s].equip(t)}getWeapon(){return this.slots.mainhand}redoSlots(){for(let t in this.slots)this.slots[t].slotSizeChange(this.slots[t]._max.valueOf())}}class Km extends Je{get maxAllies(){return this._allies.max}set maxAllies(t){this._allies.max=t}get allies(){return this._allies}set allies(t){this._allies=t}get keep(){return this._keep}set keep(t){this._keep=t}get mods(){return this._mods}set mods(t){this._mods=t}constructor(t=null){super(t),this.type=this.id="minions",this.max||(this.max=0),this._allies=new Je({id:"allies",name:"Active Minions Levels",spaceProp:"level",saveMode:$i}),this.mods=new Map}update(t){const s=game.state.explore.running;for(const i of this.items)i.alive&&(s&&i.active||i.rest(t))}add(t){super.add(t),t.team=je,t.keep=!0,t.active&&this.setActive(t);for(const[s,i]of this.mods)t.is(i)&&t.applyMods(s)}setActive(t,s=!0){if(s===!0){if(!t.alive||!this.allies.canAdd(t))return t.active=!1,!1;this.allies.includes(t)||this.allies.add(t)}else this.allies.remove(t);t.active=s}revive(t){super.revive(t),this.allies.max||(this.allies.max=Math.floor(t.player.level/5));const s=[];for(let i=this.items.length-1;i>=0;i--){const n=this.items[i];if(n.type!==er){this.items.splice(i,1);continue}n.active&&s.push(n)}this.allies.items=s,this.allies.calcUsed(),this.calcUsed(),w.add(su,this.resetActives,this)}applyMods(t,s){for(const i in t){const n=t[i];if(this[i])this[i]instanceof Vt?this[i].addMod(n):this[i].applyMods(n);else{this.mods.set(n,i);for(let r of this.items)r.is(i)&&r.applyMods(n,s)}}}resetActives(){let t=this.allies.items;for(let s=t.length-1;s>=0;s--)(!t[s].active||!t[s].alive)&&this.setActive(t[s],!1)}remove(t){super.remove(t),this.setActive(t,!1)}died(t){}}let sa=class{get id(){return"prox_"+(this.item?this.item.id:"")+"_"+(this.target?this.target.id:"")}get name(){return this.item?this.item.name:""}set name(t){}get instanced(){return!0}set count(t){}hasTag(t){return this.item&&this.item.hasTag(t)}hasTags(t){return this.item&&this.item.hasTag(t)}get buy(){return this.item?this.item.buy:null}get cost(){return this.item?this.item.cost:null}get run(){return this.item?this.item.run:null}get effect(){return this.item?this.item.effect:null}get level(){return this.item?this.item.level:0}get length(){return this.item?this.item.length:null}get perpetual(){return this._item?this._item.perpetual:!1}get item(){return this._item}set item(t){this._item=t}get repeat(){return this._item&&this._item.repeat||!1}get owned(){return this._item?this.item.owned:!1}set owned(t){this._item&&(this._item.owned=t)}get running(){return this.item?this.item.running:!1}set running(t){this.item&&(this.item.running=t)}isProxy(){return!0}maxed(t=0){return!this.item||this.item.maxed(t)}canUse(t){return this._item&&this._item.canUse(t)}canRun(t){return this._item&&this._item.canRun(t)}constructor(t=null){t&&ge(this,t)}amount(t){this._item&&this._item.amount(t)}revive(t){typeof this._item=="string"&&(this._item=t.findData(this._item))}};class zm extends sa{toJSON(){return{item:this.item?this.item.id:void 0,target:this.target?this.target.id:void 0,exp:this._exp}}get type(){return Ms}get target(){return this._target}set target(t){this._target=t}get exp(){return this._exp}set exp(t){this._exp=t}get running(){return this._item?this._item.running:!1}set running(t){this._item&&(this._item.running=t),this._target&&(this._target.running=t)}get repeat(){return this._item&&this._item.repeat||!1}percent(){return this._length?100*this._exp/this._length:0}get length(){return this._length}set length(t){this._length=t}canRun(t){return!this.done&&this._item&&this._target&&this._item.canAlter(this._target)}get done(){return this._exp>=this._length}constructor(t=null,s=null){super(),s?(this.target=s,this.item=t):t&&Object.assign(this,t),this.length=typeof this.item=="object"&&this.item.length||0,this.exp=this._exp||0}update(t){this.exp+=t,this.exp>this.length&&(this.target&&v.useOn(this.item,this.target),w.emit(rr,this,this.repeat),this.target=null)}onStop(){this.item.onStop&&this.item.onStop(this.target)}revive(t){super.revive(t),typeof this._target=="string"&&(this._target=t.findData(this._target)),this.item&&(this._length=this.item.length,this.item.resumeUseOn&&this.item.resumeUseOn(this.target))}}class Mu{get type(){return"runner"}hasTag(){return!1}constructor(t=null){t&&ge(this,t),this.id=this.type,this.name="activity",this.actives=this.actives||null,this.waiting=this.waiting||null,this.timers=new Set(this.timers||null)}toJSON(){return{max:this.max,waiting:this.waiting.map(t=>t.id),actives:this.actives.map(t=>t.id),timers:this.timers.size>0?Em(this.timers,t=>t.id):void 0}}get skillprogress(){let t=this.actives.find(s=>s.type===Wl);return t?t.exp:0}get encounterprogress(){let t=this.actives.find(s=>s.type===Gs);return t!=null&&t.enc?t.enc.exp:0}get taskprogress(){let t=this.actives.find(s=>s.type===ir);return t?t.exp:0}set skillprogress(t){}set encounterprogress(t){}set taskprogress(t){}addTimer(t){this.timers.add(t)}autoProgress(){this.actives.forEach(t=>{t.length&&(t.exp=t.length-.001)})}get context(){return this._context}set context(t){this._context=t}get running(){return this.actives.length}get free(){return Math.floor(this.max.valueOf())-this.actives.length}get max(){return this._max}set max(t){this._max?this._max.base=t instanceof N?t.base:t:this._max=t instanceof N?t:new N(t,"max",0)}revive(t){this.max=this._max||1,this.hobbies=t.getData(Jl),this.goals=t.getData(Kl),this.waiting=this.reviveList(this.waiting,t,!1),this.actives=this.reviveList(this.actives,t,!0),this.timers=Im(this.timers,s=>t.getData(s)),w.add(rr,this.actDone,this),w.add(ru,this.haltTask,this),w.add(lu,this.actBlocked,this),w.add(nu,this.stopAll,this),this.resumeTick=0}reviveList(t,s,i=!1){let n=[];if(!t)return n;for(let r of t)r=this.reviveTask(r,s,i),r&&n.push(r);return n}reviveTask(t,s,i=!1){if(t)return typeof t=="string"&&(t=s.getData(t),!t||!t.hasTag)?null:(t.running=i,t.controller?s.getData(t.controller):t)}beginUseOn(t,s){let i;return t.beginUseOn?i=t.beginUseOn(s):i=new zm(t,s),this.setTask(i)}toggleAct(t){this.actives.includes(t)?this.stopTask(t,Bt.USER,!1):this.setTask(t)}setTask(t,s){if(!t)return!1;if(t.cost&&t.exp.valueOf()===0&&!t.paid&&(this.context.payCost(t.cost),t.paid=!0),t.controller){let i=this.context.state.getData(t.controller);if(!i)return!1;i.runWith(t),t=i}return this.has(t)?w.emit(su):(this.runTask(t,s),this.trimActives(t)),!0}trimActives(t=null){let s=this.actives.length-Math.floor(this.max.valueOf());if(!(s<=0)){for(const i of this.actives)if(i!==t&&(this.stopTask(i,Bt.USER,!1),i.type===Ms&&this.addWait(i),--s<=0))return}}trimWaiting(){let t=this.waiting.length-5-Math.floor(+this.max);t>0&&this.waiting.splice(0,t)}actBlocked(t,s=Bt.USER,i=!0){this.stopTask(t,s),i&&this.addWait(t)}stopTask(t,s=Bt.USER,i=!0){t.runmod&&v.removeMods(t.runmod),t.baseTask&&t.baseTask.runmod&&v.removeMods(t.baseTask.runmod),t.onStop&&t.onStop(s),t.running=!1;let n=this.actives.indexOf(t);n>=0&&this.actives.splice(n,1),_t.add(this),i&&this.tryResume()}canPursuit(t){return this.hobbies.max>0&&t.type!==Ms&&!this.goals.includes(t)&&!this.goals.includes(t.baseTask)&&!t.noForcedAssignment}canGoal(t){return this.goals.max>0&&t.type!==Ms&&!this.hobbies.includes(t)&&!this.hobbies.includes(t.baseTask)&&!t.noForcedAssignment}baseTask(t){return t.baseTask||t}togglePursuit(t){t=this.baseTask(t),t&&(this.hobbies.includes(t)?this.hobbies.remove(t):this.hobbies.cycleAdd(t))}toggleGoal(t){t=this.baseTask(t),t&&(this.goals.includes(t)?this.goals.remove(t):this.goals.cycleAdd(t))}tryPursuit(){return this.free<=0?!1:!!this.hobbies.nextConditional(t=>this.tryAdd(t,0,!0))}tryGoal(){return this.free<=0?!1:!!this.goals.nextConditional(t=>this.tryAdd(t,0,!0))}getNextTask(t){let s=this.goals.nextConditional(r=>this.canAdd(r,t));if(s)return s;for(let r of this.waiting)if(this.canAdd(r,t))return r;let i=this.hobbies.nextConditional(r=>this.canAdd(r,t));if(i)return i;let n=this.context.state.restAction||v.getData("rest");return this.canAdd(n,t)?n:null}canAdd(t,s){if(t.controller){let i=this.getContoller(t);if(this.has(i)&&i.baseTask===t||s&&!i.canContinue(this.context,t))return!1}else if(this.has(t)||s&&!t.canContinue(this.context))return!1;return t.fill&&this.context.filled(t.fill,t)?!1:t.canRun(this.context)}tryAdd(t,s,i){return!this.free||!this.canAdd(t,i)?!1:this.setTask(t,s)}moveWaiting(t,s){let i=pl(this.waiting,t,s);return i&&(this.waiting=i),!0}moveActive(t,s){let i=pl(this.actives,t,s);return i&&(this.actives=i),!0}removeAct(t){}removeWait(t){let s=this.waiting.indexOf(t);return s<0?!1:(this.waiting.splice(s,1),!0)}addWait(t){t==null||t.hasTag(Cr)||this.waiting.includes(t)||this.hobbies.includes(t)||this.goals.includes(t)||t.maxed&&t.maxed()||t.max!=null&&+t>=t.max||t.baseTask!=null&&(this.waiting.includes(t.baseTask)||this.hobbies.includes(t.baseTask)||this.goals.includes(t.baseTask))||(this.waiting.push(t),this.trimWaiting())}haltTask(t,s=Bt.USER){t.controller&&(t=this.getContoller(t)),this.waiting.length===0&&t.hasTag(Cr)?this.stopTask(t,s,!1):this.stopTask(t,s)}actDone(t,s=!0){let i=t.baseTask||t;t.running===!1||!s||this.hobbies.items.includes(i)&&!this.hobbies.items.includes(this.getNextTask(!0))?this.stopTask(t,Bt.SUCCESS):s&&(this.context.canRun(i)&&this.free>=0?(this.setTask(i),t.hasTag(Cr)||this.tryResume()):this.actBlocked(t,Bt.CANTRUN))}stopAll(){let t=Array.from(this.actives);for(let s of t)this.stopTask(s,Bt.USER,!1);this.clearWaits()}clearWaits(){this.waiting.splice(0,this.waiting.length)}tryResume(){if(!(this.free<=0)){for(let t=this.goals.items.length;t>0;t--)if(this.tryGoal(),this.free<=0)return;for(let t=this.waiting.length-1;t>=0;t--){const s=this.waiting[t];if(s==null)this.waiting.splice(t,1);else if(this.tryAdd(s,null,!0)&&(this.waiting[t]===s&&this.waiting.splice(t,1),this.free<=0))return}for(let t=this.hobbies.items.length;t>0;t--)if(this.tryPursuit(),this.free<=0)return;this.tryRest(),this.resumeTick=0}}update(t){for(let s of this.actives)this.doTask(s,t);for(let s of this.timers){if(s==null||!s.id){this.timers.delete(s);continue}s.tick(t)&&this.timers.delete(s)}this.resumeTick+=t,this.resumeTick>=15&&this.tryResume()}tryRest(){let t=this.context.state.restAction||v.getData("rest");return this.tryAdd(t,0)}doTask(t,s){if(t.length==0&&t.perpetual==0||t.maxed())return this.stopTask(t,Bt.MAXED),!1;if(t.fill&&this.context.filled(t.fill,t))return this.actBlocked(t,Bt.FULL),!1;if(t.run){if(!this.context.canPay(t.run,s))return this.actBlocked(t,Bt.COST),!1;this.context.payCost(t.run,s)}return t.effect&&this.context.applyVars(t.effect,s),t.update&&t.update(s),!0}runTask(t,s){_t.add(this),t.running=!0,s==null?this.actives.push(t):this.actives.splice(s,0,t),t.onStart&&t.onStart(),t.runmod&&v.applyMods(t.runmod),t.baseTask&&t.baseTask.runmod&&v.applyMods(t.baseTask.runmod),this.removeWait(t)}has(t){return t.controller&&console.warn("runner has checking for task with controller:",t.id,t.controller),this.actives.includes(t)}hasType(t){let s=typeof t=="string"?t:t.type;return this.actives.find(i=>i.type===s)!=null}getContoller(t){return this.context.state.getData(t.controller)}}_e(Mu,Ee);class Es extends Vt{get value(){return super.value}set value(t){super.value=super.value+(t-super.value)*(1+this.scale.pctTot)}get scale(){return this._scale}set scale(t){this._scale=t}constructor(t=0,s,i=null){super(Number(t),s),this.scale=i||new Vt(0,this.id+".scale")}set(t){super.value=typeof t=="number"?t:t.valueOf()}addUnscaled(t){super.value+=t}apply(t,s=1){this.value=this.value+t*s}}const fo=Object.freeze({rate:1});class Xm extends vt{toJSON(){return this.exp!=0?{value:this.value,exp:this.exp,locked:this.locked}:this.value>0||this.require?{value:this.value,locked:this.locked}:void 0}get exp(){return this._exp}set exp(t){this._exp=t}get ex(){return this._exp}set ex(t){this._exp=t instanceof Es?t:new Es(t,this.id+".exp",this._rate)}get rate(){return this._rate}set rate(t){this._rate=t instanceof N?t:new N(t,this.id+".rate"),this.ex!==void 0&&(this.ex.scale=this._rate)}get length(){return this._length}set length(t){t==null?this._length=null:this._length=t instanceof N?t:new N(t)}get done(){return this._exp>=this.length}constructor(t=null,s=null){super(t),s&&Object.assign(this,s),this.type=me,this.exp instanceof Es||(this.ex=0),this.rate||(this.rate=new N(fo.rate,this.id+".rate")),this.rate.base||(this.rate.base=fo.rate),this.level||(this.level=1),this.length||(this.length=5*this.level),this._locked!=!1&&(this.locked=!!this.require)}update(t){this.exp.addUnscaled((this.rate||1)*t),this.effect&&v.applyVars(this.effect,t)}maxed(){return!1}}const mo=Object.freeze({rate:1});class ei extends vt{valueOf(){return this.locked?0:this.value.valueOf()}toJSON(){let t=super.toJSON()||{};return this.timer>0&&(t.timer=this.timer),t.attack&&(t.attack=void 0),t&&Object.keys(t).length?t:void 0}get level(){return this._level}set level(t){this._level=t}get morality(){return this._morality}set morality(t){this._morality=t}get runmod(){return this._runmod}set runmod(t){this._runmod=t}get ex(){return this._exp}set ex(t){this._exp=t instanceof Es?t:new Es(t,this.id+".exp",this._rate)}get exp(){return this._exp}set exp(t){if(!(this.locked||this.disabled||this.maxed()||this.buy&&!this.owned)){if((this._exp===null||this._exp===void 0)&&(this.ex=t),t<0){console.warn(this.id+" exp: "+t);return}t===1/0?this._exp.set(Number.MAX_VALUE):this._exp.set(t),this.tryComplete()}}get rate(){return this._rate}set rate(t){this._rate=t instanceof N?t:new N(t,this.id+".rate"),this.ex!==void 0&&(this.ex.scale=this._rate)}get length(){return this._length}set length(t){t==null?this._length=null:this._length=t instanceof N?t:new N(t)}get exclude(){return this._exclude}set exclude(t){this._exclude=typeof t=="string"?t.split(","):t}get only(){return this._only}set only(t){this._only=typeof t=="string"?t.split(","):t}get running(){return this._running}set running(t){this._running=t}get timer(){return this._timer}set timer(t){this._timer=t}percent(){return 100*(this._exp/this._length)}constructor(t=null){super(t),this.repeat=this.repeat!==!1,this.type="task",this.at&&(this.at=Ce(this.at,this.id,1)),this.every&&(this.every=Ce(this.every,this.id,this)),this.rate||(this.rate=new N(mo.rate,this.id+".rate")),this.rate.base||(this.rate.base=mo.rate),(this.length>0||this.perpetual>0)&&(this.exp instanceof Es||(this.ex=0),this.ex=this.ex||0),this.timer=this.timer||0,this.running=this.running||!1,dr(this.runmod,1)}fillsRequire(){return this.locked===!1&&this.value>0}applyImproves(){let t=this.valueOf();if(this.at)for(let s in this.at)t>=Number(s)&&this.applyMods(this.at[s]);if(this.every)for(let s in this.every)Math.floor(t/s)>0&&this.applyMods(this.every[s])}canUse(t){return!(this.timer>0)&&super.canUse(t)}canRun(t){return!(this.timer>0)&&super.canRun(t)}tryComplete(){(this._length&&this._exp>=this._length||!this._length>0&&this.perpetual>0&&this._exp>=1)&&this.complete(v)}update(t){this.exp.addUnscaled((this.rate||1)*t),this.tryComplete()}onStart(){this.runmod&&v.applyMods(this.runmod)}onStop(){this.runmod&&v.removeMods(this.runmod)}complete(t=v){this.changed(t,1),_t.add(this),this._exp.set(0),this.paid=!1,w.emit(rr,this)}changed(t,s){let i=+this;super.changed(t,s);let n=+this;if(this.at)for(const r in this.at)!isNaN(r)&&i<+r&&n>=+r?(w.emit(dl,this),this.applyMods(this.at[r])):!isNaN(r)&&i>=+r&&n<+r&&(w.emit(iu,this),this.removeMods(this.at[r]));if(this.every)for(const r in this.every){let l=Math.floor(n/+r)-Math.floor(i/+r);if(!isNaN(r)&&l>0){for(let a=0;a<l;a++)w.emit(dl,this);this.applyMods(this.every[r])}}}tick(t){return this.timer-=t,this.timer<0?(this.timer=0,!0):!1}}const po=e=>(e=v.getData(e),!e||v.state.hasUnique(e)||e.locked||e.disabled||e.locks>0?null:e.type===me?e.canUse()?e:null:Hn(e,v));class Ts{toJSON(){return this._w===1?this.ids:{ids:this.ids,w:this._w}}get w(){return this._w}set w(t){this._w=t}get ids(){return this._ids}set ids(t){typeof t=="string"&&t.includes(",")?this._ids=t.split(","):this._ids=t}constructor(t){typeof t=="string"||Array.isArray(t)?this.ids=t:typeof t=="object"&&(this.ids=t.ids,this.w=t.weight||t.w,typeof this.w=="string"&&(this.w=new Rt([C.GDATA],weight),this.w.setParameter(C.GDATA,v.gdata))),this.w==null&&(this.w=1)}instantiate(t=0){let s;if(typeof this.ids=="string")return s=po(this.ids),s===null?null:s.type===me?s:[s];{let i=[];if(typeof this.ids<"u")for(let n=0;n<this.ids.length;n++)s=po(this.ids[n]),s&&i.push(s);return i.length>0?i:null}}}class Ym{get type(){return this._type}set type(t){this._type=t}get level(){return this._level}set level(t){this._level=t}get range(){return this._range}set range(t){this._range=t}get quantity(){return this._quantity}set quantity(t){this._quantity=t}get quantitypenalty(){return this._quantitypenalty}set quantitypenalty(t){this._quantitypenalty=t}constructor(t){t?(this.level=t.level,this.range=t.range,this.quantity=t.quantity,this.quantitypenalty=t.quantitypenalty):console.warn("NO SPAWN PARAMS: "+t)}instantiate(t=0){return this.random(t)}random(t=0){return this.type!==me?v.itemGen.randEnemy(this,null,t):v.itemGen.randEncounter(this,null,t)}}const $m=e=>{if(typeof e=="object")return Array.isArray(e)?new Qm(e):new Ym(e)};class Qm{get groups(){return this._groups}set groups(t){this._groups=t}get weightTot(){return this.groups.reduce((t,s)=>{let i=+s.w;return isNaN(i)?(console.warn("isNaN weight",s,s.w),t):t+i},0)}constructor(t){this.initGroups(t)}random(t=0){let s=this.weightTot,i=[...this.groups];for(;i.length;){let n=Math.random()*s,r=0,l=i.length,a,o;for(o=0;o<l&&(a=i[o].w,r+=a,!(n<=r));o++);o>=l&&(console.warn(`Rolled weight ${n} exceeds total weight ${s} of ${l} items. Using last group`),o=l-1);let h=i[o].instantiate(t);if(h)return h;s-=a,i.splice(o,1)}return console.warn("Couldn't spawn anything",this.groups),null}initGroups(t){for(let s=t.length-1;s>=0;s--){let i=t[s];i instanceof Ts||(i=t[s]=new Ts(i))}this.groups=t}}const Zm=e=>Math.ceil(2+2500/(1+Math.pow(1.4,20-e))),tp=(e,t)=>e.dist>=t.dist,ep=(e,t)=>e.player.level>=t.level-1;class Mn extends ei{get once(){return this._once}set once(t){this._once=t}get encs(){return this._spawns}set encs(t){this.spawns=t}get spawns(){return this._spawns}set spawns(t){this._spawns=$m(t)}get bars(){return this._bars}set bars(t){this._bars=typeof t=="string"?t.split(","):t}get boss(){return this._boss}set boss(t){if(t===null||t instanceof Ts)this._boss=t;else if(typeof t=="object"&&!t.hasOwnProperty("ids")){for(let s in t)this.id==="mustylibrary"&&console.log("BOSS SUB: "+s),t[s]=new Ts(t[s]);this._boss=t}else this._boss=new Ts(t)}get controller(){return Gs}showLevel(){return this.difficulty?this.difficulty:this.level}constructor(t=null){super(t),(this.level===null||this.level===void 0)&&(this.level=1),this.type=Id,this.ex=this.ex||0,this.length||(this.length=20*this.level),this.require||(this.require=ep),(this.dist===void 0||this.dist===null)&&(this.dist=Zm(this.level)),this.need||(this.need=tp)}getEncounter(){let t=null;return this.hasBoss(this.boss,this.exp)&&(t=this.getBoss(this.boss),t)?t:this.spawns.random(this.percent()/100)}hasBoss(t,s){return t==null?!1:(s=Math.floor(s+1),t instanceof Ts?s==this.length:t.hasOwnProperty(s))}getBoss(t){if(!t)return null;if(t instanceof Ts)return t.instantiate();let s=Math.floor(this.exp+1);return t.hasOwnProperty(s)?t[s].instantiate():null}}const go=.05;class sp{get id(){return Gs}toJSON(){let t=this.enc;return{locale:this.locale?this.locale.id:void 0,enc:t?t.id:void 0,exhausted:this.exhausted||void 0}}get name(){return this.locale?this.locale.name:""}get cost(){return this.locale?this.locale.cost:null}get run(){return this.locale?this.locale.run:null}get unreturnable(){return this.locale?this.locale.unreturnable:null}get exhausted(){return this._exhausted}set exhausted(t){this._exhausted=t}get exp(){return this.locale?this.locale.exp:0}set exp(t){this.locale.exp.set(t),t>=this.locale.length&&this.complete()}get baseTask(){return this.locale}percent(){return this.locale?this.locale.percent():0}maxed(t=0){return!this.locale||this.locale.maxed(t)}canUse(){return this.locale&&!this.locale.maxed()}canRun(t){return this.locale&&!this.player.defeated()&&this.locale.canRun(t)}canContinue(t,s){if(s=s||this.locale,!s)return!1;if(this.exhausted){let i=[...this.player.defeators,...Object.keys(s.run||{}).map(n=>t.getData(n))];if(i.find(n=>n==null)&&(console.warn("Nullish value found in canContinue"),i=i.filter(n=>n==null)),i.find(n=>n.max?n.reverse?n>n.max*go:n<n.max*(1-go):!1))return!1;this.exhausted=!1}return!0}get effect(){return this.locale?this.locale.effect:null}set effect(t){}get length(){return this.locale?this.locale.length:0}get enc(){return this._enc}set enc(t){this._enc=t}get combat(){return this._combat}set combat(t){this._combat=t}get running(){return this._running}set running(t){this._running=t,this.combat&&(this.combat.active=t&&this.enc===this.combat)}get done(){return this.exp===this.length}constructor(t=null){t&&ge(this,t),this.running=!1,this.type=Gs,this._enc=this._enc||null,this.locale=this.locale||null}revive(t){if(this.state=t,this.player=t.player,this.spelllist=t.getData("spelllist"),w.add(fl,this.enemyDied,this),w.add(nr,this.charDied,this),typeof this.locale=="string"){let s=t.getData(this.locale);s instanceof Mn?this.locale=s:this.locale=null}else this.locale=null;this._enc&&(this.enc=t.getData(this._enc)),this.drops=t.drops,this.combat=t.combat,this.running&&(this.combat.active=this.combat===this.enc)}runWith(t){this.player.timer=fe(this.player.speed),t!=null?t!=this.locale?(this.enc=null,this.combat.reset(),t.exp=0,t.paid=!1):(this.combat.reenter(),this.enc&&this.enc.done&&this.nextEnc(),t.exp>=t.length&&(t.exp=0,t.paid=!1)):(this.enc=null,this.combat.reset()),this.locale=t}charDied(t){t!==this.player||!this.running||(this.player.luck>100*Math.random()&&(this.player.hp.value=Math.ceil(.25*this.player.hp.max),w.emit(Qt,"Lucky Recovery",this.player.name+" had a close call.")),this.emitDefeat())}onStart(){this.player.timer=fe(this.player.speed),this.exhausted=!1,this.locale&&this.locale.onStart&&this.locale.onStart()}onStop(t){var s;(s=this.locale)!=null&&s.onStop&&this.locale.onStop(t),this.unreturnable&&t!=Bt.SUCCESS&&this.reset(),this.locale&&t&Bt.MIDRUN_LOSS&&(this.exhausted=!0)}reset(){this.exp=0,this.combat.reset(),this.enc=null,this.locale=null,this.paid=!1}emitDefeat(){w.emit(Zh,this.locale||{name:"the locale"}),w.emit(lu,this,Bt.DEFEATED,!0),this.exhausted=!0}update(t){var s;this.locale==null||this.done||(this.enc===null?this.nextEnc():(this.enc!==this.combat&&this.player.explore(t),this.enc.update(t),(s=this.enc)!=null&&s.done&&(this.encDone(this.enc),this.exp+=1),this.player.defeated()&&this.emitDefeat()))}nextEnc(){if(!this.locale)return;const t=this.locale.getEncounter();t!==null&&(t.type===me?(this.enc=t,t.exp.set(0),w.emit(hu,t.name,t.desc)):(this.combat.setEnemies(t,this.exp/this.length),this.enc=this.combat)),this.combat.active=this.combat===this.enc}encDone(t){t!==this.combat&&(this.player.exp+=.75+Math.max(t.level-this.player.level,0),t.value++,t.result&&v.applyVars(t.result),t.loot&&v.getLoot(t.loot,this.drops),t.mod&&v.applyMods(t.mod),t.exp.set(t.length)),this.enc=null}enemyDied(t){if(this.player.exp+=Math.max(1.5*t.level-this.player.level,1),t.template&&t.template.id){let s=this.state.getData(t.template.id);s&&s.value++,_t.add(s)}t.result&&v.applyVars(t.result),t.loot&&v.getLoot(t.loot,this.drops)}complete(){let t=this.locale,s=v.getData("hobbies").items.includes(this.locale),i=v.getData("goals").items.includes(this.locale);t.amount(1);const n=Math.max(1+this.player.level-t.level,1);this.player.exp+=t.level*(15+t.length)/(.8*n),w.emit(rr,this,s||i),this.locale=null}hasTag(t){return t===Gs}}const xl="top",ip="rand",_o="loop";class Hs extends Je{toJSON(){let t=super.toJSON()||{};return t.lastInd=this.lastInd||void 0,t&&Object.keys(t).length?t:void 0}get lastInd(){return this._lastInd}set lastInd(t){this._lastInd=t}get order(){return this._order}set order(t){this._order=t}get used(){return this.recalcUsed()}set used(t){this._used=t}constructor(t=null){super(t),this.lastInd=this.lastInd||0,this.saveMode="custom",this.saveMap=Gm,this.order=this.order||_o}getRunnable(t,s){const i=this.items.length;if(i===0)return null;const n=this.nextInd();let r=n;do{const l=this.items[r];if(l.canRun(t)&&(!s||!(s instanceof Function)||s(l)))return this.lastInd=r,l;++r>=i&&(r=0)}while(r!==n);return null}canRun(t){for(let s=this.items.length-1;s>=0;s--)if(this.items[s].canRun(t))return!0;return!1}canUse(t){for(let s=this.items.length-1;s>=0;s--)if(this.items[s].canUse(t))return!0;return!1}curItem(){if(this.items.length>0)return this.items[this.nextInd()]}nextItem(){if(this.items.length>0)return this.lastInd=this.nextInd(),this.items[this.lastInd]}nextUsable(t){const s=this.items.length;if(s<=0)return null;const i=this.nextInd();let n=i,r=null,l=null;do{const a=this.items[n];if(a.canUse(t)){if(a.caststoppers){for(let o of a.caststoppers)if(r=t.self.getCause(o),r){l=r;break}}if(r)r=null;else return a.cost&&t.payCost(a.cost),this.lastInd=n,a}++n>=s&&(n=0)}while(n!==i);return l&&w.emit(ue,t.self,l),null}nextConditional(t){if(!t||!(t instanceof Function))return this.nextItem()||null;const s=this.items.length;if(s===0)return null;const i=this.nextInd();let n=i;do{const r=this.items[n];if(t(r))return this.lastInd=n,r;++n>=s&&(n=0)}while(n!==i);return null}onUse(t){const s=this.nextUsable(t);return s?(s.onUse(t),s):null}nextInd(){return this.order===_o?this.lastInd+1<this.items.length?this.lastInd+1:0:this.order===xl?0:this.order===ip?Math.floor(Math.random()*this.items.length):0}dataDeleted(t){this.remove(t)}revive(t,s=null){super.revive(t,s),w.add(Ki,this.dataDeleted,this)}recalcUsed(){const t=this.spaceProp;let s=0;for(let i=this.items.length-1;i>=0;i--){const n=this.items[i];n?s+=t?n[t]||0:1:console.warn(this.id+" null Item in Inv: "+n)}return s}}class pr{toJSON(){return{id:this.id,items:this.items.map(t=>t.id),name:this.name,type:this.type,val:this.value,custom:"group"}}get id(){return this._id}set id(t){this._id=t}get name(){return this._name}set name(t){this._name=t}get items(){return this._items}set items(t){const s=[];let i=0;if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(r==null){t.splice(n,1),s.splice(n,1);continue}typeof r=="object"&&(i+=r.level||0),s[n]=r}this.level=i,this._items=s}get type(){return this._type}set type(t){this._type=t}get level(){return this._level}set level(t){this._level=t}get cost(){return this.computeCost(!1)}set cost(t){this._cost=t}get cd(){let t=null;for(let s=this.items.length-1;s>=0;s--)this.items[s].cd&&(t=Math.max(t,this.items[s].cd));return t}get timer(){let t=null;for(let s=this.items.length-1;s>=0;s--)this.items[s].timer&&(t=Math.max(t,this.items[s].timer));return t}get caststoppers(){return this.computeCaststoppers()}get locked(){return!1}get owned(){return!0}maxed(){return!1}constructor(t=null){t&&ge(this,t),this.items||(this.items=null)}computeCost(t=!0){if(!this.items||this.items.length===0){t&&this._cost!=null&&(this.cost=null);return}let s={};for(let i=this.items.length-1;i>=0;i--){let n=this.items[i];n?n.cost&&Au(s,n.cost):this.items.splice(i,1)}return t&&(this.effect=this.items.map(i=>typeof i=="string"?i:i.name),this.cost=s),s}computeCaststoppers(){if(!this.items||this.items.length===0)return;let t=[];for(let s=this.items.length-1;s>=0;s--){let i=this.items[s];if(!i){this.items.splice(s,1);continue}if(i.caststoppers)for(let n of i.caststoppers)t.includes(n)||t.push(n)}return t}canUse(t){for(let s=this.items.length-1;s>=0;s--)if(!this.items[s].canUse(t))return!1;return t.canPay(this.cost)}onUse(t){let s=this.items.length;for(let i=0;i<s;i++)this.items[i].onUse(t)}add(t){this.items.push(t)}amount(t){let s=this.items.length;for(let i=0;i<s;i++)this.items[i].amount(t)}applyVars(t,s=1){let i=this.items.length;for(let n=0;n<i;n++)this.items[n].applyVars(t,s)}applyMods(t,s=1,i,n,r,l,a){const o=this.items.length;for(let h=0;h<o;h++){const f=this.items[h];f.applyMods(t,s,f,n,r,l,a)}}reviveSpecial(t){this.items=t.toData(this.items),this.computeCost()}}_e(pr,Ee);class np extends Je{constructor(t=null){super(t),this.id="spellLoadouts",this.name="Spell Loadouts",this.saveMode=$i}revive(t){super.revive(t),this.state=t}create(t,s=null,i=null){let n=new pr;return n.id=t.nextId("spelllist"),n.type="spelllist",n.name=i||"new spell list",s==="init"&&console.warn("Cloning list from default"),s&&(n.items=t.spelllist.items),t.addItem(n),this.add(n),n}removeAt(t){let s=this.items[t];s&&(w.emit(Ki,s),super.removeAt(t))}changeLoadout(t,s){let i=t.currentSpellLoadout;if(i==s)return;let n=t.spellLoadouts.items.find(l=>l.id===i);n.items=t.spelllist.items,t.spelllist.items=n.items,t.spelllist.calcUsed(),t.currentSpellLoadout=s;let r=t.spellLoadouts.items.find(l=>l.id===s);t.spelllist.items=r.items,t.spelllist.calcUsed(),t.spelllist.lastInd=1e4}}class rp extends Je{constructor(t=null){super(t),this.id="userSpells",this.name="Crafted Spells",this.saveMode=$i}revive(t){super.revive(t),this.state=t;for(let s of this.items)s.school||(s.school="crafted")}removeAt(t){let s=this.items[t];s&&(w.emit(Ki,s),super.removeAt(t))}create(t,s,i=null){let n=new pr;return n.school="crafted",n.items=t,n.id=s.nextId("spell"),n.type="spell",n.name=i||"new spell",n.computeCost(),s.addItem(n),this.add(n),n}}class lp extends sa{toJSON(){if(this._item||this.recipe)return this.recipe?{item:this.item.id,recipe:this.recipe}:this._item.id}get name(){return super.item?super.item.name&&super.item.name!==void 0?super.item.name.toTitleCase():this.recipe||"":this.recipe||""}get item(){return super.item}set item(t){super.item=t,t&&typeof t=="object"?t.id!==this.recipe&&(this.recipe=t.recipe||null):this.recipe=null}get recipe(){return this._recipe}set recipe(t){this._recipe=t}constructor(t=null){super(),t?typeof t=="string"?(this.item=t,this.recipe=null):typeof t=="object"&&(this.item=t.item,this.recipe=t.recipe):(this.item=null,this.recipe=null)}slotTarget(t){return this.item&&!this.recipe?this.item:this.item&&this.item.count>0?this.item:this.recipe?t.state.findInstance(this.recipe,!0):null}onUse(t){let s=this.slotTarget(t);s!=null&&s.value>0&&s.onUse(t)}revive(t){if(this.item){const s=t.findData(this.item,!1);if(s){this.item=s;return}this.item=null}if(this.recipe){let s=this.recipe;this.item=t.findInstance(s,!0)||t.getData(s)}}}const ap=10;let yo=class{toJSON(){return{slots:this.slots}}get slots(){return this._slots}set slots(t){if(t==null)return;let s=[];for(let i=0;i<ap;i++)s[i]=new lp(t[i]);this._slots=s}constructor(t=null){Array.isArray(t)?this.slots=t:t?(Object.assign(this,t),t.slots||(this.slots=[])):this.slots=[]}revive(t){for(let s=this._slots.length-1;s>=0;s--)this._slots[s].revive(t)}remove(t){for(const s in this.slots){const i=this.slots[s];i&&i.item&&i.id===t&&this.clear(s)}}clear(t){this.slots[t].item=null}setSlot(t,s){if(!(t&&t.type===sr)&&s>=0&&s<=9){let i=s>0?s-1:9;this.slots[i].item=t}}getSlot(t){return this._slots[t>0?t-1:9]}};class op{toJSON(){return{bars:this.bars,index:this.index,max:this.max}}get bars(){return this._bars}set bars(t){if(!Array.isArray(t)){console.warn("NONARRAY: "+t);return}for(let s=t.length-1;s>=0;s--)t[s]=t[s]instanceof yo?t[s]:new yo(t[s]);this._bars=t}get active(){return this._active}get index(){return this._index}set index(t){this._index=t}constructor(t=null){t&&Object.assign(this,t),(!this.bars||this.bars.length===0)&&(this.bars=[{}]),this.max||(this.max=new N(1,"quickbars.max"))}next(){++this._index>=this.bars.length&&(this._index=0),this._active=this._bars[this._index]}prev(){--this._index<0&&(this._index=this._bars.length-1),this._active=this._bars[this._index]}dataDeleted(t){if(t)for(let s=this.bars.length-1;s>=0;s--)this._bars[s].remove(t.id)}revive(t){for(let s=this.bars.length-1;s>=0;s--)this._bars[s].revive(t);this._index=this._index||0,this._active=this._bars[this._index],w.add(Ki,this.dataDeleted,this)}}class Cn extends sa{toJSON(){return{item:this.item.id,target:this.target,exp:this._exp}}get type(){return Ms}get controller(){return Qs}get target(){return this._target}set target(t){this._target=t}get exp(){return this._exp}set exp(t){this._exp=t}percent(){return this._length?Math.round(100*this._exp/this._length):0}get length(){return this._length}set length(t){this._length=new N(t)}canRun(t){return!this.done&&this._item&&this._target&&this._item.canAlter(this._target)}get done(){return this._exp>=this._length}constructor(t=null,s=null){super(),s?(this.target=s,this.item=t):t&&ge(this,t),this.length=typeof this.item=="object"&&this.item.length||0,this.exp=this._exp||0}update(t){this.exp+=t,this.exp>=this.length&&this.target&&this.target.doAlter(this.item)}revive(t){super.revive(t),typeof this._target=="string"?this.target=t.findData(this._target):typeof this._target=="object"&&(this._target=ti(t,this._target)),this.item&&(this._length=this.item.length)}}class Cu extends ei{get isRecipe(){return!0}get only(){return this._only}set only(t){this._only=typeof t=="string"?t.split(","):t}get controller(){return Qs}constructor(t){super(t),this.verb=this.verb||"enchanting",this.level=this.level||1,this.need=this.need||"enchantsource",this.alter&&dr(this.alter,1)}beginUseOn(t){return new Cn(this,t)}complete(){}useOn(t,s){t&&t.doAlter(this)}canAlter(t){return t.hasEnchant(this.id)||t.enchants+this.level>t.enchants.max?!1:!this.only||Un(this.only,t)}}class hp extends Je{get exp(){return this._exp}set exp(t){this._exp=t}get length(){return this._length}set length(t){this._length=t}percent(){return this._length>0?Math.round(100*this.exp/this.length):0}constructor(t){super(t),this.id=Qs,this.name="Enchanting Power",this.spaceProp="level",this.removeDupes=!0,this.noForcedAssignment=!0,this._exp=0,this._length=0}maxed(){for(let t=this.items.length-1;t>=0;t--)if(!this.items[t].done)return!1;return!0}revive(t){let s=0,i=0;for(let n=this.items.length-1;n>=0;n--){const r=new Cn(this.items[n]);if(!r){console.warn("invalid enchanting: "+n),this.items.splice(n,1);continue}if(r.revive(t),!r||r.target===null||r.target===void 0||!(r.item instanceof Cu)){r.target!==null&&r.target!==void 0&&v.state.inventory.add(r.target),this.items.splice(n,1);continue}else s+=r.length,i+=r.exp;this.items[n]=r}this.exp=i,this.length=s,this.calcUsed()}update(t){let s=0,i=0;for(let n=this.items.length-1;n>=0;n--){const r=this.items[n];r.done||(r.update(t),s+=r.length,i+=r.exp)}this.exp=i,this.length=s}runWith(t){!this.includes(t)&&t instanceof Cn&&super.add(t)}add(t,s=null){if(t.type===Ms)super.add(t);else if(t&&s){let i=new Cn(s,t);super.add(i)}}findItem(t,s=!1){return s===!0?this.items.find(i=>i._target.id===t||i._target.recipe===t):this.items.find(i=>i._target.id===t)}remove(t){t.type!==Ms&&(t=this.items.find(s=>s.targ===t),!t)||super.remove(t)}begin(t){for(let s=this.items.length-1;s>=0;s--)typeof this.items[s].target.begin=="function"&&this.items[s].target.begin(t)}}class up{get id(){return"combat"}toJSON(){let t;if(this.allies.length>1){t=[];for(let s=1;s<this.allies.length;s++){const i=this.allies[s];t.push(i.keep?i.id:i)}}return{enemies:this._enemies,allies:t}}get active(){return this._active}set active(t){this._active=t}get enemies(){return this._enemies}set enemies(t){this._enemies=t}get allies(){return this._allies}set allies(t){this._allies=t}get done(){return this._enemies.length===0}get teams(){return this._teams}constructor(t=null){t&&ge(this,t),this.enemies||(this.enemies=[]),this.allies||(this.allies=[]),this.active=!1,this._teams=[]}revive(t){this.state=t,this.player=t.player;let s;for(let i=this._enemies.length-1;i>=0;i--)s=this._enemies[i],s&&(s=this._enemies[i]=ti(t,s)),(!s||!(s instanceof Cs))&&this._enemies.splice(i,1);for(let i=this._allies.length-1;i>=0;i--)s=this._allies[i],typeof s=="string"?this._allies[i]=s=t.minions.find(s):s&&typeof s=="object"&&!(s instanceof Cs)&&(this._allies[i]=s=ti(t,s)),(!s||!(s instanceof Cs))&&this._allies.splice(i,1);this._allies.unshift(this.player),this.resetTeamArrays(),w.add(au,this.itemAction,this),w.add(lr,this.spellAction,this),w.add(ou,this.dotAction,this),w.add(se,this.triggerAction,this),w.add(nr,this.charDied,this)}begin(){for(let t of this.enemies)t.begin instanceof Function&&t.begin()}update(t){if(this.player.alive===!1)return;let s,i;for(let n=this._allies.length-1;n>=0;n--){const r=this._allies[n];if(r){if(n>0){if(r.alive===!1){r.deathThroes(),this._allies.splice(n,1);continue}if(r.update(t),r.alive===!1){r.deathThroes(),this._allies.splice(n,1);continue}}if(i=r.combat(t),i)if(Array.isArray(i))for(let l of i)l.canAttack()?this.attack(r,l):w.emit(ue,r,l);else i.canAttack()?this.attack(r,i):w.emit(ue,r,i);else continue}}for(let n=this._enemies.length-1;n>=0;n--)if(s=this._enemies[n],!!s){if(s.alive===!1){s.deathThroes(),this._enemies.splice(n,1),w.emit(fl,s),this._enemies.length===0&&w.emit(ro);continue}if(s.update(t),s.alive===!1){s.deathThroes(),this._enemies.splice(n,1),w.emit(fl,s),this._enemies.length===0&&w.emit(ro);continue}if(i=s.combat(t),i)if(Array.isArray(i))for(let r of i)r.canAttack()?this.attack(s,r):w.emit(ue,s,r);else i.canAttack()?this.attack(s,i):w.emit(ue,s,i);else continue}}spellAction(t,s){if(t.caststoppers)for(const i of t.caststoppers){const n=s.self.getCause(i);if(n){w.emit(ue,s.self,n);return}}if(w.emit(Qt,s.self.name.toTitleCase()+" Casts "+t.name.toTitleCase()),t.attack&&this.attack(s.self,t.attack),t.action){const i=this.getTarget(s.self,t.action);if(!i)return;if(Array.isArray(i))for(let n=i.length-1;n>=0;n--)Ze(i[n],t.action,s.self,this.player);else Ze(i,t.action,s.self,this.player)}}itemAction(t,s){if(w.emit(Qt,null,s.self.name+" Uses "+t.name.toTitleCase()),t.use.attack&&this.attack(s.self,t.use.attack),t.use.action){let i=this.getTarget(s.self,t.use.action);if(!i)return;if(Array.isArray(i))for(let n=i.length-1;n>=0;n--)Ze(i[n],t.use.action,s.self,this.player);else Ze(i,t.use.action,s.self,this.player)}}dotAction(t,s){if(t.attack&&this.attack(s.self,t.getAttack()),t.action){let i=this.getTarget(s.self,t.action);if(!i)return;if(Array.isArray(i))for(let n=i.length-1;n>=0;n--)Ze(i[n],t.action,s.self,this.player);else Ze(i,t.action,s.self,this.player)}}triggerAction(t,s,i=null){t&&this.attack(s.self,t,i)}attack(t,s,i=null){if(s.log&&w.emit(Qt,null,s.log),s.hits)for(let r in s.hits)this.attack(t,s.hits[r],i);let n=i&&s.targets==ku?i:this.getTarget(t,s);if(n)for(let r=0;r<(s.repeathits||1);r++)if(Array.isArray(n))for(let l=n.length-1;l>=0;l--)this.doAttack(t,s,n[l]);else this.doAttack(t,s,n)}doAttack(t,s,i){(!i||!i.alive)&&i.id!=t.id||(s.harmless||!i.canDefend()||this.tryHit(t,i,s))&&Ze(i,s,t,this.player)}getTarget(t,s){const i=t.retarget(s.targets??H.enemy);if(i==bu)return t;let n=this.allies.filter(_=>_.alive),r=this.enemies.filter(_=>_.alive);if(t.team==al){const _=n;n=r,r=_}if(i&Ws){let _=n.findIndex(x=>x.id==t.id);_>=0&&n.splice(_,1)}let l=[];n.length>0&&(i&Qe?i&ee?l=n:l.push(n[0]):i&ee&&(l=n.slice(1))),this.active&&r.length>0&&(i&Te?i&he?l.push.apply(l,r):l.push(r[0]):i&he&&l.push.apply(l,r.slice(1))),l=Ld(l,s.only),hm(l),s.targetspec&&(l=um(l,s.targetspec));var a=s.maxTargets??i&xe?An*2:1;if(a>=l.length)return l;const o=i&Te+he,h=i&Te,f=Math.random()<.5?1:-1;return l.sort((_,x)=>{if(o){if(_.hasState(gi)&&!x.hasState(gi))return-1;if(!_.hasState(gi)&&x.hasState(gi)||_.hasState(_i)&&!x.hasState(_i))return 1;if(!_.hasState(_i)&&x.hasState(_i))return-1}const T=cm(_,x,s.targetspec);if(T!=0)return T;if(h){if(_==r[0])return f;if(x==r[0])return-f}return 0}),a==1?l[0]:l.slice(0,a)}tryHit(t,s,i){var r;let n=t.getHit();if(i&&i!=t&&(n+=i.tohit||0),!i.nododge&&this.dodgeRoll(s,n)){if(w.emit(tu,s.name.toTitleCase()+" Dodges "+(i.name??t.name).toTitleCase()),!s.getCause(Ql)&&t&&!i.unreflectable){s.onMiss&&w.emit(se,s.onMiss,s.context,t);const l=s.dots;for(let a=l.length-1;a>=0;a--){const o=l[a];o.onMiss&&w.emit(se,o.onMiss,s.context,t),o.conditionaction&&w.emit(se,(r=o.conditionaction)==null?void 0:r.onMiss,s.context,t)}}return!1}else return!0}setEnemies(t){this.enemies.push.apply(this.enemies,t),t.length>0&&(t[0]?w.emit(Qt,t[0].name.toTitleCase()+" Encountered"):console.warn("No valid enemy")),this.resetTeamArrays(),this.setTimers();for(let s=this.enemies.length-1;s>=0;s--)this.enemies[s].onSummon&&this.enemies[s].openingAction()}addNpc(t){if(t.timer=fe(t.speed),t.team===je)if(this._allies.length<An)this._allies.push(t);else{w.emit(ml,t.name,"allies");return}else if(this._enemies.length<An)this._enemies.push(t);else{w.emit(ml,t.name,"enemies");return}this.teams[Za].push(t),t.onSummon&&t.openingAction()}resetTeamArrays(){this.teams[je]=this.allies,this.teams[al]=this.enemies,this.teams[Za]=this.allies.concat(this.enemies)}reenter(){this.allies=this.state.minions.allies.toArray();let t=this.state.getSlot(jh);t&&t.onCreate&&t.onCreate(v,je,!1),this.allies.unshift(this.player),this.resetTeamArrays()}reset(){this._enemies.splice(0,this.enemies.length),this.reenter()}setTimers(){let t=fe(this.player.speed),s;for(let i=this.enemies.length-1;i>=0;i--)s=this.enemies[i].timer=fe(this.enemies[i].speed),s<t&&(t=s);for(let i=this.allies.length-1;i>=1;i--)s=this.allies[i].timer=fe(this.allies[i].speed),s<t&&(t=s);t-=1;for(let i=this.enemies.length-1;i>=0;i--)this.enemies[i].timer-=t;for(let i=this.allies.length-1;i>=1;i--)this.allies[i].timer-=t}dodgeRoll(t,s){return t.getDodgeChance(s)>Math.random()}charDied(t,s){t!==this.player&&(t.team===je?w.emit(Yh,t):w.emit($h,t,s))}getMonsters(t,s){var n,r;let i=[];if(s===je)for(let l=0;l<this._allies.length;l++)this._allies[l].template&&((n=this._allies[l])==null?void 0:n.template.id)==t&&this._allies[l].alive==!0&&i.push(this._allies[l]);else for(let l=0;l<this._enemies.length;l++)((r=this._enemies[l])==null?void 0:r.template.id)==t&&this._enemies[l].alive==!0&&i.push(this._enemies[l]);return i}}const fi="rest",cp=e=>new Hs(e);class fp{toJSON(){let t={};for(let i in this.slots)this.slots[i]&&(t[i]=this.slots[i].id);return{version:"stable 0.0.2",pid:this.pid,lastUpdate:this.lastUpdate,name:this.player.name,items:this.saveItems,bars:this.bars,slots:t,equip:this.equip,combat:this.combat,drops:this.drops,explore:this.explore,sellRate:this.sellRate,currentSpellLoadout:this.currentSpellLoadout,NEXT_ID:this.NEXT_ID}}get modules(){return this._modules}set modules(t){this._modules=t}nextId(t=""){return t+"_"+this.nextIdNum()}nextIdNum(){return this.NEXT_ID++}constructor(t){var s,i;if(Object.assign(this,t),this.lastUpdate=this.lastUpdate??Date.now(),this.saveItems={},this.inventories=new Map,this.NEXT_ID=this.NEXT_ID||0,this.pid||(this.pid=this.player.hid||Ih("p"),this.player.hid?console.log("USING LEGACY HID: "+this.player.hid):console.log("GENERATING NEW PLAYERID: "+this.pid)),this.initSlots(),this.bars=new op(t.bars||{bars:[t.quickbar]}),this.inventory=new Je(this.items.inv||t.inventory||{max:3,countProp:"count"}),this.inventory.countProp="count",this.items.inv=this.inventory,this.inventory.removeDupes=!0,this.self=this.player,this.drops=new Je(t.drops),this.items[Qs]=new hp(this.items[Qs]),this.items.minions=this.minions=new Km(t.items.minions||null),this.equip=new Jm(this.equipslots),this.initStats(),this.combat=new up(t.combat),this.explore=new sp(t.explore),this.runner=this.items.runner=new Mu(this.items.runner),this.prepItems(),this.userSpells=this.items.userSpells=new rp(this.items.userSpells),this.items.spelllist=this.spelllist=new Hs(this.items.spelllist),this.items.scraftlist=this.scraftlist=new Hs({items:(i=(s=this.items)==null?void 0:s.scraftlist)==null?void 0:i.items,spaceProp:"level",id:"scraftlist",name:"spellcraft level"}),this.spelllist.spaceProp="level",this.spelllist.id="spelllist",this.spelllist.name="spelllist level",this.items.spellLoadouts=this.spellLoadouts=new np(this.items.spellLoadouts),!this.currentSpellLoadout){if(this.items.spellLoadouts.items[0]===void 0){this.spellLoadouts.create(this,"init","Default Spell List");const n=this.spellLoadouts.items[0].id;this.spellLoadouts.items[0]=this.findData(n)}this.currentSpellLoadout=this.spellLoadouts.items[0].id}this.items.currentSpellLoadout=this.currentSpellLoadout,this.items.hobbies=new Hs(this.items.hobbies),this.items.goals=new Hs(this.items.goals),this.items.hobbies.id=Jl,this.items.hobbies.order=xl,this.items.goals.id=Kl,this.items.goals.order=xl}revive(){console.log("Reviving GameState Items"),this.reviveItems(),this.reviveSpecial(),this.bars.revive(this),this.spelllist.calcUsed(),this.scraftlist.calcUsed(),this.items.allies=this.minions.allies,this.saveItems.allies=void 0}initStats(){this.sellRate=this.sellRate||new N(.5,"sellRate")}prepItems(){for(const t in this.items){const s=this.items[t];if(!s){console.warn("prepItems() item undefined: "+t),delete this.items[t];continue}s.custom==="group"&&(this.items[t]=new pr(s))}}reviveSpecial(){for(let t in this.slots)typeof this.slots[t]=="string"&&(this.slots[t]=this.getData(this.slots[t]));this.restAction=this.slots[fi]||v.getData("rest"),this.player.revive(this),this.minions.revive(this),this.drops.revive(this),this.items.inv.revive(this),this.combat.revive(this),this.explore.revive(this),new Set([this.player,...this.minions.items,...this.combat.enemies,...this.combat.allies]).forEach(t=>t.reviveDots(this));for(const t in this.items){const s=this.items[t];s.custom==="group"&&s.reviveSpecial(this)}}reviveItems(){const t=new Set(["minions","player","explore","equip","drops","inv"]);let s=0;for(const i in this.items){const n=this.items[i];n.revive&&typeof n.revive=="function"&&!t.has(i)&&n.revive(this),n.hasTag?(this.saveItems[i]=n,n.hasTag(Ai)&&(n.need=this.homeTest),s++):(console.warn(i+": "+this.items[i].id+" missing hasTag(). Removing."),delete this.items[i])}console.log("Items Total: "+s)}homeTest(t,s,i){const n=i.slots.home;return t.space.valueOf()<=t.space.max.delValue(s.mod.space.max.bonus-(n?n.mod.space.max.bonus:0))}initSlots(){this.slots=this.slots||{},Rd(this.slots,[Ai,"mount","bed",fi,jh]),this.slots[fi]||(this.slots[fi]=this.getData("rest"))}makeTagSets(t,s={}){for(const i in t){const n=t[i],r=n.tags;if(r)for(const l of r){let a=s[l];a||(t[l]=s[l]=a=new Wt(l)),a.add(n)}}return s}setQuickSlot(t,s){this.bars.active.setSlot(t,s)}getQuickSlot(t){return this.bars.active.getSlot(t)}toData(t){if(!t)return[];for(let s=t.length-1;s>=0;s--)typeof t[s]=="string"&&(t[s]=this.getData(t[s]));return t}getTagSet(t){return this.tagSets[t]}typeCost(t,s){return t&&t[s]||0}addMax(t,s=50){let i=typeof t=="string"?this.getData(t):t;i&&(i.max.base+=s)}filterItems(t){const s=[],i=this.items;for(const n in i)t(i[n])&&s.push(i[n]);return s}addItem(t){return this.items[t.id]&&console.warn("OVERWRITE ID: "+t.id),t.hasTag?(this.items[t.id]=t,t.module!=="hall"&&(this.saveItems[t.id]=t),!0):(console.log("MISSING HASTAG: "+t.id),!1)}deleteItem(t){delete this.items[t.id],delete this.saveItems[t.id]}getSlots(){return this.slots}getSlot(t,s){return s===Gt||s===Be||s===Kt?null:this.slots[t]}setSlot(t,s){s&&s.type===Gt||(this.slots[t]=s,t===fi&&(this.restAction=s))}findInstance(t){return this.inventory.find(t,!0)||this.equip.find(t,!0)}exists(t){return Object.hasOwn(this.items,t)}findData(t,s=!1){return this.getData(t)||this.inventory.find(t,s)||this.equip.find(t,s)}hasUnique(t){return typeof t=="string"&&(t=this.getData(t)),t===void 0||!t.unique?!1:t.isRecipe||t.instanced?this.inventory.find(t.id,!0)!=null||this.drops.find(t.id,!0)!=null||this.equip.find(t.id,!0)!=null||this.items.enchantslots.findItem(t.id,!0)!=null:t.value>0}getUnique(t){let s=this.items[t];return s===void 0||!s.unique?s:s.value>0?null:s}getData(t){return this.items[t]||this[t]}getMonster(t){return this.combat.enemies.find(s=>s.id===t)||this.combat.allies.find(s=>s.id===t)||this.minions.items.find(s=>s.id===t)}checkMaxed(t){return this.getData(t).maxed()}unlockFunc(...t){let s=0;for(let i of t)s+=i*(i.unlockweight||0);return s||0}}const dp=/[^\.]\b\w+\.((?:\w|\.)+\b)/gi;class mp{constructor(t){this.datas=t,this.unlocks={},this.needs={};for(let s in this.datas)this.mapUnlocks(this.datas[s])}forceCheck(){let t;for(let s in this.datas){let i=this.datas[s];i instanceof Wt||!i.disabled&&!i.locked&&(t=this.unlocks[s],t&&this.changed(t))}}updateTech(t){for(let s of t){let i=this.unlocks[s.id];i!==void 0&&this.changed(i)===!1&&(this.unlocks[s.id]=void 0)}}changed(t){let s;for(let i=t.length-1;i>=0;i--)s=this.datas[t[i]],(!s||s.locked===!1||s.disabled===!0||s.locks>0||v.tryUnlock(s))&&gl(t,i);return t.length>0}mapUnlocks(t){!t.locked||t.disabled||t instanceof Wt||(t.require&&this.mapRequirement(t,t.require,this.unlocks),t.need&&this.mapRequirement(t,t.need,this.unlocks))}mapRequirement(t,s,i){let n=typeof s;if(n==="string")this.mapIdRequire(t,s,i);else if(n==="function")this.mapFuncRequire(t,s,i);else{if(Array.isArray(s))return s.forEach(r=>this.mapRequirement(t,r,i),this);n==="object"&&this.mapObjRequire(t,s,i)}}mapFuncRequire(t,s,i){let n=s.toString(),r;for(;r=dp.exec(n);){let l=r[1].split(".")[0];l==="mod"||l==="slot"||this.mapIdRequire(t,l,i)}(n.includes("this")||n.includes("s."))&&this.mapIdRequire(t,t.id,i)}mapObjRequire(t,s,i){for(let n in s)this.mapIdRequire(t,n,i)}mapIdRequire(t,s,i){if(!s)return;let n=this.datas[s];if(n===void 0)return;if(n instanceof Wt)return n.forEach(l=>{this.mapIdRequire(t,l.id,i)});let r=i[s];r===void 0&&(i[s]=r=[]),r.includes(t.id)||r.push(t.id)}}class He extends vt{get require(){return super.require||(this._locked?()=>this.positive():null)}set require(t){super.require=t}get group(){return this._group}set group(t){this._group=t}positive(){return super.value>0||this.rate.value>0&&(!this.max||this.max.value>0)}get current(){return this.unit?Math.floor(super.value.valueOf()):super.value.valueOf()}get val(){return super.value}set val(t){super.value=t}get value(){return super.value}set value(t){t>this.max?t<super.value.base?super.value=t:super.value=Math.max(this.max.value,super.value.valueOf()):super.value=t>=0?t:0}remove(t){t>=this.value?this.value.base=0:this.value.base-=t}get color(){return this._color}set color(t){this._color=t}constructor(t=null){super(t),this.repeat!==!1&&(this.repeat=!0),(this.unit===null||this.unit===void 0)&&(this.unit=!0),(this.rate===null||this.rate===void 0)&&(this.rate=0),this.type=this.type||sr}fillsRequire(){return this.locked===!1&&this.value+this.delta>0}empty(){return this.value+this.delta<=0}maxed(t=0){return this.max?super.maxed(t):!1}}const Ur=e=>Math.floor(11+172789/(1+Math.pow(1.2,50-e))),di=Object.freeze({rate:.5,max:5,unlockweight:.5});class Eu extends ei{static get Defaults(){return di}showLevel(){return Math.floor(this.value)}constructor(t=null){if(super(t),this.type=Wl,!this.length||this.value==0)this.length=Ur(this.level+this.value);else if(this.value>=1){let s=Ur(this.level+this.value);this.length>s&&(this.length=s)}this.buy||(this.buy={arcana:20}),this.rate||(this.rate=new N(di.rate,this.id+".rate")),this.rate.base||(this.rate.base=di.rate),this.exp instanceof Es||(this.ex=0),this.max||(this.max=new N(di.max,this.id+".max",0)),this.unlockweight||(this.unlockweight=di.unlockweight)}canBuy(t){return!(this.disabled||this.locked||this.locks>0||this.buy&&!t.canPay(this.buy))}changed(t,s){if(super.changed(t,s),this.value>Math.floor(this._max.value)){this.value=Math.floor(this.max.value);return}this.length=Ur(this.level+this.value)}onUse(t){}}class dn{toJSON(){if(!this.empty)return{name:this.name,pid:this.pid,level:this.level,gclass:this.gclass,title:this.title||void 0,titles:this.titles||void 0,gender:this.gender||void 0,school:this.school||void 0,fame:this.fame||void 0,points:this.points||void 0}}get name(){return this._name}set name(t){this._name=t}get hid(){return this._pid}set hid(t){this.pid=t}get pid(){return this._pid}set pid(t){this._pid=t}get level(){return this._level}set level(t){this._level=t}get title(){return this._title}set title(t){this._title=t}get fame(){return this._fame}set fame(t){this._fame=t}get titles(){return this._titles}set titles(t){this._titles=t}get gender(){return this._gender}set gender(t){this._gender=t}get school(){return this._school}set school(t){this._school=t}get points(){return this._points}set points(t){this._points=t}constructor(t=null){t?(Object.assign(this,t),t.empty||!t.name?this.empty=!0:this.empty=!1):this.empty=!0,this.points||(this.points=0),this.fame||(this.fame=0),this.titles||(this.titles=0),this.level||(this.level=0)}update(t){t||(this.empty=!0,retur),this.name=t.name,this.level=t.level?t.level.valueOf():0,this.title=t.title,this.titles=t.titles?t.titles.length:0,this.fame=t.fame?t.fame.valueOf():0,this.points=t.points?t.points.valueOf():0,this.gclass=t.gclass,this.empty=!1}getPoints(){return this.empty?0:(isNaN(this.points)&&console.warn(this.name+"points: NaN: "+this.points),isNaN(this.fame)&&console.warn(this.name+"fame: NaN: "+this.fame),isNaN(this.titles)&&console.warn(this.name+"titles: NaN: "+this.titles),isNaN(this.level)&&(console.warn(this.name+"level: NaN: "+this.level),this.level=0),this.points+this.fame+(this.titles+this.level)/10)}}class pp{toJSON(){return{id:this.id,name:this.name,chars:this.chars,curId:this.curId,items:this.items}}get id(){return this._id}set id(t){this._id=t}get name(){return this._name}set name(t){this._name=t}get curSlot(){return this._curSlot}set curSlot(t){this._curSlot=t}get curId(){return this._curId}set curId(t){this._curId=t}get chars(){return this._chars}set chars(t){for(let s=t.length-1;s>=0;s--)t[s]=new dn(t[s]);this._chars=t}get prestige(){return this._prestige}set prestige(t){this._prestige=t}get points(){return this._points}set points(t){this._points=t}get items(){return this._items}set items(t){this._items=t}get max(){return this._max}set max(t){this._max=t}constructor(t=null){t&&Object.assign(this,t),this.id?console.log("HALL ID: "+this.id):(this.id=Ih("h"),console.log("NEW HALL ID: "+this.id)),this.chars||(this.chars=[]),this.findCur(t),this.name||(this.name="Wizard's Hall"),this.max=this.items.hallSize,this.points=this.items.hallPoints;const s=this.items.prestige&&this.items.prestige.value.value||0,i=this.items.hallPoints&&this.items.hallPoints.value.value||0;this.prestige=this.items.prestige,this.items.prestige.value.set(i+s>0?i+s:0),this.items.hallPoints.value.set(0),this.initChars()}findCur(t){if(t.active)console.log("LEGACY HALL SLOT: "+t.active),this.legacy=!0,this.setActive(t.active);else{let s=this.curId=t.curId;this.curSlot=this.chars.findIndex(i=>i.pid===s),console.log("CUR HALL CHAR: "+s+"  AT SLOT: "+this.curSlot)}(!this.curId||this.curSlot<0)&&(this.curId=null,this.curSlot=0)}owned(){return this.items.evt_hall>0}dismiss(t){return t<0||t>=this.chars.length?!1:(this.chars[t].empty=!0,this.chars[t].name=null,this.chars[t].pid=null,!0)}initChars(){const t=this.max.value;for(let s=0;s<t;s++)this.chars[s]===void 0&&this.chars.push(new dn)}getChars(){const t=this.max.value;for(let s=0;s<t;s++)this.chars[s]===void 0&&this.chars.push(new dn);return this.chars.length>t&&(this.chars=this.chars.slice(0,Math.floor(t))),this.chars}setActive(t){if(t<0||t>=this.chars.length)return console.warn("invalid char slot: "+t),!1;this.curSlot=t;let s=this.getSlot(t);return this.curId=s.pid,!0}updateChar(t,s=null){let i=this.getSlot(this.curSlot);i||(i=this.chars[this.curSlot]=new dn),i.update(t),s&&(this.curId=i.pid=s)}setLevel(t,s){let i=this.getSlot(this.curSlot);i&&(i.level=s)}setName(t,s=-1){let i=this.getSlot(s);i&&(i.name=t)}pidSlot(t){return this.chars.findIndex(s=>s.pid==t)}setTitle(t,s=-1){let i=this.getSlot(s);i&&(i.title=t)}charId(t=-1){return t>this.chars.length?null:this.chars[t].pid}getSlot(t=-1){return this.chars[t<0?this.curSlot:t]}rmChar(t){this.chars[t]=void 0}}class wl extends He{constructor(t){super(t),this._max||(this.max=0)}free(){return this.max-this.value-this.delta}empty(){return this.value+this.delta>=this.max.value}canPay(t){return t>=0?this.max?this.value+t<=this.max.value:!0:this.value>=-t}remove(t){this.value.base+=t}doFill(){this.value=0}filled(t=0){return this.value+this.delta<=0||this.rate&&this.rate+t>=0}maxed(t=0){let s=this.value+this.delta;return s+=t>0?t:-1e-11,s<0}}class mi extends vt{toString(){return Q(this)}get current(){return this.unit?Math.floor(this.value):this._value}add(t){let s=this.value.valueOf();return this.value.base+=t,this.value.valueOf()-s}setBase(t,s){let i=this.add(s-this.value.base);this.changed(t,i)}constructor(t=null){super(t),(this.value===void 0||this.value===null)&&(this.value=0),this.repeat=!0,(this.unit===null||this.unit===void 0)&&(this.unit=!0),(this._rate===null||this.rate===void 0)&&(this.rate=0)}maxed(){return!1}filled(){return!1}}class gp extends ei{get only(){return this._only}set only(t){this._only=typeof t=="string"?t.split(","):t}get caststoppers(){return this._caststoppers}set caststoppers(t){this._caststoppers=t}get attack(){return this._attack}set attack(t){t!=null&&(t.potencies||(t.potencies=["spelldmg"]),t instanceof F||(t=new F(t,this)),t.name||(t.name=this.name),t.kind||(t.kind=this.school)),this._attack=t}get action(){return this._action}set action(t){t&&(t instanceof F||(t=new F(t,this)),t.name||(t.name=this.name),t.kind||(t.kind=this.school)),this._action=t}get dmg(){return this.damage}set dmg(t){this.damage=t}get damage(){return this._damage?this._damage:0}set damage(t){this._damage=re(t)}get level(){return this._level}set level(t){this._level=t instanceof N?t:new N(t,null,1)}toJSON(){let t=super.toJSON()||{};return t.caststoppers&&delete t.caststoppers,t.attack&&delete t.attack,t.level&&delete t.level,this.owned&&(t.owned=this.owned),t&&Object.keys(t).length?t:void 0}constructor(t=null){super(t),this.repeat=!0,this.type="spell",this.level=this.level||1,this.caststoppers||(this.caststoppers=[zi]),this.owned=this.owned||!1,this.owned||this.buy||(this.buy={}),this.locked!==!1&&this.school!=="martial"&&this.addRequire("spellbook"),this.dot&&(this.dot=We(this.dot),this.dot.school||(this.dot.school=this.school))}canUseOn(t){return t.level&&2*this.level<t.level?!1:!this.only||Un(this.only,t)}canRez(t){return t.level&&this.resurrect.maxlevel<t.level?!1:!this.resurrect.only||Un(this.resurrect.only,t)}}const _p={level:1,repeat:!0,stack:!0,consume:!0};class yp extends vt{get isRecipe(){return!0}get timer(){return this._timer}set timer(t){this._timer=t}get count(){return this._count}set count(t){this._count=t}constructor(t=null){super(t,_p),this.use.attack!=null&&!(this.use.attack instanceof F)&&(this.use.attack=new F(this.use.attack)),this.use.action!=null&&this.use.action.targets&&(this.use.action.targetstring=this.use.action.targets,this.use.action.targets=_l(this.use.action.targets)),this.use.dot!=null&&(this.use.dot.id||(this.use.dot.name?this.use.dot.id=this.use.dot.name:this.use.dot.id=this.use.dot.name=this.name||this.id),(this.use.dot.dmg||this.use.dot.damage)&&(this.use.dot.damage?this.use.dot.dmg=this.use.dot.damage:this.use.dot.damage=this.use.dot.dmg,this.potencies&&!this.use.dot.potencies&&(this.use.dot.potencies=this.potencies)),(this.use.dot.heal||this.use.dot.healing)&&(this.use.dot.healing?this.use.dot.heal=this.use.dot.healing:this.use.dot.healing=this.use.dot.heal,this.potencies&&!this.use.dot.potencies&&(this.use.dot.potencies=this.potencies)),We(this.use.dot)),this.timer=this.timer||0,this.require=this.require||this.unlockTest}onUse(t){}tick(t){return this.timer-=t,this.timer<0?(this.timer=0,!0):!1}}class vp extends vt{get rand(){return this._rand}set rand(t){this._rand=t}get cd(){return this._cd}set cd(t){this._cd=t}constructor(t=null){super(t)}doUnlock(t=v){this.disabled||this.value>0&&!this.repeat||(this.locked&&w.emit(Ji,this),this.rand||super.amount(1),this.locked=!1,w.emit(Ds,this))}amount(t){this.locked&&this.doUnlock()}}const bp=e=>({method:"GET",headers:new Headers,mode:"cors",credentials:"same-origin"});function Tl(e,t,s){return window.fetch(e,t).then(i=>{if(i.status!==200){if(console.warn("Status: "+i.status),s>0)return Tl(e,t,s-1);throw new Error(`Server denied access to ${e}`)}else return i.json()},i=>{if(console.warn("Error: "+i),s>0)return Tl(e,t,s-1);throw i})}class kp{get results(){return this._results}get promise(){return this._promise}constructor(t,s){t&&t.length>0&&t[t.length-1]!=="/"&&(t+="/"),this._dir=t||"/",s&&this.setFiles(s)}setFiles(t){this._files=t;let s={};for(let i=t.length-1;i>=0;i--)s[t[i]]=null;this._loads=s}load(t=null){t&&this.setFiles(t);let s=this._loads,i=bp(),n=[];for(let r in s)n.push(Tl(this._dir+r+".json",i,3).then(l=>s[r]=l));return this._promise=Promise.all(n).then(()=>s)}}const mn=new mr(null,{id:"baseWeapon",name:"fists",type:Kt,attack:{name:"fists",tohit:1,kind:"blunt",damage:"0~1"}}),xp=.125;class wp extends wt{get level(){return this._level}set level(t){this._level&&typeof t=="number"?this._level.value=t:this._level=t}get title(){return this._title}set title(t){this._title=t}get titles(){return this._titles==null&&(this._titles=[]),this._titles}set titles(t){this._titles=t}get exp(){return this._exp}set exp(t){if(this._exp===void 0)this._exp=t;else for(this._exp.value=t;this._next>0&&this._exp.value>=this._next;)this.levelUp()}get gclass(){return this._gclass}set gclass(t){this._gclass=t}get next(){return this._next}set next(t){this._next=t}get hp(){return this._hp}set hp(t){this._hp?this._hp.value=t:t instanceof vt?this._hp=t:console.error("Invalid Hp: "+t)}get damage(){return this._damage}set damage(t){this._damage=t instanceof N?t:new N(t)}get weapons(){return this._weapons}set weapons(t){this._weapons=new Hs(t),this._weapons.saveMode=$i,this._weapons.removeDupes=!0}get weapon(){return this._weapons?this._weapons.curItem():null}toJSON(){let t={};return t.defense=this.defense,t.tohit=this.tohit,t.name=this.name,t.titles=this.titles,t.title=this.title,t.next=this.next,t.timer=this.timer,t.alignment=this.alignment,t.damage=this.damage,t.dots=this.dots,t.bonuses=this.bonuses,t.immunities=this.immunities,t.resist=this.resist,t.retreat=this.retreat||void 0,t.gclass=this.gclass,t.weapons=this.weapons,t.attack&&delete t.attack,t}constructor(t=null){super(t),this.id=this.type="player",(!t||!t.name)&&(this.name="Wizrobe"),this.weapons||(this.weapons=null),this.level||(this.level=0),this._title=this._title||"Waif",this.titles=this._titles||[],this._next=this._next||50,this.team=je,this.chainhit=this.chainhit||1,this.chaincast=this.chaincast||1,this.defeators=[],this.retreat=this.retreat||0,this.initStates(),this.tohit||(this.tohit=1),this.defense||(this.defense=0),this.alignment=this.alignment||"neutral",(this.damage===null||this.damage===void 0)&&(this.damage=1)}setClass(t){this.gclass=t,this.addTitle(t),w.emit(du,this)}setName(t){t&&(this.name=t,_t.add(this),w.emit(fu,this))}setTitle(t){t&&(t=t.trim(),this.title=t,this.addTitle(t),w.emit(uu,this))}addTitle(t){t=t.trim(),this._titles.includes(t.trim().toTitleCase())||(this.context.applyVars("fame",.1),this._titles.push(t.toTitleCase()),w.emit(cu,t,this._titles.length))}revive(t){super.revive(t),this.weapons.revive(t,(l,a)=>{l.equip.find(a)}),this.weapons.count===0&&this.weapons.add(mn),this.spells=t.getData("spelllist");let s=this.checkLevelUp.bind(this),i=this.exp,n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(i),"value");Object.defineProperty(i,"value",{get(){return n.get.apply(i)},set(l){n.set.apply(i,[l]),s()}});let r=Object.getOwnPropertyDescriptor(this,"exp");Object.defineProperty(this,"exp",{get(){return r.get()},set(l){r.set(l),s()}}),this.checkLevelUp()}checkLevelUp(){let t=this.exp;for(;this.next>0&&t.value>=this.next;)this.levelUp()}addWeapon(t){this.weapons.add(t),this.weapons.count>1&&this.weapons.remove(mn)}removeWeapon(t){this.weapons.remove(t),this.weapons.count===0&&this.weapons.add(mn)}getWeapon(){let t=v.state.equip.slots.mainhand.item;return t?Array.isArray(t)?t[0]:t:mn}begin(){for(let t=this.dots.length-1;t>=0;t--)this.dots[t].mod&&this.context.applyMods(this.dots[t].mod,1)}rested(){for(let t=this.defeators.length-1;t>=0;t--)if(this.defeators[t].maxed()===!1)return!1;return!0}defeated(){for(let t=this.defeators.length-1;t>=0;t--)if(this.defeators[t].empty())return!0;return!1}explore(t){if(this.timer-=t,this.timer<=0){this.timer+=fe(this.speed);for(let s=this.castAmt(this.chaincast);s>0;s--)this.tryCast()}}combat(t){if(this.timer-=t,this.timer<=0){this.timer+=fe(this.speed);for(let n=this.castAmt(this.chaincast);n>0;n--)this.tryCast();let s=this.getCause(Ls);if(s)return s;let i=[];for(let n=this.castAmt(this.chainhit);n>0;n--){let r=this.nextAttack();r&&i.push(r)}return i.length>0?i:null}}tryCast(){var t;return((t=this.spells)==null?void 0:t.onUse(this.context))??null}nextAttack(){let t=0,s;for(;t<this.weapons.items.length;)s=this.weapons.nextItem(),t++,s!=null&&s.attack;return Array.isArray(s==null?void 0:s.attack)?s.attack[Math.floor(Math.random()*s.attack.length)]:(s==null?void 0:s.attack)??null}getResources(){const t=[];for(let s in this){const i=this[s];i!==null&&typeof i=="object"&&i.type===sr&&t.push(i)}return t}levelUp(){this.level.amount(1),this._exp.value.value-=this._next,this._next=Math.floor(this._next*(1+xp)),_t.add(this),w.emit(Yl,this,this._level.valueOf())}initStates(){this._negate=this._negate||{};for(let t in this._negate)this._negate[t]=new N(this._negate[t]);this._resist=this._resist||{};for(let t in this._resist)+this._resist[t]!=0?this._resist[t]=new N(this._resist[t]):delete this._resist[t];this.regen=this.regen||0,this.immunities||(this.immunities={fire:0,water:0,air:0,earth:0,light:0,shadow:0,arcane:0,physical:0,natural:0,poison:0,disease:0}),this.bonuses||(this.bonuses={})}}class Tp extends vt{toJSON(){let t=super.toJSON()||{};return this.char&&(t.char=this.char),t&&Object.keys(t).length?t:void 0}get charlock(){return this._charlock}set charlock(t){this._charlock=t}get char(){return this._char}set char(t){this._char=t}constructor(t=null){super(t)}changed(t,s){return this.charlock&&s>0&&(this.char=t.state.player.hid),super.changed(t,s)}revive(t){let s=t.player;this.char&&s.hid!==this.char&&(this.disabled=!0)}}class Sp extends Tp{constructor(t=null){super(t),t.warn!==!1&&(this.warnMsg="Alternate Wizard classes of this tier will be locked.",this.warn=!0)}changed(t,s){super.changed(t,s),t.state.player.setClass(this.name),this.locked=!1,w.emit(Ds,this)}}const vo="hall";class zs{get objects(){return this._objects}set objects(t){this._objects=t}get lists(){return this._lists}set lists(t){this._lists=t}get hall(){return this._hall}set hall(t){this._hall=t}get name(){return this._name}set name(t){this._name=t}get sym(){return this._sym}set sym(t){this._sym=t}get author(){return this._author}set author(t){this._author=t}get email(){return this._email}set email(t){this._email=t}get git(){return this._git}set git(t){this._git=t}constructor(){this.objects={},this.lists={}}setData(t,s,i){this.name=s,this.sym=i,this.fileLoaded(t)}load(t,s){return Array.isArray(t)?Sl(t,s).then(i=>this.typesLoaded(i)):(this.name=t,Sl([t],s).then(i=>this.fileLoaded(i[t])))}typesLoaded(t){const s=[];for(const i in t){const n=t[i];if(!n)console.warn("no file: "+i);else if(i===vo)this.addHall(n);else if(n.module){let r=new zs;r.setData(n),s.push(r)}else this.lists[i]=this.parseList(t[i])}for(let i=s.length-1;i>=0;i--)this.merge(s[i]);return this}fileLoaded(t){return this.lists=t.data,this.name=t.module||this.name,this.sym=t.sym||this.sym,t.data&&this.parseLists(t.data),this}parseLists(t){for(let s in t)s===vo?(this.addHall(t[s]),delete this.lists[s]):this.parseList(t[s])}addHall(t){let s=new zs;if(!t.data){let{name:i,sym:n,...r}=t;t={name:i,sym:n,data:r}}s.setData(t,this.name,this.sym),this.hall?this.mergeHall(s):this.hall=s}mergeHall(t){this.hall||(this.hall=new zs),this.hall.merge(t)}parseList(t){const s=this.sym,i=this.name;for(let n=0;n<t.length;n++){const r=t[n];if(!r.id){console.warn("missing id: "+r.name);continue}i&&(r.module=i),s&&(r.sym=r.sym||s),this.objects[r.id]=Gi(r)}return t}merge(t){let s=t.objects,i=this.objects;for(let n in s)i[n]=s[n];for(let n in t.lists){let r=t.lists[n];if(i=this.lists[n],!Array.isArray(i)){this.lists[n]=r.slice(0);continue}for(let l=0;l<r.length;l++)i.push(r[l])}t.hall&&this.mergeHall(t.hall)}instance(t={}){return gr.instance(this.objects,this.lists,t)}}class Iu{toJSON(){}get type(){return Lh}set type(t){}get id(){return this._id}set id(t){this._id=t}get name(){return this._name||this._id}set name(t){this._name=t}get value(){return this._value}set value(t){this._value=t}get mod(){return this._mod}set mod(t){this._mod=t}get effect(){return this._effect}set effect(t){this._effect=t}get flags(){return this._flags}set flags(t){typeof t!="number"?this._flags=vu(t):this._flags=t}get stack(){return this._stack}set stack(t){this._stack=t}constructor(t){t&&ge(this,t)}applyTo(t,s){this.mod&&t.applyMods(this.mod,s)}remove(t,s){}}_e(Iu,Ee);const Du="./data/",Ap="modules",Sl=(e,t=Du)=>new kp(t,e).load(),gr={main:null,async loadModInfo(e){return Sl([e]).then(t=>{if(!t)throw new Error("Modlist not found: "+e);return t[e]})},async requestData(){const e=await this.loadModInfo(Ap);this.main=new zs,this.main.hall=new zs,await this.main.load(e.core),e.modules&&await this.main.load(e.modules,Du+"modules/")},async loadGame(e){return this.main===null&&await this.requestData(),this.instance(this.main.objects,this.main.lists,e)},instance(e,t,s={}){s=s||{};for(const r in s)r==="items"||r==="drops"||(s[r]=fs(s[r],r));let i=s.items;if(i)for(const r in e){const l=e[r];if(l.alias&&!i[r]){const a=i[l.alias];a&&(console.warn("alias: "+l.alias+" -> "+r),i[r]=a,delete i[l.alias])}}else i={};s.items=this.mergeItems(i,e);const n=this.buildLists(s.items,t);return this.initInstance(s,n)},buildLists(e,t){const s={};for(const i in t){const n=t[i];if(!n)continue;const r=s[i]=[];for(let l=0;l<n.length;l++)r[l]=e[n[l].id]}return s},mergeItems(e,t){for(const s in t){let i=e[s]||{};typeof i=="number"&&(i={val:i}),$s(i,t[s]),e[s]=fs(i,s),i.template=t[s]}return e},initInstance(e,t){const s=e.items;return t.tags&&(e.tagSets=this.initItems(s,t.tags,Wt)),t.resources&&(e.resources=this.initItems(s,t.resources,He)),t.potencies&&(e.potencies=this.initItems(s,t.potencies,mi)),t.proficiencies&&(e.proficiencies=this.initItems(s,t.proficiencies,mi)),t.stressors&&(e.stressors=this.initItems(s,t.stressors,He,"stress","stress"),e.stressors.forEach(i=>i.hide=!0)),t.upgrades&&(e.upgrades=this.initItems(s,t.upgrades,vt,null,"upgrade")),t.quests&&(e.quests=this.initItems(s,t.quests,vt,null,"quest")),t.homes&&(e.homes=this.initItems(s,t.homes,vt,Ai,Ai),e.homes.forEach(i=>i.slot=Ai)),t.furniture&&(e.furnitures=this.initItems(s,t.furniture,vt,"furniture","furniture")),t.skills&&(e.skills=this.initItems(s,t.skills,Eu,Wl)),t.encounters&&(e.encounters=this.initItems(s,t.encounters,Xm,me,me)),t.monsters&&(e.monsters=this.initItems(s,t.monsters,Ou,ne,ne)),t.rares&&(e.rares=this.initItems(s,t.rares,jr)),t.states&&(e.states=this.initItems(s,t.states,Iu,"state","state")),t.reagents&&(e.reagents=this.initItems(s,t.reagents,He)),t.locales&&(this.initItems(s,t.locales,Mn,"t_locale"),t.locales.forEach(i=>i.sym=i.sym||"")),t.dungeons&&(this.initItems(s,t.dungeons,Mn,"t_dungeon",Ed),t.dungeons.forEach(i=>i.sym=i.sym||"")),t.clashes&&(this.initItems(s,t.clashes,Mn,"t_clash",Dd),t.clashes.forEach(i=>i.sym=i.sym||"")),t.spells&&this.initItems(s,t.spells,gp,"t_spell"),t.stats&&this.initItems(s,t.stats,mi,"stat","stat"),t.items&&this.initItems(s,t.items,ds,ll,ll),t.armors&&(e.armors=this.initItems(s,t.armors,jr,Be,Be),e.armors.forEach(i=>i.kind=i.kind||Be)),t.weapons&&(e.weapons=this.initItems(s,t.weapons,jr,Kt,Kt),e.weapons.forEach(i=>i.kind=i.kind||Kt)),t.potions&&(e.potions=this.initItems(s,t.potions,yp,"t_potion",Ph)),t.materials&&(e.materials=this.initItems(s,t.materials,Vn,"material","material")),t.properties&&(e.properties=this.initItems(s,t.properties,Vn,"property","property")),t.events&&(e.events=this.initItems(s,t.events,vp,jn,jn)),t.classes&&(e.classes=this.initItems(s,t.classes,Sp,"class","class")),t.tasks&&(e.tasks=this.initItems(s,t.tasks,ei,null,"task")),t.actions&&(e.tasks=this.mergeTasks(e.tasks,this.initItems(s,t.actions,ei,null,"task"))),t.enchants&&(e.enchants=this.initItems(s,t.enchants,Cu,null,"enchant")),t.sections&&(e.sections=this.initItems(s,t.sections)),t.equipslots&&(e.equipslots=this.initItems(s,t.equipslots,qn,null,Cd)),t.player&&([e.player,e.playerStats]=this.initPlayer(s,t.player,e.items.player),kl(e.player,...e.playerStats.map(i=>i.id))),t.glossaryentries&&(e.glossaryentries=this.initItems(s,t.glossaryentries,vt,"t_glossary_entry","Glossary entry")),e},mergeTasks(e,t){return Zd(e,t,s=>e.find(i=>i.id==s.id)===void 0)},initItems(e,t,s=vt,i=null,n=null){if(t!=null){for(let r=t.length-1;r>=0;r--){let l=t[r];l.reverse?t[r]=l=new wl(l):l.stat?t[r]=l=new mi(l):t[r]=l=new s(l),i&&l.addTag(i),n&&(l.type=n),e[l.id]=l}return t}},initPlayer(e,t,s=null){if(!t)return;let i=s||{},n=[],r;for(let l of t)r=i[l.id]=l.stat===!0?new mi(l):l.reverse===!0?new wl(l):new He(l),r.type=sr,e[l.id]=r,n.push(r);return[e.player=new wp(i),n]}},Lu={saves:{autosave:!0,saveTime:30},darkMode:!1,compactMode:!1,curview:null,entryview:null,homeview:null,smoothBars:!0,debugRate:!1,totalRate:!1,ensureMaxProduction:!1,speedupFactor:10,spells:{},skills:{hideMaxed:!1}};Object.freeze(Lu);const it={toJSON(){return this.vars},vars:{darkMode:!1,compactMode:!1,smoothBars:!0,debugRate:!1,ensureMaxProduction:!1,speedupFactor:10,totalRate:!1,spells:{}},getAll(){return this.vars},setSubVar(e,t,s){let i=this.vars[e];return i||(this.vars[e]=i={}),i[t]=s,s},getSubVar(e,t){let s=this.vars[e];return s?s[t]:null},set(e,t){this.vars[e]=t},get(e){return this.vars[e]},getSubVars(e){let t=this.vars[e];return t===void 0&&(t=this.vars[e]={}),t},setSettings(e){this.vars=Object.assign({},Lu);for(let t in e)this.vars[t]=e[t]}},bo="hall",Op="settings/",Fr=null,Et={loggedIn(){return Fr==null?void 0:Fr.loggedIn},logout(){},loaders:[],addLoader(e,t){return t?this.loaders.unshift(e):this.loaders.push(e),e},async clearAll(){for(let e=0;e<this.loaders.length;e++)try{this.loaders[e].clearAll()}catch(t){console.warn(t)}},async deleteChar(e){for(let t=0;t<this.loaders.length;t++)try{this.loaders[t].deleteChar(e)}catch(s){console.warn(s)}},async saveChar(e,t){let s=!1;for(let i=0;i<this.loaders.length;i++){const n=this.loaders[i];try{await n.saveChar(e,t),s=!0}catch(r){console.warn(r)}}},async saveHall(e){let t=!1;for(let s=0;s<this.loaders.length;s++){const i=this.loaders[s];try{await i.saveHall(e,bo),t=!0}catch(n){console.warn(n)}}},async loadChar(e){for(let t=0;t<this.loaders.length;t++){const s=await this.loaders[t].loadChar(e);if(s)return s}},async loadHall(e=bo){for(let t=0;t<this.loaders.length;t++){const s=await this.loaders[t].loadHall(e);if(s)return s}},saveSettings(e,t){window.localStorage.setItem(this.settingsLoc(t),e)},loadSettings(e){return window.localStorage.getItem(this.settingsLoc(e))},settingsLoc(e){return Op+"/"+e+"/"}},Mp=e=>{const t="",s="chars/";return e.addLoader({fallback:!0,clearAll(){window.localStorage.clear()},deleteChar(i){window.localStorage.setItem(this.charLoc(i),null)},saveChar(i,n){window.localStorage.setItem(this.charLoc(n),i)},loadChar(i){const n=window.localStorage.getItem(this.charLoc(i));return n?JSON.parse(n):(console.log("CHAR NOT FOUND"),null)},saveHall(i,n){window.localStorage.setItem(this.hallLoc(n),i)},loadHall(i){let n=window.localStorage.getItem(this.hallLoc(i));return n?JSON.parse(n):(console.log("LOCAL HALL NOT FOUND"),null)},charLoc(i){return t+s+i},hallLoc(i){return t+i}})},ks="hall",Re="chars",Cp=1,ko=(e,t)=>new Promise((s,i)=>{const n=e.createObjectStore(t);n.transaction.onerror=r=>{console.warn(`failed to create store: ${r}`),i(r)},n.transaction.oncomplete=r=>{console.log(`objectStore created: ${t}`),s()}}),Ep=()=>new Promise((e,t)=>{const s=window.indexedDB.open("arcanum",Cp);s.onerror=i=>{console.warn("IndexDB failed to open database"),t(`failed to open database: ${i.data}`)},s.onsuccess=i=>{e(s.result)},s.onupgradeneeded=i=>{const n=i.target.result;Promise.all([ko(n,Re),ko(n,ks)]).catch(r=>t(r))}}),bs=e=>new Promise((t,s)=>{e.onerror=i=>s(i),e.onsuccess=()=>{t(e.result)}});async function Ip(e){const t=await Ep();function s(){const o=this.db.transaction([Re,ks],"readwrite");return Promise.all([bs(o.objectStore(Re).clear()),bs(o.objectStore(ks).clear())])}function i(o){const h=this.db.transaction([Re],"readwrite");return bs(h.objectStore(Re).delete(o))}function n(o,h){const f=this.db.transaction([Re],"readwrite");return bs(f.objectStore(Re).put(o,h))}async function r(o){const h=this.db.transaction([Re],"readonly"),f=await bs(h.objectStore(Re).get(o));return f?JSON.parse(f):null}function l(o,h){const f=this.db.transaction([ks],"readwrite");return bs(f.objectStore(ks).put(o,h))}async function a(o){const h=this.db.transaction([ks],"readonly"),f=await bs(h.objectStore(ks).get(o));return f?JSON.parse(f):null}return e.addLoader({db:t,clearAll:s,deleteChar:i,saveChar:n,loadChar:r,saveHall:l,loadHall:a},!0)}const xo="hall";(function(){Mp(Et);try{Ip(Et)}catch(e){console.warn(`failed to init IndexedDB: ${e}`)}})();const ht={VERSION:"stable 0.0.2",hall:null,active:{loggedIn:!1},get loggedIn(){return this.active.loggedIn},set loggedIn(e){this.active.loggedIn=e},logout(){Et.logout()},async loadHall(e=null){const t=await Et.loadHall(xo,e),s=this.loadHallData(t);this.hall=new pp(s),this.hall.legacy&&await this.resaveLegacy()},async resaveLegacy(){const e=this.hall.max.value;for(let t=0;t<e;t++){const s=this.hall.getSlot(t);if(s.empty)continue;const i=await Et.loadChar(t);i?await Et.saveChar(JSON.stringify(i),s.pid):console.log("NO LEGACY FOUND: "+t)}this.hall.legacy=!1},loadHallData(e){return gr.main.hall.instance(e)},onCharLevel(e,t){return this.hall.setLevel(e,t),this.saveHall()},updateChar(e){return this.hall.updateChar(e),this.saveHall()},setHallName(e){return this.hall.name=e,this.saveHall()},setActive(e,t){this.hall.updateChar(t.player),this.saveActive(t)?(this.hall.setActive(e),this.saveHall()):console.error("CUR CHAR NOT SAVED")},getHallItems(){return this.hall.items},gameLoaded(e){const t=e.state,s=t.player,i=t.pid||s.hid;console.log("player id: "+i),this.hall=Is(this.hall);const n=this.hall.pidSlot(i);n>=0&&this.hall.setActive(n),this.hall.updateChar(s,i),this.saveHall(),w.add(Yl,this.onCharLevel,this),w.add(fu,this.updateChar,this),w.add(uu,this.updateChar,this),w.add(du,this.updateChar,this)},dismiss(e){this.hall.dismiss(e)&&(Et.deleteChar(this.hall.charId(e)),this.saveHall())},async loadActive(){try{return this.hall.curId?console.log("loading hall char: "+this.hall.curId):this.hall.curSlot&&console.log("loading slot: "+this.hall.curSlot),Et.loadChar(this.hall.curId||this.hall.curSlot)}catch(e){return console.error(e.message+`
`+e.stack),null}},async getHallSave(){let e={type:xo,hall:this.hall,chars:[]},t=Math.floor(this.hall.max),s=e.chars;for(let i=0;i<t;i++){if(!this.hall.charId(i))continue;let n=await Et.loadChar(this.hall.charId(i));s.push(n||null)}return e},async setHallSave(e){if(await this.setCharDatas(e.chars),console.dir(e.hall,"Hall Save"),e.hall.active){let t=e.hall.active,s=e.hall.chars[t];s?(e.hall.curId=s.pid||s.hid,console.log("switching to cur: "+e.hall.curId)):console.warn("cur not found: "+s),delete e.hall.active}return Et.saveHall(JSON.stringify(e.hall),e.hall.id)},async setCharDatas(e){if(!e)return;let t;for(let s=e.length-1;s>=0;s--){const i=e[s];if(i){if(console.log(`HALL SAVE ${s}: ${i.name}`),t=i.pid,!t){const n=i.items.player;n&&(t=n.pid||n.hid)}}else console.log("EMPTY HALL SLOT: "+s);await Et.saveChar(JSON.stringify(e[s]),t),t=null}},async saveActive(e){try{console.log("cur char id: "+this.hall.curId);const t=JSON.stringify(e);return t&&await Et.saveChar(t,this.hall.curId),this.saveSettings(),t}catch(t){return console.error(t.message+`
`+t.stack),null}},async clearActive(){return Et.deleteChar(this.curId)},loadSettings(){try{let e=Et.loadSettings(),t=JSON.parse(e);return it.setSettings(t),it.getAll()}catch(e){console.error(e.message+`
`+e.stack)}},saveSettings(){try{let e=JSON.stringify(it);e&&Et.saveSettings(e,this.curId)}catch(e){console.error(e.message+`
`+e.stack)}},hasHall(){return this.hall&&this.hall.owned()},clearAll(){Et.clearAll()},async saveHall(){try{const e=JSON.stringify(this.hall);e&&await Et.saveHall(e,this.hall.id)}catch(e){console.error(e.message+`
`+e.stack)}}};let Hr;const _r=120,Bn=_r/1e3,v={toJSON(){return this.state},state:null,get gdata(){return this._gdata},loaded:!1,log:Is(new Om),runner:null,activeRepeaters:new Map,get player(){return this.state.player},get self(){return this.state.player},addTimer(e){this.runner.addTimer(e)},reset(){this.loaded=!1,this.state=null,this._gdata=null,this.runner=null,this.log.clear(),this.isInTurboMode=bi(!1),this.activeRepeaters=new Map},load(e=null,t=null){return this.reset(),w.init(this),this.loader=gr.loadGame(e).then(async s=>{var i,n;this.state=Is(new fp(s,e)),await this.state.revive(),this.player.context=this,this.itemGen=new Bm(this),this._gdata=this.state.items,this.runner=this.state.runner,this.runner.context=this,t&&this.addData(t),this.state.tagSets=this.state.makeTagSets(this.state.items,this.state.tagSets.reduce((r,l)=>(l.id?r[l.id]=l:console.warn("TAGSET MISSING ID: ",l),r),{})),this.state.equip.redoSlots(),await this.recalcSpace(),this.state.converters=[],await this.restoreMods(),this.runner.trimWaiting(),_t.clear(),Hr=new mp(this.gdata),await Hr.forceCheck(),w.add(Yd,this.setSlot,this),w.add($d,this.clearSlot,this),w.add(Ki,this.onDelete,this),this.loaded=!0;for(let r in this.state.items)(i=this.state.items[r])!=null&&i.defeatstat&&this.player.defeators.push(this.state.items[r]),(n=this.state.items[r])!=null&&n.restrate&&this.player.restitems.push(this.state.items[r]);return this},s=>{console.error(s.message+`
`+s.stack)})},logStat(e){let t=this.getData(e);t?(console.dir(t),console.warn(e+" value: "+t.value+"  type: "+t.constructor.name.toString().toTitleCase())):console.warn("STAT MISSING: "+e)},restoreMods(){const e=this.state.items;this.state.inventory.begin(this),this.state.items.enchantslots.begin(this),this.state.drops.begin(this),this.state.equip.begin(this),this.state.player.begin(this),this.state.combat.begin(this),this.state.minions.begin(this),e[Qs].begin(this);for(const s in e){const i=e[s];i instanceof Wt||(!i.locked&&!i.disabled&&!(i.instanced||i.isRecipe)&&i.value!=0&&(i.applyImproves&&i.applyImproves(),i.mod&&+i.value&&this.applyMods(i.mod,i.value,i.id),i.lock&&this.lock(i.lock,i.value)),i.convert&&!this.state.converters.some(n=>n===i)&&this.state.converters.push(i))}const t=this.state.equip.slots;for(let s in t)for(let i of t[s])i&&((i.type===Kt||i.attack)&&this.player.addWeapon(i),i.remod?i.remod(this):console.warn("Equipped item has mods but no remod.",i));for(let s of this.runner.actives)s.runmod&&this.applyMods(s.runmod),s.baseTask&&s.baseTask.runmod&&this.applyMods(s.baseTask.runmod)},recalcSpace(){let e=this.state.getData("space");e.value=0,dr(e.mod,e.value)},addData(e){for(let t in e){let s=e[t];this.state.addItem(s)}},setSlot(e){let t=this.state.getSlot(e.slot);t&&this.remove(t,1),this.state.setSlot(e.slot,e),e.buy&&!e.owned?(this.payCost(e.buy),e.owned=!0):e.cost&&this.payCost(e.cost),e.type!=ne&&e.amount(1)},clearSlot(e){let t=this.state.getSlot(e);t&&this.remove(t,1)},update(){const t=(it.getSubVars("speedupFactor")||10)-1,s=Bn*2,i=t/2;if(this.isInTurboMode.value){const a=this.getData("offlinetime");let o=Math.min(i,a.value/s);for(a.amount(-o*s),o<i&&(this.isInTurboMode.value=!1);o>=1;)this.updateTechTree(),this.updateForDelta(s*1e3),o--;o>0&&(this.updateTechTree(),this.updateForDelta(s*1e3*o),o=0)}const n=Date.now();this.updateTechTree();let r=Math.max(n-this.state.lastUpdate,0);const l=_r*2;if(r>l){const a=(r-l)/1e3;this.getData("offlinetime").amount(a),r=l}this.state.lastUpdate=n,this.updateForDelta(r)},updateForDelta(e){e/=1e3,this.doRepeaters(e),this.state.player.update(e),this.state.minions.update(e),this.state.player.defeated()&&w.emit(nr,this.state.player),this.runner.update(e),this.doResources(this.state.resources,e),this.doResources(this.state.playerStats,e),this.doResources(this.state.stressors,e),this.doResources(ht.hall.resources,e),this.doConversions(this.state.converters,e)},updateTechTree(){var i;const e=Vd();for(const n of e){const r=n.delta;r!==0&&((i=n.changed)==null||i.call(n,this,r))}Hr.updateTech(e);let t=0,s=so();for(;s.size>0&&t++<3;){for(const n of s)n.mod&&this.applyMods(n.mod,n.value),n.runmod&&n.running&&this.applyMods(n.runmod,1);s=so()}},doRepeaters(e){for(const s of this.activeRepeaters.entries()){const i=s[0],n=s[1],r=e+n,l=Math.floor(r/.05);this.activeRepeaters.set(i,r-l*.05);for(let a=0;a<l;a++)this.tryItem(i)}},doResources(e,t){for(let s=e.length-1;s>=0;s--){const i=e[s];i.id!=="space"&&i.locked===!1&&!i.disabled&&(i.rate.value!==0&&i.amount(i.rate.value*t),i.effect&&this.applyVars(i.effect,t,i.value))}},doConversions(e,t){for(let s=e.length-1;s>=0;s--){const i=e[s];if(i.locked===!1&&!i.disabled&&i.convert){const n=i.convert;if(i.value>0&&this.canPay(n.input,n.singular?1:i.value)){let r={};for(let a in n.output.effect)n.output.effect[a].value!=0&&(r[a]=n.output.effect[a]);const l=n.output.effect?Object.keys(r):[];if(this.filled(l,i)&&!n.output.mod)continue;this.payCost(n.input,n.singular?1:t*i.value),n.output.effect&&this.applyVars(n.output.effect,n.singular?1:t,n.singular?1:i.value),n.output.mod&&n.modvalue==0?(this.applyMods(n.output.mod,n.singular?1:i.value),n.modvalue=n.singular?1:i.valueOf()):(n.modvalue!=n.singular||i.valueOf())&&(this.removeMods(n.output.mod,n.modvalue),this.applyMods(n.output.mod,n.singular?1:i.value),n.modvalue=n.singular?1:i.valueOf())}else n.modvalue&&(this.removeMods(n.output.mod,n.modvalue),n.modvalue=0)}}},toggleTask(e){this.runner.toggleAct(e)},doRest(){this.runner.tryRest()},haltTask(e){this.runner.stopTask(e)},setTask(e){this.runner.setTask(e)},filled(e,t,s){var n;if(Array.isArray(e)){for(let r=e.length-1;r>=0;r--)if(!this.filled(e[r],t,s))return!1;return!0}const i=this.getData(e);if(!i)return console.warn("missing fill item: "+e),!0;if(it.getSubVars("ensureMaxProduction")&&t){if(!t.length&&!t.convert&&(!i.rate||!t.effect||i.rate>=0))return i.maxed();let r=0;return t.effect&&(r+=wn(t.effect,e,this.gdata)),t.result&&(r+=wn(t.result,e,this.gdata)),(n=t.convert)!=null&&n.output.effect&&(r+=wn(t.convert.output.effect,e,this.gdata)),i.maxed(r)}else if(!i.rate||!t.effect||i.rate>=0)return i.maxed();return s=t.effect[s||e],!s||i.filled(s)},disable(e){if(Array.isArray(e))for(let t of e)this.disable(t);else game.state.items[e]instanceof Wt?game.state.items[e].disable(game):(typeof e=="string"&&(e=this.getData(e)),e&&!e.disabled&&(e.disabled=!0,e.slot&&this.state.getSlot(e.slot,e.type)===e&&this.remove(e,1),e.running&&this.runner.stopTask(e),e instanceof He||e instanceof Eu||e instanceof vt?this.remove(e,e.value):e.mod&&this.removeMods(e.mod,e.value)))},enable(e){if(Array.isArray(e))for(let t of e)this.enable(t);else game.state.items[e]instanceof Wt?game.state.items[e].enable(game):(typeof e=="string"&&(e=this.getData(e)),e&&e.disabled&&(e.disabled=null,e.mod&&this.applyMods(e.mod,e.value)))},removeAll(e){typeof e=="object"?this.remove(e,e.value):Array.isArray(e)?e.forEach(this.removeAll,this):this.getData(e)&&this.remove(e,e.value)},tryBuy(e,t=!0){return this.canPay(e.buy)===!1?!1:(this.payCost(e.buy),e.isRecipe&&this.create(e,t),e.owned=!0,e.slot&&!this.state.getSlot(e.slot)&&this.setSlot(e),_t.add(e),!0)},use(e,t=null){e.onUse(this,t||this.state.inventory)},tryItem(e){if(e){if(!this.canUse(e))return!1;if(e.caststoppers)for(let t of e.caststoppers){let s=this.self.getCause(t);if(s)return w.emit(ue,this.self,s),!1}if(e.buy&&!e.owned)return this.tryBuy(e,!1);e.perpetual>0||e.length>0?this.setTask(e):e.instanced?e.count>0&&e.onUse(this):e.isRecipe?this.craft(e):e.slot?this.setSlot(e):(this.payCost(e.cost),e.amount(1))}},onDelete(e){this.state.deleteItem(e)},instance(e){return typeof e=="string"&&(e=this.state.getData(e)),this.itemGen.instance(e)},craft(e){if(!this.canPay(e.cost))return!1;this.payCost(e.cost),this.create(e)},summon(e,t=null,s=null){if(Array.isArray(e)){for(let a of e)this.summon(a,t,s);return}if(e[mt]&&!e[mt].roll()||e.summoncondition&&!e.summoncondition.getApply({[C.CONTEXT]:t.context,[C.GDATA]:t.context.gdata,[C.ITEM]:null,[C.ACTOR]:t,[C.TARGET]:s}))return;let i=e.id,n=e.keep||!1,r=e.count||1,l=e.max||0;this.create(i,n,r,l)},create(e,t=!0,s=1,i=0){if(typeof e=="string")e=this.state.getData(e);else if(Array.isArray(e)){for(let n=e.length-1;n>=0;n--)this.create(e[n],t,s);return}if(e)for(let n=s;n>0;n--)if(e.type===ne)e.onCreate&&e.onCreate(this,je,t,i);else{const r=this.itemGen.instance(e);r&&this.state.inventory.add(r),w.emit(Sn,r)}},tryUseOn(e,t){return t==null?!1:e.buy&&!e.owned?(this.payCost(e.buy),e.owned=!0,_t.add(e),!0):e.length?this.runner.beginUseOn(e,t):(this.payCost(e.cost),this.useOn(e,t,this),!0)},useOn(e,t){t!=null&&(typeof e.useOn=="function"&&e.useOn(t,this),e.value++,e.mod&&t.permVars(e.mod),e.result&&t.permVars(e.result))},fillItem(e){let t=typeof e=="string"?this.getData(e):e;if(t)if(typeof t.doFill=="function")t.doFill();else{if(!t.max){t.amount(1);return}t.max.value-t.value>0&&t.amount(t.max.value-t.value)}},sellPrice(e){let t=e.sell||e.cost||5*e.level||5;return e.sell&&typeof e.sell=="object"?(t={...t},t.gold&&(t.gold=t.gold*this.state.sellRate),t):(typeof t=="object"&&(t=t.gold||5*e.level||5),Math.ceil(t*this.state.sellRate))},trySell(e,t,s=1){if(e.value<1&&!e.instanced)return!1;s>e.count&&(s=e.count),s<1&&(s=1);const i=this.sellPrice(e);return i.gold||typeof i=="object"?Object.keys(i).forEach(n=>{const r=this.getData(n),l=i[n];r.amount(s*(l||1))}):this.getData("gold").amount(s*this.sellPrice(e)),e.instanced?(e.count-=s,t&&(!e.stack||e.count<=0)&&t.remove(e)):this.remove(e,s),!0},remove(e,t=1){let s=typeof e=="string"?this.getData(e):e;if(!s){console.warn("missing remove id: "+e);return}s.slot&&this.state.getSlot(s.slot)===s&&this.state.setSlot(s.slot,null),s.remove(t),s.mod&&this.applyMods(s.mod,-t),s.lock&&this.unlock(s.lock,t),_t.add(s)},tryUnlock(e){if(e.disabled||e.locks>0)return!1;let t=e.require||e.need;return t&&!this.unlockTest(t,e)?!1:(e.doUnlock(this),!0)},unlockTest(e,t=null){if(e==null)return console.warn("test not found: "+e+" : "+t),!0;let s=typeof e;if(s==="function")return e(this._gdata,t,this.state);if(s==="string"){let i=this.getData(e);return i&&i.fillsRequire(this)}else if(Array.isArray(e)){for(let i=e.length-1;i>=0;i--)if(!this.unlockTest(e[i],t))return!1;return!0}else if(s==="object"){if(e.id)return e.fillsRequire(this);let i;for(let n in e)if(i=this.getData(n),i&&i.value<e[n])return!1;return!0}},applyVars(e,t=1,s=1,i=null,n=null){if(Array.isArray(e))for(let r of e)this.applyVars(r,t,s);else if(typeof e=="object"){let r,l=e[mt];if(l&&!l.roll())return;for(let a in e)if(r=this.getData(a),l=e[a],r==null)a===Nh?this.self.addTitle(l):a===Rh?w.emit(Ds,l):console.warn(a+" no effect target: "+l);else{let o;if(r.amount&&r.amount instanceof Function&&(o=r.amount.length>1?h=>r.amount(this,h):r.amount.bind(r)),typeof l=="number")o(l*t*s);else if(l.isRVal){const h={[C.GDATA]:this.gdata,[C.ITEM]:r,[C.ACTOR]:i,[C.TARGET]:n};o(s*t*l.getApply(h))}else l===!0?(r.doUnlock(this),r.onUse(this)):l.type===mt?l.roll(this.getData("luck").valueOf())&&o(1):r.applyVars(l,t,s);_t.add(r)}}else if(typeof e=="string"){let r=this.getData(e);r!==void 0&&(r.type==="monster"?r.amount(this,t):r.amount(t))}},removeMods(e){if(e){if(Array.isArray(e))for(const t of e)this.removeMods(t);else if(typeof e=="object")for(const t in e){const s=this.getData(t);s!=null&&(s.removeMods?s.removeMods(e[t]):console.warn("no removeMods(): "+s))}else if(typeof e=="string"){const t=this.getData(e);t&&(console.warn("!!! REMOVE NUM MOD: "+e),t.amount(-1))}}},applyMods(e,t=1){if(e){if(Array.isArray(e))for(const s of e)this.applyMods(s,t);else if(typeof e=="object")for(const s in e){const i=this.getData(s);if(i==null){console.warn("game.applyMods SKIPPED TARGET:",s,e);continue}else e[s]===!0?i.doUnlock(this):i.applyMods?i.applyMods(e[s],t):console.warn("no applyMods(): "+i);i.convert&&!this.state.converters.some(n=>n===i)&&this.state.converters.push(i)}else if(typeof e=="string"){const s=this.getData(e);s&&(console.warn("!!!!!!!!!!ADDED NUMBER MOD: "+e),s.amount(1))}}},canRun(e){return e.canRun?e.canRun(this,Bn):(console.error(e.id+" no canRun()"),!1)},canUse(e){if(!e.canUse)console.error(e.id+" no canUse()");else return e.canUse(this)},payCost(e,t=1){if(e!=null){if(Array.isArray(e))return e.forEach(s=>this.payCost(s,t),this);if(typeof e=="object")for(const s in e){const i=this.getData(s);if(!i||i.instanced||i.isRecipe)this.payInst(s,e[s]*t);else{const n=e[s];isNaN(n)?typeof n=="object"?i.applyVars(n,-t):typeof n=="function"&&this.remove(i,t*n(this.gdata,this.player)):this.remove(i,n*t)}}}},payInst(e,t){const s=this.state.inventory.find(e,!0);s?this.state.inventory.removeCount(s,t):console.warn("Too Low: "+e)},canMod(e,t){if(typeof e!="object")return!0;if(Array.isArray(e))return e.every(s=>this.canMod(s),this);for(const s in e){const i=e[s];if(!isNaN(i)||i instanceof Vt){const n=this.state.getData(s);if(n instanceof wl)return n.canPay(i);if(n instanceof He)return n.canPay(-i)}}return!0},canPay(e,t=1){if(Array.isArray(e))return e.every(i=>this.canPay(i,t),this);let s;if(typeof e=="object")for(const i in e){const n=e[i];if(s=this.state.getData(i),s){if(s.instanced||s.isRecipe){if(!this.state.inventory.hasCount(s,t*n))return!1}else if(!isNaN(n)||n.isRVal){if(!s.canPay)console.warn("Missing canPay function for",s);else if(!s.canPay(n*t))return!1}else if(!s.canPay)console.warn("Missing canPay function for",s);else if(!this.canPayObj(s,n,t))return!1}else return!1}return!0},canPayObj(e,t,s=1){if(!e)return!1;if(t instanceof Vt||!isNaN(t))return e.canPay?e.canPay(t*s):e>=t*s;typeof t!="object"&&isNaN(t)&&console.warn("canPayObj cost is non-object NaN",t);for(const i in t){let n=t[i];if(!isNaN(n)||n instanceof Vt){if(n.getApply instanceof Function&&(n=n.getApply({[C.GDATA]:this.gdata,[C.ACTOR]:this.player})),e.canPay){if(!e.canPay(n*s))return!1}else if(e.value<n*s)return!1}else if(typeof n=="object"&&!this.canPayObj(e[i],n,s))return!1}return!0},canEquip(e){let t=this.state.inventory.includes(e)?1:0;return this.state.equip.slots[e.slot].max<1?!1:this.state.equip.replaceCount(e)<=this.state.inventory.freeSpace()+t},equip(e,t=null){if(!this.canEquip(e))return!1;let s=this.state.equip.equip(e);s&&((t||this.state.inventory).remove(e),this.onUnequip(s),e.equip(this))},onUnequip(e){if(!(!e||typeof e=="boolean"))if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.onUnequip(e[t]);else this.state.inventory.full()?this.state.drops.add(e):this.state.inventory.add(e),e.unequip(this)},unequip(e,t){return this.onUnequip(this.state.equip.remove(t,e)),!0},take(e){return this.state.inventory.add(e)},getLoot(e,t=null){if(!e)return null;if(t=t||this.state.inventory,t.full()&&(t=this.state.drops),typeof e=="object"&&e.stack&&t.addStack(e)){w.emit(Sn,e);return}let s=this.itemGen.getLoot(e);s!=null&&(w.emit(Sn,s),t.add(s))},unlock(e){this.lock(e,-1)},lock(e,t=1){if(typeof e=="object"&&e[Symbol.iterator])for(let s of e)this.lock(s,t);else if(typeof e=="object")e.locks+=t;else{let s=this.getData(e);s&&this.lock(s,t)}},getData(e){return this._gdata[e]||this.state[e]}},Dp="modulepreload",Lp=function(e){return"/NecroArcane/"+e},wo={},gt=function(t,s,i){let n=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.allSettled(s.map(o=>{if(o=Lp(o),o in wo)return;wo[o]=!0;const h=o.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${f}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":Dp,h||(_.as="script"),_.crossOrigin="",_.href=o,a&&_.setAttribute("nonce",a),document.head.appendChild(_),h)return new Promise((x,T)=>{_.addEventListener("load",x),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(l){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l}return n.then(l=>{for(const a of l||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})},yt=(e,t)=>{const s=e.__vccOpts||e;for(const[i,n]of t)s[i]=n;return s},Np={emits:["update:modelValue"],props:["modelValue","items"],methods:{itemTitle(e){return e instanceof Object?e.name||e.desc||e.id:e},itemId(e){return e instanceof Object?e.id:e},setActive(e){this.$emit("update:modelValue",e)}}},Rp={class:"menu"},Pp={class:"menu-items"},jp=["onClick"],Up={class:"menu-content"};function Fp(e,t,s,i,n,r){return u(),c("div",Rp,[m("div",Pp,[(u(!0),c(tt,null,bt(s.items,l=>(u(),c("div",{class:"menu-item",role:"tab",key:l.id},[l!=s.modelValue?(u(),c("span",{onClick:a=>r.setActive(l),key:r.itemTitle(l)},[m("u",null,b(r.itemTitle(l)),1)],8,jp)):(u(),c("span",{key:"selected"+r.itemTitle(l)},b(r.itemTitle(l)),1))]))),128))]),m("span",Up,[rh(e.$slots,r.itemId(s.modelValue),{},void 0)])])}const Nu=yt(Np,[["render",Fp],["__scopeId","data-v-c8d9fe25"]]),ia={data(){return{inConfig:!1,hideUIMixin:{}}},mounted(){let e=this.$refs.btnHides;e&&e.addEventListener("click",t=>{t.preventDefault(),this.inConfig?(this.stopHides(),this.hide=this.newHides,this.newHides=null,t.target.classList.remove("inConfig")):(this.inConfig=!0,t.target.classList.add("inConfig"),this.newHides=this.hide,this.hide={},this.$nextTick(()=>this.configHides()))})},methods:{show(e){return(this.inConfig||!this.hide[e.id])&&!e.hide},configHides(){var e=this.$refs.hidables||this.$el,t=e.querySelectorAll(".hidable");if(t){this.onTogHide=i=>this.hideToggle(i);for(let i=t.length-1;i>=0;i--){var s=t[i];this.newHides[s.dataset.key]?s.classList.add("inConfig","configHiding"):s.classList.add("inConfig"),s.addEventListener("pointerdown",this.onTogHide,!0)}}},stopHides(){var e=this.$refs.hidables||this.$el,t=e.querySelectorAll(".hidable");if(t){for(let i=t.length-1;i>=0;i--){var s=t[i];s.removeEventListener("pointerdown",this.onTogHide,!0),s.classList.remove("configHiding","inConfig")}this.onTogHide=null,this.inConfig=!1}},hideToggle(e){e.preventDefault(),e.stopPropagation();let t=e.currentTarget,s=t.dataset.key;if(!s)return;let i=this.newHides[s];i==null?this.newHides[s]=!0:this.newHides[s]=!i,i?t.classList.remove("configHiding"):t.classList.add("configHiding")},beforeDestroy(){this.onTogHide=null}}},px=e=>!e.disabled&&e.type==="upgrade"&&!e.cost.space&&!v.state.typeCost(e.mod,"space")&&e.value>=1,gx=e=>!e.disabled&&(e.type==="furniture"||v.state.typeCost(e.cost,"space")>0||v.state.typeCost(e.mod,"space")>0)&&e.value>0,_x=e=>!e.disabled&&e.type==="resource"&&e.value>=.1,Hp=e=>{const t=v.state.getData(e).convert.output.effect;if(!t||!Object.keys(t).length)return!1;for(let s in t){let i=v.state.getData(s);if(it.getSubVars("ensureMaxProduction")){let n=wn(t,s,v.gdata);if(!i.maxed(n))return!1}else if(!i.maxed())return!1}return!0},Vp=e=>{const t=v.state.getData(e).convert.input;if(!t||!Object.keys(t).length)return!1;for(let[s,i]of Object.entries(t))if(!v.canPay({[s]:i},e.convert.singular?1:e.value))return!0;return!1},Ie={methods:{floor:Nd,slottable(e){return!(e.disabled||e.need&&!v.unlockTest(e.need,e)||e.buy&&!e.owned&&!v.canPay(e.buy)||e.slot&&v.state.getSlot(e.slot,e.type)===e)},reslocked(e){return e.disabled===!0||e.locks>0||e.locked!==!1},locked(e){return e.disabled===!0||e.locks>0||e.locked!==!1||e.maxed()},spending(e){let t=[e.id];e.tags&&(t=t.concat(e.tags));let s=[];const i=this.convertRate(t);i!==0&&s.push({name:"C",rate:i});const n=this.taskRate(t);n!==0&&s.push({name:"T",rate:n});const r=this.buffRate(t);return r!==0&&s.push({name:"B",rate:r}),s},convertRate(e){let t=0;for(let s of v.state.converters)if(!Hp(s)&&!Vp(s)){const i=s.convert.singular?1:s.value;s.convert.input&&Object.keys(s.convert.input).forEach(n=>{e.includes(n)&&(t-=this.addRate(s.convert.input[n]*i))}),s.convert.output.effect&&Object.keys(s.convert.output.effect).forEach(n=>{e.includes(n)&&(t+=this.addRate(s.convert.output.effect[n].value*i))})}return t},taskRate(e){let t=0;const s=v.state.runner.actives;for(let i of s)i.run&&Object.keys(i.run).forEach(n=>{e.includes(n)&&(t-=this.addRate(i.run[n]))}),i.effect&&Object.keys(i.effect).forEach(n=>{e.includes(n)&&(t+=this.addRate(i.effect[n].value))});return t},buffRate(e){let t=0;return this.player.dots.forEach(i=>{i.effect&&Object.keys(i.effect).forEach(n=>{e.includes(n)&&(t+=this.addRate(i.effect[n].value))})}),t},addRate(e){return e instanceof N?e.value:typeof e=="number"?e:0}}},qp={props:["items","group","hide"],mixins:[Ie],methods:{formatNumber:Uh},data(){return{isOpen:!0}},computed:{shown(){let e=[],t=this.items.length;for(let s=0;s<t;s++){let i=this.items[s];!this.reslocked(i)&&!this.hide[i.id]&&e.push(i)}return e}}},Bp={key:0},Gp={class:"arrows"},Wp={key:0},Jp=["data-key","onMouseenterCapture"],Kp={class:"item-name"},zp={class:"num-align"};function Xp(e,t,s,i,n,r){return r.shown.length>0?(u(),c("div",Bp,[m("div",{class:"groupTitle separate",onClick:t[0]||(t[0]=l=>n.isOpen=!n.isOpen)},[m("span",null,b(s.group),1),m("span",Gp,b(n.isOpen?"":""),1)]),n.isOpen?(u(),c("div",Wp,[(u(!0),c(tt,null,bt(r.shown,l=>(u(),c("div",{class:"rsrc separate hidable","data-key":l.id,key:l.id,onMouseenterCapture:Zt(a=>e.itemOver(a,l),["stop"])},[m("span",Kp,b(l.name),1),m("span",zp,b(r.formatNumber(l.value.value>0?Math.floor(l.value.value):0)+(l.max&&l.max.value>0?"/"+r.formatNumber(l.max.value):"")),1)],40,Jp))),128))])):g("",!0)])):g("",!0)}const Yp=yt(qp,[["render",Xp],["__scopeId","data-v-cb84b9d4"]]),$p={props:["items"],mixins:[ia],data(){let e=it.getSubVars("resview");return e.hide||(e.hide={}),{groups:null,hide:e.hide}},components:{group:Yp},computed:{hideTip(){return"Used to hide and unhide entries. This setting is retained between characters."}},created(){let e=this.items.sort((n,r)=>(n.sortOrder??1e4)-(r.sortOrder??1e4)),t={},s,i=e.length;for(let n=0;n<i;n++){let r=e[n];if(r.hide)continue;let l=r.group||(r.tags?r.tags[0]:"other");l==="manas"||l==="menace"||l==="specialty"||l==="t_endurance"||(s=t[l]||(t[l]=[]),s.push(r))}this.groups=t}},Qp={class:"res-list"},Zp={class:"config"},tg={class:"res-container"};function eg(e,t,s,i,n,r){const l=V("group");return u(),c("div",Qp,[m("div",Zp,[m("button",{type:"button",ref:"btnHides",class:"btnConfig",onMouseenterCapture:t[0]||(t[0]=Zt(a=>e.itemOver(a,null,null,null,r.hideTip),["stop"]))},null,544)]),m("div",tg,[(u(!0),c(tt,null,bt(n.groups,(a,o)=>(u(),lt(l,{class:"res-group",items:a,group:o,hide:n.hide,key:o},null,8,["items","group","hide"]))),128))])])}const Ru=yt($p,[["render",eg],["__scopeId","data-v-24f7b4f9"]]),sg={props:["items","preventClick"],mixins:[Ie],methods:{clickHandler(e){!this.preventClick&&e.canUse()&&this.emit("upgrade",e)},getStyle(e){return{"fade-in":!0,"task-btn":!0,hidable:!0,locked:this.locked(e)||e.owned&&!e.repeat,running:e.running,runnable:e.perpetual>0||e.length>0,disabled:!e.canUse()}}}},ig={class:"upgrades fade-in"},ng=["data-key","onClick","onMouseenterCapture"];function rg(e,t,s,i,n,r){return u(),c("div",ig,[(u(!0),c(tt,null,bt(s.items,l=>(u(),c("button",{"data-key":l.id,key:l.id,type:"button",class:Pt(r.getStyle(l)),onClick:a=>r.clickHandler(l),onMouseenterCapture:Zt(a=>e.itemOver(a,l),["stop"])},b(l.actname||l.name),43,ng))),128))])}const Pu=yt(sg,[["render",rg],["__scopeId","data-v-6e871140"]]),lg={class:"taskgroup"},ag={class:"arrows"},og={key:0},hg={__name:"taskGroup",props:["id","group","preventClick"],setup(e){const t=e,s=il(()=>{const[l,a]=t.group;return{key:l,title:l.toTitleCase(),items:a}}),i=il(()=>`taskGroup_${t.id}_${v.state.pid}`),n=bi(!0);Cf(()=>{n.value=it.getSubVar(i.value,s.value.key)??!0});function r(){n.value=it.setSubVar(i.value,s.value.key,!n.value)}return(l,a)=>(u(),c("div",lg,[m("div",{class:"titlebar",onClick:r},[m("span",ag,b(n.value?"":""),1),m("span",null,b(s.value.title),1),m("span",null,b(n.value?"":""),1)]),n.value?(u(),c("div",og,[O(Pu,{class:"task-list",items:s.value.items,preventClick:t.preventClick},null,8,["items","preventClick"])])):g("",!0)]))}},ug=yt(hg,[["__scopeId","data-v-e6f1cab6"]]),cg={mixins:[Ie,ia],components:{upgrades:Pu,taskGroup:ug},data(){let e=it.getSubVars("main");return e.hide||(e.hide={}),{hide:e.hide}},collapseSection(){},methods:{groupMap(e){const t=new Map;for(let s of e){const i=s.group??"other";let n=t.get(i);n?n.push(s):t.set(i,[s])}return[...t].sort((s,i)=>String(s[0]).localeCompare(i[0]))},isVisible(e){return!this.locked(e)&&this.show(e)},isTaskInfinite(e){return e.repeat&&!e.max}},computed:{hall(){return ht.hall.tasks.filter(this.isVisible)},tasks(){return v.state.tasks.filter(this.isVisible)},upgrades(){return v.state.upgrades.filter(this.isVisible)},classes(){return v.state.classes.filter(this.isVisible)},morals(){return this.tasks.filter(e=>e.morality)},allTasks(){return this.tasks.filter(t=>!t.morality).concat(this.hall)},visibleTasks(){const e=this.allTasks.filter(this.isTaskInfinite);return this.groupMap(e)},visibleUpgrades(){const e=this.allTasks.filter(i=>!this.isTaskInfinite(i)),s=this.upgrades.filter(i=>!i.buy||!i.owned).concat(e);return this.groupMap(s)},hideTip(){return"Used to hide and unhide entries. This setting is retained between characters."}}},fg=e=>(Ke("data-v-0f509fa9"),e=e(),ze(),e),dg={class:"main-tasks",ref:"hidables"},mg={class:"config"},pg=fg(()=>m("div",{class:"div-hs"},"Tasks",-1)),gg={key:0,class:"div-hs"},_g={key:1,class:"div-hs"},yg={key:2,class:"div-hs"};function vg(e,t,s,i,n,r){const l=V("taskGroup"),a=V("upgrades");return u(),c("div",dg,[m("div",mg,[m("button",{ref:"btnHides",class:"btnConfig",onMouseenterCapture:t[0]||(t[0]=Zt(o=>e.itemOver(o,null,null,null,r.hideTip),["stop"]))},null,544)]),pg,(u(!0),c(tt,null,bt(r.visibleTasks,o=>(u(),lt(l,{id:"tasks",group:o,preventClick:e.inConfig},null,8,["group","preventClick"]))),256)),r.visibleUpgrades.length!=0?(u(),c("div",gg,"Upgrades")):g("",!0),(u(!0),c(tt,null,bt(r.visibleUpgrades,o=>(u(),lt(l,{id:"upgrades",group:o,preventClick:e.inConfig},null,8,["group","preventClick"]))),256)),r.classes.length!=0?(u(),c("div",_g,"Classes")):g("",!0),O(a,{class:"upgrade-list",items:r.classes,preventClick:e.inConfig},null,8,["items","preventClick"]),r.morals.length!=0?(u(),c("div",yg,"Morality Options")):g("",!0),O(a,{class:"upgrade-list",items:r.morals,preventClick:e.inConfig},null,8,["items","preventClick"])],512)}const ju=yt(cg,[["render",vg],["__scopeId","data-v-0f509fa9"]]),bg={props:["bars"],methods:{abbr:Fh},computed:{bar(){return this.bars.active},slots(){return this.bar.slots},hasItems(){return this.slots.some(e=>e.item!=null)}}},kg=e=>(Ke("data-v-728274da"),e=e(),ze(),e),xg={key:0,class:"quickbar"},wg=["onClick","onMouseenterCapture"],Tg=["onClick"],Sg={key:1,class:"container"},Ag={key:1,class:"quickbar"},Og=kg(()=>m("p",{class:"info-text"},[Jt(" Roll-over Item and hold {Shift} + {Number} to assign quickslot."),m("br"),Jt(" Press {Number} again to use quickslot Item. ")],-1)),Mg=[Og];function Cg(e,t,s,i,n,r){return r.hasItems?(u(),c("div",xg,[(u(!0),c(tt,null,bt(r.slots,(l,a)=>{var o;return u(),c("div",{class:Pt(["quickslot",["fill",((o=l.item)==null?void 0:o.school)??"gray"]]),key:a},[l.item!=null?(u(),c("div",{key:0,onClick:h=>e.emit("quickslot",l),onMouseenterCapture:Zt(h=>e.itemOver(h,l.item||l),["stop"]),class:"container"},[m("div",null,b(r.abbr(l)),1),m("div",{class:"remove",onClick:h=>r.bar.clear(a)},null,8,Tg)],40,wg)):(u(),c("div",Sg,b(a!=9?a+1:0),1))],2)}),128))])):(u(),c("div",Ag,Mg))}const Eg=yt(bg,[["render",Cg],["__scopeId","data-v-728274da"]]),Ig={props:["value","max","label","hideStats","type","color","revbar","smallbar"],data(){return{delta:void 0}},emits:["mouseenter"],watch:{value(e,t){typeof t=="number"&&(this.delta=Math.abs((e-t)/this.max))}},computed:{style(){const e=it.get("smoothBars");let t="width:"+this.width+"%";return this.color&&(t+=";background:"+this.color),typeof this.delta=="number"&&e&&(t+=";transition: width ",t+=_r*2,t+="ms ease-out"),t},width(){const e=this.revbar?100-Math.floor(100*(this.value/this.max)):Math.floor(100*(this.value/this.max));return e>100?100:e<0?0:e},shownValue(){return this.smallbar?"":this.value.toFixed(1)+"/"+this.max.toFixed(1)}}},Dg=["for"],Lg=["id"],Ng={key:0,class:"bar-text"},Rg={key:1};function Pg(e,t,s,i,n,r){return u(),c("div",{class:Pt([this.smallbar?"small":"","container"]),onMouseenterCapture:t[0]||(t[0]=l=>this.$emit("mouseenter",l))},[s.label?(u(),c("label",{key:0,for:e.elmId("bar")},b(s.label),9,Dg)):g("",!0),m("div",{class:"bar",id:e.elmId("bar")},[m("div",{class:Pt(["barfill",s.type]),style:Ui(r.style)},[!s.hideStats&&this.shownValue!=""?(u(),c("span",Ng,b(r.shownValue),1)):(u(),c("span",Rg,""))],6)],8,Lg)],34)}const Uu=yt(Ig,[["render",Pg],["__scopeId","data-v-b2bf9dc2"]]),jg={props:["runner"],created(){this.game=v,this.STOP_ALL=nu,this.TASK=ir,this.autofocus=!1},computed:{focus(){return v.state.getData("focus")},restAction(){return v.state.restAction||v.getData("rest")},resting(){return this.restAction.running||!this.restAction.canRun(this.game)},hobbies(){return v.state.getData(Jl)},goals(){return v.state.getData(Kl)},activitiesTip(){return"Displays your active and waiting tasks in greater detail."}},data(){return{highlightAutoFocus:!1}},methods:{taskStr(e){return(e.verb||e.name.toTitleCase())+(e.length?" "+Math.floor(e.percent())+"%":"")},levelStr(e){return" ("+Math.floor(e.valueOf())+"/"+Math.floor(e.max.valueOf())+")"},halt(e){this.emit(ru,e)},autofocusSwitch(e){e?(v.activeRepeaters.set(this.focus,0),this.autofocus=!0,this.highlightAutoFocus=!1):this.autofocus?(v.activeRepeaters.delete(this.focus),this.highlightAutoFocus=!1,this.autofocus=!1):(v.activeRepeaters.set(this.focus,0),this.autofocus=!0,this.highlightAutoFocus=!0)}}},Fu=e=>(Ke("data-v-82e0e4f2"),e=e(),ze(),e),Ug={class:"separate-run"},Fg=["disabled"],Hg=["disabled"],Vg={class:"running"},qg=["onMouseenterCapture"],Bg=["onClick"],Gg={key:0},Wg=["onClick"],Jg=["onClick"],Kg={class:"relative"},zg=Fu(()=>m("button",{type:"button",class:"stop",disabled:""},"X",-1)),Xg=Fu(()=>m("span",null,"Idle",-1)),Yg=[zg,Xg];function $g(e,t,s,i,n,r){return u(),c("div",null,[m("div",Ug,[m("button",{type:"button",class:"btn-sm",onClick:t[0]||(t[0]=l=>e.emit(e.STOP_ALL))},"Stop All"),r.focus.locked?g("",!0):(u(),c("button",{key:0,type:"button",class:"btn-sm",onMouseenterCapture:t[1]||(t[1]=Zt(l=>e.itemOver(l,r.focus),["stop"])),disabled:!r.focus.canUse,onMousedown:t[2]||(t[2]=l=>r.autofocusSwitch(!0)),onMouseup:t[3]||(t[3]=l=>r.autofocusSwitch(!1)),onClick:t[4]||(t[4]=l=>e.emit(e.TASK,r.focus))}," Focus ",40,Fg)),r.focus.locked?g("",!0):(u(),c("button",{key:1,type:"button",class:Pt(["btn-sm",{highlighted:n.highlightAutoFocus}]),onClick:t[5]||(t[5]=l=>r.autofocusSwitch(!1)),id:"auto",disabled:!r.focus.canUse}," Auto Focus ",10,Hg)),m("button",{type:"button",class:"btnMenu",onMouseenterCapture:t[6]||(t[6]=Zt(l=>e.itemOver(l,null,null,null,r.activitiesTip),["stop"])),onClick:t[7]||(t[7]=l=>e.emit("showActivities"))},null,32)]),m("div",Vg,[(u(!0),c(tt,null,bt(s.runner.actives,l=>(u(),c("div",{class:"relative",key:l.id,onMouseenterCapture:Zt(a=>e.itemOver(a,l),["stop"])},[m("button",{type:"button",class:"stop",onClick:a=>r.halt(l)},"X",8,Bg),m("span",null,b(r.taskStr(l)),1),l.type==="skill"?(u(),c("span",Gg,b(r.levelStr(l)),1)):g("",!0),s.runner.canGoal(l)?(u(),c("button",{key:1,type:"button",v:"",class:Pt(["goal",r.goals.includes(s.runner.baseTask(l))?"current":""]),onClick:a=>s.runner.toggleGoal(l)}," G ",10,Wg)):g("",!0),s.runner.canPursuit(l)?(u(),c("button",{key:2,type:"button",v:"",class:Pt(["pursuit",r.hobbies.includes(s.runner.baseTask(l))?"current":""]),onClick:a=>s.runner.togglePursuit(l)}," H ",10,Jg)):g("",!0)],40,qg))),128)),(u(!0),c(tt,null,bt(Math.max(Math.floor(s.runner.max-s.runner.actives.length),0),l=>(u(),c("div",Kg,Yg))),256))])])}const Qg=yt(jg,[["render",$g],["__scopeId","data-v-82e0e4f2"]]),Zg={props:["state"],mixins:[Ie,ia],components:{progbar:Uu,running:Qg},data(){let e=it.getSubVars("");return e.hide||(e.hide={}),{hide:e.hide}},computed:{hp(){return this.state.getData("hp")},barrier(){return this.state.getData("barrier")},stamina(){return this.state.getData("stamina")},vigor(){return this.state.getData("vigor")},mana(){return this.state.getData("mana")},manaElementList(){return this.state.filterItems(e=>e.hasTag("element")&&!e.locked)},visManaElementList(){return this.manaElementList.filter(e=>this.show(e)).sort((e,t)=>e.sortOrder-t.sortOrder)},manaPrimalList(){return this.state.filterItems(e=>e.hasTag("primal")&&!e.locked)},visManaPrimalList(){return this.manaPrimalList.filter(e=>this.show(e)).sort((e,t)=>e.sortOrder-t.sortOrder)},manaFundamentalList(){return this.state.filterItems(e=>e.hasTag("fundamental")&&!e.locked)},visManaFundamentalList(){return this.manaFundamentalList.filter(e=>this.show(e)).sort((e,t)=>e.sortOrder-t.sortOrder)},specials(){return this.state.filterItems(e=>e.hasTag("specialty")&&!e.locked)},visSpecials(){return this.specials.filter(e=>this.show(e))},menaces(){return this.state.filterItems(e=>e.hasTag("menace")&&e.value>0)},visMenaces(){return this.menaces.filter(e=>this.show(e))},labelManaElemental(){return this.visManaElementList.length>0},labelManaPrimal(){return this.visManaPrimalList.length>0},labelManaFundamental(){return this.visManaFundamentalList.length>0},labelSpecialMenace(){return this.visMenaces.length>0||this.visSpecials.length>0},showBarrier(){return this.show(this.barrier)&&!this.barrier.locked},showMana(){return this.show(this.mana)&&!this.mana.locked},labelManas(){return this.showMana||this.labelManaElemental||this.labelManaPrimal||this.labelManaFundamental},hideTip(){return"Used to hide and unhide entries. This setting is retained between characters."}}},Qi=e=>(Ke("data-v-7a1593f9"),e=e(),ze(),e),t_={class:"vitals"},e_={class:"config"},s_={class:"statbars"},i_=Qi(()=>m("div",{class:"category-label"},"Body",-1)),n_={class:"hidable statbar","data-key":"hp"},r_=Qi(()=>m("span",{class:"name"},"life",-1)),l_={class:"barspan"},a_={class:"hidable statbar","data-key":"barrier"},o_=Qi(()=>m("span",{class:"name"},"barrier",-1)),h_={class:"barspan"},u_={class:"hidable statbar","data-key":"stamina"},c_=Qi(()=>m("span",{class:"name"},"Stamina",-1)),f_={class:"barspan"},d_={class:"category-label"},m_={class:"hidable statbar","data-key":"mana"},p_=Qi(()=>m("span",{class:"name"},"mana",-1)),g_={class:"barspan"},__={class:"subcategory-label"},y_=["data-key"],v_={class:"name"},b_={class:"barspan"},k_={class:"subcategory-label"},x_=["data-key"],w_={class:"name"},T_={class:"barspan"},S_={class:"category-label"},A_=["data-key"],O_={class:"name"},M_={class:"barspan"},C_={class:"category-label"},E_=["data-key"],I_={class:"name"},D_={class:"barspan"},L_=["data-key"],N_={class:"name"},R_={class:"barspan"};function P_(e,t,s,i,n,r){const l=V("running"),a=V("progbar");return u(),c("div",t_,[O(l,{runner:s.state.runner},null,8,["runner"]),m("div",e_,[m("button",{type:"button",ref:"btnHides",class:"btnConfig",onMouseenterCapture:t[0]||(t[0]=Zt(o=>e.itemOver(o,null,null,null,r.hideTip),["stop"]))},null,544)]),m("div",s_,[i_,At(m("div",n_,[r_,m("span",l_,[O(a,{type:"hp",value:r.hp.valueOf(),max:r.hp.max.value,onMouseenter:t[1]||(t[1]=o=>e.itemOver(o,r.hp))},null,8,["value","max"])])],512),[[ke,e.show(r.hp)]]),At(m("div",a_,[o_,m("span",h_,[O(a,{type:"barrier",value:r.barrier.valueOf(),max:r.barrier.max.value,onMouseenter:t[2]||(t[2]=o=>e.itemOver(o,r.barrier))},null,8,["value","max"])])],512),[[ke,r.showBarrier]]),At(m("div",u_,[c_,m("span",f_,[O(a,{type:"stamina",value:r.stamina.valueOf(),max:r.stamina.max.value,onMouseenter:t[3]||(t[3]=o=>e.itemOver(o,r.stamina))},null,8,["value","max"])])],512),[[ke,e.show(r.stamina)]]),At(m("div",d_,"Prismatic Energies",512),[[ke,r.labelManas]]),At(m("div",m_,[p_,m("span",g_,[O(a,{type:"mana",value:r.mana.valueOf(),max:r.mana.max.value,onMouseenter:t[4]||(t[4]=o=>e.itemOver(o,r.mana))},null,8,["value","max"])])],512),[[ke,r.showMana]]),At(m("div",__,"Elemental",512),[[ke,r.labelManaElemental]]),(u(!0),c(tt,null,bt(r.visManaElementList,o=>(u(),c("div",{class:"hidable statbar fade-in",key:o.key,"data-key":o.id},[m("span",v_,b(o.name),1),m("span",b_,[O(a,{value:o.valueOf(),type:o.id,max:o.max.value,color:o.color,onMouseenter:h=>e.itemOver(h,o)},null,8,["value","type","max","color","onMouseenter"])])],8,y_))),128)),At(m("div",k_,"Primal",512),[[ke,r.labelManaPrimal]]),(u(!0),c(tt,null,bt(r.visManaPrimalList,o=>(u(),c("div",{class:"hidable statbar fade-in",key:o.key,"data-key":o.id},[m("span",w_,b(o.name),1),m("span",T_,[O(a,{value:o.valueOf(),type:o.id,max:o.max.value,color:o.color,onMouseenter:h=>e.itemOver(h,o)},null,8,["value","type","max","color","onMouseenter"])])],8,x_))),128)),At(m("div",S_,"Fundamental Energies",512),[[ke,r.labelManaFundamental]]),(u(!0),c(tt,null,bt(r.visManaFundamentalList,o=>(u(),c("div",{class:"hidable statbar fade-in",key:o.key,"data-key":o.id},[m("span",O_,b(o.name),1),m("span",M_,[O(a,{value:o.valueOf(),type:o.id,max:o.max.value,color:o.color,onMouseenter:h=>e.itemOver(h,o)},null,8,["value","type","max","color","onMouseenter"])])],8,A_))),128)),At(m("div",C_,"Specialties & Menaces",512),[[ke,r.labelSpecialMenace]]),(u(!0),c(tt,null,bt(r.visSpecials,o=>(u(),c("div",{class:"hidable statbar fade-in",key:o.key,"data-key":o.id},[m("span",I_,b(o.name),1),m("span",D_,[O(a,{value:o.valueOf(),type:o.id,max:o.max.value,color:o.color,onMouseenter:h=>e.itemOver(h,o)},null,8,["value","type","max","color","onMouseenter"])])],8,E_))),128)),(u(!0),c(tt,null,bt(r.visMenaces,o=>(u(),c("div",{class:"hidable statbar",key:o.key,"data-key":o.id},[m("span",N_,b(o.name),1),m("span",R_,[O(a,{value:o.valueOf(),type:o.id,max:o.max.value,color:o.color,onMouseenter:h=>e.itemOver(h,o)},null,8,["value","type","max","color","onMouseenter"])])],8,L_))),128))])])}const j_=yt(Zg,[["render",P_],["__scopeId","data-v-7a1593f9"]]),U_={props:["dots","mini","char"],mixins:[Ie],beforeCreate(){this.abbr=Fh}},F_=e=>(Ke("data-v-81f3eae2"),e=e(),ze(),e),H_={key:0,class:"dot-view"},V_=["onMouseenterCapture"],q_={key:0},B_={key:1},G_={key:2},W_=F_(()=>m("br",null,null,-1));function J_(e,t,s,i,n,r){return s.dots.length>0?(u(),c("div",H_,[(u(!0),c(tt,null,bt(s.dots,l=>(u(),c("div",{class:Pt(["dot",s.mini?"mini":"","fill",l.kind??l.school]),key:l.id,onMouseenterCapture:Zt(a=>e.itemOver(a,l,s.char),["stop"])},[l.perm?s.mini?(u(),c("span",B_,"")):g("",!0):(u(),c("span",q_,b(Math.ceil(l.duration)),1)),s.mini?g("",!0):(u(),c("span",G_,[W_,Jt(b(s.mini?e.abbr(l):l.name),1)]))],42,V_))),128))])):g("",!0)}const K_=yt(U_,[["render",J_],["__scopeId","data-v-81f3eae2"]]),z_={data(){return{active:ht.active}}},X_={key:0},Y_={key:1};function $_(e,t,s,i,n,r){return n.active.loggedIn?(u(),c("span",X_,[m("button",{type:"button",onClick:t[0]||(t[0]=l=>e.dispatch("logout"))},"Logout")])):(u(),c("span",Y_,[m("button",{type:"button",onClick:t[1]||(t[1]=l=>e.dispatch("show-login"))},"Login")]))}const Q_=yt(z_,[["render",$_]]),Z_={computed:{hasHall(){return ht.hasHall()},VERSION(){return"stable 0.0.2"}},created(){this.Profile=ht},components:{login:Q_},methods:{fileSelect(e){e.stopPropagation(),e.preventDefault(),this.dispatch("load-file",e.target.files)},fileDrop(e){e.stopPropagation(),e.preventDefault(),e.target.classList.remove("hilite");const t=e.dataTransfer;this.dispatch("load-file",t.files)},fileDrag(e){e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.add("hilite")},dragOut(e){e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.remove("hilite")}}},yr=e=>(Ke("data-v-309c3892"),e=e(),ze(),e),ty={class:"top-bar"},ey={class:"load-opts"},sy={class:"items"},iy={class:"link-bar"},ny=yr(()=>m("a",{class:"item",href:"https://arcanumtesting.gitlab.io/arcanum/",target:"_blank"},"Test Site",-1)),ry=yr(()=>m("a",{class:"item",href:"https://discord.gg/bCABC96",target:"_blank"},"Discord",-1)),ly=yr(()=>m("a",{class:"item",href:"https://theoryofmagic.miraheze.org/wiki/Main_Page",target:"_blank"},"Wiki",-1)),ay=yr(()=>m("a",{class:"item",href:"https://www.reddit.com/r/wizrobe/",target:"_blank"},"Reddit",-1)),oy={class:"vers item"};function hy(e,t,s,i,n,r){const l=V("login");return u(),c("div",ty,[m("span",ey,[e.Profile.CLOUD?(u(),lt(l,{key:0})):g("",!0),m("button",{type:"button",onClick:t[0]||(t[0]=a=>e.dispatch("save"))},"Save"),m("button",{type:"button",onClick:t[1]||(t[1]=a=>e.dispatch("load"))},"Load"),m("button",{type:"button",onClick:t[2]||(t[2]=a=>e.emit("save-file-check",a))},"Get Save"),r.hasHall?(u(),c("button",{key:1,type:"button",class:"text-button",onClick:t[3]||(t[3]=a=>e.dispatch("hall-file",a))}," Hall Save ")):g("",!0),m("button",{type:"button",id:"drop-file",onClick:t[4]||(t[4]=a=>e.$refs.fileInput.click()),onDrop:t[5]||(t[5]=(...a)=>r.fileDrop&&r.fileDrop(...a)),onDragover:t[6]||(t[6]=(...a)=>r.fileDrag&&r.fileDrag(...a)),onDragleaveCapture:t[7]||(t[7]=Zt((...a)=>r.dragOut&&r.dragOut(...a),["stop"])),name:"[Load Save]"}," [Load Save] ",32),m("input",{ref:"fileInput",type:"file",onChange:t[8]||(t[8]=(...a)=>r.fileSelect&&r.fileSelect(...a)),accept:"text/json text/*"},null,544)]),m("span",sy,[rh(e.$slots,"center",{},void 0)]),m("span",iy,[ny,ry,ly,ay,m("span",oy,b(r.VERSION),1),m("button",{type:"button",class:"text-button item",onClick:t[9]||(t[9]=a=>e.$emit("open-settings"))},"")])])}const uy=yt(Z_,[["render",hy],["__scopeId","data-v-309c3892"]]),pn=20,cy=(e,t)=>{const s=t.top-40;return s<pn?pn:s+e.offsetHeight>window.innerHeight-pn?window.innerHeight-pn-e.offsetHeight:s},Hu=e=>{e.style.left=(window.innerWidth-e.offsetWidth)/2+"px"},yx=(e,t)=>{const s=e.style;s.left=(window.innerWidth-e.offsetWidth)/2+"px",s.top=(t||.5)*(window.innerHeight-e.offsetHeight)+"px"},fy=(e,t,s=32)=>{const i=e.style,n=t.getBoundingClientRect(),r=n.left;r<window.innerWidth/2?i.left=r+t.offsetWidth+s+"px":i.left=r-e.offsetWidth-s+"px",i.top=cy(e,n)+"px"},To="This action is not reversible. Continue?",dy={emits:["confirmed"],data(){return{item:null,cb:null,nowarn:!1,nomsg:!1,passon:null}},updated(){this.item&&Hu(this.$el)},computed:{msg(){return typeof this.item=="string"?To:this.item.warnMsg||To}},methods:{show(e,t=null,s=!1,i=null){this.item=e,this.cb=t,this.nowarn=!1,this.nomsg=s,this.passon=i},confirm(){let e=this.item,t=this.cb,s=this.nowarn,i=this.passon;this.item=null,this.cb=null,this.nowarn=!1,this.passon=null,this.nomsg=!1,e&&this.$emit("confirmed",e,s,i),t&&t()},cancel(){this.cb=null,this.nowarn=!1,this.item=null,this.passon=null,this.nomsg=!1}}},my={key:0,class:"popup"},py={key:0},gy={key:0},_y={key:1},yy={class:"log-title"},vy={key:0},by={class:"skip"},ky=["for"],xy=["id"];function wy(e,t,s,i,n,r){return n.item?(u(),c("div",my,[typeof n.item=="string"?(u(),c("div",py,[m("div",null,b(n.item),1),n.nomsg?g("",!0):(u(),c("div",gy,b(r.msg),1))])):(u(),c("div",_y,[m("div",yy,b(n.item.name.toString().toTitleCase()),1),m("div",null,b(n.item.desc),1),n.nomsg?g("",!0):(u(),c("div",vy,b(r.msg),1)),m("div",by,[m("label",{for:e.elmId("nowarn")},"Skip Warning",8,ky),At(m("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=l=>n.nowarn=l),id:e.elmId("nowarn")},null,8,xy),[[$e,n.nowarn]])])])),m("div",null,[m("button",{type:"button",onClick:t[1]||(t[1]=(...l)=>r.confirm&&r.confirm(...l))},"Confirm"),m("button",{type:"button",onClick:t[2]||(t[2]=(...l)=>r.cancel&&r.cancel(...l))},"Cancel")])])):g("",!0)}const Ty=yt(dy,[["render",wy],["__scopeId","data-v-88c1b0d0"]]);class Sy{constructor(t,s,i,n,r=null,l=null){this.name=t.toTitleCase(),this.value=s,this.isRate=i,this.isAvailable=n,this.maxLength=r,this.currentLength=l}add(t){this.value=this.value+t}toString(){const t=typeof this.value;return t==="boolean"?this.name:Math.abs(this.value)>0||typeof this.value.toString()=="string"?this.name+": "+(t==="object"?this.value.toString():Q(this.value))+(this.isRate?"/s":""):null}}const Al=e=>{let t=B.context.getData(e,!1);return t?t.name:e},Ss=Object.freeze({COST:"cost",NEED:"need",FULL:"maxed",MOD:"mod"});function Vr(e,t){return[e,t]}function Ay(){}const So={mod:(e,t)=>[e,t+" "],runmod:(e,t)=>[e,t+" "],base:Vr,value:Vr,statedata:Vr,skipLocked:Ay,max:(e,t)=>[e,"Max "+t],min:(e,t)=>[e,"Min "+t],default:(e,t,s)=>(s.startsWith(cs)?(s=prop.slice(cs.length),s=Al(s),s="Existing "+s):s=Al(s),[e?e+" "+t:t,s])},Oy=(e,t,s)=>(So[s]??So.default)(e,t,s);let gn=class{static GetItem(t,s=null){return(s==null?void 0:s[t])||s||B.context.getData(t,!1)}constructor(){this.results={}}clear(){this.results={}}add(t,s,i=!1,n=null,r=null,l=null){r&&r.reverseDisplay&&(s=-s);let a=this.results[t],o=B.context;if(a===void 0){let h=!0;if(r instanceof Object&&n&&st(o)===v){if(n===Ss.NEED&&r.fillsRequire instanceof Function&&h&&(h=r.fillsRequire(o)),n===Ss.COST&&r.canPay instanceof Function&&!(r.isRecipe||r.instanced)&&h&&(h=r.canPay(s)),n===Ss.COST&&(r.isRecipe||r.instanced)){let f={};f[r.id]=s,h&&(h=v.canPay(f))}n===Ss.FULL&&r.maxed instanceof Function&&h&&(h=!r.maxed())}if(n===Ss.NEED&&l instanceof Function&&(h&&(h=l(v.gdata,null,v.state)),t=l.toString()),s.toString()!=="0"){let f=B.item,_=f.length?(f.length-f.exp)/f.rate:null,x=f.length?f.length/f.rate:null;this.results[t]=new Sy(t,s,i,h,x,_)}}else a.add(s)}};const My=/^function *\w+\( *(?<params>[^\)]+) *\) *{ *return +(?<body>.*)}$/,Cy=new RegExp("^\\( *(?:(?:(?<! |\\() *\\|\\| *)?(?:\\+g\\.(\\w+)|g\\.(\\w+) *> *0)){2,} *\\)$|^\\( *(?:(?:(?<! |\\() *\\+ *)?g\\.(\\w+)){2,} *\\)(?: *> *0)?$|^ *(?:(?:(?<!^| ) *\\|\\| *)?(?:\\+g\\.(\\w+)|g\\.(\\w+) *> *0)){2,}$|^(?:(?:(?<!^| |\\() *\\+ *)?g\\.(\\w+)){2,}(?: *> *0)?$"),Ey=/g\.(?<id>\w+)(?!\.)/g,Iy={props:["title","info","text","rate","checkType","target","require","separate"],mixins:[Ie],components:{progbar:Uu,dot:pt(()=>gt(()=>Promise.resolve().then(()=>$v),void 0)),attack:pt(()=>gt(()=>Promise.resolve().then(()=>qu),void 0))},beforeCreate(){this.infos=new gn,this.player=v.state.player,this.CheckTypes=Ss},computed:{isAvailable(){for(const e in this.infos.results)if(!this.infos.results[e].isAvailable)return!1;return!0},totalRateSetting(){return it.get("totalRate")}},methods:{precise:Q,processInfo(){return!this.info||(this.infos.clear(),this.subTitle=null,this.item=B.item,this.source=B.source,this.items=this.process(this.info),this.items==null)?!1:Object.keys(this.items).length>1||Object.keys(this.items.eff).length>0},process(e){let t=typeof e;return t==="string"?this.processString(e):t==="number"?this.processNumber(e):t==="function"?this.processFunction(e):Array.isArray(e)?this.processArray(e):t==="object"?this.processObject(e):null},processNumber(e){const t=gn.GetItem("gold");return t?(this.infos.add(t.name,e,this.rate,this.checkType,t),{eff:this.infos.results}):null},processString(e){return this.infos.add(Al(e),!0,!1,this.checkType,gn.GetItem(e)),{eff:this.infos.results}},processFunction(e){if(this.text)return this.infos.add(this.text,!0,!1,this.checkType,null,e),{eff:this.infos.results};if(!this.require)return null;const t=My.exec(e.toString().replaceAll(`
`,""));if(!t)return null;const s=t.groups.body;if(!Cy.test(s))return null;this.subTitle="One of";for(const i of s.matchAll(Ey))this.effectList(i.groups.id);return{eff:this.infos.results}},processArray(e){for(const t of e)this.effectList(t);return{eff:this.infos.results}},processObject(e){if(this.separate){let{attack:t,dot:s,...i}=e;return this.effectList(i),{attack:t,dot:s,eff:this.infos.results}}else return this.effectList(e),{eff:this.infos.results}},effectList(e){if(typeof e=="string")return this.processString(e);if(typeof e=="function"&&this.text)return this.processFunction(e);this.crawlObject(e,null,"","")},crawlObject(e,t,s,i){for(let n in e){let r=e[n];if(r==null)continue;const l=n==="self"&&this.target||n;let a=Oy(s,i,l);if(a===void 0)continue;const[o,h]=a,f=o?o+" "+h:h;n.startsWith(cs)&&(n=n.slice(cs.length));let _=gn.GetItem(n,t);if(r instanceof Rt){this.infos.add(f,this.evaluateFValue(r),this.rate,this.checkType,_);continue}if(!(r instanceof Object)){this.infos.add(f,r,this.rate,this.checkType,_);continue}if(!this.isSkipLocked(r,_)){if(r.constructor!==Object&&r.constructor.name!=="Attack"){this.infos.add(f,r,this.rate,this.checkType,_);continue}if(r.constructor.name!=="Attack"){if(r[mt]&&r.value){this.crawlChancedObject(r,o,h);continue}f==="dot"&&(r={...r},r.id&&delete r.id,r.name&&delete r.name,r[void 0]&&delete r[void 0],r.tags&&(r.tags=r.tags.split(",").map(x=>{let T=v.state.tagSets[x];return T?T.name:x}))),this.crawlObject(r,_,o,h)}}}},crawlChancedObject(e,t,s){const i=t?t+" "+s:s,n=e[mt],r=Wh(+n.pct*100,+this.player.luck).toPrecision(2),l=e.value,a=typeof l=="object"?l.toString():Q(l).toString();let o;a!=1?o=`${i}: ${n} (${r}%) for ${a}`:o=`${i}: ${n} (${r}%)`,this.infos.add(o,!0)},isSkipLocked(e,t){return!e.skipLocked||!t?!1:t.disabled===!0||t.locks>0||t.locked!==!1},evaluateFValue(e){let t=this.item instanceof wt?this.item:null;t??(t=this.source instanceof wt?this.source:this.player);let s=this.player;return e.applyDummy({[C.GAME]:v.gdata,[C.ACTOR]:t,[C.TARGET]:s,[C.CONTEXT]:s.context,[C.STATE]:v.state})}}},na=e=>(Ke("data-v-402a9290"),e=e(),ze(),e),Dy={key:0,class:"info-block"},Ly={key:0,class:"note-text"},Ny=na(()=>m("hr",null,null,-1)),Ry={key:0,class:"note-text"},Py={key:0},jy={key:0},Uy={key:1,class:"calc-text"},Fy={key:0},Hy={key:1},Vy={key:2},qy=na(()=>m("div",{class:"info-sect"},"Applies:",-1)),By={key:3},Gy=na(()=>m("div",{class:"info-sect"},"Attack",-1));function Wy(e,t,s,i,n,r){const l=V("dot"),a=V("attack");return r.processInfo()?(u(),c("div",Dy,[s.title?(u(),c("div",Ly,[Ny,Jt(" "+b(s.title),1)])):g("",!0),m("div",null,[e.subTitle?(u(),c("div",Ry,b(e.subTitle),1)):g("",!0),m("div",{class:Pt(e.subTitle?"info-subsubsect":"")},[s.text?(u(),c("span",{key:0,class:Pt(["replacetext",{failed:!r.isAvailable,full:s.checkType===e.CheckTypes.FULL}])},[Jt(b(s.text)+" ",1),!r.isAvailable&&s.checkType===e.CheckTypes.FULL?(u(),c("span",Py,"(Full)")):g("",!0)],2)):(u(!0),c(tt,{key:1},bt(e.items.eff,o=>(u(),c("div",{key:o.name},[o.toString()!=null&&o!=null?(u(),c("span",{key:0,class:Pt({failed:!o.isAvailable,full:s.checkType===e.CheckTypes.FULL})},[Jt(b(o.toString())+" ",1),!o.isAvailable&&(Math.abs(o.value)>0||typeof o.value.toString()=="string")&&s.checkType===e.CheckTypes.FULL?(u(),c("span",jy,"(Full)")):g("",!0),r.totalRateSetting&&o.isRate&&o.maxLength?(u(),c("span",Uy,[o.value.type==="range"?(u(),c("span",Fy," ~("+b(r.precise(o.currentLength*o.value.avg,1))+"/"+b(r.precise(o.maxLength*o.value.avg,1))+")",1)):(u(),c("span",Hy,"("+b(r.precise(o.currentLength*o.value,1))+"/"+b(r.precise(o.maxLength*o.value,1))+") ",1))])):g("",!0)],2)):g("",!0)]))),128)),e.items.dot?(u(),c("div",Vy,[qy,O(l,{dot:e.items.dot,target:s.target,item:e.item},null,8,["dot","target","item"])])):g("",!0),e.items.attack?(u(),c("div",By,[Gy,O(a,{item:e.item,atk:e.items.attack,hideDmg:e.item.type=="enchant"||e.item.type=="alter"},null,8,["item","atk","hideDmg"])])):g("",!0)],2)])])):g("",!0)}const ra=yt(Iy,[["render",Wy],["__scopeId","data-v-402a9290"]]);function la(e="item"){return{methods:{getTarget(){const t=this[e];return t.context?t.context.state.self:B.item instanceof wt?B.item:B.source instanceof wt?B.source:v.state.player},getActor(){const t=this[e];return t.source instanceof wt?t.source:t.applier instanceof wt?t.applier:t.context?t.context.state.self:B.item instanceof wt||B.item instanceof Ou?B.item:B.source instanceof wt?B.source:v.state.player},getDamage(t,s=null){if(s)return t.damage instanceof Rt||t.dmg instanceof Rt?!0:t.damage||t.dmg;let i=t.damage||t.dmg;return this.getDamageStr(i,t)},getDamageStr(t,s){let i=this.getDamageMult(s),n=this.getDamageBonus(s);if(s.showinstanced&&(i=1,n=0),t){if(typeof t=="number")return Q(t*i+n)}else return null;if(t instanceof Rt)return this.getDummyDamage(t,i,n);if(t){let r;return t instanceof Mt?(r=t.instantiate(),r.add(n),r.multiply(i)):r=Q(t*i+n),r.toString()}return console.warn("Failed damage parse",t),null},getDummyDamage(t,s=1,i=0){let n={[C.TARGET]:this.getTarget(),[C.ACTOR]:this.getActor(),[C.ITEM]:this[e],[C.GDATA]:this.getActor().context?this.getActor().context.state.items:null};return Q(t.applyDummy(n)*s+i)},displayDamage(t){if(!t)return!1;let s=t.damage||t.dmg;return s!=null&&(s instanceof Rt||this.getDamageStr(s,t))},getDamageMult(t){let s=1,i=this.getActor();if(i.context&&t.potencies)for(let n of t.potencies){let r=i.context.state.getData(n,!1,!1);r&&(s=s*r.damage.getApply({[C.ACTOR]:i,[C.TARGET]:v.state.player,[C.CONTEXT]:v.state.player.context,[C.ITEM]:r}))}return s},getDamageBonus(t){let s=0,i=this.getActor();return i&&i.getBonus&&(s+=i.getBonus(t.kind)),t.bonus&&(s+=t.bonus),s}}}}const Jy={props:["item","smn"],name:"summon",computed:{percent(){return this.summon[mt]},summoncondition(){return this.summon.summonconditiontext},summon(){return this.smn||this.item.summon},itemName(){return v.state.getData(this.summon.id).name.toTitleCase()},cap(){return this.summon.max||""},count(){return!this.summon.count||this.summon.count==1?" (1)":" ("+this.summon.count+")"},keep(){return this.summon.keep||!1}}},Ky={class:"summon"},zy={key:0},Xy={key:0,class:"info-sect"},Yy={key:1},$y={key:0},Qy={key:1},Zy={key:2};function tv(e,t,s,i,n,r){const l=V("summon",!0);return u(),c("div",Ky,[Array.isArray(r.summon)?(u(),c("div",zy,[(u(!0),c(tt,null,bt(r.summon,(a,o)=>(u(),c("div",{key:"smn-"+o},[o!==0?(u(),c("div",Xy)):g("",!0),O(l,{item:s.item,smn:a},null,8,["item","smn"])]))),128))])):(u(),c("div",Yy,[r.percent?(u(),c("div",$y,[m("div",null,"Chance to summon: "+b(r.percent),1)])):g("",!0),r.summoncondition?(u(),c("div",Qy,[m("div",null,"Conditional: "+b(r.summoncondition),1)])):g("",!0),m("div",null,"Name: "+b(r.itemName)+b(r.count),1),m("div",null,"Max: "+b(r.cap),1),r.keep?(u(),c("div",Zy,"Instead of summoning, creates a permanent minion.")):g("",!0)]))])}const aa=yt(Jy,[["render",tv]]);function oa(e="item"){return{methods:{getHealing(t,s=null){if(s)return t.healing instanceof Rt||t.heal instanceof Rt?!0:t.healing||t.heal;let i=t.healing||t.heal;return this.getHealingStr(i,t)},getHealingStr(t,s){let i=this.getHealingMult(s),n=this.getHealingBonus(s);if(s.showinstanced&&(i=1,n=0),t){if(typeof t=="number")return Q(t*i+n)}else return null;if(t instanceof Rt){let r={[C.ACTOR]:B.item instanceof wt||B.item instanceof Monster?B.item:B.source instanceof wt?B.source:v.state.player,[C.ITEM]:this[e],[C.GDATA]:(B.item instanceof wt||B.item instanceof Monster?B.item:B.source instanceof wt?B.source:v.state.player).context?(B.item instanceof wt||B.item instanceof Monster?B.item:B.source instanceof wt?B.source:v.state.player).context.state.items:null};return Q(t.applyDummy(r)*i+n)}if(t){let r;return t instanceof Mt?(r=t.instantiate(),r.add(n),r.multiply(i)):r=Q(t*i+n),r.toString()}return console.warn("Failed healing parse",t),null},displayHealing(t){if(!t)return!1;let s=t.healing||t.heal;return s!=null&&(s instanceof Rt||this.getHealingStr(s,t))},getHealingMult(t){let s=1,i;if(B.item instanceof wt||B.item.type=="monster"?i=B.item:B.source instanceof wt?i=B.source:i=v.state.player,i.context&&t.potencies)for(let n of t.potencies){let r=i.context.state.getData(n,!1,!1);r&&(s=s*r.damage.getApply({[C.ACTOR]:i,[C.TARGET]:v.state.player,[C.CONTEXT]:v.state.player.context,[C.ITEM]:r}))}return s},getHealingBonus(t){let s=0,i;return B.item instanceof wt||B.item.type=="monster"?i=B.item:B.source instanceof wt?i=B.source:i=v.state.player,i&&i.getBonus&&(s+=i.getBonus(t.kind)),t.bonus&&(s+=t.bonus),s}}}}const ev={props:["dot","title","item","target"],name:"dot",mixins:[Ie,la(),oa()],components:{gdata:pt(()=>gt(()=>Promise.resolve().then(()=>Wk),void 0)),info:ra,Summon:aa,attack:pt(()=>gt(()=>Promise.resolve().then(()=>qu),void 0))},computed:{percent(){return this.dot[mt]},damage(){return this.getDamage(this.dot)},healing(){return this.getHealing(this.dot)},leech(){return this.dot.leech*100+"%"},name(){var e;return this.dot.name||this.dot.id||((e=this.item)==null?void 0:e.name)},potency(){let e="";for(let t of this.dot.potencies)e!=""&&(e=e.concat(", ")),e=e.concat(v.state.getData(t).name.replace(" potency","").toTitleCase());return e}}},sv={class:"dot"},iv={key:0,class:"note-text"},nv={key:1},rv={key:0,class:"info-sect"},lv={key:2},av={key:0},ov=m("span",null,"Name: ",-1),hv={key:0},uv={key:0},cv={key:1},fv={key:0},dv=m("span",null,"Estimated damage: ",-1),mv={key:0},pv={key:1},gv={key:2},_v={key:3},yv={key:4},vv={key:1},bv=m("span",null,"Estimated healing: ",-1),kv={key:0},xv={key:1},wv={key:2},Tv={key:2},Sv={key:2},Av=m("div",{class:"info-sect"},"Has a conditional effect:",-1),Ov={key:3},Mv=m("div",null,"This dot will be removed",-1),Cv=[Mv],Ev={key:4},Iv=m("div",{class:"info-subsect"},"When condition is met",-1),Dv={key:5},Lv=m("div",{class:"info-subsect"},"When condition is not met",-1),Nv={key:6},Rv=m("div",{class:"info-sect"},"Effects",-1),Pv={key:7},jv=m("div",{class:"info-sect"},"Summons",-1),Uv={key:8},Fv=m("div",{class:"info-sect"},"Modifications",-1),Hv={key:9},Vv=m("div",{class:"info-sect"},"Attack",-1),qv={key:10},Bv=m("div",{class:"info-sect"},"On expiration",-1),Gv={key:11},Wv=m("div",{class:"info-sect"},"When struck directly",-1),Jv={key:12},Kv=m("div",{class:"info-sect"},"After dodging an attack",-1),zv={key:13},Xv=m("div",{class:"info-sect"},"When target killed",-1);function Yv(e,t,s,i,n,r){var f,_,x,T,E,U,P;const l=V("dot-info",!0),a=V("info"),o=V("Summon"),h=V("attack");return u(),c("div",sv,[s.title?(u(),c("div",iv,b(s.title)+":",1)):g("",!0),Array.isArray(s.dot)?(u(),c("div",nv,[(u(!0),c(tt,null,bt(s.dot,(Y,K)=>(u(),c("div",{key:"dot-"+K},[K!==0?(u(),c("div",rv)):g("",!0),O(l,{dot:Y,item:this.item,target:this.target},null,8,["dot","item","target"])]))),128))])):(u(),c("div",lv,[r.name&&((f=s.item)==null?void 0:f.name)!==r.name?(u(),c("div",av,[ov,m("span",null,b(r.name.toString().toTitleCase()),1)])):g("",!0),m("div",null,[!s.dot.damage&&!s.dot.dmg&&!s.dot.effect&&!s.dot.mod&&!r.name?(u(),c("div",hv,[s.dot.id?(u(),c("div",uv,"Id: "+b(s.dot.id.toString().toTitleCase()),1)):g("",!0)])):g("",!0)]),r.percent?(u(),c("div",cv,[m("div",null,"Chance to apply: "+b(r.percent),1)])):g("",!0),m("div",null,[e.displayDamage(s.dot)?(u(),c("div",fv,[dv,m("span",null,b(r.damage),1),s.dot.kind?(u(),c("div",mv,"Damage Type: "+b(s.dot.kind.toString().toTitleCase()),1)):g("",!0),((_=s.dot.potencies)==null?void 0:_.length)===1?(u(),c("div",pv,"Scales With: "+b(r.potency)+" Potency",1)):g("",!0),((x=s.dot.potencies)==null?void 0:x.length)>1?(u(),c("div",gv,"Scales With: "+b(r.potency)+" Potencies",1)):g("",!0),s.dot.leech?(u(),c("div",_v,"Returns "+b(r.leech)+" of damage as healing",1)):g("",!0),s.dot.nodefense?(u(),c("div",yv,"Ignores defense")):g("",!0)])):g("",!0),e.displayHealing(s.dot)?(u(),c("div",vv,[bv,m("span",null,b(r.healing),1),s.dot.kind?(u(),c("div",kv,"Heal Type: "+b(s.dot.kind.toString().toTitleCase()),1)):g("",!0),((T=s.dot.potencies)==null?void 0:T.length)===1?(u(),c("div",xv,"Scales With: "+b(r.potency)+" Potency",1)):g("",!0),((E=s.dot.potencies)==null?void 0:E.length)>1?(u(),c("div",wv,"Scales With: "+b(r.potency)+" Potencies",1)):g("",!0)])):g("",!0),s.dot.duration?(u(),c("div",Tv,"Duration: "+b(s.dot.duration+"s"||"infinity"),1)):g("",!0)]),s.dot.conditiontext?(u(),c("div",Sv,[Av,m("div",null,b(s.dot.conditiontext),1)])):g("",!0),s.dot.removedot?(u(),c("div",Ov,Cv)):g("",!0),(U=s.dot.conditional)!=null&&U.onSuccess?(u(),c("div",Ev,[Iv,O(l,{dot:s.dot.conditional.onSuccess,item:this.item,target:this.target},null,8,["dot","item","target"])])):g("",!0),(P=s.dot.conditional)!=null&&P.onFailure?(u(),c("div",Dv,[Lv,O(l,{dot:s.dot.conditional.onFailure,item:this.item,target:this.target},null,8,["dot","item","target"])])):g("",!0),s.dot.effect?(u(),c("div",Nv,[Rv,O(a,{info:s.dot.effect,rate:"true"},null,8,["info"])])):g("",!0),s.dot.summon?(u(),c("div",Pv,[jv,O(o,{item:s.dot,class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.dot.mod?(u(),c("div",Uv,[Fv,this.target==="allies"?(u(),lt(a,{key:0,info:s.dot.mod,target:"friendly allies"},null,8,["info"])):(u(),lt(a,{key:1,info:s.dot.mod,target:this.target},null,8,["info","target"]))])):g("",!0),s.dot.attack?(u(),c("div",Hv,[Vv,O(h,{item:s.dot,class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.dot.onExpire?(u(),c("div",qv,[Bv,O(h,{item:s.dot,onexpireflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.dot.onHit?(u(),c("div",Gv,[Wv,O(h,{item:s.dot,onhitflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.dot.onMiss?(u(),c("div",Jv,[Kv,O(h,{item:s.dot,onmissflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.dot.onDeath?(u(),c("div",zv,[Xv,O(h,{item:s.dot,ondeathflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0)]))])}const ha=yt(ev,[["render",Yv]]),$v=Object.freeze(Object.defineProperty({__proto__:null,default:ha},Symbol.toStringTag,{value:"Module"})),Qv={props:["item","atk","target","ondeathflag","onhitflag","onmissflag","onexpireflag","onsummonflag","hideDmg"],name:"attack",mixins:[la(),oa()],components:{dot:ha,info:ra,Summon:aa},methods:{calcAffected(e,t,s,i,n="",r=null){return n+=", "+(t?"only targeting ":"prioritizing "),n+="those "+(i?"":"not ")+"affected by ",e.length>1&&(!s!=!i?n+="any of ":s?n+="all of ":n+="at least one of "),r?n+=r:n+=e.filter(l=>l).map(l=>{var a;return(((a=v.getData(l))==null?void 0:a.name)||l===this.attack.id&&this.attack.name||l).toTitleCase()}).join(", "),n},tagNames(e){return Array.isArray(e)?e.map(this.tagNames,this):typeof e=="string"&&e.substring(0,2)==="t_"?e.slice(2).toTitleCase():e.toTitleCase()}},computed:{attack(){return this.onhitflag?this.item.onHit:this.onmissflag?this.item.onMiss:this.ondeathflag?this.item.onDeath:this.onexpireflag?this.item.onExpire:this.onsummonflag?this.item.onSummon:this.atk||this.item.attack},damage(){return this.getDamage(this.attack,this.hideDmg)},healing(){return this.getHealing(this.attack,this.hideDmg)},hitBonus(){return this.attack.tohit||0},leech(){return this.attack.leech*100+"%"},bonus(){let e=this.attack.bonus;return!e||e.valueOf()==0?0:e>0?" (+"+e+")":" ("+e+")"},itemtype(){var e;return((e=this.item.type)==null?void 0:e.toString())||"untyped"},cureeffects(){var t;let e="";for(let s of this.attack.cure)e!=""&&(e=e.concat(", ")),e=e.concat(((t=v.getData(s))==null?void 0:t.name.toTitleCase())||s.toTitleCase());return e},calcTarget(){let e=this.attack.targetstring||this.target||this.attack.targets||"enemy";if(e=e.toTitleCase(),this.attack.targetspec){let t=this.attack.targetspec;if(t.affectedby&&(e=this.calcAffected(t.affectedby.condition,t.affectedby.strict,t.affectedby.all,!0,e,t.affectedby.conditiontext)),t.notaffectedby&&(e=this.calcAffected(t.notaffectedby.condition,t.notaffectedby.strict,t.notaffectedby.all,!1,e,t.notaffectedby.conditiontext)),t.stat){let s=v.getData(t.stat).name.toTitleCase();e+=" with "+(t.highest?"highest ":"lowest ")+s+(t.usepercentage?" percentage":"")}}return e},shortTarget(){let e=this.attack.targetstring||this.target||"enemy";return e=e.toTitleCase(),e},maxTargets(){if(!this.attack.maxTargets)return"";let e=this.attack.maxTargets;return e==999||e==An*2?" ()":" ("+e+")"},potency(){let e="";for(let t of this.attack.potencies)e!=""&&(e=e.concat(", ")),e=e.concat(v.state.getData(t).name.replace(" potency","").toTitleCase());return e},only(){let e="";for(let t of this.attack.only)e!=""&&(e=e.concat(", ")),t=v.state.tagSets[t]||t,t instanceof Object&&t.name?e=e.concat(t.name.toTitleCase()):e=e.concat(this.tagNames(t));return e}}},Zv={class:"attack"},tb={key:0},eb={key:0,class:"info-sect"},sb={key:1},ib={key:0},nb={key:0},rb=m("span",null,"Name: ",-1),lb={key:1},ab={key:2},ob={key:0,class:"damage"},hb={key:0},ub={key:1},cb={key:2},fb={key:3},db={key:4},mb={key:5},pb={key:6},gb={key:7},_b={key:8},yb={key:3},vb={key:0,class:"damage"},bb={key:0},kb={key:1},xb={key:2},wb={key:3},Tb={key:4},Sb={key:5},Ab={key:6},Ob={key:7},Mb={key:8},Cb={key:9},Eb=m("div",{class:"info-sect"},"Summons:",-1),Ib={key:10,class:"info-sect"},Db={key:12,class:"info-sect"},Lb={key:1},Nb=m("div",{class:"info-sect"},"Attack hit",-1),Rb={key:2},Pb=m("div",{class:"info-sect"},"Applies",-1);function jb(e,t,s,i,n,r){var f,_;const l=V("attack",!0),a=V("summon"),o=V("info"),h=V("dot");return u(),c("div",Zv,[Array.isArray(r.attack)?(u(),c("div",tb,[(u(!0),c(tt,null,bt(r.attack,(x,T)=>(u(),c("div",{key:"atk-"+T},[T!==0?(u(),c("div",eb)):g("",!0),O(l,{item:s.item,hideDmg:this.hideDmg,atk:x},null,8,["item","hideDmg","atk"])]))),128))])):(u(),c("div",sb,[r.damage||r.attack.hits||r.attack.dot||r.attack.result||r.attack.acquire||r.attack.summon||r.attack.healing||r.attack.cure?(u(),c("div",ib,[r.attack.name&&r.attack.name!==s.item.name?(u(),c("div",nb,[rb,m("span",null,b(r.attack.name.toString().toTitleCase()),1)])):g("",!0),r.attack.damagedesc&&this.hideDmg?(u(),c("div",lb,b(r.attack.damagedesc),1)):g("",!0),r.damage?(u(),c("div",ab,[this.hideDmg?g("",!0):(u(),c("div",ob,[Jt(" Estimated damage: "+b(r.damage),1),r.bonus?(u(),c("span",hb,b(r.bonus),1)):g("",!0)])),r.attack.repeathits?(u(),c("div",ub,"Total hits: "+b(r.attack.repeathits),1)):g("",!0),r.attack.kind?(u(),c("div",cb,"Damage Type: "+b(r.attack.kind.toString().toTitleCase()),1)):g("",!0),((f=r.attack.potencies)==null?void 0:f.length)===1?(u(),c("div",fb,"Scales With: "+b(r.potency)+" Potency",1)):((_=r.attack.potencies)==null?void 0:_.length)>1?(u(),c("div",db,"Scales With: "+b(r.potency)+" Potencies",1)):g("",!0),r.attack.leech?(u(),c("div",mb,"Returns "+b(r.leech)+" of damage as healing",1)):g("",!0),r.attack.nodefense?(u(),c("div",pb,"Ignores defense")):g("",!0),r.attack.unreflectable?(u(),c("div",gb,"Ignores retaliation effects")):g("",!0),r.hitBonus?(u(),c("div",_b,"Hit Bonus: "+b(r.hitBonus),1)):g("",!0)])):g("",!0),r.healing?(u(),c("div",yb,[this.hideDmg?g("",!0):(u(),c("div",vb,[Jt(" Estimated healing: "+b(r.healing),1),r.bonus?(u(),c("span",bb,b(r.bonus),1)):g("",!0)])),r.attack.kind?(u(),c("div",kb,"Heal Type: "+b(r.attack.kind.toString().toTitleCase()),1)):g("",!0),r.attack.potencies.length===1?(u(),c("div",xb,"Scales With: "+b(r.potency)+" Potency",1)):g("",!0),r.attack.potencies.length>1?(u(),c("div",wb,"Scales With: "+b(r.potency)+" Potencies",1)):g("",!0)])):g("",!0),r.attack.nododge?(u(),c("div",Tb,"Cannot be dodged")):g("",!0),r.attack.harmless?(u(),c("div",Sb,"Cannot be dodged")):g("",!0),r.attack.cure?(u(),c("div",Ab,"Cures: "+b(r.cureeffects),1)):g("",!0),r.attack.targets||r.attack.targetspec?(u(),c("div",Ob,"Targets: "+b(r.calcTarget)+b(r.maxTargets),1)):g("",!0),r.attack.only?(u(),c("div",Mb,"Only Affects: "+b(r.only),1)):g("",!0),r.attack.summon?(u(),c("div",Cb,[Eb,O(a,{item:s.item,smn:r.attack.summon,class:"info-subsubsect"},null,8,["item","smn"])])):g("",!0),r.attack.result?(u(),c("div",Ib,"Results:")):g("",!0),r.attack.result?(u(),lt(o,{key:11,info:r.attack.result,target:r.shortTarget},null,8,["info","target"])):g("",!0),r.attack.acquire?(u(),c("div",Db,"Produces:")):g("",!0),r.attack.acquire?(u(),lt(o,{key:13,info:r.attack.acquire,target:r.shortTarget},null,8,["info","target"])):g("",!0)])):g("",!0),r.attack.hits?(u(),c("div",Lb,[(u(!0),c(tt,null,bt(r.attack.hits,(x,T)=>(u(),c("div",{key:"hit-"+T},[Nb,O(l,{item:s.item,atk:x,hideDmg:this.hideDmg,class:"info-subsubsect"},null,8,["item","atk","hideDmg"])]))),128))])):g("",!0),r.attack.dot?(u(),c("div",Rb,[Pb,O(h,{dot:r.attack.dot,item:r.attack,target:r.attack.targetstring||this.target||"enemy",class:"info-subsubsect"},null,8,["dot","item","target"])])):g("",!0)]))])}const Vu=yt(Qv,[["render",jb]]),qu=Object.freeze(Object.defineProperty({__proto__:null,default:Vu},Symbol.toStringTag,{value:"Module"})),Ub={name:"gdata",props:["item"],mixins:[Ie,la(),oa()],components:{info:ra,attack:Vu,dot:ha,summon:aa},methods:{precise:Q,formatNumber:Uh,tagNames(e){return Array.isArray(e)?e.map(this.tagNames,this):typeof e=="string"&&e.substring(0,2)==="t_"?e.slice(2).toTitleCase():e.toTitleCase()},joinedtext(e){return Array.isArray(e)?e.join(`
`):e},formatTime(e){e<0&&(e=0);let t=Math.floor(e/36e5),s=Math.floor(e/6e4)%60,i=Math.floor(e/1e3)%60;return`${(t<10?"0":"")+t}:${(s<10?"0":"")+s}:${(i<10?"0":"")+i}`},only(e){let t="",s=typeof e=="string"?e.split(","):e;for(let i of s)t!=""&&(t=t.concat(", ")),i=game.state.tagSets[i]||i,i instanceof Object&&i.name?t=t.concat(i.name.toTitleCase()):t=t.concat(this.tagNames(i));return t},exclude(e){let t="",s=typeof e=="string"?e.split(","):e;for(let i of s)t!=""&&(t=t.concat(", ")),i=game.state.tagSets[i]||i,i instanceof Object&&i.name?t=t.concat(i.name.toTitleCase()):t=t.concat(this.tagNames(i));return t}},beforeCreate(){this.player=v.state.player,this.CheckTypes=Ss,this.CONST={ENCOUNTER:me,EXPLORE:Gs,MONSTER:ne}},computed:{name(){return this.item.sname||this.item.name.toTitleCase()},damage(){return this.getDamage(this.item)},healing(){return this.getHealing(this.item)},sellPrice(){return v.sellPrice(this.item)},nextImprove(){return this.nextAt>0?this.nextAt:this.nextEvery},nextEvery(){let e=Math.floor(this.item.value);var t=Number.MAX_VALUE,s;for(let n in this.item.every){var i=n-e%n;i<t&&(t=i,s=n)}return t!==Number.MAX_VALUE?(s-i)/s:-1},nextAt(){let e=this.item.value;var t=Number.MAX_VALUE;for(let s in this.item.at)s=Number(s),s>e&&s<t&&(t=s);return t>e&&t!==Number.MAX_VALUE?t:-1},tags(){let e=this.item.tags;typeof e=="string"&&(e=[e]);let t=[];for(var s=0;s<e.length;s++){let i=e[s];i=v.state.tagSets[i]||i,!(i==null||i.hide)&&(i instanceof Object&&i.name?t.push(i.name.toTitleCase()):t.push(this.tagNames(i)))}return t.join(", ")},cdtags(){if(!this.item.tags)return null;let e=this.item.tags;typeof e=="string"&&(e=[e]);let t=[];for(var s=0;s<e.length;s++){let i=e[s];i=v.state.tagSets[i]||i,!(i==null||i.hide||!i.sharecd)&&(i instanceof Object&&i.name?t.push(i.name.toTitleCase()):t.push(this.tagNames(i)))}return t.join(", ")},cdRemain(){if(this.item.template){let e=this.item.template;return this.item.template.id&&(e=this.item.template.id),v.state.getData(e).timer}else return this.item.timer},spendingRate(){let e=this.item.rate.value;const t=this.spending(this.item);if(t.length===0)return e?Q(e,1,4)+"/s":"";if(this.debugRateSetting){let s=`<span class="calc-text">${Q(e,1,4)}(R)`;return t.forEach(i=>{s+=(i.rate>=0?" + ":" - ")+Q(Math.abs(i.rate),1,4)+`(${i.name})`,e+=i.rate}),s+=`</span>    ${Q(e,1,4)}/s`,s}else return Q(t.reduce((s,i)=>s+i.rate,e),1,4)+"/s"},debugRateSetting(){return it.get("debugRate")},itemSlot(){let e=v.getData(this.item.slot);return e?e.name.toTitleCase():this.item.slot.toString().toTitleCase()},restrate(){let e=this.getDummyDamage(this.item.restrate);return e>0?"+"+e:e}}},at=e=>(Ke("data-v-95bb1fa8"),e=e(),ze(),e),Fb={class:"item-info"},Hb={class:"separate"},Vb={class:"item-name"},qb={key:0},Bb={key:1},Gb={key:2},Wb=at(()=>m("br",null,null,-1)),Jb={key:0},Kb={key:1},zb={key:2},Xb={key:3},Yb={key:0},$b={key:1},Qb={key:4},Zb={key:0},t0={key:5},e0={key:6},s0={key:0,class:"tight note-text"},i0={key:0},n0=["innerHTML"],r0={key:2,class:"flex-right"},l0={key:3,class:"flex-right"},a0={class:"separate"},o0={key:0},h0={key:1},u0={key:2},c0={key:3},f0={key:4},d0={key:5},m0={class:"separate"},p0={key:0},g0={key:1},_0={key:0},y0={key:1,class:"note-text"},v0={key:2,class:"note-text"},b0={key:3,class:"note-text"},k0={key:4,class:"note-text"},x0={key:5,class:"note-text"},w0={key:6},T0={key:7},S0={key:8},A0={key:9},O0={key:10},M0={key:11},C0={key:12,class:"item-desc"},E0={key:13,class:"item-extdesc"},I0={key:4},D0={key:10},L0=at(()=>m("div",{class:"info-sect"},"Attack",-1)),N0={key:11},R0={key:0},P0=at(()=>m("div",{class:"info-sect"},"When summoned in combat",-1)),j0={key:12},U0={key:0},F0=at(()=>m("div",{class:"info-sect"},"When struck directly",-1)),H0={key:13},V0={key:0},q0=at(()=>m("div",{class:"info-sect"},"After dodging an attack",-1)),B0={key:14},G0={key:0},W0=at(()=>m("div",{class:"info-sect"},"On expiration",-1)),J0={key:15},K0={key:0},z0=at(()=>m("div",{class:"info-sect"},"When killed",-1)),X0={key:16},Y0=at(()=>m("div",{class:"info-sect"},"Has a conditional effect:",-1)),$0={key:17},Q0=at(()=>m("div",null,"This dot will be removed",-1)),Z0=[Q0],tk={key:18},ek=at(()=>m("div",{class:"info-subsect"},"When condition is met",-1)),sk={key:19},ik=at(()=>m("div",{class:"info-subsect"},"When condition is not met",-1)),nk={key:20},rk=at(()=>m("div",{class:"info-sect"},"Effects:",-1)),lk={key:21},ak=at(()=>m("div",{class:"info-sect"},"Modifications:",-1)),ok={key:22},hk={key:0,class:"info-sect"},uk={key:1,class:"info-sect"},ck=at(()=>m("div",{class:"info-sect"},"Input:",-1)),fk=at(()=>m("div",{class:"info-sect"},"Output:",-1)),dk={key:23},mk=at(()=>m("div",{class:"info-sect"},"Summons:",-1)),pk={key:24},gk=at(()=>m("div",{class:"info-sect"},"Resurrects:",-1)),_k={key:0},yk={key:1},vk={key:25},bk=at(()=>m("div",{class:"info-sect"},"On First Completion:",-1)),kk={key:0},xk=at(()=>m("div",{class:"info-sect"},"Loot:",-1)),wk={key:26},Tk=at(()=>m("div",{class:"info-sect"},"Results:",-1)),Sk={key:0},Ak=at(()=>m("div",{class:"info-sect"},"Loot:",-1)),Ok={key:0},Mk={key:1},Ck={key:2},Ek={key:27},Ik=at(()=>m("div",{class:"info-sect"},"When used:",-1)),Dk={class:"info-subsubsect"},Lk={key:28},Nk=at(()=>m("div",{class:"info-sect"},"Modifications While Progressing:",-1)),Rk={key:29},Pk=at(()=>m("div",{class:"info-sect"},"Buffs:",-1)),jk={key:30},Uk=at(()=>m("div",{class:"info-sect"},"Locks:",-1)),Fk={key:31},Hk=at(()=>m("div",{class:"info-sect"},"Disables:",-1)),Vk={key:32},qk=at(()=>m("div",{class:"info-sect"},"Enables:",-1)),Bk={key:33,class:"note-text"};function Gk(e,t,s,i,n,r){var f,_;const l=V("info"),a=V("attack"),o=V("dot"),h=V("summon");return u(),c("div",Fb,[m("span",Hb,[m("span",Vb,b(r.name.toString().toTitleCase()),1),m("span",null,[s.item.type==="resource"||s.item.type==="stat"?(u(),c("span",qb,b(r.formatNumber(Math.floor(s.item.current))+(r.formatNumber(s.item.max)?" / "+r.formatNumber(s.item.max.value):"")),1)):s.item.type==="furniture"?(u(),c("span",Bb," max: "+b(s.item.max?r.formatNumber(s.item.max.value):s.item.repeat?"":1),1)):s.item.type==="upgrade"||s.item.type==="task"?(u(),c("span",Gb,[Wb,s.item.value?(u(),c("span",Jb,b(r.formatNumber(+s.item.value)),1)):g("",!0),s.item.max?(u(),c("span",Kb,"/ "+b(r.formatNumber(+s.item.max)),1)):s.item.type==="upgrade"?(u(),c("span",zb,"/ 1")):g("",!0)])):g("",!0),s.item.type==="locale"||s.item.type==="dungeon"?(u(),c("span",Xb,[s.item.value?(u(),c("span",Yb,b(r.formatNumber(+s.item.value)),1)):g("",!0),s.item.max?(u(),c("span",$b,"/ "+b(r.formatNumber(+s.item.max)),1)):g("",!0)])):g("",!0),s.item.type==="encounter"?(u(),c("span",Qb,[s.item.value?(u(),c("span",Zb,b(r.formatNumber(+s.item.value)),1)):g("",!0)])):g("",!0),s.item.type==="spell"&&s.item.owned===!0&&s.item.value>=0?(u(),c("span",t0,b(r.formatNumber(+s.item.value)),1)):g("",!0),s.item.sym?(u(),c("span",e0,b(s.item.sym),1)):g("",!0)])]),s.item.tags||s.item.hands?(u(),c("div",s0,[s.item.hands>1?(u(),c("span",i0,"Two-Handed ")):g("",!0),Jt(b(r.tags),1)])):g("",!0),s.item.rate&&(s.item.rate.value!=0||s.item.convert||r.debugRateSetting)&&!(s.item.type=="task"||s.item.type=="encounter"||s.item.type=="explore"||s.item.type=="dungeon"||s.item.type=="clash"||s.item.type=="locale"||s.item.type=="spell")?(u(),c("span",{key:1,class:"flex-right",innerHTML:r.spendingRate},null,8,n0)):g("",!0),s.item.restrate?(u(),c("span",r0,b(r.restrate)+"/s (Downtime) ",1)):g("",!0),s.item.rate&&s.item.rate.value!=0&&s.item.length>0&&(s.item.type=="task"||s.item.type=="encounter")?(u(),c("span",l0," Completion rate: "+b(r.precise(s.item.rate.value*100))+"% ",1)):g("",!0),m("div",null,[m("span",a0,[s.item.showLevel?(u(),c("span",o0,"Level: "+b(s.item.showLevel()),1)):s.item.level&&s.item.type==="encounter"?(u(),c("span",h0,"Length: "+b(s.item.length),1)):s.item.level?(u(),c("span",u0,"Level: "+b(s.item.level),1)):g("",!0),s.item.slot&&s.item.type!=="armor"&&s.item.type!=="weapon"?(u(),c("span",c0,"Slot: "+b(s.item.slot.toString().toTitleCase()),1)):s.item.slot?(u(),c("span",f0,"Slot: "+b(r.itemSlot),1)):g("",!0),s.item.kind&&(s.item.type==="monster"||s.item.type==="npc")?(u(),c("span",d0," Kind: "+b(s.item.kind.toTitleCase()),1)):g("",!0)]),m("span",m0,[s.item.regen&&s.item.type!=="player"?(u(),c("span",p0,"Regen: "+b(s.item.regen),1)):g("",!0),s.item.recharge&&s.item.type!=="player"?(u(),c("span",g0,"Recharge: "+b(s.item.recharge),1)):g("",!0)]),s.item.enchants&&s.item.enchants.max>0?(u(),c("span",_0," Enchant Levels: "+b(s.item.enchants.value)+" / "+b(s.item.enchants.max),1)):g("",!0),s.item.at&&r.nextAt>0?(u(),c("span",y0," Next Improvement: "+b(Math.round(100*s.item.value/r.nextAt)+"%"),1)):s.item.every&&r.nextEvery>=0?(u(),c("span",v0," Next Improvement: "+b(Math.round(100*r.nextEvery)+"%"),1)):g("",!0),s.item.cd||r.cdRemain>0?(u(),c("div",b0," Cooldown: "+b(r.cdRemain>0?r.cdRemain.toFixed(2)+"Left":s.item.cd+"s"),1)):g("",!0),r.cdtags?(u(),c("div",k0,"Shares cooldown with: "+b(r.cdtags),1)):g("",!0),s.item.exclude?(u(),c("div",x0,"Cannot be used with: "+b(this.exclude(s.item.exclude)),1)):g("",!0),+s.item.dist&&s.item.type!=="player"&&s.item.type!=="npc"&&s.item.type!=="monster"?(u(),c("div",w0," Distance: "+b(s.item.dist),1)):g("",!0),+s.item.armor?(u(),c("div",T0,"Armor: "+b(s.item.armor),1)):g("",!0),+s.item.evasion?(u(),c("div",S0,"Evasion: "+b(s.item.evasion),1)):g("",!0),+s.item.shield?(u(),c("div",A0,"Shield: "+b(s.item.shield),1)):g("",!0),+s.item.dmg&&(!s.item.attack||s.item.attack.dmg!==s.item.dmg)?(u(),c("div",O0,"Base damage: "+b(r.damage),1)):g("",!0),+s.item.heal&&(!s.item.attack||s.item.attack.heal!==s.item.heal)?(u(),c("div",M0,"Healing: "+b(r.healing),1)):g("",!0),s.item.desc?(u(),c("div",C0,b(r.joinedtext(s.item.desc)),1)):g("",!0),s.item.extdesc?(u(),c("div",E0,b(r.joinedtext(s.item.extdesc)),1)):g("",!0)]),s.item.length>0&&s.item.type==="task"?(u(),c("span",I0," Completion time: "+b(r.formatTime((s.item.length-s.item.exp)*1e3/s.item.rate)),1)):g("",!0),s.item.need?(u(),lt(l,{key:5,title:"Need",require:!0,info:s.item.need,text:s.item.needtext,checkType:e.CheckTypes.NEED},null,8,["info","text","checkType"])):g("",!0),s.item.buy&&!s.item.owned?(u(),lt(l,{key:6,info:s.item.buy,checkType:e.CheckTypes.COST,title:"Purchase Cost"},null,8,["info","checkType"])):g("",!0),s.item.cost?(u(),lt(l,{key:7,info:s.item.cost,checkType:e.CheckTypes.COST,title:"Cost"},null,8,["info","checkType"])):g("",!0),(s.item.sell||s.item.instanced||s.item.type==="furniture")&&s.item.type!=="player"&&s.item.type!=="npc"?(u(),lt(l,{key:8,info:r.sellPrice,checkType:e.CheckTypes.FULL,title:"Sell"},null,8,["info","checkType"])):g("",!0),s.item.run?(u(),lt(l,{key:9,info:s.item.run,checkType:e.CheckTypes.COST,title:"Progress Cost",rate:"true"},null,8,["info","checkType"])):g("",!0),s.item.attack?(u(),c("div",D0,[L0,O(a,{item:s.item,class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.item.onSummon?(u(),c("div",N0,[s.item.onSummon.name?(u(),c("div",R0,[P0,O(a,{item:s.item,onsummonflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0)])):g("",!0),s.item.onHit?(u(),c("div",j0,[s.item.onHit.name?(u(),c("div",U0,[F0,O(a,{item:s.item,onhitflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0)])):g("",!0),s.item.onMiss?(u(),c("div",H0,[s.item.onMiss.name?(u(),c("div",V0,[q0,O(a,{item:s.item,onmissflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0)])):g("",!0),s.item.onExpire?(u(),c("div",B0,[s.item.onExpire.name?(u(),c("div",G0,[W0,O(a,{item:s.item,onexpireflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0)])):g("",!0),s.item.onDeath?(u(),c("div",J0,[s.item.onDeath.name?(u(),c("div",K0,[z0,O(a,{item:s.item,ondeathflag:"true",class:"info-subsubsect"},null,8,["item"])])):g("",!0)])):g("",!0),s.item.conditiontext?(u(),c("div",X0,[Y0,m("div",{class:Pt({failed:!s.item.conditionstatus})},b(s.item.conditiontext),3)])):g("",!0),s.item.removedot?(u(),c("div",$0,Z0)):g("",!0),(f=s.item.conditional)!=null&&f.onSuccess?(u(),c("div",tk,[ek,O(o,{dot:s.item.conditional.onSuccess,item:s.item},null,8,["dot","item"])])):g("",!0),(_=s.item.conditional)!=null&&_.onFailure?(u(),c("div",sk,[ik,O(o,{dot:s.item.conditional.onFailure,item:s.item},null,8,["dot","item"])])):g("",!0),s.item.effect?(u(),c("div",nk,[rk,O(l,{info:s.item.effect,text:s.item.effecttext,rate:!0,checkType:e.CheckTypes.FULL},null,8,["info","text","checkType"])])):g("",!0),s.item.mod&&Object.keys(s.item.mod).length||s.item.alter&&Object.keys(s.item.alter).length?(u(),c("div",lk,[ak,s.item.mod&&Object.keys(s.item.mod).length?(u(),lt(l,{key:0,info:s.item.mod,text:s.item.modtext},null,8,["info","text"])):g("",!0),s.item.alter&&Object.values(s.item.alter).length?(u(),lt(l,{key:1,info:s.item.alter,text:s.item.altertext,separate:!0},null,8,["info","text"])):g("",!0)])):g("",!0),s.item.convert?(u(),c("div",ok,[s.item.convert.singular?g("",!0):(u(),c("div",hk," Conversion per "+b(r.name.toString().toTitleCase()),1)),s.item.convert.singular?(u(),c("div",uk," Constant conversion for "+b(r.name.toString().toTitleCase()),1)):g("",!0),ck,O(l,{info:s.item.convert.input,rate:s.item.perpetual>0||s.item.length>0,checkType:e.CheckTypes.COST},null,8,["info","rate","checkType"]),fk,s.item.convert.output.effect&&Object.values(s.item.convert.output.effect).length?(u(),lt(l,{key:2,info:s.item.convert.output.effect,rate:s.item.perpetual>0||s.item.length>0,checkType:e.CheckTypes.FULL},null,8,["info","rate","checkType"])):g("",!0),s.item.convert.output.mod&&Object.values(s.item.convert.output.mod).length?(u(),lt(l,{key:3,info:s.item.convert.output.mod},null,8,["info"])):g("",!0)])):g("",!0),s.item.summon?(u(),c("div",dk,[mk,O(h,{item:s.item,class:"info-subsubsect"},null,8,["item"])])):g("",!0),s.item.resurrect?(u(),c("div",pk,[gk,s.item.resurrect.only?(u(),c("div",_k,"Only: "+b(this.only(s.item.resurrect.only)),1)):g("",!0),s.item.resurrect.maxlevel?(u(),c("div",yk,"Up to level "+b(s.item.resurrect.maxlevel),1)):g("",!0),m("div",null,"Up to "+b(s.item.resurrect.count||1)+" minions per cast",1)])):g("",!0),s.item.once?(u(),c("div",vk,[bk,O(l,{info:s.item.once,checkType:e.CheckTypes.FULL},null,8,["info","checkType"]),s.item.once.loot?(u(),c("div",kk,[xk,O(l,{info:s.item.once.loot,checkType:e.CheckTypes.FULL},null,8,["info","checkType"])])):g("",!0)])):g("",!0),s.item.result?(u(),c("div",wk,[Tk,O(l,{info:s.item.resulttext||s.item.result,checkType:e.CheckTypes.FULL},null,8,["info","checkType"])])):g("",!0),m("div",null,[s.item.loot?(u(),c("div",Sk,[Ak,s.item.type===e.CONST.MONSTER&&!+s.item.value?(u(),c("div",Ok,"Kill to discover")):s.item.type===e.CONST.ENCOUNTER&&!+s.item.value?(u(),c("div",Mk,"Complete to discover")):s.item.controller===e.CONST.EXPLORE&&!+s.item.value?(u(),c("div",Ck,"Complete to discover")):(u(),lt(l,{key:3,info:s.item.loottext||s.item.loot,checkType:e.CheckTypes.FULL},null,8,["info","checkType"]))])):g("",!0)]),s.item.use?(u(),c("div",Ek,[Ik,m("div",Dk,[O(l,{info:s.item.use,separate:!0},null,8,["info"])])])):g("",!0),s.item.runmod&&Object.values(s.item.runmod).length?(u(),c("div",Lk,[Nk,O(l,{info:s.item.runmod},null,8,["info"])])):g("",!0),s.item.dot?(u(),c("div",Rk,[Pk,O(o,{dot:s.item.dot,item:s.item,class:"info-subsubsect"},null,8,["dot","item"])])):g("",!0),s.item.lock?(u(),c("div",jk,[Uk,O(l,{info:s.item.lock},null,8,["info"])])):g("",!0),s.item.disable?(u(),c("div",Fk,[Hk,O(l,{info:s.item.disable},null,8,["info"])])):g("",!0),s.item.enable?(u(),c("div",Vk,[qk,O(l,{info:s.item.enable},null,8,["info"])])):g("",!0),s.item.flavor?(u(),c("div",Bk,b(r.joinedtext(s.item.flavor)),1)):g("",!0)])}const Bu=yt(Ub,[["render",Gk],["__scopeId","data-v-95bb1fa8"]]),Wk=Object.freeze(Object.defineProperty({__proto__:null,default:Bu},Symbol.toStringTag,{value:"Module"})),B=Is({item:null,elm:null,title:null,source:null,text:null}),Jk=(e,t,s,i,n=null)=>{const r={};r.item=t,r.elm=e.currentTarget,r.source=s!=null||t instanceof wt?s:v.player,t&&t.context?r.context=t.context:r.source&&r.source.context?r.context=r.source.context:(console.warn("Item and Source don't have context. Defaulting to game.",t,s),r.context=v),r.title=i,r.text=n,Object.assign(B,r)},Ao=e=>{e&&e.target===B.elm||(B.item=null,B.elm=null,B.source=null,B.title=null,B.context=null,B.text=null)},Kk={data(){return B},updated(){if(this.item||this.text){fy(this.$el,this.elm);const s=document.getElementsByClassName("item-popup")[0];s.style["column-count"]="auto",s.style["column-width"]="auto",s.style["max-width"]="280px";var e=s.getBoundingClientRect(),t=e.height;if(t>=window.innerHeight*.85){let i=document.getElementsByClassName("popup-content")[0],n=Math.ceil(i.getBoundingClientRect().height/(window.innerHeight*.95)),r=n*300+"px";s.style["column-width"]="280px",s.style["column-count"]=n,s.style["max-width"]=r}}},components:{gdata:Bu}},zk={class:"item-popup"},Xk={class:"popup-content"},Yk={key:0,class:"pop-title"},$k={key:3};function Qk(e,t,s,i,n,r){const l=V("gdata");return At((u(),c("div",zk,[m("div",Xk,[e.title?(u(),c("div",Yk,b(e.title),1)):g("",!0),Array.isArray(e.item)?(u(!0),c(tt,{key:1},bt(e.item,a=>(u(),c("div",{key:a},b(a.toString()),1))),128)):(u(),c(tt,{key:2},[e.item?(u(),lt(l,{key:0,item:e.item},null,8,["item"])):g("",!0)],64)),e.text?(u(),c("div",$k,b(e.text),1)):g("",!0)])],512)),[[ke,e.item!=null||e.text!=null]])}const Zk=yt(Kk,[["render",Qk],["__scopeId","data-v-cf9f121c"]]),t1={mixins:[Ie],components:{"vue-menu":Nu,resources:Ru,tasks:ju},emits:["close-settings"],data(){let e=it.vars;return it.get("curview"),{psection:null,sCompactMode:e.compactMode,sDarkMode:e.darkMode,sSmoothBars:e.smoothBars,sDebugRate:e.debugRate,sTotalRate:e.totalRate,sEnsureMaxProduction:e.ensureMaxProduction,sSpeedupFactor:e.speedupFactor,saves:Object.assign({},it.getSubVars("saves"))}},updated(){Hu(this.$el)},created(){this.psection=v.state.sections.find(e=>e.id==="sect_settings_main");for(let e in it.vars)this.dispatch("setting",e,it.vars[e])},methods:{clear(){},close(){this.dispatch("save-settings"),this.$emit("close-settings")}},computed:{menuItems(){return v.state.sections.filter(e=>e.parent==="settings")},compactMode:{get(){return this.sCompactMode},set(e){it.set("compactMode",e),this.sCompactMode=e,this.dispatch("setting","compactMode",e)}},autosave:{get(){return this.saves.autosave},set(e){this.saves.autosave=it.setSubVar("saves","autosave",e),this.dispatch("setting","autosave",e)}},darkMode:{get(){return this.sDarkMode},set(e){it.set("darkMode",e),this.sDarkMode=e,this.dispatch("setting","darkMode",e)}},smoothBars:{get(){return this.sSmoothBars},set(e){it.set("smoothBars",e),this.sSmoothBars=e,this.dispatch("setting","smoothBars",e)}},debugRate:{get(){return this.sDebugRate},set(e){it.set("debugRate",e),this.sDebugRate=e,this.dispatch("setting","debugRate",e)}},totalRate:{get(){return this.sTotalRate},set(e){it.set("totalRate",e),this.sTotalRate=e,this.dispatch("setting","totalRate",e)}},ensureMaxProduction:{get(){return this.sEnsureMaxProduction},set(e){it.set("ensureMaxProduction",e),this.sEnsureMaxProduction=e,this.dispatch("setting","ensureMaxProduction",e)}},speedupFactor:{get(){return this.sSpeedupFactor},set(e){it.set("speedupFactor",e),this.sSpeedupFactor=e,this.dispatch("setting","speedupFactor",e)}},autoSaveTip(){return"Periodically save current game."}}},ps=e=>(Ke("data-v-d57210f6"),e=e(),ze(),e),e1={class:Pt(["settings","popup"])},s1=["for"],i1=["id"],n1=["for"],r1=["id"],l1=["for"],a1=["id"],o1=["for"],h1=["id"],u1=ps(()=>m("div",{class:"calc-text"}," Periodically save game to storage. Game is saved to Browser storage by default. ",-1)),c1=ps(()=>m("h3",null,"Tooltip Stats",-1)),f1=["for"],d1=["id"],m1=ps(()=>m("div",{class:"calc-text"}," Show calculated resource income from modified rate R, converters C, running tasks T, and buffs B. ",-1)),p1=["for"],g1=["id"],_1=ps(()=>m("div",{class:"calc-text"}," Shows remaining costs to pay and resources to acquire until next completion (for tasks with completion time of more than 1 second) ",-1)),y1=ps(()=>m("h3",null,"Gameplay adjustments",-1)),v1=["for"],b1=["id"],k1=ps(()=>m("div",{class:"calc-text"},[Jt(" Actions will only be performed if their outputs can be fully collected"),m("br"),Jt(" Warning! This can prevent you from fully filling your resources to max, but will prevent wastefully underpoducing. ")],-1)),x1=["for"],w1=["id"],T1=ps(()=>m("div",{class:"calc-text"}," Speedup factor for fast-forward feature. It is not recommended to set it above 25, depending on your PC performance. ",-1)),S1=ps(()=>m("hr",null,null,-1)),A1={class:"buttons"};function O1(e,t,s,i,n,r){const l=V("vue-menu"),a=V("confirm");return u(),c("div",e1,[O(l,{class:"game-mid",items:r.menuItems,modelValue:n.psection,"onUpdate:modelValue":t[8]||(t[8]=o=>n.psection=o)},{sect_settings_main:xt(()=>[m("div",null,[m("label",{for:e.elmId("dark-mode")},"Dark Mode",8,s1),At(m("input",{type:"checkbox",id:e.elmId("dark-mode"),"onUpdate:modelValue":t[0]||(t[0]=o=>r.darkMode=o)},null,8,i1),[[$e,r.darkMode]])]),m("div",null,[m("label",{for:e.elmId("compact-mode")},"Compact Mode",8,n1),At(m("input",{type:"checkbox",id:e.elmId("compact-mode"),"onUpdate:modelValue":t[1]||(t[1]=o=>r.compactMode=o)},null,8,r1),[[$e,r.compactMode]])]),m("div",null,[m("label",{for:e.elmId("smooth-bars")},"Smooth bars",8,l1),At(m("input",{type:"checkbox",id:e.elmId("smooth-bars"),"onUpdate:modelValue":t[2]||(t[2]=o=>r.smoothBars=o)},null,8,a1),[[$e,r.smoothBars]])]),m("div",null,[m("label",{for:e.elmId("auto-save")},"Auto-Save",8,o1),At(m("input",{type:"checkbox",id:e.elmId("auto-save"),"onUpdate:modelValue":t[3]||(t[3]=o=>r.autosave=o)},null,8,h1),[[$e,r.autosave]]),u1])]),sect_settings_extra:xt(()=>[c1,m("div",null,[m("label",{for:e.elmId("debug-rate")},"Expand Resource Rate",8,f1),At(m("input",{type:"checkbox",id:e.elmId("debug-rate"),"onUpdate:modelValue":t[4]||(t[4]=o=>r.debugRate=o)},null,8,d1),[[$e,r.debugRate]]),m1]),m("div",null,[m("label",{for:e.elmId("total-rate")},"Display total task effects",8,p1),At(m("input",{type:"checkbox",id:e.elmId("total-rate"),"onUpdate:modelValue":t[5]||(t[5]=o=>r.totalRate=o)},null,8,g1),[[$e,r.totalRate]]),_1]),y1,m("div",null,[m("label",{for:e.elmId("ensure-max")},"Maximized efficiency mode",8,v1),At(m("input",{type:"checkbox",id:e.elmId("ensure-max"),"onUpdate:modelValue":t[6]||(t[6]=o=>r.ensureMaxProduction=o)},null,8,b1),[[$e,r.ensureMaxProduction]]),k1]),m("div",null,[m("label",{for:e.elmId("speedup-factor")},"Fastforward speed",8,x1),At(m("input",{type:"number",min:"1",max:"1000",required:"",id:e.elmId("speedup-factor"),"onUpdate:modelValue":t[7]||(t[7]=o=>r.speedupFactor=o)},null,8,w1),[[gd,r.speedupFactor]]),T1])]),_:1},8,["items","modelValue"]),S1,m("div",A1,[m("span",null,[O(a,{onConfirm:t[9]||(t[9]=o=>e.dispatch("reset"))},{default:xt(()=>[Jt("Wipe Wizard")]),_:1}),O(a,{onConfirm:t[10]||(t[10]=o=>e.dispatch("resetHall"))},{default:xt(()=>[Jt("Wipe Hall Save")]),_:1})]),m("button",{type:"button",class:"close",onClick:t[11]||(t[11]=(...o)=>r.close&&r.close(...o))},"Close")])])}const M1=yt(t1,[["render",O1],["__scopeId","data-v-d57210f6"]]),C1={data(){let e=0;for(const t in Oi)e|=Oi[t];return{log:v.log,LogTypes:Oi,filter:e,showOptions:!1}},methods:{changed(e){e.checked?this.filter=this.filter|e.value:this.filter=~e.value&this.filter},doOptions(){this.showOptions=!this.showOptions},clearLog(){this.log.clear()}},computed:{visItems(){let e=this.log.items,t=[];for(let i=e.length-1;i>=0;i--){var s=e[i];(!s.type||(this.filter&s.type)>0)&&t.push(s)}return t}}},E1={class:"log-view"},I1={class:"top-span"},D1={class:"checks"},L1=["value","id","checked"],N1=["for"],R1={key:0,class:"options"},P1={class:"outlog"},j1={key:0,class:"log-title item-name"},U1={class:"log-text"},F1={key:0,class:"num-align"};function H1(e,t,s,i,n,r){return u(),c("div",E1,[m("div",I1,[m("button",{type:"button",class:"inline btn-sm",onClick:t[0]||(t[0]=(...l)=>r.clearLog&&r.clearLog(...l))},"Clear"),m("span",D1,[(u(!0),c(tt,null,bt(n.LogTypes,(l,a)=>(u(),c("span",{key:a},[m("input",{type:"checkbox",value:l,id:e.elmId(a),checked:n.filter&l,onChange:t[1]||(t[1]=o=>r.changed(o.target))},null,40,L1),m("label",{for:e.elmId(a)},b(a.toString().toTitleCase()),9,N1)]))),128))]),n.showOptions?(u(),c("div",R1)):g("",!0)]),m("div",P1,[(u(!0),c(tt,null,bt(r.visItems,(l,a)=>(u(),c("div",{class:"log-item",key:a},[m("div",null,[l.title?(u(),c("span",j1,b(l.title),1)):g("",!0)]),m("span",U1,b(l.text),1),l.count>1?(u(),c("span",F1,"(x"+b(l.count)+")",1)):g("",!0)]))),128))])])}const V1=yt(C1,[["render",H1],["__scopeId","data-v-7dbe24ea"]]),qr="all",Br="*";class Gu{get resources(){return this.game.state.resources}get state(){return this.game.state}get items(){return this.game.state.items}constructor(t){this.game=window.game=t,window.debug=this}max(t,s){this.addmax(t,s)}addmax(t,s){if(t===qr||t===Br){for(let i in this.items)this.addmax(i,s);return}this.unlock(t),this.state.addMax(t,s)}ids(t){if(t){const s=this.state[t];return s?s.map(i=>i.id).join(", "):"no such list"}else{const s=[];for(const i in this.items)s.push(i);return s.join(", ")}}apply(t,s){if(t===qr||t===Br)for(let i in this.items)s(this.items[i]);else{let i=this.state.getData(t);if(i)return s(i),!0}return!1}emptyall(){for(let t in this.items){let s=this.items[t];s&&typeof s.amount=="function"&&s.amount(-s.value)}}empty(t){this.apply(t,s=>{typeof s.amount=="function"&&s.amount(-s.value)})}removeall(){for(let t in this.items){let s=this.items[t];s&&s instanceof He&&this.game.remove(s,Number(s.value))}}remove(t,s){return this.apply(t,i=>{this.game.remove(i,Number(s))})}fillall(){const t=this.resources;for(const s in t){const i=t[s];i.locked||this.game.fillItem(i)}}fill(t){return this.apply(t,s=>{s.locked=!1,this.game.fillItem(s)})}addall(t){this.getall(t)}add(t,s){return this.get(t,s)}getall(t){const s=this.resources;for(const i in s){const n=s[i];!n.locked&&n instanceof He&&this.get(n.id,t)}}get(t,s){if(!isNaN(t)){let r=t;t=s,s=r}if(!t)return;if(t===qr||t===Br){this.getall(s);return}let i=this.state.getData(t);if(!i)return;if(i.isRecipe){i.locked=!1,i.disabled=!1,this.game.create(i,!0);return}let n=i.value+s;n>i.max&&(i.max=n),i.amount(Number(s)||1)}lock(t){return this.apply(t,s=>this.game.lock(s))}unlockall(){for(let t in this.items)this.unlock(t)}unlock(t){return this.apply(t,s=>{try{s.locked=!1}catch{return!1}return!0})}help(){window.alert("Printed to console!"),console.log(`Current commands:
(Items refer to any Data items in game: Upgrades, furniture,actions, etc.)
addmax, max - add stat max
get [item|amount] [item|amount] - get quantity of item.
add - same as get
addall [amount] - add quantity to all items.
getall [amount] - same as addall
fill [item] - fill item.
fillall - fill all resources.
emptyall - remove all count of item.
emptyid - remove all of one item type.
help - prints this list into the console.
removeall [amount] - remove quantity from one resource.
remove [item] [amount] - remove quantity of item.
lock [item] - apply lock to item.
unlock [item] - unlock item.
unlockall - unlock all items.`)}}let Wu;{const e={b:"herbs",g:"gold",s:"scrolls",e:"exp",t:"stamina",h:"hp",k:"sp",m:"mana",c:"codices",a:"arcana",r:"research",w:"wizardhall"};Wu={created(){this.debug=window.debug||new Gu(v),window.addEventListener("keydown",t=>{t.repeat||this.cheatKey(t)},!1),this.enabled=!1,this.code="bodias",this.input=""},methods:{cheatKey(t){if(!this.interval)return;let s=document.activeElement;if(s&&s.tagName.toLowerCase()==="input")return;let i=t.key.toLowerCase();if(!this.enabled){this.testUnlock(i);return}let n=e[i];i==="p"?(this.state.getData("runner").autoProgress(),t.stopPropagation()):i==="f"?(this.debug.fillall(),t.stopPropagation()):n&&(t.shiftKey?this.state.addMax(n):this.debug.doFill(n),t.stopPropagation())},testUnlock(t){this.input+=t,this.input===this.code?(console.warn("CHEATS ON"),this.enabled=!0):this.input.length>=this.code.length&&(this.input=this.input.slice(1+this.input.length-this.code.length))}}}}const q1=Wu;class B1{constructor(t){this.context=t,this.history=[],this.hIndex=-1}prevLine(){return++this.hIndex>=this.history.length&&(this.hIndex=this.history.length-1),this.hIndex>=0?this.history[this.hIndex]:""}nextLine(){return--this.hIndex<0?this.hIndex=-1:this.hIndex>=this.history.length&&(this.hIndex=this.history.length-1),this.hIndex>=0?this.history[this.hIndex]:""}parse(t){if(t==null)return!1;this.history.unshift(t),this.history.length>=100&&this.history.pop(),this.hIndex=-1,t=t.toLowerCase();let s=t.split(" ");console.log(this.exec(s,t))}exec(t,s=""){let i=this.context;const n=t.length;for(let r=0;r<n;r++){const l=t[r];if(l==null)return"Invalid Command: "+s;const a=this.getValue(l,i);if(a==null)return"Not found: "+s;if(typeof a=="function")return this.callFunc(i,a,t.slice(r+1));if(typeof a=="object")i=a;else return a}return sub}callFunc(t,s,i){return s.apply(t,i?i.map(this.getValue,this):null)}getValue(t,s=this.context){if(!isNaN(t))return Number(t);let i=t.split("."),n=i.length;for(let r=0;r<n;r++){const l=s[i[r]];if(l===void 0)return t;if(typeof l=="object")s=l;else return l}return s}}const G1=192,W1={data(){return{open:!1}},created(){window.game=v;let e=window.debug||new Gu(v);this.cmdLine=new B1(e),window.addEventListener("keydown",this.onkey)},updated(){this.$refs.cmdInput&&this.$refs.cmdInput.focus()},methods:{toggleView(){this.open=!this.open},onkey(e){e.keyCode===G1&&(this.toggleView(),e.preventDefault())},doCmd(e){this.cmdLine.parse(e)},onpress(e){if(e.keyCode===38)this.$refs.cmdInput.value=this.cmdLine.prevLine();else if(e.keyCode===40)this.$refs.cmdInput.value=this.cmdLine.nextLine();else if(e.keyCode===13){let t=e.target.value;e.target.value="",this.doCmd(t)}}}};function J1(e,t,s,i,n,r){return n.open?(u(),c("input",{key:0,ref:"cmdInput",type:"text",onKeydown:t[0]||(t[0]=(...l)=>r.onpress&&r.onpress(...l))},null,544)):g("",!0)}const K1=yt(W1,[["render",J1]]),z1=30,Oo="As you currently own the Wizard hall, exporting the character file will not allow you to bring any hall progression over. Are you sure you want to export only the character data?",X1={mixins:[Ie,q1],components:{devconsole:K1,resources:Ru,tasks:ju,itempopup:Zk,vitals:j_,log:V1,quickbar:Eg,dots:K_,warn:Ty,topbar:uy,settings:M1,login:pt(()=>gt(()=>import("./login.bundle.js"),__vite__mapDeps([0,1]))),register:pt(()=>gt(()=>import("./register.bundle.js"),[])),activities:pt(()=>gt(()=>import("./activities.bundle.js"),__vite__mapDeps([2,3]))),choice:pt(()=>gt(()=>import("./choice.bundle.js"),__vite__mapDeps([4,5]))),skills:pt(()=>gt(()=>import("./skills.bundle.js"),__vite__mapDeps([6,7,8,9]))),equip:pt(()=>gt(()=>import("./equip.bundle.js"),__vite__mapDeps([10,11]))),craft:pt(()=>gt(()=>import("./crafting.bundle.js"),__vite__mapDeps([12,7,8]))),inventory:pt(()=>gt(()=>import("./inventory.bundle.js"),__vite__mapDeps([13,7,8,14]))),potions:pt(()=>gt(()=>import("./potions.bundle.js"),__vite__mapDeps([15,7,8,16]))),home:pt(()=>gt(()=>import("./home.bundle.js"),__vite__mapDeps([17,7,8,18,19]))),player:pt(()=>gt(()=>import("./player.bundle.js"),__vite__mapDeps([20,18,21]))),bestiary:pt(()=>gt(()=>import("./bestiary.bundle.js"),__vite__mapDeps([22,7,8,23]))),travelogue:pt(()=>gt(()=>import("./travelogue.bundle.js"),__vite__mapDeps([24,7,8,25]))),spells:pt(()=>gt(()=>import("./spells.bundle.js"),__vite__mapDeps([26,7,8,27,28,29]))),adventure:pt(()=>gt(()=>import("./adventure.bundle.js"),__vite__mapDeps([30,18,7,8,31]))),enchanting:pt(()=>gt(()=>import("./enchanting.bundle.js"),__vite__mapDeps([32,7,8,13,14,33]))),minions:pt(()=>gt(()=>import("./minions.bundle.js"),__vite__mapDeps([34,7,8,35]))),scraft:pt(()=>gt(()=>import("./scraft.bundle.js"),__vite__mapDeps([36,7,8,27,28,37]))),glossary:pt(()=>gt(()=>import("./glossary.bundle.js"),__vite__mapDeps([38,7,8,39]))),"vue-menu":Nu},data(){return{displayError:null,timed:!1,debugTimer:[],state:null,psection:null,togRegister:!1,showLogin:!1,togSettings:!1,togActivities:!1}},beforeCreate(){this.loopId=0,this.repeaterId=0,this.repeatEndFunc=null,this.mainLoopTimeout=null},created(){this.Profile=ht,this.listen("load-error",this.onLoadError),this.listen("game-loaded",this.gameLoaded),this.listen("setting",this.onSetting),this.listen("pause",this.pause),this.listen("unpause",this.unpause),this.listen("show-register",this.onShowRegister,this),this.listen("show-login",this.onShowLogin,this)},beforeUnmount(){Ao(),this.endRepeater(),this.removeListener("load-error",this.onLoadError),this.removeListener("game-loaded",this.gameLoaded),this.removeListener("setting",this.onSetting),this.removeListener("pause",this.pause),this.removeListener("unpause",this.unpause),this.removeListener("show-register",this.onShowRegister),this.removeListener("show-login",this.onShowLogin)},methods:{onLoadError(e){this.displayError=e},gameLoaded(){this.state=v.state;let e=it.get("curview")||"sect_main";this.section=this.state.sections.find(t=>t.id===e),this.initEvents()},initEvents(){this.add("save-file-check",this.trySave),this.add("sell",this.onSell),this.add("take",this.onTake),this.add("upgrade",this.onItem),this.add(ir,this.onItem),this.add("spell",this.onItem),this.add("equip",this.onEquip),this.add("unequip",this.onUnequip),this.add("enchant",this.onEnchant),this.add("craft",this.onCraft),this.add("warn",this.onWarn),this.add("showActivities",()=>{this.togActivities=!0}),this.add("repeater",this.makeRepeater,this),this.add("endrepeater",this.endRepeater,this),this.add(zd,this.tryUse),this.add(Xd,this.onUse),this.add("quickslot",this.doQuickslot),this.add(Kd,this.onBuy),this.dispatch(Mi,"titles",this.state.player.titles.length),this.dispatch(Mi,"level",this.state.getData("level").valueOf()),this.dispatch(Mi,"prestige",this.state.getData("prestige").valueOf())},onSetting(e,t){e==="autosave"&&(t?this.startAutoSave():this.stopAutoSave())},onShowLogin(){this.showLogin=!0},onShowRegister(){this.togRegister=!0},stopAutoSave(){if(this.saver){let e=this.saver;this.saver=null,clearInterval(e)}},startAutoSave(){if(!this.isMainLoopActive())return;it.get("autosave"),this.saver||(this.saver=setInterval(()=>this.dispatch("autosave"),1e3*z1))},pause(){this.isMainLoopActive()&&(clearTimeout(this.mainLoopTimeout),this.mainLoopTimeout=null),this.stopAutoSave(),this.endRepeater(),this.keyListen&&window.removeEventListener("keydown",this.keyListen,!1)},makeRepeater(e){this.repeaterId&&(clearInterval(this.repeaterId),this.repeaterId=0),this.repeaterId=setInterval(t=>v.tryItem(t),50,e)},endRepeater(){this.repeaterId&&(clearInterval(this.repeaterId),this.repeaterId=0),this.repeatEndFunc&&(document.removeEventListener("mouseup",this.repeatEndFunc),this.repeatEndFunc=null)},unpause(){v.loaded&&(this.isMainLoopActive()||this.mainLoop(),this.keyListen=e=>{e.repeat||(this.keyDown(e),e.stopPropagation())},window.addEventListener("keydown",this.keyListen,!1),this.startAutoSave())},isMainLoopActive(){return this.mainLoopTimeout},mainLoop(){this.mainLoopLogic(),this.mainLoopTimeout=setTimeout(()=>this.mainLoop(),_r)},mainLoopLogic(){let e=0;if(this.timed&&(e=performance.now(),this.timed<=1&&(this.timed=Date.now())),v.update(),this.timed){const t=this.debugTimer.push(performance.now()-e)-1;let s=this.debugTimer.reduce((i,n)=>i+n);console.log(`frame(${this.debugTimer.length}): ${Q(this.debugTimer[t])}ms	avg: ${Q(s/this.debugTimer.length)}ms	max: ${Q(Math.max(...this.debugTimer))}ms	min: ${Q(Math.min(...this.debugTimer))}ms	`),Date.now()-this.timed>=3e4&&this.finishDebugTiming()}},finishDebugTiming(){console.log(`Done timing! Timed: ${Date.now()-this.timed}ms	Sum of frames: ${Q(this.debugTimer.reduce((e,t)=>e+t))}ms`),this.timed=!1,this.debugTimer.length=0},handleTurboModeChange(){v.isInTurboMode.value=!v.isInTurboMode.value},keyDown(e){if(!this.isMainLoopActive())return;e.key==="t"&&(this.timed?this.finishDebugTiming():this.timed=!0);let t=e.code.slice(0,-1);if(t==="Digit"||t==="Numpad"){let s=Number(e.code.slice(-1));if(e.altKey){v.state.currentSpellLoadout;let i=v.state.spellLoadouts.items[s-1];i!==void 0&&v.state.spellLoadouts.changeLoadout(v.state,i.id)}else if(e.shiftKey&&B.item&&B.item.type!=="encounter")B.item,this.state.setQuickSlot(B.item,s);else{let i=this.state.getQuickSlot(s);i&&this.doQuickslot(i)}}},doQuickslot(e){v.tryItem(e.slotTarget(v))},onEquip(e,t){v.equip(e,t)},onUnequip(e,t){v.unequip(e,t)},onTake(e){v.take(e)},onCraft(e){v.craft(e)},onUse(e,t){v.use(e,t)},onEnchant(e,t){v.tryUseOn(e,t)},onSell(e,t,s){v.trySell(e,t,s)},itemOut:Ao,trySave(e){this.hasHall?this.$refs.warn.show(Oo,null,!0,e):this.dispatch("save-file",e)},onItem(e){e.warn?this.$refs.warn.show(e):v.tryItem(e)},onConfirmed(e,t,s=null){typeof e!="string"&&(e.warn=!t,v.tryItem(e)),typeof e=="string"&&e===Oo&&this.dispatch("save-file",s)},onWarn(e,t){this.$refs.warn.show(e,t)},tryUse(e){v.tryItem(e)},onBuy(e){v.tryBuy(e)}},computed:{hasHall(){return ht.hasHall()},section:{get(){return this.psection},set(e){this.psection=e,e&&it.set("curview",e.id)}},menuItems(){return this.state.sections.filter(e=>!this.locked(e)&&!e.parent)},hall(){return ht.hall},mergedresources(){return this.state.resources.concat(this.hall.resources)},drops(){return v.state.drops},turboButton(){return{backgroundColor:v.isInTurboMode.value?"green":""}}}},Y1={key:1,class:"load-message"},$1={key:2,class:"load-error"},Q1={key:4,class:"load-message"},Z1={key:5,class:"game-main"},tx={class:"inv-equip"};function ex(e,t,s,i,n,r){const l=V("devconsole"),a=V("dots"),o=V("topbar"),h=V("itempopup"),f=V("warn"),_=V("choice"),x=V("register"),T=V("login"),E=V("settings"),U=V("activities"),P=V("resources"),Y=V("tasks"),K=V("skills"),J=V("player"),kt=V("home"),Tt=V("adventure"),Z=V("inventory"),le=V("equip"),te=V("craft"),ri=V("spells"),De=V("scraft"),gs=V("potions"),Ns=V("bestiary"),Rs=V("travelogue"),li=V("minions"),Zi=V("enchanting"),Ct=V("glossary"),ct=V("vue-menu"),rt=V("vitals"),Le=V("log"),Ps=V("quickbar");return u(),c("div",{class:"full",onMouseoverCapture:t[8]||(t[8]=Zt(St=>r.itemOut(St),["stop"]))},[O(l),O(o,{onOpenSettings:t[2]||(t[2]=St=>n.togSettings=!0)},{center:xt(()=>[n.state?(u(),c("button",{key:0,type:"button",onMouseenterCapture:t[0]||(t[0]=Zt(St=>e.itemOver(St,null,null,null,"Use stored time to speed up the game"),["stop"])),onClick:t[1]||(t[1]=(...St)=>r.handleTurboModeChange&&r.handleTurboModeChange(...St)),style:Ui(r.turboButton)}," Fast-forward ",36)):g("",!0),n.state?g("",!0):(u(),c("span",Y1,"LOADING DATA...")),n.displayError?(u(),c("span",$1,"ERROR "+b(n.displayError),1)):g("",!0),n.state?(u(),lt(a,{key:3,dots:n.state.player.dots},null,8,["dots"])):g("",!0)]),_:1}),O(h),O(f,{ref:"warn",onConfirmed:r.onConfirmed},null,8,["onConfirmed"]),O(_),e.Profile.CLOUD&&n.togRegister?(u(),lt(x,{key:0,onClose:t[3]||(t[3]=St=>n.togRegister=!1)})):g("",!0),e.Profile.CLOUD&&n.showLogin?(u(),lt(T,{key:1,onClose:t[4]||(t[4]=St=>n.showLogin=!1)})):g("",!0),n.togSettings?(u(),lt(E,{key:2,onCloseSettings:t[5]||(t[5]=St=>n.togSettings=!1)})):g("",!0),n.togActivities?(u(),lt(U,{key:3,onClose:t[6]||(t[6]=St=>n.togActivities=!1)})):g("",!0),n.displayError?(u(),c("span",Q1," Please try refreshing the page few times. If problem persists, you can seek help through Discord. ")):g("",!0),n.state?(u(),c("div",Z1,[O(P,{items:r.mergedresources},null,8,["items"]),O(ct,{class:"game-mid",items:r.menuItems,modelValue:r.section,"onUpdate:modelValue":t[7]||(t[7]=St=>r.section=St)},{sect_main:xt(()=>[O(Y,{class:"main-tasks"})]),sect_skills:xt(()=>[O(K,{state:n.state},null,8,["state"])]),sect_player:xt(()=>[O(J)]),sect_home:xt(()=>[O(kt,{state:n.state},null,8,["state"])]),sect_raid:xt(()=>[O(Tt,{state:n.state},null,8,["state"])]),sect_loot:xt(()=>[O(Z,{inv:r.drops,take:!0},null,8,["inv"])]),sect_equip:xt(()=>[m("div",tx,[O(le,{equip:n.state.equip},null,8,["equip"]),O(Z,{inv:n.state.inventory},null,8,["inv"])])]),sect_craft:xt(()=>[O(te)]),sect_spells:xt(()=>[O(ri)]),sect_scraft:xt(()=>[O(De)]),sect_potions:xt(()=>[O(gs),O(Z,{inv:n.state.inventory,types:"potion"},null,8,["inv"])]),sect_bestiary:xt(()=>[O(Ns)]),sect_travelogue:xt(()=>[O(Rs)]),sect_minions:xt(()=>[O(li)]),sect_enchant:xt(()=>[O(Zi)]),sect_glossary:xt(()=>[O(Ct)]),_:1},8,["items","modelValue"]),O(rt,{state:n.state},null,8,["state"]),O(Le)])):g("",!0),n.state?(u(),lt(Ps,{key:6,class:"bot-bar",bars:n.state.bars},null,8,["bars"])):g("",!0)],32)}const Mo=yt(X1,[["render",ex],["__scopeId","data-v-1a2e4e32"]]),sx={components:{Confirm:pt(()=>gt(()=>import("./confirm.bundle.js"),__vite__mapDeps([40,41])))},methods:{listen:w.listen,dispatch:w.dispatch,removeListener:w.removeListener,itemOver:Jk,emit:w.emit,add:w.add,elmId(e){return e+this.$.uid}}};console.log=function(){};const Ju=kd({el:"#vueRoot",components:{Main:Mo},data(){return{active:ht.active,renderKey:1}},created(){this.saveLink=null,this.game=v,this.listen("save-file",this.saveFile,this),this.listen("hall-file",this.hallFile,this),this.listen("load-file",this.loadFile,this),this.listen("load",this.loadSave,this),this.listen("reset",this.reset,this),this.listen("resetHall",this.resetHall,this),this.listen("stat",this.doStat,this),this.listen("save-settings",ht.saveSettings,ht),this.listen("set-char",this.setChar,this),this.listen("dismiss-char",this.dismissChar,this),this.listen("save",this.manualSave,this),this.listen("autosave",this.save,this),this.listen("setting",this.onSetting,this),this.listen("logout",this.logout,this),this.listen("login-changed",this.onLoginChanged,this),gr.requestData().then(()=>this.loadHall()).catch(e=>this.onError(e))},methods:{onError(e){console.error(e.message+`
`+e.stack),this.dispatch("load-error",e.message)},onLoginChanged(e){console.log("LOGGED IN: "+e),ht.loggedIn=e,e&&this.loadHall("remote")},logout(){ht.logout()},tryLogin(e,t){},loadHall(e=null){console.log("loading hall type: "+e),this.dispatch("pause"),ht.loadHall(e).then(()=>this.loadSave())},doStat(e,t){},setChar(e){ht.setActive(e,this.game.state),this.loadSave()},dismissChar(e){ht.dismiss(e)},async loadSave(){try{this.dispatch("pause");let e=await ht.loadActive();this.setStateJSON(e)}catch(e){console.error(e.message+`
`+e.stack)}},gameLoaded(e){e||console.warn("gameloaded(): NULL"),this.settingsLoaded(ht.loadSettings()),this.dispatch("game-loaded"),console.log("Begin player id: "+e.state.pid),ht.gameLoaded(e),this.dispatch("unpause")},settingsLoaded(e){e&&(this.onSetting("darkMode",e.darkMode),this.onSetting("compactMode",e.compactMode))},onSetting(e,t){e==="darkMode"?t?(document.body.classList.remove("lightmode"),document.body.classList.add("darkmode")):(document.body.classList.remove("darkmode"),document.body.classList.add("lightmode")):e==="compactMode"&&(t?document.body.classList.add("compact"):document.body.classList.remove("compact"))},saveFile(e){if(e)try{e.preventDefault();let t=this.game.state;this.makeLink(t,t.player.name)}catch(t){console.error(t.message+`
`+t.stack)}},async hallFile(e){if(e){this.save();try{e.preventDefault(),this.hallLink&&URL.revokeObjectURL(this.hallLink);let t=await ht.getHallSave();this.makeLink(t,"hall")}catch(t){console.error(t.message+`
`+t.stack)}}},makeLink(e,t){this.saveLink&&URL.revokeObjectURL(this.saveLink);let s=JSON.stringify(e),i=new Blob([s],{type:"text/json;charset=utf-8"});const n=document.createElement("a");n.download=n.title=t+".json",this.saveLink=URL.createObjectURL(i),n.href=this.saveLink,n.click()},loadFile(e){const t=e[0];if(!t)return;this.dispatch("pause");const s=new FileReader;s.onload=i=>{try{let n=JSON.parse(i.target.result);n.type==="hall"?this.setHallJSON(n):this.setStateJSON(n)}catch(n){console.error(n.message+`
`+n.stack)}},s.readAsText(t)},async setHallJSON(e){await ht.setHallSave(e),this.loadHall()},setStateJSON(e=null){try{this.renderKey++,this.game.load(e,ht.getHallItems()).then(this.gameLoaded,t=>this.onError(t))}catch(t){this.onError(t)}},manualSave(){this.save()},async save(){if(!this.game.loaded)return;await ht.saveActive(this.game.state)?ht.saveHall():(console.warn("ERR ON SAVE. NO SAVE."),alert("ERR ON SAVE. NO SAVE."))},reset(){this.dispatch("pause"),ht.clearActive(),this.setStateJSON(null)},async resetHall(){this.dispatch("pause"),await ht.clearAll(),this.loadHall()}},render(){return zf(Mo,{key:this.renderKey})}});Ju.mixin(sx);const ix=Ju;ix.mount("#vueRoot");export{Ui as $,pt as A,xt as B,Qd as C,ht as D,Nd as E,tt as F,v as G,Ai as H,Ie as I,fe as J,zd as K,Uh as L,Nu as M,Fm as N,Dt as O,Uu as P,as as Q,os as R,it as S,Kd as T,Yi as U,me as V,Ed as W,Id as X,Dd as Y,ke as Z,yt as _,g as a,K_ as a0,ru as a1,ux as a2,$t as a3,Gs as a4,$d as a5,Yd as a6,Un as a7,Qs as a8,Xd as a9,mu as aa,ia as ab,il as ac,bi as ad,Qc as ae,Sr as af,rh as ag,Mi as ah,Ss as ai,_x as aj,gx as ak,px as al,Hp as am,Vp as an,wn as ao,m as b,c,$e as d,Zt as e,yx as f,Ke as g,ze as h,Hu as i,ax as j,O as k,Jt as l,V as m,Pt as n,u as o,fy as p,ox as q,bt as r,hx as s,b as t,lt as u,gd as v,At as w,lx as x,gt as y,Q as z};
