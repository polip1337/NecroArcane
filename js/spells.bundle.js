import{_,I as B,c as p,o as c,b as i,k as v,w,m,v as K,a as O,F as g,r as S,Z as V,G as d,S as h,$ as T,t as k,d as I,u as j}from"./wizrobe.js";import{F as C}from"./filterbox.bundle.js";import{S as P,a as z}from"./spellschool.bundle.js";const A={data(){return Object.assign({min:0,showList:!1,showKeywords:!1,schools:{},keywords:[],spellsBySearch:null},h.getSubVars("spells"))},mixins:[B],components:{filterbox:C,spellschool:z,spelllist:P},created(){const e=this.spells,t={};for(let r=0;r<e.length;r++){const l=e[r];t[l.school]=this.schools[l.school]===!0}this.schools=t;const s=this.allKeywords,o=[];for(let r=0;r<this.keywords.length;r++){const l=this.keywords[r];for(let n in s)if(s[n][l]){o.push(l);break}}this.keywords=o},setup(){return{counter:0}},updated(){this.counter++},methods:{toggleShow(){this.showList=h.setSubVar("spells","showList",!this.showList)},toggleKeywords(){this.showKeywords=h.setSubVar("spells","showKeywords",!this.showKeywords)},toggleSchool(e){this.schools[e]=!this.schools[e],h.setSubVar("spells","schools",this.schools)},toggleAllSchools(){const e=this.spellsBySearch||this.spellsByLevel;let t=!1;for(let s=0;s<e.length;s++)t||(t=!this.schools[e[s].school]);for(let s=0;s<e.length;s++)this.schools[e[s].school]=t;h.setSubVar("spells","schools",this.schools)},getSpellOrder(e){return e.template?e.sortOrder??9999:-9999},searchSpell(e,t){const s=t.split("|");for(let o=0;o<s.length;o++){if(s[o].length==0)continue;const r=s[o].split(" ");let l=!0;for(let n=0;n<r.length;n++){if(r[n].length==0)continue;const u=r[n].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");if(!this.crawlSpell(e,new RegExp(u,"i"))){l=!1;break}}if(l)return!0}return!1},crawlSpell(e,t){if(e.template)return this.crawlTemplate(e.template,t);const s=e.items;for(let o=0;o<s.length;o++)if(this.crawlSpell(s[o],t))return!0;return!1},crawlTemplate(e,t){if(e.dot&&t.test("buffs")||e.summon&&t.test("summons"))return!0;if(e.cost){for(let s in e.cost)if(this.crawlProperty(s,t))return!0}for(let s in e)if(!(s=="desc"||s=="flavor"||s=="require"||s=="buy"||s=="cost"||s=="need"||s=="needtext")&&this.crawlProperty(e[s],t))return!0;return!1},crawlObject(e,t){for(let s in e)if(this.crawlProperty(s,t)||this.crawlProperty(e[s],t))return!0;return!1},crawlProperty(e,t){const s=typeof e;if(s=="object"||s=="array")return this.crawlObject(e,t);s!="string"&&(e=e.toString());const o=e.split(/\.|=|<|>|!|,|&&|\|\||\(|\)|\+|\-|'/);for(let r=0;r<o.length;r++){const l=o[r];if(!/^[0-9\*\~\%]*$/.test(l)){if(/^[a-zA-Z0-9_ ]*$/.test(l)){const n=d.state.getData(l);if(n){if(t.test(n.name))return!0;continue}}if(t.test(l))return!0}}return!1},testSpellKeywords(e,t){if(!e.template){const s=e.items;for(let o=0;o<s.length;o++)if(this.testSpellKeywords(s[o],t))return!0;return!1}if(!e.keywords)return!1;for(let s=0;s<t.length;s++){const o=t[s];let r=!1;for(let l in e.keywords)r||(r=e.keywords[l].includes(o));if(!r)return!1}return!0}},computed:{minLevel:{get(){return this.min},set(e){this.min=h.setSubVar("spells","min",Number(e))}},varKeywords:{get(){return this.keywords},set(e){this.keywords=h.setSubVar("spells","keywords",e)}},state(){return d.state},spells(){return this.state.filterItems(e=>e.type==="spell"&&!this.locked(e)).sort((e,t)=>this.getSpellOrder(e)-this.getSpellOrder(t))},allKeywords(){const e={type:{damage:!1,recovery:!1,buff:!1,debuff:!1,summon:!1},target:{self:!1,ally:!1,enemy:!1},targets:{single:!1,multiple:!1},delivery:{instant:!1,"over time":!1},special:{explore:!1,resource:!1,weapon:!1,stance:!1}},t=this.spells;for(let s=0;s<t.length;s++){const o=t[s].keywords??{};for(let r in o){const l=e[r]??(e[r]={}),n=o[r];for(let u=0;u<n.length;u++)l[n[u]]=!0}}for(let s in e){const o=e[s];for(let r in o)o[r]||delete o[r];Object.keys(o).length==0&&delete e[s]}return e},spellsByKeywords(){const e=this.spells,t=this.keywords;return!t||t.length==0?e:e.filter(s=>this.testSpellKeywords(s,t))},spellsByLevel(){const e=this.spellsByKeywords,t=this.minLevel;return t?e.filter(s=>!t||s.level.valueOf()===t):e},spellBySchools(){const e=this.spellsBySearch||this.spellsByLevel,t={};let s;const o=e.length;for(let r=0;r<o;r++){let l=e[r],n=l.school;s=t[n]||(t[n]=[]),s.push(l)}return t},list(){return d.state.spelllist},currentSpellLoadout(){return d.state.currentSpellLoadout?d.state.currentSpellLoadout:""},spellLoadouts(){return d.state.spellLoadouts},topTier(){for(let e=9;e>=0;e--){let t="tier"+e,s=d.state.items[t];if(s!==void 0&&s.value.value)return e}return 0}}},F={class:"spells"},N={class:"filters"},D={class:"inputgroup"},M=["for"],U=["id"],E={class:"keywordcontainer"},G={class:"keytitle"},Z={class:"keywordgroup"},q=["value","id"],R=["for"],H={class:"buttongroup"},J={class:"bottom"},Q={class:"spellbook"};function W(e,t,s,o,r,l){const n=m("filterbox"),u=m("spellschool"),b=m("spelllist");return c(),p("div",F,[i("div",N,[i("div",D,[v(n,{modelValue:e.spellsBySearch,"onUpdate:modelValue":t[0]||(t[0]=a=>e.spellsBySearch=a),prop:l.searchSpell,items:l.spellsByLevel},null,8,["modelValue","prop","items"]),i("label",{class:"level-lbl",for:e.elmId("level")},"Level",8,M),w(i("input",{class:"level",id:e.elmId("level"),type:"number","onUpdate:modelValue":t[1]||(t[1]=a=>l.minLevel=a),min:"0",size:"5"},null,8,U),[[K,l.minLevel]])]),i("div",E,[e.showKeywords?(c(!0),p(g,{key:0},S(l.allKeywords,(a,f)=>(c(),p("div",{class:"keywords",key:f,style:T({"min-width":Object.keys(a).length*9+"%"})},[i("div",G,[i("b",null,k(f),1)]),i("div",Z,[(c(!0),p(g,null,S(a,(X,y)=>(c(),p("div",{class:"checks",key:y},[w(i("input",{type:"checkbox",value:y,id:e.elmId("chk"+y),"onUpdate:modelValue":t[2]||(t[2]=L=>l.varKeywords=L)},null,8,q),[[I,l.varKeywords]]),i("label",{for:e.elmId("chk"+y)},k(y.toTitleCase()),9,R)]))),128))])],4))),128)):O("",!0)]),i("div",H,[i("button",{type:"button",onClick:t[3]||(t[3]=(...a)=>l.toggleShow&&l.toggleShow(...a))},"Memorized"),i("button",{type:"button",onClick:t[4]||(t[4]=(...a)=>l.toggleKeywords&&l.toggleKeywords(...a))},"Keywords"),i("button",{type:"button",onClick:t[5]||(t[5]=(...a)=>l.toggleAllSchools&&l.toggleAllSchools(...a))},"Toggle Schools")])]),i("div",J,[i("div",Q,[(c(!0),p(g,null,S(l.spellBySchools,(a,f)=>(c(),j(u,{spells:a,school:f,key:f,isOpen:!e.schools[f],onToggleOpen:l.toggleSchool},null,8,["spells","school","isOpen","onToggleOpen"]))),128))]),w(v(b,{class:"spelllist",list:l.list,topTier:l.topTier,spellLoadouts:l.spellLoadouts,currentSpellLoadout:l.currentSpellLoadout},null,8,["list","topTier","spellLoadouts","currentSpellLoadout"]),[[V,e.showList]])])])}const ee=_(A,[["render",W],["__scopeId","data-v-2efe0aeb"]]);export{ee as default};
