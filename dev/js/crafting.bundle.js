import{_ as f,c as n,o as d,a as u,b as p,w as m,t as c,v as b,x as w,F as I,r as V,I as g,k as h,m as v,e as C,C as M,G as k}from"./wizrobe.js";import{F as S}from"./filterbox.bundle.js";const y={emits:["input"],props:["label","options","modelValue","show","pick","disabled","disabledValue","searchable"],emits:["update:modelValue"],data(){return{pshow:this.show||"text",pvar:this.pick||"modelValue",inputData:null}},methods:{text(t){if(!this.pshow||!(t instanceof Object))return t;if(typeof this.pshow=="function")return this.pshow(t);let e=t[this.pshow];return e??t},val(t){if(!this.pvar||!(t instanceof Object))return t;if(typeof this.pvar=="function")return this.pvar(t);let e=t[this.pvar];return e??t}},computed:{selected:{get(){return this.selected},set(t){this.$emit("update:modelValue",t)}},filterOptions(){if(!this.inputData)return this.options;let t=this.options.slice(),e=this.show||"name";for(let l=t.length-1;l>=0;l--)t[l][e].includes(this.inputData)||t.splice(l,1);return t}}},_={class:"dropdown"},O=["for"],x=p("br",null,null,-1),D=["disabled"],N=["id","name","disabled"],j=["value"],B=["value"];function F(t,e,l,i,s,a){return d(),n("div",_,[l.label?(d(),n("label",{key:0,class:"form-label",for:t.elmId("sel")},c(l.label),9,O)):u("",!0),x,this.searchable?m((d(),n("input",{key:1,type:"text",placeholder:"Search...","onUpdate:modelValue":e[0]||(e[0]=r=>s.inputData=r),id:"SearchInput",disabled:this.options.length<=0},null,8,D)),[[b,s.inputData]]):u("",!0),m((d(),n("select",{id:t.elmId("sel"),name:t.elmId("sel"),"onUpdate:modelValue":e[1]||(e[1]=r=>a.selected=r),key:l.options,disabled:this.options.length<=0},[l.disabled?(d(),n("option",{key:0,disabled:"",value:l.disabledValue},c(l.disabled),9,j)):u("",!0),(d(!0),n(I,null,V(a.filterOptions,(r,o)=>(d(),n("option",{value:a.val(r),key:o},c(a.text(r)),9,B))),128))],8,N)),[[w,a.selected]])])}const G=f(y,[["render",F]]),U={mixins:[g],data(){return{selectedSlot:null,selectedMaterial:null,selectedItem:null,itemsView:0,materialsView:0}},components:{filterbox:S,dropdown:G},beforeCreate(){this.game=k},methods:{AssembleItem(t,e){let l=this.prelimCost(t,e);this.game.payCost(l),this.emit(M,t,e)},ClearMaterials(){this.selectedMaterial=null,this.materialsView+=1},ClearItemMaterials(){this.selectedMaterial=null,this.selectedItem=null,this.materialsView+=1,this.itemsView+=1},prelimItem(t,e){let l=e?game.itemGen.instance(e,t):{};l.cost={};let i=1;if(t!=null&&t.cost){t.craftcostmult&&(i*=t.craftcostmult);for(let s in t.cost)l.cost[s]=t.cost[s]}if(e!=null&&e.cost){e.craftcostmult&&(i*=e.craftcostmult);for(let s in e.cost)Object.hasOwn(l.cost,s)?l.cost[s]+=e.cost[s]:l.cost[s]=e.cost[s]}if(i!=1)for(let s in l.cost)l.cost[s]*=i;return l.id||(l.id="item_preview"),l.name||(l.name="item preview"),l},prelimCost(t,e){let l={},i=1;if(t!=null&&t.cost){t.craftcostmult&&(i*=t.craftcostmult);for(let s in t.cost)l[s]=t.cost[s]}if(e!=null&&e.cost){e.craftcostmult&&(i*=e.craftcostmult);for(let s in e.cost)Object.hasOwn(l,s)?l[s]+=e.cost[s]:l[s]=e.cost[s]}if(i!=1)for(let s in l)l[s]*=i;return l},canCraft(t,e){let l=this.prelimCost(t,e);return!!this.game.canPay(l)}},computed:{Slots(){let t=[],e=this.game.state.equip.slots;for(let l in e)this.game.state.armors.filter(i=>!i.blocked()&&i.slot==e[l].id).concat(this.game.state.weapons.filter(i=>!i.blocked()&&i.slot==e[l].id)).length>0&&t.push(e[l]);return t},Items(){let t=[];return this.selectedSlot&&(t=this.game.state.armors.filter(e=>!e.blocked()&&e.slot==this.selectedSlot.id).concat(this.game.state.weapons.filter(e=>!e.blocked()&&e.slot==this.selectedSlot.id))),t},Materials(){let t=[];return this.selectedItem&&(t=this.game.itemGen.getAllCompatible(this.game.itemGen.groups.materials,this.selectedItem,50)),t}}},A=["disabled"];function P(t,e,l,i,s,a){const r=v("dropdown");return d(),n("div",null,[h(r,{label:"Slot",options:a.Slots,onChange:e[0]||(e[0]=o=>a.ClearItemMaterials()),show:"name",disabled:"Not selected",modelValue:s.selectedSlot,"onUpdate:modelValue":e[1]||(e[1]=o=>s.selectedSlot=o),searchable:!0},null,8,["options","modelValue"]),h(r,{label:"Item",options:a.Items,onChange:e[2]||(e[2]=o=>a.ClearMaterials()),show:"name",disabled:"Not selected",modelValue:s.selectedItem,"onUpdate:modelValue":e[3]||(e[3]=o=>s.selectedItem=o),searchable:!0},null,8,["options","modelValue"]),h(r,{label:"Material",options:a.Materials,show:"name",disabled:"Not selected",modelValue:s.selectedMaterial,"onUpdate:modelValue":e[4]||(e[4]=o=>s.selectedMaterial=o),searchable:!0},null,8,["options","modelValue"]),p("button",{onClick:e[5]||(e[5]=o=>this.AssembleItem(this.selectedMaterial,this.selectedItem)),disabled:!this.selectedMaterial||!this.selectedItem||!this.canCraft(this.selectedMaterial,this.selectedItem)||t.game.state.inventory.full(),onMouseenterCapture:e[6]||(e[6]=C(o=>t.itemOver(o,this.prelimItem(this.selectedMaterial,this.selectedItem)),["stop"]))}," Craft ",40,A)])}const q=f(U,[["render",P]]);export{q as default};
